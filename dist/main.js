(()=>{"use strict";var t,e,i,n,s,r,o,a,h,d,c,l,_={91:t=>{t.exports=function(t,e){return e||(e={}),t?(t=String(t.__esModule?t.default:t),e.hash&&(t+=e.hash),e.maybeNeedQuotes&&/[\t\n\f\r "'=<>`]/.test(t)?'"'.concat(t,'"'):t):t}},951:(t,e,i)=>{t.exports=i.p+"83543eec05909a0ca535.png"},282:(t,e,i)=>{t.exports=i.p+"31f5ef0c8dffa5492da6.png"},517:(t,e,i)=>{t.exports=i.p+"3ecd27d9240d163175c1.png"},856:(t,e,i)=>{t.exports=i.p+"857e29fea39a49d24eab.png"},873:(t,e,i)=>{t.exports=i.p+"0d1cb381129368ba84d1.png"},551:(t,e,i)=>{t.exports=i.p+"ef6efa6101e076a26a10.png"},337:(t,e,i)=>{t.exports=i.p+"23da7583e2e60bf72666.png"},302:(t,e,i)=>{t.exports=i.p+"4392c3e322617baf9aa7.png"},794:(t,e,i)=>{t.exports=i.p+"c72adc7afbb90c3d3def.png"},994:(t,e,i)=>{t.exports=i.p+"65a7bd79167e55459bb5.png"}},u={};function f(t){var e=u[t];if(void 0!==e)return e.exports;var i=u[t]={exports:{}};return _[t](i,i.exports,f),i.exports}f.m=_,f.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return f.d(e,{a:e}),e},f.d=(t,e)=>{for(var i in e)f.o(e,i)&&!f.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},f.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),f.p="./dist/",f.b=document.baseURI||self.location.href,(()=>{class t{static checkWebGL(t){const e=["experimental-webgl","webkit-3d","moz-webgl"];var i=t.getContext("webgl",{preserveDrawingBuffer:!0});if(!i)for(var n=0;n<e.length;n++){try{i=t.getContext(e[n],{preserveDrawingBuffer:!0})}catch(t){}if(i)break}return i||alert("WebGL not available. Please use a new version of Chrome or Firefox."),i}static createProgram(e,i,n){var s=e.createProgram(),r=t.getShader(e,e.VERTEX_SHADER,i),o=t.getShader(e,e.FRAGMENT_SHADER,n);if(e.attachShader(s,r),e.attachShader(s,o),e.linkProgram(s),!e.getProgramParameter(s,e.LINK_STATUS)){var a=e.getProgramInfoLog(s);return console.log("Failed to link program: "+a),e.deleteProgram(s),e.deleteShader(o),e.deleteShader(r),null}return s}static renderBuffers(t,e,i,n=null){let s=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let n=0;n<s;++n){let s=t.getActiveAttrib(e,n);if(!s)break;var r=i[s.name],o=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,r.bufferData,t.STATIC_DRAW);var a=t.getAttribLocation(e,s.name);t.enableVertexAttribArray(a),t.vertexAttribPointer(a,r.size,t.FLOAT,!1,0,r.bufferData.BYTES_PER_ELEMENT*r.offset)}if(n){var h=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,h),t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW)}}static bindBuffers(t,e,i,n,s=null){let r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let s=0;s<r;++s){let r=t.getActiveAttrib(e,s);if(!r)break;var o=i[r.name];t.bindBuffer(t.ARRAY_BUFFER,n[r.name]);var a=t.getAttribLocation(e,r.name);t.enableVertexAttribArray(a),t.vertexAttribPointer(a,o.size,t.FLOAT,!1,0,o.bufferData.BYTES_PER_ELEMENT*o.offset)}s&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s)}static initBuffers(t,e,i,n=null){let s=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);var r={};for(let n=0;n<s;++n){let s=t.getActiveAttrib(e,n);if(!s)break;var o=i[s.name];r[s.name]=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,r[s.name]),t.bufferData(t.ARRAY_BUFFER,o.bufferData,t.STATIC_DRAW);var a=t.getAttribLocation(e,s.name);t.enableVertexAttribArray(a),t.vertexAttribPointer(a,o.size,t.FLOAT,!1,0,o.bufferData.BYTES_PER_ELEMENT*o.offset)}var h=null;return n&&(h=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,h),t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW)),[r,h]}static getShader(t,e,i){var n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:(console.log("An error occurred compiling the shaders:"+t.getShaderInfoLog(n)),t.deleteShader(n),null)}}class e{static inCanvas(t){var e=t.clientX,i=t.clientY,n=t.target.getBoundingClientRect();return n.left<=e&&e<n.right&&n.top<=i&&i<n.bottom}static pixelInputToGLCoord(t,e){var i=t.clientX,n=t.clientY,s=e.width/2,r=e.height/2;return{relx:i=(i-e.left-s)/s,rely:n=(r-(n-e.top))/r}}static pixelInputToCanvasCoord(t,e){var i=t.clientX,n=t.clientY,s=e.getBoundingClientRect();return{x:i-=s.left,y:n=s.bottom-n}}static pixelsFromMouseClick(t,i,n){var s=e.pixelInputToCanvasCoord(t,i),r=new Uint8Array(4);return n.readPixels(s.x,s.y,1,1,n.RGBA,n.UNSIGNED_BYTE,r),r}}var i=1e-6,n="undefined"!=typeof Float32Array?Float32Array:Array;function s(){var t=new n(4);return n!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function r(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function o(t,e,i){var n=e[0],s=e[1],r=e[2],o=e[3];return t[0]=i[0]*n+i[4]*s+i[8]*r+i[12]*o,t[1]=i[1]*n+i[5]*s+i[9]*r+i[13]*o,t[2]=i[2]*n+i[6]*s+i[10]*r+i[14]*o,t[3]=i[3]*n+i[7]*s+i[11]*r+i[15]*o,t}function a(){var t=new n(3);return n!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function h(t){var e=t[0],i=t[1],n=t[2];return Math.hypot(e,i,n)}function d(t,e,i){var s=new n(3);return s[0]=t,s[1]=e,s[2]=i,s}function c(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function l(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function _(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function u(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function f(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t}function v(t,e){var i=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2];return Math.hypot(i,n,s)}function p(t,e){var i=e[0],n=e[1],s=e[2],r=i*i+n*n+s*s;return r>0&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function m(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function g(t,e,i){var n=e[0],s=e[1],r=e[2],o=i[0],a=i[1],h=i[2];return t[0]=s*h-r*a,t[1]=r*o-n*h,t[2]=n*a-s*o,t}function x(t,e,i){var n=i[0],s=i[1],r=i[2],o=i[3],a=e[0],h=e[1],d=e[2],c=s*d-r*h,l=r*a-n*d,_=n*h-s*a,u=s*_-r*l,f=r*c-n*_,v=n*l-s*c,p=2*o;return c*=p,l*=p,_*=p,u*=2,f*=2,v*=2,t[0]=a+c+u,t[1]=h+l+f,t[2]=d+_+v,t}function y(t){return t[0]=0,t[1]=0,t[2]=0,t}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),s();var b=v,k=h;function w(){var t=new n(16);return n!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function C(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function M(t,e,i){var n,s,r,o,a,h,d,c,l,_,u,f,v=i[0],p=i[1],m=i[2];return e===t?(t[12]=e[0]*v+e[4]*p+e[8]*m+e[12],t[13]=e[1]*v+e[5]*p+e[9]*m+e[13],t[14]=e[2]*v+e[6]*p+e[10]*m+e[14],t[15]=e[3]*v+e[7]*p+e[11]*m+e[15]):(n=e[0],s=e[1],r=e[2],o=e[3],a=e[4],h=e[5],d=e[6],c=e[7],l=e[8],_=e[9],u=e[10],f=e[11],t[0]=n,t[1]=s,t[2]=r,t[3]=o,t[4]=a,t[5]=h,t[6]=d,t[7]=c,t[8]=l,t[9]=_,t[10]=u,t[11]=f,t[12]=n*v+a*p+l*m+e[12],t[13]=s*v+h*p+_*m+e[13],t[14]=r*v+d*p+u*m+e[14],t[15]=o*v+c*p+f*m+e[15]),t}function z(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function E(t,e,i,n){var s=e[0],r=e[1],o=e[2],a=e[3],h=s+s,d=r+r,c=o+o,l=s*h,_=s*d,u=s*c,f=r*d,v=r*c,p=o*c,m=a*h,g=a*d,x=a*c,y=n[0],b=n[1],k=n[2];return t[0]=(1-(f+p))*y,t[1]=(_+x)*y,t[2]=(u-g)*y,t[3]=0,t[4]=(_-x)*b,t[5]=(1-(l+p))*b,t[6]=(v+m)*b,t[7]=0,t[8]=(u+g)*k,t[9]=(v-m)*k,t[10]=(1-(l+f))*k,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}a();var L;function B(t,e){return t[0]*e[0]+t[1]*e[1]}L=new n(2),n!=Float32Array&&(L[0]=0,L[1]=0);const A=Math.PI;function N(t){return Math.cos(t)}function S(t){return Math.sin(t)}class P{constructor(t=A/4,e=A/4,i=12,n=[0,0,1.5]){this._spherical={theta:t,phi:e,radius:i},this._position=[0,0,0],this._ray={absPos:[0,0,0],normal:[0,0],toWorld:w()},this._transformation=n,this._mView=w(),this._mProj=w(),this._reset=!1,this.updateCameraPos(),this.setRay()}update(t,e,n,s){var r=t.getUniformLocation(e,"mView"),o=t.getUniformLocation(e,"mProj");t.viewport(0,0,n,s),function(t,e,i,n,s){var r,o=1/Math.tan(e/2);t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=s&&s!==1/0?(r=1/(n-s),t[10]=(s+n)*r,t[14]=2*s*n*r):(t[10]=-1,t[14]=-2*n)}(this._mProj,A/4,n/s,1,5*this._spherical.radius),function(t,e,n,s){var r,o,a,h,d,c,l,_,u,f,v=e[0],p=e[1],m=e[2],g=s[0],x=s[1],y=s[2],b=n[0],k=n[1],w=n[2];Math.abs(v-b)<i&&Math.abs(p-k)<i&&Math.abs(m-w)<i?C(t):(l=v-b,_=p-k,u=m-w,r=x*(u*=f=1/Math.hypot(l,_,u))-y*(_*=f),o=y*(l*=f)-g*u,a=g*_-x*l,(f=Math.hypot(r,o,a))?(r*=f=1/f,o*=f,a*=f):(r=0,o=0,a=0),h=_*a-u*o,d=u*r-l*a,c=l*o-_*r,(f=Math.hypot(h,d,c))?(h*=f=1/f,d*=f,c*=f):(h=0,d=0,c=0),t[0]=r,t[1]=h,t[2]=l,t[3]=0,t[4]=o,t[5]=d,t[6]=_,t[7]=0,t[8]=a,t[9]=c,t[10]=u,t[11]=0,t[12]=-(r*v+o*p+a*m),t[13]=-(h*v+d*p+c*m),t[14]=-(l*v+_*p+u*m),t[15]=1)}(this._mView,this._position,[0,0,0],[0,0,1]),M(this._mView,this._mView,this._transformation),t.uniformMatrix4fv(r,!1,this._mView),t.uniformMatrix4fv(o,!1,this._mProj)}resetCam(t,e,i,n){const s=A/4-this._spherical.theta,r=A/4-this._spherical.phi,o=12-this._spherical.radius;s<-A||s>=0?this._spherical.theta+=Math.sqrt(Math.abs(s))/30:this._spherical.theta-=Math.sqrt(Math.abs(s))/30,this._spherical.phi+=Math.sign(r)*Math.sqrt(Math.abs(r))/30,this._spherical.phi=Math.min(Math.max(1e-4,this._spherical.phi),A-1e-4),this._spherical.radius+=o/30;var h=_(a(),[0,0,1.5],this._transformation);f(this._transformation,this._transformation,h,1/30/1.6),Math.abs(s)<.001&&Math.abs(r)<.001&&Math.abs(o)<.01&&k(h)<.01&&(this.reset=!1),this.updateCameraPos(),this.update(t,e,i,n)}updateCameraPos(){this._spherical.theta>2*A&&(this._spherical.theta=this._spherical.theta-2*A),this._spherical.theta<0&&(this._spherical.theta=2*A-this._spherical.theta),this._position[0]=this._spherical.radius*S(this._spherical.phi)*N(this._spherical.theta),this._position[1]=this._spherical.radius*S(this._spherical.phi)*S(this._spherical.theta),this._position[2]=this._spherical.radius*N(this._spherical.phi)}addAngle(t,e){this._spherical.phi=this._spherical.phi-e*Math.sqrt(this._spherical.radius),this._spherical.theta=this._spherical.theta-t*Math.sqrt(this._spherical.radius),this._spherical.phi=Math.min(Math.max(1e-4,this._spherical.phi),A-1e-4),this.updateCameraPos()}addRadius(t){this._spherical.radius+=5e-4*t*this._spherical.radius,this._spherical.radius=Math.min(Math.max(2,this._spherical.radius),35),this.updateCameraPos()}transform(t,e,i){i?this._transformation[2]=this._transformation[2]-S(this._spherical.phi)*e*this._spherical.radius:(this._transformation[0]=this._transformation[0]-S(this._spherical.theta)*t*this._spherical.radius,this._transformation[0]=this._transformation[0]+N(this._spherical.theta)*e*this._spherical.radius,this._transformation[1]=this._transformation[1]+N(this._spherical.theta)*t*this._spherical.radius,this._transformation[1]=this._transformation[1]+S(this._spherical.theta)*e*this._spherical.radius),this._transformation[0]=Math.min(Math.max(-15,this._transformation[0]),15),this._transformation[1]=Math.min(Math.max(-15,this._transformation[1]),15),this._transformation[2]=Math.min(Math.max(-15,this._transformation[2]),15)}setRay(){var t,e,i,n,s,r,o,a,h,d,c,l,u,f,v,p,m,g,x,y,b,k,C,M,z,E,L,B,A,N,S;t=this._ray.toWorld,e=function(t,e,i){var n=e[0],s=e[1],r=e[2],o=e[3],a=e[4],h=e[5],d=e[6],c=e[7],l=e[8],_=e[9],u=e[10],f=e[11],v=e[12],p=e[13],m=e[14],g=e[15],x=i[0],y=i[1],b=i[2],k=i[3];return t[0]=x*n+y*a+b*l+k*v,t[1]=x*s+y*h+b*_+k*p,t[2]=x*r+y*d+b*u+k*m,t[3]=x*o+y*c+b*f+k*g,x=i[4],y=i[5],b=i[6],k=i[7],t[4]=x*n+y*a+b*l+k*v,t[5]=x*s+y*h+b*_+k*p,t[6]=x*r+y*d+b*u+k*m,t[7]=x*o+y*c+b*f+k*g,x=i[8],y=i[9],b=i[10],k=i[11],t[8]=x*n+y*a+b*l+k*v,t[9]=x*s+y*h+b*_+k*p,t[10]=x*r+y*d+b*u+k*m,t[11]=x*o+y*c+b*f+k*g,x=i[12],y=i[13],b=i[14],k=i[15],t[12]=x*n+y*a+b*l+k*v,t[13]=x*s+y*h+b*_+k*p,t[14]=x*r+y*d+b*u+k*m,t[15]=x*o+y*c+b*f+k*g,t}(w(),this._mProj,this._mView),i=e[0],n=e[1],s=e[2],r=e[3],o=e[4],a=e[5],h=e[6],d=e[7],c=e[8],l=e[9],u=e[10],f=e[11],v=e[12],p=e[13],m=e[14],(S=(x=i*a-n*o)*(N=u*(g=e[15])-f*m)-(y=i*h-s*o)*(A=l*g-f*p)+(b=i*d-r*o)*(B=l*m-u*p)+(k=n*h-s*a)*(L=c*g-f*v)-(C=n*d-r*a)*(E=c*m-u*v)+(M=s*d-r*h)*(z=c*p-l*v))&&(S=1/S,t[0]=(a*N-h*A+d*B)*S,t[1]=(s*A-n*N-r*B)*S,t[2]=(p*M-m*C+g*k)*S,t[3]=(u*C-l*M-f*k)*S,t[4]=(h*L-o*N-d*E)*S,t[5]=(i*N-s*L+r*E)*S,t[6]=(m*b-v*M-g*y)*S,t[7]=(c*M-u*b+f*y)*S,t[8]=(o*A-a*L+d*z)*S,t[9]=(n*L-i*A-r*z)*S,t[10]=(v*C-p*b+g*x)*S,t[11]=(l*b-c*C-f*x)*S,t[12]=(a*E-o*B-h*z)*S,t[13]=(i*B-n*E+s*z)*S,t[14]=(p*y-v*k-m*x)*S,t[15]=(c*k-l*y+u*x)*S),_(this._ray.absPos,this._position,this._transformation),function(t,e){var i=e[0],n=e[1],s=i*i+n*n;s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s}(this._ray.normal,[this._position[0],this._position[1]])}get toWorld(){return this._ray.toWorld}get absPos(){return this._ray.absPos}get normal(){return this._ray.normal}get reset(){return this._reset}set reset(t){this._reset=t}}class T{static setLight(t,e,i=[50,50,50]){var n=p(a(),i),s=t.getUniformLocation(e,"uAmbientLight"),r=t.getUniformLocation(e,"uDiffuseLight"),o=t.getUniformLocation(e,"uLightPosition");t.uniform3f(s,.75,.75,.75),t.uniform3f(r,.35,.35,.35),t.uniform3f(o,n[0],n[1],n[2])}}function R(){var t=new n(9);return n!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function D(t,e){var i=e[0],n=e[1],s=e[2],r=e[3],o=e[4],a=e[5],h=e[6],d=e[7],c=e[8],l=e[9],_=e[10],u=e[11],f=e[12],v=e[13],p=e[14],m=e[15],g=i*a-n*o,x=i*h-s*o,y=i*d-r*o,b=n*h-s*a,k=n*d-r*a,w=s*d-r*h,C=c*v-l*f,M=c*p-_*f,z=c*m-u*f,E=l*p-_*v,L=l*m-u*v,B=_*m-u*p,A=g*B-x*L+y*E+b*z-k*M+w*C;return A?(A=1/A,t[0]=(a*B-h*L+d*E)*A,t[1]=(h*z-o*B-d*M)*A,t[2]=(o*L-a*z+d*C)*A,t[3]=(s*L-n*B-r*E)*A,t[4]=(i*B-s*z+r*M)*A,t[5]=(n*z-i*L-r*C)*A,t[6]=(v*w-p*k+m*b)*A,t[7]=(p*y-f*w-m*x)*A,t[8]=(f*k-v*y+m*g)*A,t):null}class j{constructor(t=[.1,.2,.3],e=.1,i=[0,0,0]){this._rad=e,this._SBO=K.check(t),this._state={position:i,mvp:w(),nm:R()},this.updateMat()}draw(t,e){this._SBO.init||this._SBO.initBuffers(t,e);var i=t.getUniformLocation(e,"mWorld"),n=t.getUniformLocation(e,"uNormalMatrix");this._SBO.bindBuffers(t,e),t.uniformMatrix4fv(i,!1,this._state.mvp),t.uniformMatrix3fv(n,!1,this._state.nm),t.drawElements(t.TRIANGLES,this._SBO.numVert,t.UNSIGNED_SHORT,0)}updateMat(){var t,e,i,n,s,r;z(this._state.mvp,this._state.position),t=this._state.mvp,e=this._state.mvp,n=(i=[this._rad,this._rad,this._rad])[0],s=i[1],r=i[2],t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],D(this._state.nm,this._state.mvp)}get color(){return this._SBO.color}get position(){return this._state.position}set position(t){t?(this._state.position=t,this.updateMat()):alert("error in Sphere.ts set position")}changeColor(t){this._SBO=K.check(t)}}j.SBOList=[];class K{constructor(t){this._init=!1,this._color=t;let e,i,n=2*Math.PI/20,s=Math.PI/16;var r,o,a,h,d,c,l=[],_=[],u=[],f=[];for(let t=0;t<=16;++t){i=Math.PI/2-t*s,r=1*Math.cos(i),o=1*Math.sin(i);for(let t=0;t<=20;++t)e=t*n,a=r*Math.cos(e),h=r*Math.sin(e),l.push(a,h,o),_.push(1*a,1*h,1*o),u.push(this._color[0],this._color[1],this._color[2],1)}for(let t=0;t<16;++t){c=20+(d=21*t)+1;for(let e=0;e<20;++e,++d,++c)0!=t&&f.push(d,c,d+1),15!=t&&f.push(d+1,c,c+1)}this._attributes={aColor:{size:4,offset:0,bufferData:new Float32Array(u)},aPosition:{size:3,offset:0,bufferData:new Float32Array(l)},aNormal:{size:3,offset:0,bufferData:new Float32Array(_)}},this._indices=new Uint16Array(f),this._numVert=this._indices.length}initBuffers(e,i){[this._buffers,this._indexBuffer]=t.initBuffers(e,i,this._attributes,this._indices),this._init=!0}bindBuffers(e,i){t.bindBuffers(e,i,this._attributes,this._buffers,this._indexBuffer)}static check(t){var e,i;for(i=0;i<j.SBOList.length;i++)if(e=j.SBOList[i],b(e.color,t)<1e-4)return e;const n=new K(t);return j.SBOList.push(n),n}get color(){return this._color}get init(){return this._init}get numVert(){return this._numVert}}function I(){var t=new n(4);return n!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}var F,U,O,q=(F=a(),U=d(1,0,0),O=d(0,1,0),function(t,e,i){var n=m(e,i);return n<-.999999?(g(F,U,e),k(F)<1e-6&&g(F,O,e),p(F,F),function(t,e,i){i*=.5;var n=Math.sin(i);t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(i)}(t,F,Math.PI),t):n>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(g(F,e,i),t[0]=F[0],t[1]=F[1],t[2]=F[2],t[3]=1+n,function(t,e){var i=e[0],n=e[1],s=e[2],r=e[3],o=i*i+n*n+s*s+r*r;return o>0&&(o=1/Math.sqrt(o)),t[0]=i*o,t[1]=n*o,t[2]=s*o,t[3]=r*o,t}(t,t))});I(),I(),R();class G{constructor(t=[.18,.1,.18],e=[0,0,0],i=[0,0,1]){this._CBO=Y.check(t),this._state={start:e,end:i,rotQuat:I(),scale:a(),mvp:w(),nm:R()},this.updateMat()}draw(t,e){this._CBO.init||this._CBO.initBuffers(t,e);var i=t.getUniformLocation(e,"mWorld"),n=t.getUniformLocation(e,"uNormalMatrix");this._CBO.bindBuffers(t,e),t.uniformMatrix4fv(i,!1,this._state.mvp),t.uniformMatrix3fv(n,!1,this._state.nm),t.drawElements(t.TRIANGLES,this._CBO.numVert,t.UNSIGNED_BYTE,0)}get color(){return this._CBO.color}get start(){return this._state.start}get end(){return this._state.end}updateMat(){_(this._state.scale,this._state.end,this._state.start),q(this._state.rotQuat,[0,0,1],p(a(),this._state.scale)),E(this._state.mvp,this._state.rotQuat,this._state.start,[1,1,h(this._state.scale)]),D(this._state.nm,this._state.mvp)}set start(t){t?(this._state.start=t,this.updateMat()):alert("error in Cylinder.ts set start")}set end(t){t?(this._state.end=t,this.updateMat()):alert("error in Cylinder.ts set end")}changeColor(t){this._CBO=Y.check(t)}}G.CBOList=[];class Y{constructor(t){this._init=!1,this._color=t;let e=0;var i,n,s,r,o,a=[],h=[],d=[],c=[];for(let t=0;t<=1;++t){i=t;for(let t=0,r=0;t<=16;++t,r+=3)e=t/16*2*Math.PI,n=Math.cos(e),s=Math.sin(e),a.push(.03*n,.03*s,i),h.push(n,s,0),d.push(this.color[0],this.color[1],this.color[2],1)}for(let t=0;t<1;++t){o=16+(r=17*t)+1;for(let t=0;t<16;++t,++r,++o)c.push(r,r+1,o),c.push(o,r+1,o+1)}this._attributes={aColor:{size:4,offset:0,bufferData:new Float32Array(d)},aNormal:{size:3,offset:0,bufferData:new Float32Array(h)},aPosition:{size:3,offset:0,bufferData:new Float32Array(a)}},this._indices=new Uint8Array(c),this._numVert=this._indices.length}initBuffers(e,i){[this._buffers,this._indexBuffer]=t.initBuffers(e,i,this._attributes,this._indices),this._init=!0}bindBuffers(e,i){t.bindBuffers(e,i,this._attributes,this._buffers,this._indexBuffer)}static check(t){var e,i;for(i=0;i<G.CBOList.length;i++)if(e=G.CBOList[i],b(e.color,t)<1e-4)return e;const n=new Y(t);return G.CBOList.push(n),n}get color(){return this._color}get init(){return this._init}get numVert(){return this._numVert}}class V{constructor(){this._opacity1=.24,this._opacity2=.4,this._attributes1={aColor:{size:4,offset:0,bufferData:new Float32Array([0,0,0,this._opacity1,0,0,0,this._opacity1,0,0,0,this._opacity1,0,0,0,this._opacity1])},aNormal:{size:3,offset:0,bufferData:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1])},aPosition:{size:3,offset:0,bufferData:new Float32Array([5,5,0,5,-5,0,-5,5,0,-5,-5,0])}},this._indices1=new Uint8Array([0,1,2,1,2,3]),this._attributes2={aColor:{size:4,offset:0,bufferData:new Float32Array([0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2])},aNormal:{size:3,offset:0,bufferData:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1])},aPosition:{size:3,offset:0,bufferData:new Float32Array([5,0,0,-5,0,0,5,.5,0,-5,.5,0,5,1,0,-5,1,0,5,1.5,0,-5,1.5,0,5,2,0,-5,2,0,5,2.5,0,-5,2.5,0,5,3,0,-5,3,0,5,3.5,0,-5,3.5,0,5,4,0,-5,4,0,5,4.5,0,-5,4.5,0,5,-.5,0,-5,-.5,0,5,-1,0,-5,-1,0,5,-1.5,0,-5,-1.5,0,5,-2,0,-5,-2,0,5,-2.5,0,-5,-2.5,0,5,-3,0,-5,-3,0,5,-3.5,0,-5,-3.5,0,5,-4,0,-5,-4,0,5,-4.5,0,-5,-4.5,0,0,5,0,0,-5,0,.5,5,0,.5,-5,0,1,5,0,1,-5,0,1.5,5,0,1.5,-5,0,2,5,0,2,-5,0,2.5,5,0,2.5,-5,0,3,5,0,3,-5,0,3.5,5,0,3.5,-5,0,4,5,0,4,-5,0,4.5,5,0,4.5,-5,0,-.5,5,0,-.5,-5,0,-1,5,0,-1,-5,0,-1.5,5,0,-1.5,-5,0,-2,5,0,-2,-5,0,-2.5,5,0,-2.5,-5,0,-3,5,0,-3,-5,0,-3.5,5,0,-3.5,-5,0,-4,5,0,-4,-5,0,-4.5,5,0,-4.5,-5,0])}},this._state={mvp:w(),nm:R(),n1:this._indices1.length,n2:76},C(this._state.mvp),this._state.nm=D(R(),this._state.mvp)}draw(e,i){this._buffers1||([this._buffers1,this._indexBuffer1]=t.initBuffers(e,i,this._attributes1,this._indices1),[this._buffers2]=t.initBuffers(e,i,this._attributes2));var n=e.getUniformLocation(i,"mWorld"),s=e.getUniformLocation(i,"uNormalMatrix");e.uniformMatrix4fv(n,!1,this._state.mvp),e.uniformMatrix3fv(s,!1,this._state.nm),t.bindBuffers(e,i,this._attributes1,this._buffers1,this._indexBuffer1),e.drawElements(e.TRIANGLES,this._state.n1,e.UNSIGNED_BYTE,0),t.bindBuffers(e,i,this._attributes2,this._buffers2),e.drawArrays(e.LINES,0,this._state.n2)}}class W{constructor(){this._arrows=[new Q([0,0,1]),new Q([0,0,-1])],this._position=[0,0,0]}draw(t,e){this._arrows[0].draw(t,e),this._arrows[1].draw(t,e)}set position(t){if(!t)throw new Error("error in Arrow.ts set position");this._arrows[0].position=t,this._arrows[1].position=t}}class X{constructor(){this._arrows=[new Q([1,0,0]),new Q([-1,0,0]),new Q([0,1,0]),new Q([0,-1,0])],this._position=[0,0,0]}draw(t,e){this._arrows[0].draw(t,e),this._arrows[1].draw(t,e),this._arrows[2].draw(t,e),this._arrows[3].draw(t,e)}set position(t){if(!t)throw new Error("error in Arrow.ts set position");this._arrows[0].position=t,this._arrows[1].position=t,this._arrows[2].position=t,this._arrows[3].position=t}}class Q{constructor(t=[0,0,0]){this._state={mvp:w(),nm:R(),n:0};const e=[.3,.3,.3],i=16,n=.04,s=.08;let r=0;var o=[],h=[],d=[],c=[];const l=q(I(),[0,0,1],t);var _,u,f,v,m,g=a();for(let t=0;t<=1;++t){_=.2*t+.2;for(let t=0,s=0;t<=i;++t,s+=3)r=t/i*2*Math.PI,x(g,[n*(u=Math.cos(r)),n*(f=Math.sin(r)),_],l),o.push(g[0],g[1],g[2]),x(g,[u,f,0],l),h.push(g[0],g[1],g[2]),d.push(e[0],e[1],e[2],.3)}for(let t=0;t<1;++t){m=(v=17*t)+i+1;for(let t=0;t<i;++t,++v,++m)c.push(v,v+1,m),c.push(m,v+1,m+1)}for(let t=0;t<=1;++t){_=.4;for(let a=0,c=0;a<=i;++a,c+=3)r=a/i*2*Math.PI,u=Math.cos(r),f=Math.sin(r),x(g,0==t?[n*u,n*f,_]:[s*u,s*f,_],l),o.push(g[0],g[1],g[2]),x(g,[0,0,-1],l),h.push(g[0],g[1],g[2]),d.push(e[0],e[1],e[2],.3)}for(let t=2;t<3;++t){m=(v=17*t)+i+1;for(let t=0;t<i;++t,++v,++m)c.push(v,v+1,m),c.push(m,v+1,m+1)}for(let t=0;t<=1;++t){_=.2*t+.2+.2;for(let n=0,a=0;n<=i;++n,a+=3)r=n/i*2*Math.PI,u=Math.cos(r),f=Math.sin(r),x(g,0==t?[s*u,s*f,_]:[0,0,_],l),o.push(g[0],g[1],g[2]),x(g,[.2*u,.2*f,s],l),p(g,g),h.push(g[0],g[1],g[2]),d.push(e[0],e[1],e[2],.3)}for(let t=4;t<5;++t){m=(v=17*t)+i+1;for(let t=0;t<i;++t,++v,++m)c.push(v,v+1,m),c.push(m,v+1,m+1)}this._attributes={aColor:{size:4,offset:0,bufferData:new Float32Array(d)},aNormal:{size:3,offset:0,bufferData:new Float32Array(h)},aPosition:{size:3,offset:0,bufferData:new Float32Array(o)}},this._indices=new Uint8Array(c),this._state.n=this._indices.length,C(this._state.mvp),D(this._state.nm,this._state.mvp)}draw(e,i){var n=e.getUniformLocation(i,"mWorld"),s=e.getUniformLocation(i,"uNormalMatrix");t.renderBuffers(e,i,this._attributes,this._indices),e.uniformMatrix4fv(n,!1,this._state.mvp),e.uniformMatrix3fv(s,!1,this._state.nm),e.drawElements(e.TRIANGLES,this._state.n,e.UNSIGNED_BYTE,0)}set position(t){z(this._state.mvp,t),D(this._state.nm,this._state.mvp)}}class H{constructor(){this._opacity=.8,this._color=[.2,.2,.2];var t=[],e=[],i=[];for(let n=0;n<=40;++n)t.push(0,0,.125*n),e.push(0,0,0),i.push(this._color[0],this._color[1],this._color[2],this._opacity);this._attributes={aColor:{size:4,offset:0,bufferData:new Float32Array(i)},aNormal:{size:3,offset:0,bufferData:new Float32Array(e)},aPosition:{size:3,offset:0,bufferData:new Float32Array(t)}},this._state={position:[0,0,0],length:0,mvp:w(),n:0}}draw(e,i){var n=e.getUniformLocation(i,"mWorld");t.renderBuffers(e,i,this._attributes),e.uniformMatrix4fv(n,!1,this._state.mvp),e.drawArrays(e.LINES,0,this._state.n)}set position(t){if(!t)throw new Error("error in Cylinder.ts set start");var e,i;this._state.position[0]=t[0],this._state.position[1]=t[1],this._state.length=t[2],e=this._state.mvp,i=[1,1,Math.sign(this._state.length)],e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,M(this._state.mvp,this._state.mvp,this._state.position),this._state.n=Math.floor(Math.abs(this._state.length)/.125+1.5),this._state.n-=this._state.n%2}}class Z{constructor(){this._nodeStack=new J,this._edgeStack=new J,this._nodeNum=0,this._edgeNum=0,this._isKnot=!1,this._nodeArr=[],this._transform_z=!1,this._selected=null,this._xyPlane=new V,this._planeArrows=new X,this._verticalArrows=new W,this._guide=new H,this._overlapNode=null,this._drawingTool=new et(this),this._drawingTool.initCallback()}deleteData(){this._nodeStack=new J,this._edgeStack=new J,this._nodeNum=0,this._edgeNum=0,this._isKnot=!1,this._nodeArr=[],this._selected=null,this._drawingTool.reset()}insert(){var t=[0,0,0];this.selectedNode&&(t=this.selected.object.position,this._overlapNode=this.selected);const e=this._nodeStack.available();if(e>255)return void alert("Can only have at most 255 Nodes");const i=new tt(t);this._nodeStack.insert(i,e),this.nodeNum++,this._isKnot=!1,this.selected=i}connect(t,e){const i=this._edgeStack.available();if(i>255)alert("Can only have at most 255 Edges");else{var n;if(t.curNext||e.prevCur)if(t.prevCur||e.curNext)if(t.curNext||e.curNext){if(t.prevCur||e.prevCur)return void alert("Nodes can have at most 2 edges");Z.reverse(t),n=new $(t,e)}else Z.reverse(e),n=new $(t,e);else n=new $(e,t);else n=new $(t,e);this._edgeStack.insert(n,i),this.edgeNum++,this.checkKnot()}}subdivide(){if(this.selected instanceof $){const t=this.selected.startNode,e=this.selected.endNode,i=u(a(),l(a(),e.object.position,t.object.position),.5);this.delete(),this.insert(),this.selected.object.position=i,this.connect(this.selected,e),this.connect(t,this.selected),this._verticalArrows.position=this.selected.object.position,this._planeArrows.position=this.selected.object.position}}connected(t,e){return t.next instanceof tt&&(t.next===e.next||t.next===e.prev)||t.prev instanceof tt&&(t.prev===e.next||t.prev===e.prev)}delete(t=this.selected){t instanceof tt?(this._nodeStack.delete(t),this.nodeNum--,t.prevCur&&(this._edgeStack.delete(t.prevCur),this.edgeNum--),t.curNext&&(this._edgeStack.delete(t.curNext),this.edgeNum--),t.delete()):t instanceof $&&(t.delete(),this._edgeStack.delete(t),this.edgeNum--),this.selected=null,this.checkKnot()}static reverse(t){var e,i,n,s=t;if(t.next)do{n=s,s=s.next,null===(e=n.curNext)||void 0===e||e.reverse(),n.reverse()}while(s);else if(t.prev)do{n=s,s=s.prev,null===(i=n.prevCur)||void 0===i||i.reverse(),n.reverse()}while(s)}checkKnot(){if(this.nodeNum==this.edgeNum&&this.nodeNum>2){var t=null;for(let e=0;e<this._nodeStack.data.length;e++)if(null!==this._nodeStack.data[e]){t=this._nodeStack.data[e];break}var e=null==t?void 0:t.next;for(let i=1;i<this.nodeNum;i++){if(!e)return void(this._isKnot=!1);if(t===e)return void(this._isKnot=!1);e=e.next}this._isKnot=!0}else this._isKnot=!1}draw(t,e){var i;for(let n=0;n<this._nodeStack.data.length;n++)(i=this._nodeStack.data[n])&&i.object.draw(t,e);for(let n=0;n<this._edgeStack.data.length;n++)(i=this._edgeStack.data[n])&&i.object.draw(t,e);t.enable(t.BLEND),t.depthMask(!1),this._xyPlane.draw(t,e),this.selectedNode&&(this.transform_z?this._verticalArrows.draw(t,e):this._planeArrows.draw(t,e),this._guide.draw(t,e)),t.disable(t.BLEND),t.depthMask(!0)}get isEmpty(){return 0==this.nodeNum&&0==this.edgeNum}get isKnot(){return this._isKnot}get nodeArr(){var t=null;for(let e=0;e<this._nodeStack.data.length;e++)if(null!==this._nodeStack.data[e]){t=this._nodeStack.data[e];break}var e=null==t?void 0:t.next;this._nodeArr=[],this._nodeArr.push(t.object.position);for(let i=1;i<this.nodeNum;i++){if(!e)return this._isKnot=!1,void alert("not a knot");if(this._nodeArr.push(e.object.position),t===e)return void(this._isKnot=!1);e=e.next}return this._nodeArr}get selectedNode(){return this.selected instanceof tt}get selected(){return this._selected}set selected(t){(this.selected instanceof tt||this.selected instanceof $)&&this.selected.object.changeColor(_(a(),this.selected.object.color,[.18,.18,.18])),this._selected=t,this.selected instanceof tt?(this.selected.object.changeColor(l(a(),this.selected.object.color,[.18,.18,.18])),this._verticalArrows.position=this.selected.object.position,this._planeArrows.position=this.selected.object.position,this._guide.position=this.selected.object.position):this.selected instanceof $&&this.selected.object.changeColor(l(a(),this.selected.object.color,[.18,.18,.18]))}get drawingTool(){return this._drawingTool}get nodeNum(){return this._nodeNum}set nodeNum(t){this._nodeNum=t}get edgeNum(){return this._edgeNum}set edgeNum(t){this._edgeNum=t}get transform_z(){return this._transform_z}set transform_z(t){this._transform_z=t}setDrawState(t){t?(this._nodeStack.data.forEach((function(t){t&&t.object.drawState()})),this._edgeStack.data.forEach((function(t){t&&t.object.drawState()}))):(this._nodeStack.data.forEach((function(t){t&&t.object.readState()})),this._edgeStack.data.forEach((function(t){t&&t.object.readState()})))}btnManager(){if(this.drawingTool.insert)this._overlapNode&&this.selected instanceof tt&&(this.delete(),this.selected=this._overlapNode),this.insert(),this.drawingTool.insert=!0;else if(this.drawingTool.connectFirst){this._overlapNode&&this.selected instanceof tt&&(this.delete(),this.selected=this._overlapNode);const t=this.selected;this.insert(),this.connect(t,this.selected),this.drawingTool.connectFirst=!1}else if(this.drawingTool.connectLast&&this.selected instanceof tt){var t=null;if(this._overlapNode&&(this.selected.prev?t=this.selected.prev:this.selected.next&&(t=this.selected.next),this.delete(),this.selected=this._overlapNode,t&&this.connect(t,this.selected),this.selected.next&&this.selected.prev))return void(this.drawingTool.connectLast=!1);t=this.selected,this.insert(),this.connect(t,this.selected)}}moveNode(t,e,i){var n,s;if(this.selected instanceof tt){var r=a();c(r,this.selected.object.position);const o=_(a(),e,this.selected.object.position);if(this.transform_z){const n=B(i,[o[0],o[1]]);r[2]=t[2]*(-n/B([t[0],t[1]],i))+e[2],r[2]=Math.max(-5,Math.min(5,r[2]))}else{const i=-o[2]/t[2];r[0]=t[0]*i+e[0],r[1]=t[1]*i+e[1],r[0]=Math.max(-5,Math.min(5,r[0])),r[1]=Math.max(-5,Math.min(5,r[1]))}this.selected.object.position=r,(this.drawingTool.insert||this.drawingTool.connectLast)&&(this.overlapping(p(a(),t),e),this._overlapNode&&(this.selected.object.position=this._overlapNode.object.position)),null===(n=this.selected.prevCur)||void 0===n||n.updatePos(),null===(s=this.selected.curNext)||void 0===s||s.updatePos(),this._verticalArrows.position=this.selected.object.position,this._planeArrows.position=this.selected.object.position,this._guide.position=this.selected.object.position}}overlapping(t,e){var i,n,s;if(this.selected instanceof tt)for(let r=0;r<this._nodeStack.data.length;r++)if(i=this._nodeStack.data[r]){if(i===this.selected||i===this.selected.prev||i===this.selected.next||this.connected(i,this.selected))continue;if((!i.prevCur||!i.curNext)&&(n=v(e,i.object.position),s=l(a(),u(a(),t,n),e),v(i.object.position,s)<.25))return void(this._overlapNode=i)}this._overlapNode=null}pickObj(t,e){var i;this._overlapNode=null,this.selected=null;var n=a(),s=100,r=a(),o=a();for(let a=0;a<this._nodeStack.data.length;a++)(i=this._nodeStack.data[a])&&(_(n,i.object.position,e),p(r,t),f(o,n,r,-m(r,n)),h(o)<.12&&s>k(n)&&(this.selected=i,s=k(n)));if(!this.selected)for(let h=0;h<this._edgeStack.data.length;h++)if(i=this._edgeStack.data[h]){if(_(n,i.object.end,i.object.start),g(r,n,t),k(r)<.001)continue;if(_(o,e,i.object.start),p(r,r),Math.abs(m(r,o))<.12){g(r,t,r);const h=m(o,r)/m(r,n);if(h>0&&h<1){const t=_(a(),f(a(),i.object.start,n,h),e);s>k(t)&&(this.selected=i,s=k(t))}}}this.drawingTool.erase?(this.delete(),this.isEmpty&&(this.drawingTool.erase=!1)):this.drawingTool.subdivide&&(this.subdivide(),this.selectedNode&&(this.drawingTool.subdivide=!1))}}class J{constructor(){this._data=[]}insert(t,e){e<this._data.length?this._data[e]=t:this._data.push(t)}free(t){this._data[t]=null}delete(t){for(let e=0;e<this._data.length;e++)this._data[e]===t&&(this._data[e]=null)}available(){for(let t=0;t<this._data.length;t++)if(!this._data[t])return t;return this._data.length}get data(){return this._data}}class ${constructor(t,e){this._startNode=t,this._endNode=e,this._startNode.curNext=this,this._startNode.next=this._endNode,this._endNode.prevCur=this,this._endNode.prev=this._startNode,this._object=new G([.4,.4,.4],this._startNode.object.position,this._endNode.object.position)}delete(){this._startNode.next=null,this._endNode.prev=null,this._startNode.curNext=null,this._endNode.prevCur=null}updatePos(){this.object.start=this._startNode.object.position,this.object.end=this._endNode.object.position}reverse(){const t=this._startNode;this._startNode=this._endNode,this._endNode=t}get object(){return this._object}get startNode(){return this._startNode}set startNode(t){this._startNode=t}get endNode(){return this._endNode}set endNode(t){this._endNode=t}}class tt{constructor(t=d(0,0,0),e=null,i=null){this._object=new j(u(a(),[42,106,209],1/255),.1,t),this._prev=e,this._next=i,this._curNext=null,this._prevCur=null}delete(){var t,e;null===(t=this._prevCur)||void 0===t||t.delete(),null===(e=this._curNext)||void 0===e||e.delete()}reverse(){const t=this._next;this._next=this._prev,this._prev=t;const e=this._curNext;this._curNext=this._prevCur,this._prevCur=e}get object(){return this._object}get next(){return this._next}get prev(){return this._prev}get prevCur(){return this._prevCur}get curNext(){return this._curNext}set next(t){this._next=t}set prev(t){this._prev=t}set prevCur(t){this._prevCur=t}set curNext(t){this._curNext=t}}class et{constructor(t){this._linkedKnot=t,this._overlay=document.getElementById("drawing tool"),this._insertBtn=document.getElementById("insert button"),this._connectBtn=document.getElementById("connect button"),this._subdivideBtn=document.getElementById("subdivide button"),this._eraseBtn=document.getElementById("erase button"),this._insert=!1,this._connectFirst=!1,this._connectLast=!1,this._subdivide=!1,this._erase=!1}initCallback(){this._overlay.addEventListener("mousedown",(t=>{this.resize(t)})),this._insertBtn.addEventListener("click",(()=>{this.insertBtnResponse()})),this._connectBtn.addEventListener("click",(()=>{this.connectBtnResponse()})),this._eraseBtn.addEventListener("click",(()=>{this.eraseBtnResponse()})),this._subdivideBtn.addEventListener("click",(()=>{this.subdivideBtnResponse()}))}reset(){this.insert=!1,this.connectLast=!1,this.subdivide=!1,this.erase=!1}insertBtnResponse(){if(this.linkedKnot.nodeNum>254)alert("cannot have more than 255 nodes");else{if(this.insert=!this.insert,this.insert){if(this.linkedKnot.transform_z=!1,this.connectFirst)return void(this.connectLast=!1);this.connectLast&&this.linkedKnot.delete(),this.linkedKnot.insert()}else this.linkedKnot.delete();this.erase=!1,this.connectLast=!1,this.subdivide=!1}}connectBtnResponse(){this.linkedKnot.nodeNum>254?alert("cannot have more than 255 nodes"):(this.connectLast=!this.connectLast,this.connectLast?(this.linkedKnot.transform_z=!1,this.insert||this.linkedKnot.insert()):this.linkedKnot.delete(),this.insert=!1,this.erase=!1,this.subdivide=!1)}eraseBtnResponse(){this.erase=!this.erase,this.erase&&((this.connectLast||this.insert)&&this.linkedKnot.delete(),this.linkedKnot.selected=null),this.insert=!1,this.connectLast=!1,this.subdivide=!1}subdivideBtnResponse(){this.subdivide=!this.subdivide,this.subdivide&&((this.connectLast||this.insert)&&this.linkedKnot.delete(),this.linkedKnot.selected=null),this.insert=!1,this.connectLast=!1,this.erase=!1}get insert(){return this._insert}set insert(t){this._insert=t,this._insertBtn.classList.toggle("active",t)}set connectLast(t){this._connectLast=t,this._connectFirst=t,this._connectBtn.classList.toggle("active",t)}set connectFirst(t){this._connectFirst=t}get connectLast(){return this._connectLast}get connectFirst(){return this._connectFirst}get subdivide(){return this._subdivide}set subdivide(t){this._subdivide=t,this._subdivideBtn.classList.toggle("active",t)}set erase(t){this._erase=t,this._eraseBtn.classList.toggle("active",t)}get erase(){return this._erase}get linkedKnot(){return this._linkedKnot}Disable(t){this.insert=!1,this.connectLast=!1,this.subdivide=!1,this.erase=!1,!0===t?this._overlay.classList.toggle("hidden",!0):this._overlay.classList.toggle("hidden",!1)}resize(t){t.offsetY>=75&&t.offsetX<240&&t.offsetX>160&&("translate(0px, -80%)"===this._overlay.style.transform?this._overlay.style.transform="translate(0px, -0%)":this._overlay.style.transform="translate(0px, -80%)")}}const it=Math.PI;function nt(t){return Math.cos(t)}function st(t){return Math.sin(t)}class rt{constructor(){this._cosCoef=[],this._sinCoef=[],this._opacity=1,this._attributes={aColor:{size:4,offset:0,bufferData:new Float32Array},aNormal:{size:3,offset:0,bufferData:new Float32Array},aPosition:{size:3,offset:0,bufferData:new Float32Array}},this._indices=new Uint16Array,this._state={mvp:w(),nm:R(),n:0},this._calculated=!1,this._intersecting=!0}deleteData(){this._calculated=!1,this._intersecting=!0}calcFourier(t){var e,i,n=[],s=[],r=t.length,o=0,d=[0,0,0];for(let n=0;n<r;n++){o+=v(e=t[n],i=0==n?t[r-1]:t[n-1]);for(let i=0;i<r;i++){let n=_(a(),e,t[i]);Math.abs(n[0])>d[0]&&(d[0]=Math.abs(n[0])),Math.abs(n[1])>d[1]&&(d[1]=Math.abs(n[1])),Math.abs(n[2])>d[2]&&(d[2]=Math.abs(n[2]))}}const x=10/Math.max(d[0],d[1],d[2]);var b,k=a(),w=a(),M=0,z=a(),E=a();for(let h=1;h<=6;h++){let d=a(),c=a();y(d),y(c);for(let n=0;n<r;n++)b=M,M+=v(e=t[n],i=0==n?t[r-1]:t[n-1]),p(k,_(a(),e,i)),f(w,i,k,-b),l(z,l(a(),u(a(),w,2*it*h*st(2*it*h*M/o)),u(a(),k,2*it*h*M*st(2*it*h*M/o))),u(a(),k,o*nt(2*it*h*M/o))),l(E,l(a(),u(a(),w,2*it*h*st(2*it*h*b/o)),u(a(),k,2*it*h*b*st(2*it*h*b/o))),u(a(),k,o*nt(2*it*h*b/o))),f(d,d,_(a(),z,E),1/(2*it*it*h*h)),l(z,l(a(),u(a(),w,-2*it*h*nt(2*it*h*M/o)),u(a(),k,-2*it*h*M*nt(2*it*h*M/o))),u(a(),k,o*st(2*it*h*M/o))),l(E,l(a(),u(a(),w,-2*it*h*nt(2*it*h*b/o)),u(a(),k,-2*it*h*b*nt(2*it*h*b/o))),u(a(),k,o*st(2*it*h*b/o))),f(c,c,_(a(),z,E),1/(2*it*it*h*h));u(d,d,x),u(c,c,x),n.push(d),s.push(c)}this._cosCoef=n,this._sinCoef=s,this._calculated=!1;var L=[1,0,0];const B=600;var A,N,S,P,T,R=-1,j=[],K=[],I=[],F=[],U=a(),O=a(),q=[0,0,1];for(let t=0;t<=B;t++){p(A=_(a(),this.knot(t/B),this.knot((t+1)/B)),A),h(N=_(a(),q,u(a(),A,m(q,A))))<1e-6&&h(N=_(a(),[0,1,0],u(a(),A,m([0,1,0],A))))<1e-5&&(N=[1,0,0],N=_(a(),N,u(a(),A,m(N,A)))),p(N,N),p(S=g(a(),N,A),S),q=N;for(let e=0;e<=12;e++){const i=e/12*2*Math.PI;l(U,u(a(),N,nt(i)),u(a(),S,st(i))),c(O,U),u(U,U,.035),l(U,U,this.knot(t/B)),j.push(U[0],U[1],U[2]),K.push(O[0],O[1],O[2]),I.push(L[0],L[1],L[2],this._opacity)}t%100==0&&R++,0==R?L[1]+=.01:1==R?L[0]-=.01:2==R?L[2]+=.01:3==R?L[1]-=.01:4==R?L[0]+=.01:5==R&&(L[2]-=.01)}for(let t=0;t<B;++t){T=13+(P=13*t);for(let t=0;t<12;++t,++P,++T)F.push(P,P+1,T),F.push(T,P+1,T+1)}this._attributes.aColor.bufferData=new Float32Array(I),this._attributes.aNormal.bufferData=new Float32Array(K),this._attributes.aPosition.bufferData=new Float32Array(j),this._indices=new Uint16Array(F),C(this._state.mvp),D(this._state.nm,this._state.mvp),this._state.n=this._indices.length,this._intersecting=!0,this.checkIntersection()}knot(t){const e=2*t*it;return l(a(),f(a(),f(a(),f(a(),f(a(),f(a(),u(a(),this._cosCoef[5],nt(6*e)),this._cosCoef[4],nt(5*e)),this._cosCoef[3],nt(4*e)),this._cosCoef[2],nt(3*e)),this._cosCoef[1],nt(2*e)),this._cosCoef[0],nt(e)),f(a(),f(a(),f(a(),f(a(),f(a(),u(a(),this._sinCoef[5],st(6*e)),this._sinCoef[4],st(5*e)),this._sinCoef[3],st(4*e)),this._sinCoef[2],st(3*e)),this._sinCoef[1],st(2*e)),this._sinCoef[0],st(e)))}draw(e,i){this.calculated||([this._buffers,this._indexBuffer]=t.initBuffers(e,i,this._attributes,this._indices),this._calculated=!0);var n=e.getUniformLocation(i,"mWorld"),s=e.getUniformLocation(i,"uNormalMatrix");t.bindBuffers(e,i,this._attributes,this._buffers,this._indexBuffer),e.uniformMatrix4fv(n,!1,this._state.mvp),e.uniformMatrix3fv(s,!1,this._state.nm),e.drawElements(e.TRIANGLES,this._state.n,e.UNSIGNED_SHORT,0)}exportKI(){var t=[];for(let e=0;e<6;e++)t.push(this._cosCoef[e][0],this._cosCoef[e][1],this._cosCoef[e][2],0);for(let e=0;e<6;e++)t.push(this._sinCoef[e][0],this._sinCoef[e][1],this._sinCoef[e][2],0);return new Float32Array(t)}exportKIArr(){var t=[],e=[],i=[],n=[];for(let s=0;s<this._cosCoef.length;s++)t.push(u(a(),this._sinCoef[s],s+1)),e.push(u(a(),this._cosCoef[s],-(s+1))),i.push(u(a(),this._cosCoef[s],-(s+1)*(s+1))),n.push(u(a(),this._sinCoef[s],-(s+1)*(s+1)));return[this._cosCoef,this._sinCoef,t,e,i,n]}checkIntersection(){const t=1200;for(let e=0;e<t;e++)for(let i=e+Math.round(24);i<Math.floor(1152);i++)if(b(this.knot(e/t),this.knot(i/t))<.05)return;this._intersecting=!1}get intersecting(){return this._intersecting}get calculated(){return this._calculated}}class ot{constructor(t=1,e=[.5,.5,.5]){this._CBO=at.check(e,t),this._state={center:[0,0,0],normal:[0,0,1],radius:t,mvp:w(),nm:R()},C(this._state.mvp),D(this._state.nm,this._state.mvp)}setCenterNormalRad(t,e,i){var n;n=i/this._state.radius,E(this._state.mvp,q(I(),[0,0,1],e),t,[n,n,n]),D(this._state.nm,this._state.mvp)}draw(t,e){this._CBO.init||this._CBO.initBuffers(t,e);var i=t.getUniformLocation(e,"mWorld"),n=t.getUniformLocation(e,"uNormalMatrix");this._CBO.bindBuffers(t,e),t.uniformMatrix4fv(i,!1,this._state.mvp),t.uniformMatrix3fv(n,!1,this._state.nm),t.drawElements(t.TRIANGLES,this._CBO.numVert,t.UNSIGNED_SHORT,0)}}ot.CBOList=[];class at{constructor(t,e){this._init=!1,this._color=t,this._majorRad=e;var i=Math.max(Math.min(Math.round(60*Math.sqrt(e)),500),50),n=e,s=[],r=[],o=[],a=[];for(let t=0;t<=10;++t){const e=t/10*2*Math.PI,a=Math.cos(e),h=Math.sin(e),d=n+.02*a;for(let t=0;t<=i;++t){const e=t/i*2*Math.PI,n=Math.cos(e),c=Math.sin(e),l=d*n,_=d*c,u=.02*h;s.push(l,_,u),r.push(n*a,c*a,h),o.push(this._color[0],this._color[1],this._color[2],1)}}const h=i+1;var d,c;for(let t=0;t<10;++t){c=(d=t*h)+h;for(let t=0;t<i;++t,++d,++c)a.push(d,d+1,c),a.push(d+1,c+1,c)}this._attributes={aColor:{size:4,offset:0,bufferData:new Float32Array(o)},aNormal:{size:3,offset:0,bufferData:new Float32Array(r)},aPosition:{size:3,offset:0,bufferData:new Float32Array(s)}},this._indices=new Uint16Array(a),this._numVert=this._indices.length}initBuffers(e,i){[this._buffers,this._indexBuffer]=t.initBuffers(e,i,this._attributes,this._indices),this._init=!0}bindBuffers(e,i){t.bindBuffers(e,i,this._attributes,this._buffers,this._indexBuffer)}static check(t,e){var i,n;for(n=0;n<ot.CBOList.length;n++)if(i=ot.CBOList[n],b(i.color,t)<1e-4&&Math.abs(i.radius-e)<.001)return i;const s=new at(t,e);return ot.CBOList.push(s),s}get color(){return this._color}get init(){return this._init}get numVert(){return this._numVert}get radius(){return this._majorRad}}class ht{constructor(){this._loader=document.getElementById("loader"),this._text=document.getElementById("loader text"),this._quit=document.getElementById("quit"),this._doubleCheck={overlay:document.getElementById("double check"),confirm:document.getElementById("confirm"),cancel:document.getElementById("cancel")},this._cancel=!1}initCallback(){this._quit.addEventListener("click",(()=>{this.quitBtnResponse()})),this._doubleCheck.confirm.addEventListener("click",(()=>{this.confirmBtnResponse()})),this._doubleCheck.cancel.addEventListener("click",(()=>{this.cancelBtnResponse()}))}quitBtnResponse(){this._doubleCheck.overlay.classList.toggle("hidden",!1)}confirmBtnResponse(){this._doubleCheck.overlay.classList.toggle("hidden",!0),this._cancel=!0}cancelBtnResponse(){this._doubleCheck.overlay.classList.toggle("hidden",!0),this._cancel=!1}load(t){this.text="",this._loader.classList.toggle("hidden",!t),this._doubleCheck.overlay.classList.toggle("hidden",!0),this._cancel=!1}set text(t){this._text.textContent=t}get cancel(){return this._cancel}}class dt{constructor(t,e=0){this._resetValue=e,this._value=e;const i=document.getElementById(t);this._button=i.querySelector(".dropbtn"),this._button.addEventListener("focus",(()=>{this._overlay.classList.toggle("hidden",!1)})),this._button.addEventListener("blur",(()=>{this._overlay.classList.toggle("hidden",!0)})),this._overlay=i.querySelector(".content"),this._resetStr=this._button.textContent?this._button.textContent:"";const n=i.querySelectorAll(".element");this._element=[];for(let t=0;t<n.length;t++){let e=n[t];this._element.push(e),e.addEventListener("mousedown",(()=>{this.value=Number(e.getAttribute("value")),this._overlay.classList.toggle("hidden",!0),this._button.textContent=e.textContent}))}this.reset()}reset(){this.value=this._resetValue,this._overlay.classList.toggle("hidden",!0),this._button.textContent=this._resetStr}set value(t){t=t||this._resetValue,this._value=t}get value(){return this._value}}var ct=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};const lt=Math.PI;function _t(t){return Math.cos(t)}function ut(t){return Math.sin(t)}class ft{constructor(){this._bufferSize=0,this._calc={error_field:1e-7,ACPolyAve:0},this._frames=[],this._cosCoef=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],this._sinCoef=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],this._dcosCoef=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],this._dsinCoef=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],this._d2cosCoef=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],this._d2sinCoef=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],this._circles=new Array(80);for(let t=0;t<80;t++)this._circles[t]=new ot(Math.pow(2,(t-10)/5),[.5,.5,.5]);this._spheres={red:new j([1,0,0],.1),black:new j([.2,.2,.2],.08)},this._calculated=!1,this._player=new yt,this._player.initCallback()}deleteData(){this._player.reset(),this._frames=[],this.calculated=!1}Initialize(){return ct(this,void 0,void 0,(function*(){if(!navigator.gpu)throw new Error("WebGPU not supported.");if(this._adapter=yield navigator.gpu.requestAdapter({powerPreference:"high-performance"}),!this._adapter)throw new Error("Couldn't request WebGPU adapter.");const t=yield this._adapter.requestAdapterInfo();console.log(t.architecture),console.log(t.description),console.log(t.device),console.log(t.vendor),this._device=yield this._adapter.requestDevice()}))}initKnot(t){this._cosCoef=t[0],this._sinCoef=t[1],this._dcosCoef=t[2],this._dsinCoef=t[3],this._d2cosCoef=t[4],this._d2sinCoef=t[5]}get calculated(){return this._calculated}set calculated(t){this._calculated=t}findCircles(t,e,i,n,s){return ct(this,void 0,void 0,(function*(){s.text=(0).toFixed(1)+" %",this._bufferSize=29925*n/2/40,this._frames=new Array(n);var r=new Array(n);this._bindGroupLayout=this._device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}}]});const o=this._device.createShaderModule({code:"\r\n\r\n\r\nstruct fourier_series {\r\n    cos : array<vec3f, 6>,\r\n    sin : array<vec3f, 6>,\r\n};\r\n\r\n\r\n@group(0) @binding(0)var<uniform> knot_info: fourier_series;\r\n@group(0) @binding(1)var<storage, read> tlist: array<f32>;\r\n@group(0) @binding(2)var<storage, read_write> output: array<f32>;\r\n\r\n\r\nconst PI : f32 = 3.1415926535897932384626433832795;\r\nconst error_field : f32 = 0.0025;\r\nconst grad_stop_double : f32 = 0.00001;\r\nconst ptol_stop_double : f32 = 0.001;\r\n\r\nconst MAX_ITER : i32 = 150;\r\noverride BUFFER_SIZE : u32 = 5985 * 100;\r\n\r\nvar<workgroup> t_i : array<array<f32, 5>, 16>;\r\n\r\nvar<workgroup> abort : array<bool, 16>;\r\n\r\nvar<workgroup> vv : array<array<vec3f, 16>, 16>;\r\nvar<workgroup> nv : array<array<f32, 16>, 16>;\r\nvar<workgroup> dv : array<array<vec3f, 4>, 16>;\r\nvar<workgroup> d2v : array<array<vec3f, 4>, 16>;\r\n\r\nvar<workgroup> ptol : array<f32, 16>;\r\nvar<workgroup> grad : array<array<f32, 4>, 16>;\r\nvar<workgroup> hess : array<array<f32, 16>, 16>;\r\n\r\n\r\nvar<workgroup> diff : array<array<f32, 4>, 16>;\r\nvar<workgroup> backtrack : array<array<u32, 16>, 16>;\r\n\r\n\r\nfn set_variables(x_index : u32, z_index : u32){\r\n\r\n    for(var i : u32 = 0; i<4; i++){\r\n        vv[z_index][x_index + 4*i] = (\r\n            knotc(t_i[z_index][x_index + 1]) \r\n            - knotc(t_i[z_index][i])\r\n        );\r\n    }\r\n\r\n    vv[z_index][9] = -vv[z_index][11];\r\n    vv[z_index][14] = -vv[z_index][15];\r\n\r\n    for(var i : u32 = 0; i<4; i++){\r\n        nv[z_index][x_index + 4*i] = length(vv[z_index][x_index + 4*i]);\r\n    }\r\n\r\n\r\n    if(\r\n        (nv[z_index][0] < error_field) ||\r\n        (nv[z_index][1] < error_field) ||\r\n        (nv[z_index][2] < error_field) ||\r\n        (nv[z_index][3] < error_field) ||\r\n        (nv[z_index][5] < error_field) ||\r\n        (nv[z_index][6] < error_field) ||\r\n        (nv[z_index][10] < error_field) ||\r\n        (nv[z_index][11] < error_field) ||\r\n        (nv[z_index][15] < error_field)){\r\n        abort[z_index] = true;\r\n    }\r\n\r\n\r\n    ptol[z_index] = nv[z_index][2]*nv[z_index][5]+nv[z_index][6]*nv[z_index][1]-nv[z_index][0]*nv[z_index][10] \r\n                    +nv[z_index][2]*nv[z_index][11]+nv[z_index][1]*nv[z_index][15]-nv[z_index][3]*nv[z_index][10];\r\n\r\n\r\n    dv[z_index][x_index] = knotd(t_i[z_index][x_index + 1]);\r\n    d2v[z_index][x_index] = knotd2(t_i[z_index][x_index + 1]);\r\n\r\n}\r\n    \r\nfn grad_compute(x : u32, z_index : u32){\r\n\r\n    var sgn : array<f32, 3>;\r\n\r\n    var index1 : array<u32, 3>;\r\n    var index2 : array<u32, 3>;\r\n\r\n    let dvv : vec3f = dv[z_index][x];\r\n\r\n    index2[0] = 1;\r\n\r\n    switch x {\r\n        case 0: {\r\n            index1[0] = 10;   index1[1] = 2;   index1[2] = 1;\r\n            index2[0] = 0;   index2[1] = 8;   index2[2] = 12;\r\n            sgn[0] = f32(-1);   sgn[1] = f32(1);   sgn[2] = f32(1);\r\n\r\n        }\r\n        case 1: {\r\n            index1[0] = 6;   index1[1] = 0;   index1[2] = 2;\r\n            index2[0] = 1;   index2[1] = 13;   index2[2] = 5;\r\n            sgn[0] = f32(1);   sgn[1] = f32(-1);   sgn[2] = f32(1);\r\n\r\n        }\r\n        case 2: {\r\n            index1[0] = 5;   index1[1] = 1;   index1[2] = 0;\r\n            index2[0] = 2;   index2[1] = 6;   index2[2] = 10;\r\n            sgn[0] = f32(1);   sgn[1] = f32(1);   sgn[2] = f32(-1);\r\n\r\n        }\r\n        default {\r\n            sgn[0] = f32(0);   sgn[1] = f32(0);   sgn[2] = f32(0);\r\n        }\r\n    }\r\n\r\n    \r\n\r\n    let dptol1423 : f32= (\r\n        sgn[0]*(nv[z_index][index1[0]]/nv[z_index][index2[0]])*dot(vv[z_index][index2[0]],dvv) \r\n        + sgn[1]*(nv[z_index][index1[1]]/nv[z_index][index2[1]])*dot(vv[z_index][index2[1]],dvv)\r\n        + sgn[2]*(nv[z_index][index1[2]]/nv[z_index][index2[2]])*dot(vv[z_index][index2[2]],dvv)\r\n    );\r\n\r\n    switch x {\r\n        case 1: {\r\n            index1[0] = 3;   index1[1] = 2;   index1[2] = 15;\r\n            index2[0] = 13;   index2[1] = 9;   index2[2] = 1;\r\n            sgn[0] = f32(-1);   sgn[1] = f32(1);   sgn[2] = f32(1);\r\n\r\n        }\r\n        case 2: {\r\n            index1[0] = 1;   index1[1] = 3;   index1[2] = 11;\r\n            index2[0] = 14;   index2[1] = 10;   index2[2] = 2;\r\n            sgn[0] = f32(1);   sgn[1] = f32(-1);   sgn[2] = f32(1);\r\n\r\n        }\r\n        case 3: {\r\n            index1[0] = 2;   index1[1] = 1;   index1[2] = 10;\r\n            index2[0] = 11;   index2[1] = 15;   index2[2] = 3;\r\n            sgn[0] = f32(1);   sgn[1] = f32(1);   sgn[2] = f32(-1);\r\n\r\n        }\r\n        default {\r\n            sgn[0] = f32(0);   sgn[1] = f32(0);   sgn[2] = f32(0);\r\n        }\r\n    }\r\n\r\n\r\n    let dptol1453 : f32 = (\r\n        sgn[0]*(nv[z_index][index1[0]]/nv[z_index][index2[0]])*dot(vv[z_index][index2[0]],dvv) \r\n        + sgn[1]*(nv[z_index][index1[1]]/nv[z_index][index2[1]])*dot(vv[z_index][index2[1]],dvv)\r\n        + sgn[2]*(nv[z_index][index1[2]]/nv[z_index][index2[2]])*dot(vv[z_index][index2[2]],dvv)\r\n    );\r\n\r\n\r\n    grad[z_index][x] = dptol1423 + dptol1453;\r\n\r\n}\r\n\r\nfn hess_compute(x : u32, z_index : u32){\r\n\r\n    var sgn : array<f32, 3>;\r\n    \r\n    var index1 : array<u32, 2>;\r\n    var index2 : array<u32, 2>;\r\n    var index3 : array<u32, 2>;\r\n\r\n    let dvv : vec3f = dv[z_index][x];\r\n    let dvdv : f32 = dot(dvv,dvv);\r\n    let d2vv : vec3f = d2v[z_index][x];\r\n    \r\n    index1[1] = 1;\r\n\r\n\r\n    switch x {\r\n        case 0: {\r\n            index1[0] = 10;     index1[1] = 0;\r\n            index2[0] = 2;      index2[1] = 8;      \r\n            index3[0] = 1;      index3[1] = 12;\r\n            sgn[0] = f32(-1);   sgn[1] = f32(1);   sgn[2] = f32(1);\r\n\r\n        }\r\n        case 1: {\r\n            index1[0] = 6;     index1[1] = 1;\r\n            index2[0] = 0;      index2[1] = 13;      \r\n            index3[0] = 2;      index3[1] = 5;\r\n            sgn[0] = f32(1);   sgn[1] = f32(-1);   sgn[2] = f32(1);\r\n\r\n        }\r\n        case 2: {\r\n            index1[0] = 5;     index1[1] = 2;\r\n            index2[0] = 1;      index2[1] = 6;      \r\n            index3[0] = 0;      index3[1] = 10;\r\n            sgn[0] = f32(1);   sgn[1] = f32(1);   sgn[2] = f32(-1);\r\n\r\n        }\r\n        default {\r\n            sgn[0] = f32(0);   sgn[1] = f32(0);   sgn[2] = f32(0);\r\n        }\r\n    }\r\n    \r\n\r\n    let d2ptol1423_diag : f32 = (\r\n        sgn[0]*(nv[z_index][index1[0]]/nv[z_index][index1[1]])*(dot(vv[z_index][index1[1]],d2vv) + dvdv - pow(dot(vv[z_index][index1[1]],dvv), f32(2))/(pow(nv[z_index][index1[1]], f32(2))))\r\n        + sgn[1]*(nv[z_index][index2[0]]/nv[z_index][index2[1]])*(dot(vv[z_index][index2[1]],d2vv) + dvdv - pow(dot(vv[z_index][index2[1]],dvv), f32(2))/(pow(nv[z_index][index2[1]], f32(2))))\r\n        + sgn[2]*(nv[z_index][index3[0]]/nv[z_index][index3[1]])*(dot(vv[z_index][index3[1]],d2vv) + dvdv - pow(dot(vv[z_index][index3[1]],dvv), f32(2))/(pow(nv[z_index][index3[1]], f32(2))))\r\n    );\r\n\r\n    switch x {\r\n        case 1: {\r\n            index1[0] = 3;     index1[1] = 13;\r\n            index2[0] = 2;      index2[1] = 9;      \r\n            index3[0] = 15;      index3[1] = 1;\r\n            sgn[0] = f32(-1);   sgn[1] = f32(1);   sgn[2] = f32(1);\r\n\r\n        }\r\n        case 2: {\r\n            index1[0] = 1;     index1[1] = 14;\r\n            index2[0] = 3;      index2[1] = 10;      \r\n            index3[0] = 11;      index3[1] = 2;\r\n            sgn[0] = f32(1);   sgn[1] = f32(-1);   sgn[2] = f32(1);\r\n\r\n        }\r\n        case 3: {\r\n            index1[0] = 2;     index1[1] = 11;\r\n            index2[0] = 1;      index2[1] = 15;      \r\n            index3[0] = 10;      index3[1] = 3;\r\n            sgn[0] = f32(1);   sgn[1] = f32(1);   sgn[2] = f32(-1);\r\n\r\n        }\r\n        default {\r\n            sgn[0] = f32(0);   sgn[1] = f32(0);   sgn[2] = f32(0);\r\n        }\r\n    }\r\n    \r\n\r\n    let d2ptol1453_diag : f32 = (\r\n        sgn[0]*(nv[z_index][index1[0]]/nv[z_index][index1[1]])*(dot(vv[z_index][index1[1]],d2vv) + dvdv - pow(dot(vv[z_index][index1[1]],dvv), f32(2))/(pow(nv[z_index][index1[1]], f32(2))))\r\n        + sgn[1]*(nv[z_index][index2[0]]/nv[z_index][index2[1]])*(dot(vv[z_index][index2[1]],d2vv) + dvdv - pow(dot(vv[z_index][index2[1]],dvv), f32(2))/(pow(nv[z_index][index2[1]], f32(2))))\r\n        + sgn[2]*(nv[z_index][index3[0]]/nv[z_index][index3[1]])*(dot(vv[z_index][index3[1]],d2vv) + dvdv - pow(dot(vv[z_index][index3[1]],dvv), f32(2))/(pow(nv[z_index][index3[1]], f32(2))))\r\n    );\r\n\r\n    hess[z_index][x + 4*x] = d2ptol1423_diag + d2ptol1453_diag;\r\n\r\n    \r\n    var xindex : u32 = 1;\r\n    var yindex : u32 = 1;\r\n\r\n\r\n\r\n    switch x {\r\n        case 1: {\r\n            // block index 1\r\n            index1[0] = 2;    index1[1] = 5;\r\n            index2[0] = 10;    index2[1] = 0;    \r\n            index3[0] = 1;    index3[1] = 6;  \r\n            xindex = 1;\r\n            yindex = 0;\r\n            sgn[0] = f32(-1);   sgn[1] = f32(1);   sgn[2] = f32(-1);        \r\n\r\n        }\r\n        case 2: {\r\n            // block index 2\r\n            index1[0] = 1;    index1[1] = 6;\r\n            index2[0] = 10;    index2[1] = 0;    \r\n            index3[0] = 2;    index3[1] = 5;    \r\n            xindex = 2;\r\n            yindex = 0;\r\n            sgn[0] = f32(-1);   sgn[1] = f32(-1);   sgn[2] = f32(-1);        \r\n\r\n        }\r\n        case 3: {\r\n            // block index 6\r\n            index1[0] = 0;    index1[1] = 10;\r\n            index2[0] = 6;    index2[1] = 1;    \r\n            index3[0] = 2;    index3[1] = 5;    \r\n            xindex = 2;\r\n            yindex = 1;\r\n            sgn[0] = f32(1);   sgn[1] = f32(1);   sgn[2] = f32(1);        \r\n\r\n        }\r\n        default {\r\n            sgn[0] = f32(0);   sgn[1] = f32(0);   sgn[2] = f32(0);\r\n        }\r\n    }\r\n    \r\n\r\n    let d2ptol1423_non_diag : f32 = (\r\n        sgn[0]*(nv[z_index][index1[0]]/nv[z_index][index1[1]])*(dot(dv[z_index][xindex],dv[z_index][yindex]) - dot(vv[z_index][index1[1]],dv[z_index][xindex])*dot(vv[z_index][index1[1]],dv[z_index][yindex])/(nv[z_index][index1[1]]*nv[z_index][index1[1]]))\r\n        + sgn[1]/(nv[z_index][index2[0]]*nv[z_index][index2[1]])*dot(vv[z_index][index2[0]],dv[z_index][xindex])*dot(vv[z_index][index2[1]],dv[z_index][yindex])\r\n        + sgn[2]/(nv[z_index][index3[0]]*nv[z_index][index3[1]])*dot(vv[z_index][index3[0]],dv[z_index][xindex])*dot(vv[z_index][index3[1]],dv[z_index][yindex])\r\n    );\r\n\r\n\r\n\r\n    switch x {\r\n        case 3: {\r\n            // block index 6\r\n            index1[0] = 3;    index1[1] = 10;\r\n            index2[0] = 2;    index2[1] = 11;    \r\n            index3[0] = 15;    index3[1] = 1;   \r\n            xindex = 2;\r\n            yindex = 1; \r\n            sgn[0] = f32(1);   sgn[1] = f32(-1);   sgn[2] = f32(-1);        \r\n\r\n        }\r\n        case 2: {\r\n            // block index 7\r\n            index1[0] = 2;    index1[1] = 11;\r\n            index2[0] = 3;    index2[1] = 10;    \r\n            index3[0] = 15;    index3[1] = 1;    \r\n            xindex = 3;\r\n            yindex = 1;\r\n            sgn[0] = f32(-1);   sgn[1] = f32(1);   sgn[2] = f32(1);        \r\n\r\n        }\r\n        case 1: {\r\n            // block index 11\r\n            index1[0] = 1;    index1[1] = 15;\r\n            index2[0] = 3;    index2[1] = 10;    \r\n            index3[0] = 11;    index3[1] = 2;   \r\n            xindex = 3;\r\n            yindex = 2; \r\n            sgn[0] = f32(-1);   sgn[1] = f32(-1);   sgn[2] = f32(1);        \r\n\r\n        }\r\n        default {\r\n            sgn[0] = f32(0);   sgn[1] = f32(0);   sgn[2] = f32(0);\r\n        }\r\n    }\r\n    \r\n\r\n    let d2ptol1453_non_diag : f32 = (\r\n        sgn[0]*(nv[z_index][index1[0]]/nv[z_index][index1[1]])*(dot(dv[z_index][xindex],dv[z_index][yindex]) - dot(vv[z_index][index1[1]],dv[z_index][xindex])*dot(vv[z_index][index1[1]],dv[z_index][yindex])/(nv[z_index][index1[1]]*nv[z_index][index1[1]]))\r\n        + sgn[1]/(nv[z_index][index2[0]]*nv[z_index][index2[1]])*dot(vv[z_index][index2[0]],dv[z_index][xindex])*dot(vv[z_index][index2[1]],dv[z_index][yindex])\r\n        + sgn[2]/(nv[z_index][index3[0]]*nv[z_index][index3[1]])*dot(vv[z_index][index3[0]],dv[z_index][xindex])*dot(vv[z_index][index3[1]],dv[z_index][yindex])\r\n    );\r\n\r\n\r\n    switch x {\r\n        case 3: {\r\n            hess[z_index][6] = d2ptol1423_non_diag + d2ptol1453_non_diag;\r\n            hess[z_index][9] = hess[z_index][6];\r\n        }\r\n        case 2: {\r\n            hess[z_index][2] = d2ptol1423_non_diag;\r\n            hess[z_index][7] = d2ptol1453_non_diag;\r\n            hess[z_index][8] = hess[z_index][2];\r\n            hess[z_index][13] = hess[z_index][7];\r\n\r\n        }\r\n        case 1: {\r\n            hess[z_index][1] = d2ptol1423_non_diag;\r\n            hess[z_index][11] = d2ptol1453_non_diag;\r\n            hess[z_index][4] = hess[z_index][1];\r\n            hess[z_index][14] = hess[z_index][11];\r\n\r\n        }\r\n        default {\r\n\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\n\r\n\r\n\r\n@compute @workgroup_size(4,16)\r\nfn main(\r\n    @builtin(workgroup_id) workgroup_id : vec3<u32>,\r\n    @builtin(local_invocation_id) local_invocation_id : vec3<u32>,\r\n    @builtin(global_invocation_id) global_invocation_id : vec3<u32>,\r\n    @builtin(local_invocation_index) local_invocation_index: u32,\r\n    @builtin(num_workgroups) num_workgroups: vec3<u32>\r\n) {\r\n\r\n    \r\n\r\n    let workgroup_index = (\r\n        workgroup_id.x +\r\n        workgroup_id.y * num_workgroups.x +\r\n        workgroup_id.z * num_workgroups.x * num_workgroups.y\r\n    );\r\n    \r\n    let newton_index = (\r\n        workgroup_index * 16 +\r\n        local_invocation_id.y\r\n    );\r\n    \r\n\r\n\r\n    let global_invocation_index = (\r\n        workgroup_index * 64 +\r\n        local_invocation_index\r\n    );\r\n\r\n\r\n    let tlist_index = (\r\n        newton_index*5\r\n    );\r\n\r\n\r\n\r\n        // Avoid accessing the buffer out of bounds\r\n    if (tlist_index >= BUFFER_SIZE) {\r\n        return;\r\n    }\r\n\r\n    var grad_length: f32;\r\n\r\n    var i : u32;\r\n    var grad_dot_diff: f32;\r\n    var func: f32;\r\n    var min_backtrack : u32;\r\n\r\n    var x_n : array<f32, 5>;\r\n\r\n    let c : f32 = 0.0001;\r\n    const rho : f32 = 0.65;\r\n\tvar alpha : f32 = pow(rho, f32(4*local_invocation_id.x));\r\n\t\r\n\r\n    t_i[local_invocation_id.y][0] = tlist[tlist_index];\r\n    t_i[local_invocation_id.y][1] = tlist[tlist_index + 1];\r\n    t_i[local_invocation_id.y][2] = tlist[tlist_index + 2];\r\n    t_i[local_invocation_id.y][3] = tlist[tlist_index + 3];\r\n    t_i[local_invocation_id.y][4] = tlist[tlist_index + 4];\r\n\r\n\r\n    var iter : i32;\r\n\r\n    output[tlist_index] = 1.0;\r\n\r\n\r\n    for(iter = 0; iter< MAX_ITER; iter++){\r\n\r\n        set_variables(local_invocation_id.x, local_invocation_id.y);\r\n\r\n        if(abort[local_invocation_id.y] == true){\r\n            return;\r\n        }\r\n\r\n\r\n\r\n        grad_compute(local_invocation_id.x, local_invocation_id.y);\r\n        hess_compute(local_invocation_id.x, local_invocation_id.y);\r\n\r\n        \r\n        grad_length = sqrt(\r\n            pow(grad[local_invocation_id.y][0], 2.0) \r\n            + pow(grad[local_invocation_id.y][1], 2.0)\r\n            + pow(grad[local_invocation_id.y][2], 2.0)\r\n            + pow(grad[local_invocation_id.y][3], 2.0)\r\n        );\r\n\r\n\r\n        if((grad_length < grad_stop_double) || (ptol[local_invocation_id.y] <= ptol_stop_double)){\r\n            if(ptol[local_invocation_id.y] > ptol_stop_double){\r\n                return;\r\n            }\r\n\r\n\r\n            if(check_order(t_i[local_invocation_id.y])){\r\n\r\n                if(check_pentagon(t_i[local_invocation_id.y])){\r\n\r\n                    if(local_invocation_id.x == 0){\r\n                        output[tlist_index] = t_i[local_invocation_id.y][0];\r\n                        output[tlist_index + 1] = t_i[local_invocation_id.y][1];\r\n                        output[tlist_index + 2] = t_i[local_invocation_id.y][2];\r\n                        output[tlist_index + 3] = t_i[local_invocation_id.y][3];\r\n                        output[tlist_index + 4] = t_i[local_invocation_id.y][4];\r\n                    }\r\n                }\r\n                return;\r\n            }\r\n\r\n            var tmp : f32 = t_i[local_invocation_id.y][1];\r\n\r\n            t_i[local_invocation_id.y][1] = t_i[local_invocation_id.y][4];\r\n            t_i[local_invocation_id.y][4] = tmp;\r\n            tmp = t_i[local_invocation_id.y][2];\r\n            t_i[local_invocation_id.y][2] = t_i[local_invocation_id.y][3];\r\n            t_i[local_invocation_id.y][3] = tmp;\r\n\r\n            if(check_order(t_i[local_invocation_id.y])){\r\n\r\n                if(check_pentagon(t_i[local_invocation_id.y])){\r\n\r\n                    if(local_invocation_id.x == 0){\r\n                        output[tlist_index] = t_i[local_invocation_id.y][0];\r\n                        output[tlist_index + 1] = t_i[local_invocation_id.y][1];\r\n                        output[tlist_index + 2] = t_i[local_invocation_id.y][2];\r\n                        output[tlist_index + 3] = t_i[local_invocation_id.y][3];\r\n                        output[tlist_index + 4] = t_i[local_invocation_id.y][4];\r\n                    }\r\n            \r\n                }\r\n            }\r\n\r\n            return;\r\n\r\n        }\r\n\r\n\r\n\r\n        modified_Cholesky(local_invocation_id.y);\r\n\r\n\r\n        grad_dot_diff = (\r\n            grad[local_invocation_id.y][0] * diff[local_invocation_id.y][0]\r\n            + grad[local_invocation_id.y][1] * diff[local_invocation_id.y][1]\r\n            + grad[local_invocation_id.y][2] * diff[local_invocation_id.y][2]\r\n            + grad[local_invocation_id.y][3] * diff[local_invocation_id.y][3]\r\n        );\r\n\r\n\r\n        for (i = 0; i < 4; i++)\r\n        {\r\n\r\n            x_n[0] = t_i[local_invocation_id.y][0];\r\n            x_n[1] = t_i[local_invocation_id.y][1] - alpha*diff[local_invocation_id.y][0];\r\n            x_n[2] = t_i[local_invocation_id.y][2] - alpha*diff[local_invocation_id.y][1];\r\n            x_n[3] = t_i[local_invocation_id.y][3] - alpha*diff[local_invocation_id.y][2];\r\n            x_n[4] = t_i[local_invocation_id.y][4] - alpha*diff[local_invocation_id.y][3];\r\n\r\n            func = (\r\n                length(knotc(x_n[0]) - knotc(x_n[3])) * length(knotc(x_n[1]) - knotc(x_n[2]))\r\n                + length(knotc(x_n[1]) - knotc(x_n[3])) * length(knotc(x_n[0]) - knotc(x_n[2]))\r\n                - length(knotc(x_n[0]) - knotc(x_n[1])) * length(knotc(x_n[2]) - knotc(x_n[3]))\r\n                \r\n                + length(knotc(x_n[0]) - knotc(x_n[3])) * length(knotc(x_n[2]) - knotc(x_n[4]))\r\n                + length(knotc(x_n[0]) - knotc(x_n[2])) * length(knotc(x_n[3]) - knotc(x_n[4]))\r\n                - length(knotc(x_n[0]) - knotc(x_n[4])) * length(knotc(x_n[2]) - knotc(x_n[3]))\r\n            );\r\n\r\n            if(func <= (ptol[local_invocation_id.y] - c*alpha*grad_dot_diff)){\r\n                backtrack[local_invocation_id.y][4*local_invocation_id.x + i] = 4*local_invocation_id.x + i;\r\n            } else {\r\n                backtrack[local_invocation_id.y][4*local_invocation_id.x + i] = 15;\r\n            }\r\n\r\n            alpha = alpha * rho;\r\n\r\n        }\r\n\r\n\r\n\r\n        min_backtrack = 15;\r\n\r\n        if(local_invocation_id.x == 0){\r\n\r\n            for (i = 0; i < 16; i++)\r\n            {\r\n                if(backtrack[local_invocation_id.y][i] < min_backtrack){\r\n                    min_backtrack = backtrack[local_invocation_id.y][i];\r\n                }\r\n            }\r\n\r\n            alpha = pow(rho, f32(min_backtrack));\r\n\r\n            t_i[local_invocation_id.y][1] = t_i[local_invocation_id.y][1] - alpha*diff[local_invocation_id.y][0];\r\n            t_i[local_invocation_id.y][2] = t_i[local_invocation_id.y][2] - alpha*diff[local_invocation_id.y][1];\r\n            t_i[local_invocation_id.y][3] = t_i[local_invocation_id.y][3] - alpha*diff[local_invocation_id.y][2];\r\n            t_i[local_invocation_id.y][4] = t_i[local_invocation_id.y][4] - alpha*diff[local_invocation_id.y][3];\r\n        }\r\n        \r\n\r\n        t_i[local_invocation_id.y][local_invocation_id.x + 1] = fract(t_i[local_invocation_id.y][local_invocation_id.x + 1]);\r\n\r\n        proxim(local_invocation_id.x, local_invocation_id.y, error_field);\r\n\r\n        if(abort[local_invocation_id.y] == true){\r\n            return;\r\n        }\r\n\r\n        iter ++;\r\n\r\n    }\r\n\r\n\r\n}\r\n\r\nfn check_order(t_i : array<f32, 5>) -> bool{\r\n    if(\r\n        (t_i[0] < t_i[1])\r\n        && (t_i[1] < t_i[2])\r\n        && (t_i[2] < t_i[3])\r\n        && (t_i[3] < t_i[4])\r\n    ){\r\n        return true;\r\n    }else if(\r\n        (t_i[4] < t_i[0])\r\n        && (t_i[0] < t_i[1])\r\n        && (t_i[1] < t_i[2])\r\n        && (t_i[2] < t_i[3])\r\n    ){\r\n        return true;\r\n    }else if(\r\n        (t_i[3] < t_i[4])\r\n        && (t_i[4] < t_i[0])\r\n        && (t_i[0] < t_i[1])\r\n        && (t_i[1] < t_i[2])\r\n    ){\r\n        return true;\r\n    }else if(\r\n        (t_i[2] < t_i[3])\r\n        && (t_i[3] < t_i[4])\r\n        && (t_i[4] < t_i[0])\r\n        && (t_i[0] < t_i[1])\r\n    ){\r\n        return true;\r\n    }else if(\r\n        (t_i[1] < t_i[2])\r\n        && (t_i[2] < t_i[3])\r\n        && (t_i[3] < t_i[4])\r\n        && (t_i[4] < t_i[0])\r\n    ){\r\n        return true;\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\nfn proxim(x : u32, y : u32, proxim_float : f32){\r\n    for(var i = i32(x) + 1; i < 5; i++){\r\n        let t_diff = t_i[y][i] - t_i[y][x];\r\n\r\n        if((abs(t_diff) < proxim_float)\r\n            || (abs(t_diff + 1.0) < proxim_float)\r\n            || (abs(1.0 - t_diff) < proxim_float))\r\n        {\r\n            abort[y] = true;\r\n            return;\r\n        }\r\n    }\r\n}\r\n\r\n\r\nfn modified_Cholesky(z: u32) {\r\n\r\n    var max_diag : f32 = 0.0;\r\n    var max_nondiag : f32 = 0.0;\r\n\r\n\r\n    for (var i = 0; i < 4; i++)\r\n    {\r\n        if(abs(hess[z][i*4+i]) > max_diag){\r\n            max_diag = abs(hess[z][i*4+i]);\r\n        }\r\n        for(var j =i+1; j < 4; j++){\r\n            if(abs(hess[z][i*4+j]) > max_nondiag){\r\n                max_nondiag = abs(hess[z][i*4+j]);\r\n            }\r\n        }\r\n    }\r\n\r\n    var beta2 : f32 = max(max(max_diag, max_nondiag/(sqrt(f32(15)))), 0.0001);\r\n\r\n    var temp : array<f32, 16>;\r\n    var D : array<f32, 4>;\r\n    var L : array<f32, 16>;\r\n\r\n    var theta : array<f32, 4>;\r\n\r\n    for(var j =0; j<4; j++){\r\n        temp[j*4 + j] = hess[z][j*4 + j];\r\n        for(var s = 0; s< j; s++){\r\n            temp[j*4 + j] -= D[s]*L[j*4 + s]*L[j*4 + s];\r\n        }\r\n        \r\n        for(var i=j+1; i<4; i++){\r\n            temp[i*4 + j] = hess[z][i*4 + j];\r\n            for(var s = 0; s< j; s++){\r\n                temp[i*4 + j] -= D[s]*L[i*4 + s]*L[j*4 + s];\r\n            }\r\n\r\n            if(theta[j]< abs(temp[i*4 + j])){\r\n                theta[j]= abs(temp[i*4 + j]);\r\n            }\r\n        }\r\n\r\n        D[j] = max(max(abs(temp[j*4 + j]), theta[j]*theta[j]/beta2), 0.001);\r\n        \r\n        for(var i=j+1; i<4; i++){\r\n            L[i*4 + j] = temp[i*4 + j]/D[j];\r\n        }\r\n        L[j*4 + j] = 1.0;\r\n    }\r\n\r\n    // forward substitution.\r\n    var y : array<f32, 4>;\r\n    var sum : f32;\r\n\r\n    for (var i = 0; i < 4; i++)\r\n    {\r\n        sum = grad[z][i];\r\n        for (var j = 0; j < i; j++){\r\n            sum -= L[i*4+j] * y[j];\r\n        }\r\n        y[i] = sum / L[i*4 +i];\r\n    }\r\n\r\n\r\n    // back substitution.\r\n    // var retval = new Array(4);\r\n\r\n    for (var k = 3; k >= 0; k--)\r\n    {\r\n        sum = y[k];\r\n        for (var j = k + 1; j < 4; j++){\r\n            sum -= L[j*4+k] * diff[z][j] * D[k];\r\n        }\r\n        diff[z][k] = sum/(D[k]);\r\n    }\r\n\r\n}\r\n\r\n\r\nfn check_pentagon(t_i : array<f32, 5>) -> bool {\r\n\r\n    let v1 = knotc(t_i[0]);\r\n    let v2 = knotc(t_i[3]);\r\n    let v3 = knotc(t_i[1]);\r\n    let v4 = knotc(t_i[4]);\r\n    let v5 = knotc(t_i[2]);\r\n\r\n    let v12 = (v2-v1);\r\n    let v23 = (v3-v2);\r\n    let v34 = (v4-v3);\r\n    let v45 = (v5-v4);\r\n    let v51 = (v1-v5);\r\n\r\n    var sum_angle : f32 = 0.0;\r\n\r\n    sum_angle += acos(-1*dot(v12,v23)/(length(v12)*length(v23)));\r\n    sum_angle += acos(-1*dot(v23,v34)/(length(v23)*length(v34)));\r\n    sum_angle += acos(-1*dot(v34,v45)/(length(v34)*length(v45)));\r\n    sum_angle += acos(-1*dot(v45,v51)/(length(v45)*length(v51)));\r\n    sum_angle += acos(-1*dot(v51,v12)/(length(v51)*length(v12)));\r\n\r\n    if(abs(sum_angle - 3*PI) < 0.02){\r\n        return true;\r\n    }\r\n    return false;\r\n\r\n\r\n}\r\n\r\n\r\n\r\nfn knotc(param : f32) -> vec3f {\r\n    let t : f32 = 2 * PI * param;\r\n    let ret : vec3f = (\r\n        knot_info.cos[0] * cos(t) + knot_info.cos[1] * cos(2*t) + knot_info.cos[2] * cos(3*t) + knot_info.cos[3] * cos(4*t) + knot_info.cos[4] * cos(5*t) + knot_info.cos[5] * cos(6*t)\r\n        + knot_info.sin[0] * sin(t) + knot_info.sin[1] * sin(2*t) + knot_info.sin[2] * sin(3*t) + knot_info.sin[3] * sin(4*t) + knot_info.sin[4] * sin(5*t)+ knot_info.sin[5] * sin(6*t)\r\n    );\r\n\treturn ret;\r\n}\r\nfn knotd(param : f32) -> vec3f {\r\n    let t : f32 = 2 * PI * param;\r\n    let ret : vec3f = (\r\n        knot_info.sin[0] * cos(t) + knot_info.sin[1] *2* cos(2*t) + knot_info.sin[2] *3* cos(3*t) + knot_info.sin[3] *4* cos(4*t) + knot_info.sin[4] *5* cos(5*t)+ knot_info.sin[5] *6* cos(6*t)\r\n        - knot_info.cos[0] * sin(t) - knot_info.cos[1] *2* sin(2*t) - knot_info.cos[2] *3* sin(3*t) - knot_info.cos[3] *4* sin(4*t) - knot_info.cos[4] *5* sin(5*t)- knot_info.cos[5] *6* sin(6*t)\r\n    );\r\n\treturn 2*PI*ret;\r\n}\r\nfn knotd2(param : f32) -> vec3f {\r\n    let t : f32 = 2 * PI * param;\r\n    let ret : vec3f = (\r\n        knot_info.cos[0] * cos(t) + knot_info.cos[1] *4* cos(2*t) + knot_info.cos[2] *9* cos(3*t) + knot_info.cos[3] *16* cos(4*t) + knot_info.cos[4] *25* cos(5*t)+ knot_info.cos[5] *36* cos(6*t)\r\n        + knot_info.sin[0] * sin(t) + knot_info.sin[1] *4* sin(2*t) + knot_info.sin[2] *9* sin(3*t) + knot_info.sin[3] *16* sin(4*t) + knot_info.sin[4] *25* sin(5*t)+ knot_info.sin[5] *36* sin(6*t)\r\n    );\r\n\treturn -4*PI*PI*ret;\r\n}\r\n\r\n"});this._computePipeline=this._device.createComputePipeline({layout:this._device.createPipelineLayout({bindGroupLayouts:[this._bindGroupLayout]}),compute:{module:o,entryPoint:"main",constants:{BUFFER_SIZE:this._bufferSize}}});for(let t=0;t<n;t++)r[t]=[];for(let e=0;e<40;e++){const[,i]=this.sett_i(n/2,n/2/40,n/2/40*e),o=this._device.createCommandEncoder(),d=o.beginComputePass();let c=this._device.createBuffer({size:48*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});this._device.queue.writeBuffer(c,0,t);let l=this._device.createBuffer({size:this._bufferSize*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),_=this._device.createBuffer({size:this._bufferSize*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC}),u=this._device.createBuffer({size:this._bufferSize*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST});this._device.queue.writeBuffer(l,0,i);const f=this._device.createBindGroup({layout:this._bindGroupLayout,entries:[{binding:0,resource:{buffer:c}},{binding:1,resource:{buffer:l}},{binding:2,resource:{buffer:_}}]});d.setPipeline(this._computePipeline),d.setBindGroup(0,f),d.dispatchWorkgroups(200,200),d.end(),o.copyBufferToBuffer(_,0,u,0,this._bufferSize*Float32Array.BYTES_PER_ELEMENT),this._device.queue.submit([o.finish()]),yield u.mapAsync(GPUMapMode.READ,0,this._bufferSize*Float32Array.BYTES_PER_ELEMENT);var a=new Float32Array(u.getMappedRange(0,this._bufferSize*Float32Array.BYTES_PER_ELEMENT).slice(0));for(let t=0;t<a.length/5;t++)if(1!=a[5*t]){var h=Math.round(a[5*t]*n);h>=n||h<0||r[h].push([a[5*t],a[5*t+1],a[5*t+2],a[5*t+3],a[5*t+4]])}if(s.text=(100*e/40).toFixed(1)+" %",s.cancel)return}var d,c,l,_,u,f,v=new Array(2);v[0]=[],v[1]=[];for(let t=0;t<n;t+=2)if(r[t]=this.removeDupe(r[t],.01),r[t]=r[t].slice(0,2*i),r[t]=this.c5_ptolemy(r[t]),r[t]=this.removeDupe(r[t],.002),r[t]=r[t].slice(0,i),this._calc.ACPolyAve+=r[t].length%2,v[r[t].length%2].push(t),s.cancel)return;for(let t=1;t<n;t+=2){let e;(l=t+1)==n&&(l=0),u=[],_=r[c=t-1].length<r[l]?l:c;for(let i=0;i<r[_].length;i++)e=r[_][i],u.push([t/n,e[1],e[2],e[3],e[4]]);if(u=this.c5_ptolemy(u),r[t]=this.removeDupe(u,.002),r[t]=r[t].slice(0,i),v[r[t].length%2].push(t),s.cancel)return}if(this._calc.ACPolyAve=Math.round(this._calc.ACPolyAve/n),e){s.text="verifying number of circles";const t=v[(this._calc.ACPolyAve+1)%2];for(let e=0;e<t.length;e++){let i;u=[],(c=(d=t[e])-1)<0&&(c=n-1),(l=d+1)>=n&&(l=0),_=r[c].length<r[l]?(f=l,t.indexOf(f)>-1?c:l):c;for(let t=0;t<r[_].length;t++)i=r[_][t],u.push([d/n,i[1],i[2],i[3],i[4]]);if(u=this.c5_ptolemy(u),r[d]=this.removeDupe(u,.002),s.cancel)return}}s.text="creating buffers",this._calculated=!1,this.setFrameData(r,n,s),s.cancel||(this.player.max=n,this._calculated=!0,this._player.play=!0)}))}removeDupe(t,e){let i=[];for(var n=0;n<t.length;n++){var s=!0;let o=i.length;for(var r=0;r<o;r++)Math.sqrt(Math.pow(t[n][1]-i[r][1],2)+Math.pow(t[n][2]-i[r][2],2)+Math.pow(t[n][3]-i[r][3],2)+Math.pow(t[n][4]-i[r][4],2))<e&&(s=!1);s&&i.push(t[n])}return i}sett_i(t,e,i){var n,s,r,o,a,h=0;const d=22,c=new Float32Array(5985*e*5);for(h=0,a=0;a<e;a++)for(n=1;n<d;n++)for(s=n+1;s<d;s++)for(r=s+1;r<d;r++)for(o=r+1;o<d;o++)c[h]=i/t+a/t,c[h+1]=n/d+c[h],c[h+2]=s/d+c[h],c[h+3]=r/d+c[h],c[h+4]=o/d+c[h],h+=5;return[h,c]}setFrameData(t,e,i){var n,s,r,o,a;for(let c=0;c<e;c++){this._frames[c]={redPoints:{position:this.knot(c/e)},blackPoints:[],circles:[]},o=[];var h=t[c];for(let t=0;t<h.length;t++){var d=[!0,!0,!0,!0];n=[h[t][5],h[t][6],h[t][7]],s=[h[t][8],h[t][9],h[t][10]],r=h[t][11],a=Math.max(0,Math.min(Math.floor(5*Math.log2(r))+10,79)),this._frames[c].circles.push({center:n,normal:s,radius:r,radID:a});for(let e=0;e<o.length;e++)for(let i=0;i<4;i++)b(o[e].position,this.knot(h[t][i+1]))<.001&&(d[i]=!1);for(let e=0;e<4;e++)d[e]&&o.push({position:this.knot(h[t][e+1])})}if(this._frames[c].blackPoints=o,i.cancel)return}}draw(t,e){var i,n=this._frames[this._player.frame];for(let s=0;s<n.circles.length;s++)i=n.circles[s],this._circles[i.radID].setCenterNormalRad(i.center,i.normal,i.radius),this._circles[i.radID].draw(t,e);for(let i=0;i<n.blackPoints.length;i++)this._spheres.black.position=n.blackPoints[i].position,this._spheres.black.draw(t,e);this._spheres.red.position=n.redPoints.position,this._spheres.red.draw(t,e),this._player.play&&this._player.addFrame()}get player(){return this._player}toCVR(t,e,i){const n=vt(t,e),s=vt(e,i),r=vt(i,t);var o,a,h=(a=s,[(o=n)[1]*a[2]-o[2]*a[1],o[2]*a[0]-o[0]*a[2],o[0]*a[1]-o[1]*a[0]]);const d=mt(n)*mt(s)*mt(r)*.5/mt(h),c=mt(s)*mt(s)*xt(n,r)*-.5/xt(h,h),l=mt(r)*mt(r)*xt(n,s)*-.5/xt(h,h),_=mt(n)*mt(n)*xt(r,s)*-.5/xt(h,h),u=pt(pt(gt(c,t),gt(l,e)),gt(_,i));return h=function(t){const e=mt(t);return[t[0]/e,t[1]/e,t[2]/e]}(h),[u,h,d]}decim(t){for(var e=1;e<5;e++)t[e]%=1,t[e]<0&&(t[e]+=1)}proxim(t,e){for(var i=0;i<5;i++)for(var n=i+1;n<5;n++)if(Math.abs(t[i]-t[n])<e||Math.abs(t[i]-t[n]+1)<e||Math.abs(t[n]-t[i]+1)<e)return!0;return!1}modified_Cholesky(t,e){if(16!=t.length||4!=e.length)throw new Error("dimension error in modified_Cholesky");var i,n,s,r,o=0,a=0;for(i=0;i<4;i++)for(Math.abs(t[4*i+i])>o&&(o=Math.abs(t[4*i+i])),n=0;n<4;n++)Math.abs(t[4*i+n])>a&&n!=i&&(a=Math.abs(t[4*i+n]));var h=Math.max(o,a/Math.sqrt(15),1e-4),d=new Array(16),c=new Array(4),l=new Array(16),_=[0,0,0,0];for(n=0;n<4;n++){for(d[4*n+n]=t[4*n+n],r=0;r<n;r++)d[4*n+n]-=c[r]*l[4*n+r]*l[4*n+r];for(i=n+1;i<4;i++){for(d[4*i+n]=t[4*i+n],r=0;r<n;r++)d[4*i+n]-=c[r]*l[4*i+r]*l[4*n+r];_[n]<Math.abs(d[4*i+n])&&(_[n]=Math.abs(d[4*i+n]))}for(c[n]=Math.max(Math.abs(d[4*n+n]),_[n]*_[n]/h,.001),i=n+1;i<4;i++)l[4*i+n]=d[4*i+n]/c[n];l[4*n+n]=1}var u,f=new Array(4);for(i=0;i<4;i++){for(u=e[i],n=0;n<i;n++)u-=l[4*i+n]*f[n];f[i]=u/l[4*i+i]}var v=[0,0,0,0];for(s=3;s>=0;s--){for(u=f[s],n=s+1;n<4;n++)u-=l[4*n+s]*v[n]*c[s];v[s]=u/c[s]}return v}gradient_ptolemy(t,e,i){const n=-t[2]/t[4]*e[1]+-t[1]/t[5]*e[2]-t[7]/t[0]*e[0],s=t[2]/t[4]*e[5]+t[5]/t[1]*e[4]- -t[0]/t[7]*e[6],r=t[4]/t[2]*e[8]+t[1]/t[5]*e[9]-t[0]/t[7]*e[10],o=t[8]/t[0]*e[0]+-t[1]/t[6]*e[3]- -t[3]/t[4]*e[1],a=-t[0]/t[8]*e[7]+t[6]/t[1]*e[4]-t[3]/t[4]*e[5],h=t[0]/t[8]*e[13]+t[1]/t[6]*e[12]-t[4]/t[3]*e[11];i[0]=n+o,i[1]=s+a,i[2]=r,i[3]=h}hessian_ptolemy(t,e,i,n,s){const r=-t[2]/t[4]*(n[1]-i[0]+Math.pow(e[1],2)/Math.pow(t[4],2))+-t[1]/t[5]*(n[2]-i[0]+Math.pow(e[2],2)/Math.pow(t[5],2))-t[7]/t[0]*(n[0]+i[0]-Math.pow(e[0],2)/Math.pow(t[0],2)),o=1/(t[7]*t[0])*e[6]*e[0]+-t[2]/t[4]*(i[1]-e[5]*e[1]/Math.pow(t[4],2))+1/(-t[1]*t[5])*e[4]*e[2],a=-1/(t[7]*t[0])*e[10]*e[0]+1/(-t[2]*t[4])*e[8]*e[1]+-t[1]/t[5]*(i[2]-e[9]*e[2]/Math.pow(t[5],2)),h=t[2]/t[4]*(n[5]+i[4]-Math.pow(e[5],2)/Math.pow(t[4],2))+t[5]/t[1]*(n[4]+i[4]-Math.pow(e[4],2)/Math.pow(t[1],2))- -t[0]/t[7]*(n[6]-i[4]+Math.pow(e[6],2)/Math.pow(t[7],2)),d=- -t[0]/t[7]*(i[5]-e[10]*e[6]/Math.pow(t[7],2))+1/(t[2]*t[4])*e[8]*e[5]+1/(t[5]*t[1])*e[9]*e[4],c=t[4]/t[2]*(n[8]+i[7]-Math.pow(e[8],2)/Math.pow(t[2],2))+t[1]/t[5]*(n[9]+i[7]-Math.pow(e[9],2)/Math.pow(t[5],2))-t[0]/t[7]*(n[10]+i[7]-Math.pow(e[10],2)/Math.pow(t[7],2)),l=t[8]/t[0]*(n[0]+i[0]-Math.pow(e[0],2)/Math.pow(t[0],2))+-t[1]/t[6]*(n[3]-i[0]+Math.pow(e[3],2)/Math.pow(t[6],2))- -t[3]/t[4]*(n[1]-i[0]+Math.pow(e[1],2)/Math.pow(t[4],2)),_=- -t[3]/t[4]*(i[1]-e[1]*e[5]/Math.pow(t[4],2))+1/(-t[8]*t[0])*e[7]*e[0]+1/(-t[1]*t[6])*e[4]*e[3],u=-1/(-t[3]*t[4])*e[11]*e[1]+1/(t[8]*t[0])*e[13]*e[0]+-t[1]/t[6]*(i[3]-e[3]*e[12]/Math.pow(t[6],2)),f=-t[0]/t[8]*(n[7]-i[4]+Math.pow(e[7],2)/Math.pow(t[8],2))+t[6]/t[1]*(n[4]+i[4]-Math.pow(e[4],2)/Math.pow(t[1],2))-t[3]/t[4]*(n[5]+i[4]-Math.pow(e[5],2)/Math.pow(t[4],2)),v=-1/(t[3]*t[4])*e[11]*e[5]+-t[0]/t[8]*(i[6]-e[7]*e[13]/Math.pow(t[8],2))+1/(t[6]*t[1])*e[12]*e[4],p=t[0]/t[8]*(n[13]+i[8]-Math.pow(e[13],2)/Math.pow(t[8],2))+t[1]/t[6]*(n[12]+i[8]-Math.pow(e[12],2)/Math.pow(t[6],2))-t[4]/t[3]*(n[11]+i[8]-Math.pow(e[11],2)/Math.pow(t[3],2));s[0]=r+l,s[1]=o+_,s[2]=a,s[3]=u,s[4]=o+_,s[5]=h+f,s[6]=d,s[7]=v,s[8]=a,s[9]=d,s[10]=c,s[11]=0,s[12]=u,s[13]=v,s[14]=0,s[15]=p}setvariables(t,e,i,n,s,r,o,a,h){e[0]=this.knot(t[0]),e[1]=this.knot(t[1]),e[2]=this.knot(t[2]),e[3]=this.knot(t[3]),e[4]=this.knot(t[4]),n[0]=vt(e[1],e[0]),n[1]=vt(e[2],e[0]),n[2]=vt(e[3],e[0]),n[3]=vt(e[4],e[0]),n[4]=vt(e[2],e[1]),n[5]=vt(e[3],e[1]),n[6]=vt(e[4],e[1]),n[7]=vt(e[3],e[2]),n[8]=vt(e[4],e[2]),i[0]=mt(n[0]),i[1]=mt(n[1]),i[2]=mt(n[2]),i[3]=mt(n[3]),i[4]=mt(n[4]),i[5]=mt(n[5]),i[6]=mt(n[6]),i[7]=mt(n[7]),i[8]=mt(n[8]);for(var d=0;d<9;d++)if(i[d]<this._calc.error_field)return!0;return s[0]=this.dknot(t[1]),s[1]=this.dknot(t[2]),s[2]=this.dknot(t[3]),s[3]=this.dknot(t[4]),r[0]=xt(n[0],s[0]),r[1]=xt(n[4],s[0]),r[2]=xt(n[5],s[0]),r[3]=xt(n[6],s[0]),r[4]=xt(n[1],s[1]),r[5]=xt(n[4],s[1]),r[6]=xt(n[7],s[1]),r[7]=xt(n[8],s[1]),r[8]=xt(n[2],s[2]),r[9]=xt(n[5],s[2]),r[10]=xt(n[7],s[2]),r[11]=xt(n[3],s[3]),r[12]=xt(n[6],s[3]),r[13]=xt(n[8],s[3]),a[0]=this.d2knot(t[1]),a[1]=this.d2knot(t[2]),a[2]=this.d2knot(t[3]),a[3]=this.d2knot(t[4]),h[0]=xt(n[0],a[0]),h[1]=xt(n[4],a[0]),h[2]=xt(n[5],a[0]),h[3]=xt(n[6],a[0]),h[4]=xt(n[1],a[1]),h[5]=xt(n[4],a[1]),h[6]=xt(n[7],a[1]),h[7]=xt(n[8],a[1]),h[8]=xt(n[2],a[2]),h[9]=xt(n[5],a[2]),h[10]=xt(n[7],a[2]),h[11]=xt(n[3],a[3]),h[12]=xt(n[6],a[3]),h[13]=xt(n[8],a[3]),o[0]=xt(s[0],s[0]),o[1]=xt(s[0],s[1]),o[2]=xt(s[0],s[2]),o[3]=xt(s[0],s[3]),o[4]=xt(s[1],s[1]),o[5]=xt(s[1],s[2]),o[6]=xt(s[1],s[3]),o[7]=xt(s[2],s[2]),o[8]=xt(s[3],s[3]),!1}knot(t){const e=2*t*lt;return l(a(),f(a(),f(a(),f(a(),f(a(),f(a(),u(a(),this._cosCoef[5],_t(6*e)),this._cosCoef[4],_t(5*e)),this._cosCoef[3],_t(4*e)),this._cosCoef[2],_t(3*e)),this._cosCoef[1],_t(2*e)),this._cosCoef[0],_t(e)),f(a(),f(a(),f(a(),f(a(),f(a(),u(a(),this._sinCoef[5],ut(6*e)),this._sinCoef[4],ut(5*e)),this._sinCoef[3],ut(4*e)),this._sinCoef[2],ut(3*e)),this._sinCoef[1],ut(2*e)),this._sinCoef[0],ut(e)))}dknot(t){const e=2*t*lt;return u(a(),l(a(),f(a(),f(a(),f(a(),f(a(),f(a(),u(a(),this._dcosCoef[5],_t(6*e)),this._dcosCoef[4],_t(5*e)),this._dcosCoef[3],_t(4*e)),this._dcosCoef[2],_t(3*e)),this._dcosCoef[1],_t(2*e)),this._dcosCoef[0],_t(e)),f(a(),f(a(),f(a(),f(a(),f(a(),u(a(),this._dsinCoef[5],ut(6*e)),this._dsinCoef[4],ut(5*e)),this._dsinCoef[3],ut(4*e)),this._dsinCoef[2],ut(3*e)),this._dsinCoef[1],ut(2*e)),this._dsinCoef[0],ut(e))),2*lt)}d2knot(t){const e=2*t*lt;return u(a(),l(a(),f(a(),f(a(),f(a(),f(a(),f(a(),u(a(),this._d2cosCoef[5],_t(6*e)),this._d2cosCoef[4],_t(5*e)),this._d2cosCoef[3],_t(4*e)),this._d2cosCoef[2],_t(3*e)),this._d2cosCoef[1],_t(2*e)),this._d2cosCoef[0],_t(e)),f(a(),f(a(),f(a(),f(a(),f(a(),u(a(),this._d2cosCoef[5],ut(6*e)),this._d2sinCoef[4],ut(5*e)),this._d2sinCoef[3],ut(4*e)),this._d2sinCoef[2],ut(3*e)),this._d2sinCoef[1],ut(2*e)),this._d2sinCoef[0],ut(e))),4*lt*lt)}c5_ptolemy(t){var e,i,n,s,r,o,a,h=[],d=new Array(5),c=new Array(9),l=new Array(9),_=new Array(4),u=new Array(14),f=new Array(9),v=new Array(4),p=new Array(14),m=[0,0,0,0,0],g=[0,0,0,0],x=[0,0,0,0],y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b=0,k=[0,0,0,0,0];for(let z=0;z<t.length;z++)for(m[0]=t[z][0],m[1]=t[z][1],m[2]=t[z][2],m[3]=t[z][3],m[4]=t[z][4],b=0;b<250&&!this.setvariables(m,d,l,c,_,u,f,v,p);){if(e=l[0]*l[8]+l[1]*l[6]-l[3]*l[4]+l[2]*l[4]+l[5]*l[1]-l[0]*l[7],this.gradient_ptolemy(l,u,g),this.hessian_ptolemy(l,u,f,p,y),Math.sqrt(Math.pow(g[0],2)+Math.pow(g[1],2)+Math.pow(g[2],2)+Math.pow(g[3],2))<1e-7||e<=1e-7){if(e>1e-7)break;var[w,C,M]=this.toCVR(this.knot(m[0]),this.knot(m[1]),this.knot(m[2]));h.push([m,w,C,M].flat());break}x=this.modified_Cholesky(y,g),o=0,n=1/.75,s=Math.sqrt(Math.pow(x[0],2)+Math.pow(x[1],2)+Math.pow(x[2],2)+Math.pow(x[3],2)),r=g[0]*x[0]+g[1]*x[1]+g[2]*x[2]+g[3]*x[3];do{for(n*=.75,o++,k[0]=m[0],i=0;i<4;i++)k[i+1]=m[i+1]-n*x[i];d[1]=this.knot(k[1]),d[2]=this.knot(k[2]),d[3]=this.knot(k[3]),d[4]=this.knot(k[4]),c[0]=vt(d[1],d[0]),c[1]=vt(d[2],d[0]),c[2]=vt(d[3],d[0]),c[3]=vt(d[4],d[0]),c[4]=vt(d[2],d[1]),c[5]=vt(d[3],d[1]),c[6]=vt(d[4],d[1]),c[7]=vt(d[3],d[2]),c[8]=vt(d[4],d[2]),l[0]=mt(c[0]),l[1]=mt(c[1]),l[2]=mt(c[2]),l[3]=mt(c[3]),l[4]=mt(c[4]),l[5]=mt(c[5]),l[6]=mt(c[6]),l[7]=mt(c[7]),l[8]=mt(c[8]),a=l[0]*l[8]+l[1]*l[6]-l[3]*l[4]+l[2]*l[4]+l[5]*l[1]-l[0]*l[7]}while(a>e-1e-4*n*r&&n*s>5e-6&&o<20);if(m=[k[0],k[1],k[2],k[3],k[4]],this.decim(m),this.proxim(m,2e-4))break;b++}return h}}function vt(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]}function pt(t,e){return[t[0]+e[0],t[1]+e[1],t[2]+e[2]]}function mt(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}function gt(t,e){return[t*e[0],t*e[1],t*e[2]]}function xt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}class yt{constructor(){this.videoControls=document.getElementById("video-controls"),this.playpause=document.getElementById("playpause"),this.progress=document.getElementById("progress"),this.progressBar=document.getElementById("progress-bar"),this.left=0,this.pressed=!1,this.speedDrop=new dt("speed dropdown",1),this._animation={play:!1,frame:0,max:0,speed:1},this.videoControls.classList.toggle("hidden",!0),this.resize()}initCallback(){this.playpause.addEventListener("click",(()=>{this.playBtnResponse()})),this.progress.addEventListener("mousedown",(t=>{0==t.button&&(this.pressed=!0,this.progressResponse(t))})),document.addEventListener("mousemove",(t=>{this.progressResponse(t)})),document.addEventListener("mouseup",(()=>{this.pressed=!1}))}progressResponse(t){if(this.pressed){var e=(t.clientX-this.left)/this.progress.offsetWidth;this.frame=Math.max(Math.min(Math.round(e*(this._animation.max-1)),this._animation.max-1),0)}}playBtnResponse(){this._animation.play=!this._animation.play,this._animation.play?this.playpause.setAttribute("data-state","play"):this.playpause.setAttribute("data-state","pause")}get frame(){return Math.floor(this._animation.frame)}addFrame(t=this.speed){2e3==this._animation.max||(t/=2),this.frame=this._animation.frame+t}set frame(t){(t<0||t>=this._animation.max)&&(t=0),this.progressBar.style.width=String(Math.floor(t/(this._animation.max-1)*1e3)/10)+"%",this._animation.frame=t}get speed(){return this._animation.speed=this.speedDrop.value,this._animation.speed}get play(){return this._animation.play}set max(t){this._animation.max=t}set play(t){this._animation.play=t}Disable(t){!0===t?this.videoControls.classList.toggle("hidden",!0):this.videoControls.classList.toggle("hidden",!1)}resize(){this.left=this.progress.getBoundingClientRect().left}reset(){this.frame=0,this.play=!0,this._animation.speed=1,this.speedDrop.reset(),this.resize()}}class bt{constructor(){this._loader=new ht,this._loader.initCallback(),this._linkedKnot=new Z,this._fourierKnot=new rt,this._quintpules=new ft,this._quintpules.Initialize(),this._freeze=!1,this._knotMenu=new kt(this),this._knotMenu.initCallback()}get sceneType(){return this._knotMenu.sceneType}advanceScene(t){return e=this,i=void 0,s=function*(){if(this._freeze=!0,this.linkedKnot.selected=null,this.linkedKnot.drawingTool.Disable(!0),"Quintuples"===t){this.fourierKnot.calculated&&!this.fourierKnot.intersecting||(alert("Tried to find circles on incomplete knot"),this._knotMenu.sceneType="Fourier Knot"),this._loader.load(!0);const t=this.fourierKnot.exportKIArr();this.quintuples.initKnot(t);const e=this.fourierKnot.exportKI();if(yield this.quintuples.findCircles(e,this._knotMenu.doubleCheck,this._knotMenu.maxCircles,this._knotMenu.knotDivision,this._loader),this._loader.load(!1),this._knotMenu.resetCircleOption(),!this._quintpules.calculated)return this._quintpules.deleteData(),this._knotMenu.sceneType="Fourier Knot",void(this._freeze=!1);this._knotMenu.sceneType="Quintuples",this.quintuples.player.reset()}else if("Fourier Knot"===t){this.linkedKnot.isKnot||(alert("Tried to smoothen incomplete knot"),this._knotMenu.sceneType="Linked Knot");var e=this.linkedKnot.nodeArr;this.fourierKnot.calcFourier(e),this._knotMenu.sceneType="Fourier Knot"}this._freeze=!1},new((n=void 0)||(n=Promise))((function(t,r){function o(t){try{h(s.next(t))}catch(t){r(t)}}function a(t){try{h(s.throw(t))}catch(t){r(t)}}function h(e){var i;e.done?t(e.value):(i=e.value,i instanceof n?i:new n((function(t){t(i)}))).then(o,a)}h((s=s.apply(e,i||[])).next())}));var e,i,n,s}drawScene(t,e,i=!0){if(!this._freeze)if(t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),"Linked Knot"==this.sceneType)this.linkedKnot.draw(t,e);else if("Fourier Knot"==this.sceneType){if(!i)return;this._fourierKnot.draw(t,e)}else if("Quintuples"==this.sceneType){if(!i)return;this._fourierKnot.draw(t,e),this._quintpules.draw(t,e)}}get linkedKnot(){return this._linkedKnot}get fourierKnot(){return this._fourierKnot}get quintuples(){return this._quintpules}get transform_z(){return this.linkedKnot.transform_z}set transform_z(t){this.linkedKnot.transform_z=t}get selected(){return this.linkedKnot.selected}get InsertOrConnect(){return this.linkedKnot.drawingTool.connectLast||this.linkedKnot.drawingTool.insert}get EraseOrSubdiv(){return this.linkedKnot.drawingTool.erase||this.linkedKnot.drawingTool.subdivide}get selectedNode(){return this.linkedKnot.selectedNode}btnManager(){this._knotMenu.disableAdvance(),this._knotMenu.disableDelete()}}class kt{constructor(t){this._scene=t,this._sceneType="Linked Knot",this._advance=document.getElementById("advance scene"),this._delete=document.getElementById("delete scene"),this._doubleCheck={overlay:document.getElementById("delete-check"),confirm:document.getElementById("delete-confirm"),cancel:document.getElementById("delete-cancel")},this._slider={linkedKnot:document.getElementById("Linked Knot"),fourierKnot:document.getElementById("Fourier Knot"),quintuples:document.getElementById("Quintuples")},this._slider.fourierKnot.disabled=!0,this._slider.quintuples.disabled=!0,this._circleOptions={overlay:document.getElementById("circle options"),doubleCheck:document.getElementById("double check box"),maxCircles:new dt("circle max dropdown",8),knotDivision:new dt("knotDivision",2e3),submit:document.getElementById("confirm calculate"),cancel:document.getElementById("cancel calculate")},this.cancelBtnResponse(),this.sceneSelect()}initCallback(){this._advance.addEventListener("click",(()=>{this.advanceBtnResponse()})),this._delete.addEventListener("click",(()=>{this.deleteBtnResponse()})),this._doubleCheck.confirm.addEventListener("click",(()=>{this.confirmBtnResponse()})),this._doubleCheck.cancel.addEventListener("click",(()=>{this.cancelBtnResponse()})),document.addEventListener("mousedown",(t=>{"Linked Knot"!==this.sceneType||this._doubleCheck.overlay.contains(t.target)||this._doubleCheck.overlay.classList.contains("hidden")||this._doubleCheck.overlay.classList.toggle("hidden",!0)})),this._slider.linkedKnot.addEventListener("click",(()=>{this.sceneSelect()})),this._slider.fourierKnot.addEventListener("click",(()=>{this.sceneSelect()})),this._slider.quintuples.addEventListener("click",(()=>{this.sceneSelect()})),this._circleOptions.submit.addEventListener("click",(()=>{this._circleOptions.overlay.classList.toggle("hidden",!0),this._scene.advanceScene("Quintuples")})),this._circleOptions.cancel.addEventListener("click",(()=>{this.resetCircleOption()}))}advanceBtnResponse(){"Linked Knot"===this.sceneType?this._scene.advanceScene("Fourier Knot"):"Fourier Knot"===this.sceneType&&this._circleOptions.overlay.classList.toggle("hidden",!1)}resetCircleOption(){this._circleOptions.knotDivision.reset(),this._circleOptions.maxCircles.reset(),this._circleOptions.doubleCheck.checked=!0,this._circleOptions.overlay.classList.toggle("hidden",!0)}get knotDivision(){return this._circleOptions.knotDivision.value}get maxCircles(){return this._circleOptions.maxCircles.value}get doubleCheck(){return this._circleOptions.doubleCheck.checked}deleteBtnResponse(){"Linked Knot"===this.sceneType&&this._doubleCheck.overlay.classList.toggle("hidden",!1)}confirmBtnResponse(){"Linked Knot"===this.sceneType&&(this._scene.linkedKnot.deleteData(),this._doubleCheck.overlay.classList.toggle("hidden",!0),this.disableDelete(),this.disableAdvance())}cancelBtnResponse(){this._doubleCheck.overlay.classList.toggle("hidden",!0)}disableDelete(){"Linked Knot"!=this.sceneType||this._scene.linkedKnot.isEmpty?this._delete.classList.toggle("hidden",!0):this._delete.classList.toggle("hidden",!1)}disableAdvance(){"Linked Knot"==this.sceneType?this._advance.disabled=!this._scene.linkedKnot.isKnot:"Fourier Knot"==this.sceneType&&(this._advance.disabled=this._scene.fourierKnot.intersecting)}sceneSelect(){this._slider.linkedKnot.checked?this.sceneType="Linked Knot":this._slider.fourierKnot.checked?this.sceneType="Fourier Knot":this._slider.quintuples.checked&&(this.sceneType="Quintuples")}get sceneType(){return this._sceneType}set sceneType(t){this._sceneType=t,"Linked Knot"==this.sceneType?(this._slider.linkedKnot.checked=!0,this._scene.linkedKnot.drawingTool.Disable(!1),this._scene.quintuples.player.Disable(!0),this._advance.textContent="Smoothen Knot"):"Fourier Knot"==this.sceneType?(this._slider.fourierKnot.disabled=!1,this._slider.fourierKnot.checked=!0,this._scene.linkedKnot.selected=null,this._scene.linkedKnot.drawingTool.Disable(!0),this._scene.quintuples.player.Disable(!0),this._advance.textContent="Find Circles"):"Quintuples"==this.sceneType&&(this._slider.quintuples.disabled=!1,this._slider.quintuples.checked=!0,this._scene.linkedKnot.selected=null,this._scene.linkedKnot.drawingTool.Disable(!0),this._scene.quintuples.player.Disable(!1)),this._advance.setAttribute("sceneType",this._sceneType),this.disableAdvance(),this.disableDelete(),this.resetCircleOption(),this._circleOptions.overlay.classList.toggle("hidden",!0)}}class wt{constructor(e){this.canvas=e,this.boundingClientRect=this.canvas.getBoundingClientRect(),this.gl=t.checkWebGL(this.canvas),this.programs={render:t.createProgram(this.gl,"precision mediump float;\r\nattribute vec4 aColor;\r\nattribute vec4 aNormal;\r\nattribute vec4 aPosition;\r\n\r\nuniform mat4 mWorld;\r\nuniform mat4 mView;\r\nuniform mat4 mProj;\r\n\r\n\r\nuniform mat3 uNormalMatrix;\r\n\r\nvarying vec4 vColor;\r\nvarying vec3 vNormal;\r\n\r\nvoid main() {\r\n    gl_Position = mProj * mView * mWorld * aPosition;\r\n\r\n    vColor = aColor;\r\n    vNormal = uNormalMatrix * vec3(aNormal);\r\n}","precision mediump float;\r\n\r\nuniform vec3 uDiffuseLight;\r\nuniform vec3 uLightPosition;\r\nuniform vec3 uAmbientLight;\r\n\r\nvarying vec4 vColor;\r\nvarying vec3 vNormal;\r\n\r\n\r\nvoid main() {\r\n    // Normalize the normal because it is interpolated and not 1.0 in length any more\r\n    vec3 normal = normalize(vNormal);\r\n\r\n    // Calculate the light direction and make its length 1.\r\n    vec3 lightDirection = uLightPosition;\r\n\r\n    // The dot product of the light direction and the orientation of a surface (the normal)\r\n    float nDotL = max(dot(lightDirection, normal), 0.0);\r\n\r\n    // Calculate the final color from diffuse reflection and ambient reflection\r\n    vec3 diffuse = uDiffuseLight * vColor.rgb * nDotL;\r\n    vec3 ambient = uAmbientLight * vColor.rgb;\r\n    gl_FragColor = vec4(diffuse + ambient, vColor.a);\r\n}")},this.camera=new P,this.scene=new bt,this.ui={left_down:!1,wheel_down:!1,mouse:{lastX:0,lastY:0},doubleClick:{click:!1,sameObj:!1,lastX:0,lastY:0},shift:!1},this._fps={fpsLimit:30,prev:0},this._infoPage={hidden:!0,overlay:document.getElementById("about overlay"),btn:document.getElementById("about button"),exit:document.getElementById("info-exit")}}run(){this.initGL(),this.initCallbacks(),requestAnimationFrame(this.animate.bind(this))}initGL(){this.gl.clearColor(.9855,.9867,.9812,1),this.gl.enable(this.gl.DEPTH_TEST),this.gl.useProgram(this.programs.render),T.setLight(this.gl,this.programs.render,[50,50,50]),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.blendEquation(this.gl.FUNC_ADD)}initCallbacks(){var t;window.addEventListener("beforeunload",(t=>{t.returnValue=!0})),this._infoPage.btn.addEventListener("click",(()=>{this._infoPage.overlay.classList.toggle("hidden",!1),this._infoPage.hidden=!1})),this._infoPage.exit.addEventListener("click",(()=>{this._infoPage.overlay.classList.toggle("hidden",!0),this._infoPage.hidden=!0})),document.addEventListener("mousedown",(t=>{var e;t.target.id==this.canvas.id?this.mouseDown(t):(null===(e=this._infoPage.overlay.querySelector("#info-content"))||void 0===e?void 0:e.contains(t.target))||this._infoPage.hidden||(this._infoPage.overlay.classList.toggle("hidden",!0),this._infoPage.hidden=!0)})),document.addEventListener("mouseup",(t=>{this.mouseUp(t)})),document.addEventListener("click",(t=>{t.target.id==this.canvas.id&&this.ui.doubleClick.click&&(this.scene.InsertOrConnect||this.scene.EraseOrSubdiv?this.scene.linkedKnot.btnManager():this.ui.doubleClick.sameObj&&(this.scene.transform_z=!this.scene.transform_z)),this.scene.btnManager(),this.ui.doubleClick.sameObj=!1,this.configCamera()})),document.addEventListener("mousemove",(t=>{this.mouseMove(t)})),document.addEventListener("keydown",(t=>{this.keyDown(t)})),document.addEventListener("keyup",(t=>{this.keyUp(t)})),window.addEventListener("resize",(()=>{this.resizer()})),this.resizer(),this.canvas.addEventListener("wheel",(t=>{this.zoom(t),1==t.ctrlKey&&t.preventDefault()}),{passive:!1}),null===(t=document.getElementById("camera button"))||void 0===t||t.addEventListener("click",(()=>{this.camera.reset=!0}))}configCamera(){this.camera.update(this.gl,this.programs.render,this.canvas.width,this.canvas.height),this.camera.setRay()}animate(t){requestAnimationFrame(this.animate.bind(this)),this.camera.reset&&this.camera.resetCam(this.gl,this.programs.render,this.canvas.width,this.canvas.height),t-this._fps.prev<1e3/this._fps.fpsLimit-.1||this.scene.drawScene(this.gl,this.programs.render,!0)}keyDown(t){this.ui.shift=t.shiftKey,("Delete"===t.key||"Backspace"===t.key)&&this.scene.linkedKnot.delete(),("="==t.key&&1==t.ctrlKey||"-"==t.key&&1==t.ctrlKey)&&t.preventDefault()}keyUp(t){this.ui.shift=t.shiftKey}mouseDown(t){if(this.camera.reset&&(this.camera.reset=!1,this.configCamera()),this.ui.doubleClick.click=!0,this.ui.doubleClick.lastX=t.clientX,this.ui.doubleClick.lastY=t.clientY,0==t.button){this.ui.left_down=!0;const h=this.scene.selected;if("Linked Knot"==this.scene.sceneType&&!this.scene.InsertOrConnect){const{relx:h,rely:d}=e.pixelInputToGLCoord(t,this.boundingClientRect);var i=o(s(),[h,d,-1,1],this.camera.toWorld),n=o(s(),[h,d,1,1],this.camera.toWorld);r(i,i,1/i[3]),r(n,n,1/n[3]);const c=_(a(),[n[0],n[1],n[2]],[i[0],i[1],i[2]]);this.scene.linkedKnot.pickObj(c,this.camera.absPos)}h===this.scene.selected&&(this.scene.selectedNode||this.ui.shift)&&(this.ui.doubleClick.sameObj=!0)}1==t.button&&(this.ui.wheel_down=!0)}mouseUp(t){0==t.button&&(this.ui.left_down=!1),1==t.button&&(this.ui.wheel_down=!1),this.camera.setRay()}checkClick(t,e,i=25){const n=Math.abs(t-this.ui.doubleClick.lastX),s=Math.abs(e-this.ui.doubleClick.lastY);return n<i&&s<i}mouseMove(t){const i=t.clientX,n=t.clientY;if(this.scene.selectedNode||!this.ui.left_down&&!this.ui.wheel_down){if("Linked Knot"==this.scene.sceneType&&(this.scene.InsertOrConnect||this.scene.EraseOrSubdiv)&&(this.ui.left_down||this.ui.wheel_down)){if(this.ui.doubleClick.click)return void(this.ui.doubleClick.click=this.checkClick(i,n));const t=1/this.canvas.height,e=t*(i-this.ui.mouse.lastX),s=t*(n-this.ui.mouse.lastY);this.ui.left_down&&!this.ui.shift?(this.camera.addAngle(e,s),this.camera.update(this.gl,this.programs.render,this.canvas.width,this.canvas.height)):(this.ui.wheel_down||this.ui.shift&&this.ui.left_down)&&(this.camera.transform(e,s,this.scene.transform_z),this.camera.update(this.gl,this.programs.render,this.canvas.width,this.canvas.height))}else if("Linked Knot"==this.scene.sceneType&&this.scene.selectedNode&&(this.ui.left_down||this.scene.InsertOrConnect)){if(this.ui.doubleClick.click)return void(this.ui.doubleClick.click=this.checkClick(i,n,3));const{relx:c,rely:l}=e.pixelInputToGLCoord(t,this.boundingClientRect);var h=o(s(),[c,l,-1,1],this.camera.toWorld),d=o(s(),[c,l,1,1],this.camera.toWorld);r(h,h,1/h[3]),r(d,d,1/d[3]);const u=_(a(),[d[0],d[1],d[2]],[h[0],h[1],h[2]]);this.scene.linkedKnot.moveNode(u,this.camera.absPos,this.camera.normal)}}else{const t=1/this.canvas.height,e=t*(i-this.ui.mouse.lastX),s=t*(n-this.ui.mouse.lastY);this.ui.left_down&&!this.ui.shift?(this.camera.addAngle(e,s),this.camera.update(this.gl,this.programs.render,this.canvas.width,this.canvas.height),this.ui.doubleClick.click=!1):(this.ui.wheel_down||this.ui.shift&&this.ui.left_down)&&(this.ui.doubleClick.click&&(this.ui.doubleClick.click=this.checkClick(i,n,3)),this.camera.transform(e,s,this.scene.transform_z),this.camera.update(this.gl,this.programs.render,this.canvas.width,this.canvas.height))}this.ui.mouse.lastX=i,this.ui.mouse.lastY=n}zoom(t){this.camera.reset=!1,this.camera.addRadius(t.deltaY),this.configCamera()}resizer(){this.scene.quintuples.player.resize(),this.resizeCanvasToDisplaySize(),this.configCamera(),this.boundingClientRect=this.canvas.getBoundingClientRect()}resizeCanvasToDisplaySize(){const t=window.devicePixelRatio,{width:e,height:i}=this.canvas.getBoundingClientRect(),n=Math.round(e*t),s=Math.round(i*t);this.canvas.width=n,this.canvas.height=s}}const Ct=document.getElementById("gfx-main"),Mt=document.getElementById("error-screen");let zt=!1;var Et,Lt;if(Et=navigator.userAgent,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(Et)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(Et.substr(0,4)))&&(zt=!0),zt)throw Mt.textContent="Mobile and Tablets not supported.",Mt.classList.remove("hidden"),new Error("Use chrome on PC");try{Lt=new wt(Ct)}catch(t){throw console.log(t),Mt.textContent="Try a new version of Chrome.",Mt.classList.remove("hidden"),new Error}Lt.run()})(),t=f(91),e=f.n(t),i=new URL(f(551),f.b),n=new URL(f(951),f.b),s=new URL(f(337),f.b),r=new URL(f(517),f.b),o=new URL(f(994),f.b),a=new URL(f(873),f.b),h=new URL(f(856),f.b),d=new URL(f(282),f.b),c=new URL(f(794),f.b),l=new URL(f(302),f.b),e()(i),e()(n),e()(s),e()(r),e()(o),e()(a),e()(h),e()(d),e()(c),e()(l)})();