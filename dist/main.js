(()=>{"use strict";var t,i,e,o,s,n,r,a,h,c,l,_,d={91:t=>{t.exports=function(t,i){return i||(i={}),t?(t=String(t.__esModule?t.default:t),i.hash&&(t+=i.hash),i.maybeNeedQuotes&&/[\t\n\f\r "'=<>`]/.test(t)?'"'.concat(t,'"'):t):t}},951:(t,i,e)=>{t.exports=e.p+"83543eec05909a0ca535.png"},282:(t,i,e)=>{t.exports=e.p+"31f5ef0c8dffa5492da6.png"},517:(t,i,e)=>{t.exports=e.p+"3ecd27d9240d163175c1.png"},856:(t,i,e)=>{t.exports=e.p+"857e29fea39a49d24eab.png"},873:(t,i,e)=>{t.exports=e.p+"0d1cb381129368ba84d1.png"},551:(t,i,e)=>{t.exports=e.p+"ef6efa6101e076a26a10.png"},337:(t,i,e)=>{t.exports=e.p+"23da7583e2e60bf72666.png"},302:(t,i,e)=>{t.exports=e.p+"4392c3e322617baf9aa7.png"},794:(t,i,e)=>{t.exports=e.p+"c72adc7afbb90c3d3def.png"},994:(t,i,e)=>{t.exports=e.p+"65a7bd79167e55459bb5.png"}},u={};function p(t){var i=u[t];if(void 0!==i)return i.exports;var e=u[t]={exports:{}};return d[t](e,e.exports,p),e.exports}p.m=d,p.n=t=>{var i=t&&t.__esModule?()=>t.default:()=>t;return p.d(i,{a:i}),i},p.d=(t,i)=>{for(var e in i)p.o(i,e)&&!p.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:i[e]})},p.o=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),p.p="/dist/",p.b=document.baseURI||self.location.href,(()=>{class t{static checkWebGL(t){const i=["experimental-webgl","webkit-3d","moz-webgl"];var e=t.getContext("webgl",{preserveDrawingBuffer:!0});if(!e)for(var o=0;o<i.length;o++){try{e=t.getContext(i[o],{preserveDrawingBuffer:!0})}catch(t){}if(e)break}return e||alert("WebGL not available. Please use a new version of Chrome or Firefox."),e}static createProgram(i,e,o){var s=i.createProgram(),n=t.getShader(i,i.VERTEX_SHADER,e),r=t.getShader(i,i.FRAGMENT_SHADER,o);if(i.attachShader(s,n),i.attachShader(s,r),i.linkProgram(s),!i.getProgramParameter(s,i.LINK_STATUS)){var a=i.getProgramInfoLog(s);return console.log("Failed to link program: "+a),i.deleteProgram(s),i.deleteShader(r),i.deleteShader(n),null}return s}static renderBuffers(t,i,e,o=null){let s=t.getProgramParameter(i,t.ACTIVE_ATTRIBUTES);for(let o=0;o<s;++o){let s=t.getActiveAttrib(i,o);if(!s)break;var n=e[s.name],r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,n.bufferData,t.STATIC_DRAW);var a=t.getAttribLocation(i,s.name);t.enableVertexAttribArray(a),t.vertexAttribPointer(a,n.size,t.FLOAT,!1,0,n.bufferData.BYTES_PER_ELEMENT*n.offset)}if(o){var h=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,h),t.bufferData(t.ELEMENT_ARRAY_BUFFER,o,t.STATIC_DRAW)}}static getShader(t,i,e){var o=t.createShader(i);return t.shaderSource(o,e),t.compileShader(o),t.getShaderParameter(o,t.COMPILE_STATUS)?o:(console.log("An error occurred compiling the shaders:"+t.getShaderInfoLog(o)),t.deleteShader(o),null)}}class i{static inCanvas(t){var i=t.clientX,e=t.clientY,o=t.target.getBoundingClientRect();return o.left<=i&&i<o.right&&o.top<=e&&e<o.bottom}static pixelInputToGLCoord(t,i){var e=t.clientX,o=t.clientY,s=i.width/2,n=i.height/2,r=t.target.getBoundingClientRect();return{relx:e=(e-r.left-s)/s,rely:o=(n-(o-r.top))/n}}static pixelInputToCanvasCoord(t,i){var e=t.clientX,o=t.clientY,s=t.target.getBoundingClientRect();return{x:e-=s.left,y:o=s.bottom-o}}static pixelsFromMouseClick(t,e,o){var s=i.pixelInputToCanvasCoord(t,e),n=new Uint8Array(4);return o.readPixels(s.x,s.y,1,1,o.RGBA,o.UNSIGNED_BYTE,n),n}}var e=1e-6,o="undefined"!=typeof Float32Array?Float32Array:Array;function s(){var t=new o(4);return o!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function n(t,i,e){return t[0]=i[0]*e,t[1]=i[1]*e,t[2]=i[2]*e,t[3]=i[3]*e,t}function r(t,i,e){var o=i[0],s=i[1],n=i[2],r=i[3];return t[0]=e[0]*o+e[4]*s+e[8]*n+e[12]*r,t[1]=e[1]*o+e[5]*s+e[9]*n+e[13]*r,t[2]=e[2]*o+e[6]*s+e[10]*n+e[14]*r,t[3]=e[3]*o+e[7]*s+e[11]*n+e[15]*r,t}function a(){var t=new o(3);return o!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function h(t){var i=t[0],e=t[1],o=t[2];return Math.hypot(i,e,o)}function c(t,i,e){var s=new o(3);return s[0]=t,s[1]=i,s[2]=e,s}function l(t,i){return t[0]=i[0],t[1]=i[1],t[2]=i[2],t}function _(t,i,e){return t[0]=i[0]+e[0],t[1]=i[1]+e[1],t[2]=i[2]+e[2],t}function d(t,i,e){return t[0]=i[0]-e[0],t[1]=i[1]-e[1],t[2]=i[2]-e[2],t}function u(t,i,e){return t[0]=i[0]*e,t[1]=i[1]*e,t[2]=i[2]*e,t}function p(t,i,e,o){return t[0]=i[0]+e[0]*o,t[1]=i[1]+e[1]*o,t[2]=i[2]+e[2]*o,t}function f(t,i){var e=i[0]-t[0],o=i[1]-t[1],s=i[2]-t[2];return Math.hypot(e,o,s)}function v(t,i){var e=i[0],o=i[1],s=i[2],n=e*e+o*o+s*s;return n>0&&(n=1/Math.sqrt(n)),t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t}function y(t,i){return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]}function m(t,i,e){var o=i[0],s=i[1],n=i[2],r=e[0],a=e[1],h=e[2];return t[0]=s*h-n*a,t[1]=n*r-o*h,t[2]=o*a-s*r,t}function g(t,i,e){var o=e[0],s=e[1],n=e[2],r=e[3],a=i[0],h=i[1],c=i[2],l=s*c-n*h,_=n*a-o*c,d=o*h-s*a,u=s*d-n*_,p=n*l-o*d,f=o*_-s*l,v=2*r;return l*=v,_*=v,d*=v,u*=2,p*=2,f*=2,t[0]=a+l+u,t[1]=h+_+p,t[2]=c+d+f,t}function x(t){return t[0]=0,t[1]=0,t[2]=0,t}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var t=0,i=arguments.length;i--;)t+=arguments[i]*arguments[i];return Math.sqrt(t)}),s();var b=f,w=h;function k(){var t=new o(16);return o!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function C(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function M(t,i,e){var o,s,n,r,a,h,c,l,_,d,u,p,f=e[0],v=e[1],y=e[2];return i===t?(t[12]=i[0]*f+i[4]*v+i[8]*y+i[12],t[13]=i[1]*f+i[5]*v+i[9]*y+i[13],t[14]=i[2]*f+i[6]*v+i[10]*y+i[14],t[15]=i[3]*f+i[7]*v+i[11]*y+i[15]):(o=i[0],s=i[1],n=i[2],r=i[3],a=i[4],h=i[5],c=i[6],l=i[7],_=i[8],d=i[9],u=i[10],p=i[11],t[0]=o,t[1]=s,t[2]=n,t[3]=r,t[4]=a,t[5]=h,t[6]=c,t[7]=l,t[8]=_,t[9]=d,t[10]=u,t[11]=p,t[12]=o*f+a*v+_*y+i[12],t[13]=s*f+h*v+d*y+i[13],t[14]=n*f+c*v+u*y+i[14],t[15]=r*f+l*v+p*y+i[15]),t}function z(t,i){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function E(t,i,e,o){var s=i[0],n=i[1],r=i[2],a=i[3],h=s+s,c=n+n,l=r+r,_=s*h,d=s*c,u=s*l,p=n*c,f=n*l,v=r*l,y=a*h,m=a*c,g=a*l,x=o[0],b=o[1],w=o[2];return t[0]=(1-(p+v))*x,t[1]=(d+g)*x,t[2]=(u-m)*x,t[3]=0,t[4]=(d-g)*b,t[5]=(1-(_+v))*b,t[6]=(f+y)*b,t[7]=0,t[8]=(u+m)*w,t[9]=(f-y)*w,t[10]=(1-(_+p))*w,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}a();var L;function A(t,i){return t[0]*i[0]+t[1]*i[1]}L=new o(2),o!=Float32Array&&(L[0]=0,L[1]=0);const N=Math.PI;function P(t){return Math.cos(t)}function S(t){return Math.sin(t)}class B{constructor(t=N/4,i=N/4,e=12,o=[0,0,1.5]){this._spherical={theta:t,phi:i,radius:e},this._position=[0,0,0],this._ray={absPos:[0,0,0],normal:[0,0],toWorld:k()},this._transformation=o,this._mView=k(),this._mProj=k(),this._reset=!1,this.updateCameraPos(),this.setRay()}update(t,i,o,s){var n=t.getUniformLocation(i,"mView"),r=t.getUniformLocation(i,"mProj");t.viewport(0,0,o,s),function(t,i,e,o,s){var n,r=1/Math.tan(i/2);t[0]=r/e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=s&&s!==1/0?(n=1/(o-s),t[10]=(s+o)*n,t[14]=2*s*o*n):(t[10]=-1,t[14]=-2*o)}(this._mProj,N/4,o/s,1,5*this._spherical.radius),function(t,i,o,s){var n,r,a,h,c,l,_,d,u,p,f=i[0],v=i[1],y=i[2],m=s[0],g=s[1],x=s[2],b=o[0],w=o[1],k=o[2];Math.abs(f-b)<e&&Math.abs(v-w)<e&&Math.abs(y-k)<e?C(t):(_=f-b,d=v-w,u=y-k,n=g*(u*=p=1/Math.hypot(_,d,u))-x*(d*=p),r=x*(_*=p)-m*u,a=m*d-g*_,(p=Math.hypot(n,r,a))?(n*=p=1/p,r*=p,a*=p):(n=0,r=0,a=0),h=d*a-u*r,c=u*n-_*a,l=_*r-d*n,(p=Math.hypot(h,c,l))?(h*=p=1/p,c*=p,l*=p):(h=0,c=0,l=0),t[0]=n,t[1]=h,t[2]=_,t[3]=0,t[4]=r,t[5]=c,t[6]=d,t[7]=0,t[8]=a,t[9]=l,t[10]=u,t[11]=0,t[12]=-(n*f+r*v+a*y),t[13]=-(h*f+c*v+l*y),t[14]=-(_*f+d*v+u*y),t[15]=1)}(this._mView,this._position,[0,0,0],[0,0,1]),M(this._mView,this._mView,this._transformation),t.uniformMatrix4fv(n,!1,this._mView),t.uniformMatrix4fv(r,!1,this._mProj)}resetCam(t,i,e,o){const s=N/4-this._spherical.theta,n=N/4-this._spherical.phi,r=12-this._spherical.radius;s<-N||s>=0?this._spherical.theta+=Math.sqrt(Math.abs(s))/50:this._spherical.theta-=Math.sqrt(Math.abs(s))/50,this._spherical.phi+=Math.sign(n)*Math.sqrt(Math.abs(n))/50,this._spherical.phi=Math.min(Math.max(1e-4,this._spherical.phi),N-1e-4),this._spherical.radius+=r/50;var h=d(a(),[0,0,1.5],this._transformation);p(this._transformation,this._transformation,h,.02),Math.abs(s)<.005&&Math.abs(n)<.005&&Math.abs(r)<.01&&w(h)<.01&&(this.reset=!1),this.updateCameraPos(),this.update(t,i,e,o)}updateCameraPos(){this._spherical.theta>2*N&&(this._spherical.theta=this._spherical.theta-2*N),this._spherical.theta<0&&(this._spherical.theta=2*N-this._spherical.theta),this._position[0]=this._spherical.radius*S(this._spherical.phi)*P(this._spherical.theta),this._position[1]=this._spherical.radius*S(this._spherical.phi)*S(this._spherical.theta),this._position[2]=this._spherical.radius*P(this._spherical.phi)}addAngle(t,i){this._spherical.phi=this._spherical.phi-i*Math.sqrt(this._spherical.radius),this._spherical.theta=this._spherical.theta-t*Math.sqrt(this._spherical.radius),this._spherical.phi=Math.min(Math.max(1e-4,this._spherical.phi),N-1e-4),this.updateCameraPos()}addRadius(t){this._spherical.radius+=5e-4*t*this._spherical.radius,this._spherical.radius=Math.min(Math.max(2,this._spherical.radius),35),this.updateCameraPos()}transform(t,i,e){e?this._transformation[2]=this._transformation[2]-S(this._spherical.phi)*i*this._spherical.radius:(this._transformation[0]=this._transformation[0]-S(this._spherical.theta)*t*this._spherical.radius,this._transformation[0]=this._transformation[0]+P(this._spherical.theta)*i*this._spherical.radius,this._transformation[1]=this._transformation[1]+P(this._spherical.theta)*t*this._spherical.radius,this._transformation[1]=this._transformation[1]+S(this._spherical.theta)*i*this._spherical.radius),this._transformation[0]=Math.min(Math.max(-15,this._transformation[0]),15),this._transformation[1]=Math.min(Math.max(-15,this._transformation[1]),15),this._transformation[2]=Math.min(Math.max(-15,this._transformation[2]),15)}setRay(){var t,i,e,o,s,n,r,a,h,c,l,_,u,p,f,v,y,m,g,x,b,w,C,M,z,E,L,A,N,P,S;t=this._ray.toWorld,i=function(t,i,e){var o=i[0],s=i[1],n=i[2],r=i[3],a=i[4],h=i[5],c=i[6],l=i[7],_=i[8],d=i[9],u=i[10],p=i[11],f=i[12],v=i[13],y=i[14],m=i[15],g=e[0],x=e[1],b=e[2],w=e[3];return t[0]=g*o+x*a+b*_+w*f,t[1]=g*s+x*h+b*d+w*v,t[2]=g*n+x*c+b*u+w*y,t[3]=g*r+x*l+b*p+w*m,g=e[4],x=e[5],b=e[6],w=e[7],t[4]=g*o+x*a+b*_+w*f,t[5]=g*s+x*h+b*d+w*v,t[6]=g*n+x*c+b*u+w*y,t[7]=g*r+x*l+b*p+w*m,g=e[8],x=e[9],b=e[10],w=e[11],t[8]=g*o+x*a+b*_+w*f,t[9]=g*s+x*h+b*d+w*v,t[10]=g*n+x*c+b*u+w*y,t[11]=g*r+x*l+b*p+w*m,g=e[12],x=e[13],b=e[14],w=e[15],t[12]=g*o+x*a+b*_+w*f,t[13]=g*s+x*h+b*d+w*v,t[14]=g*n+x*c+b*u+w*y,t[15]=g*r+x*l+b*p+w*m,t}(k(),this._mProj,this._mView),e=i[0],o=i[1],s=i[2],n=i[3],r=i[4],a=i[5],h=i[6],c=i[7],l=i[8],_=i[9],u=i[10],p=i[11],f=i[12],v=i[13],y=i[14],(S=(g=e*a-o*r)*(P=u*(m=i[15])-p*y)-(x=e*h-s*r)*(N=_*m-p*v)+(b=e*c-n*r)*(A=_*y-u*v)+(w=o*h-s*a)*(L=l*m-p*f)-(C=o*c-n*a)*(E=l*y-u*f)+(M=s*c-n*h)*(z=l*v-_*f))&&(S=1/S,t[0]=(a*P-h*N+c*A)*S,t[1]=(s*N-o*P-n*A)*S,t[2]=(v*M-y*C+m*w)*S,t[3]=(u*C-_*M-p*w)*S,t[4]=(h*L-r*P-c*E)*S,t[5]=(e*P-s*L+n*E)*S,t[6]=(y*b-f*M-m*x)*S,t[7]=(l*M-u*b+p*x)*S,t[8]=(r*N-a*L+c*z)*S,t[9]=(o*L-e*N-n*z)*S,t[10]=(f*C-v*b+m*g)*S,t[11]=(_*b-l*C-p*g)*S,t[12]=(a*E-r*A-h*z)*S,t[13]=(e*A-o*E+s*z)*S,t[14]=(v*x-f*w-y*g)*S,t[15]=(l*w-_*x+u*g)*S),d(this._ray.absPos,this._position,this._transformation),function(t,i){var e=i[0],o=i[1],s=e*e+o*o;s>0&&(s=1/Math.sqrt(s)),t[0]=i[0]*s,t[1]=i[1]*s}(this._ray.normal,[this._position[0],this._position[1]])}get toWorld(){return this._ray.toWorld}get absPos(){return this._ray.absPos}get normal(){return this._ray.normal}get reset(){return this._reset}set reset(t){this._reset=t}}class j{static setLight(t,i,e=[50,50,50]){var o=e,s=t.getUniformLocation(i,"uAmbientLight"),n=t.getUniformLocation(i,"uDiffuseLight"),r=t.getUniformLocation(i,"uLightPosition");t.uniform3f(s,.75,.75,.75),t.uniform3f(n,.35,.35,.35),t.uniform3f(r,o[0],o[1],o[2])}}function T(){var t=new o(9);return o!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function K(t,i){var e=i[0],o=i[1],s=i[2],n=i[3],r=i[4],a=i[5],h=i[6],c=i[7],l=i[8],_=i[9],d=i[10],u=i[11],p=i[12],f=i[13],v=i[14],y=i[15],m=e*a-o*r,g=e*h-s*r,x=e*c-n*r,b=o*h-s*a,w=o*c-n*a,k=s*c-n*h,C=l*f-_*p,M=l*v-d*p,z=l*y-u*p,E=_*v-d*f,L=_*y-u*f,A=d*y-u*v,N=m*A-g*L+x*E+b*z-w*M+k*C;return N?(N=1/N,t[0]=(a*A-h*L+c*E)*N,t[1]=(h*z-r*A-c*M)*N,t[2]=(r*L-a*z+c*C)*N,t[3]=(s*L-o*A-n*E)*N,t[4]=(e*A-s*z+n*M)*N,t[5]=(o*z-e*L-n*C)*N,t[6]=(f*k-v*w+y*b)*N,t[7]=(v*x-p*k-y*g)*N,t[8]=(p*w-f*x+y*m)*N,t):null}class D{constructor(t,i=1,e=[.1,.2,.3],o=.1,s=[0,0,0]){this._opacity=i,this._color=e,this._selColor=[t[0]/255,t[1]/255,t[2]/255,t[3]/255];const n=o;let r,a,h=1/n,c=2*Math.PI/15,l=Math.PI/14;var _,d,u,p,f,v,y=[],m=[],g=[],x=[],b=[];for(let t=0;t<=14;++t){a=Math.PI/2-t*l,_=n*Math.cos(a),d=n*Math.sin(a);for(let t=0;t<=15;++t)r=t*c,u=_*Math.cos(r),p=_*Math.sin(r),y.push(u,p,d),m.push(u*h,p*h,d*h),g.push(this.selColor[0],this.selColor[1],this.selColor[2],this.selColor[3]),x.push(this.color[0],this.color[1],this.color[2],this.opacity)}for(let t=0;t<14;++t){v=15+(f=16*t)+1;for(let i=0;i<15;++i,++f,++v)0!=t&&b.push(f,v,f+1),13!=t&&b.push(f+1,v,v+1)}this._attributes={aColor:{size:4,offset:0,bufferData:new Float32Array(x)},aPosition:{size:3,offset:0,bufferData:new Float32Array(y)},aNormal:{size:3,offset:0,bufferData:new Float32Array(m)},aSelColor:{size:4,offset:0,bufferData:new Float32Array(g)},aColorBackup:{size:4,offset:0,bufferData:new Float32Array([])}},this._indices=new Uint8Array(b),this._state={position:s,mvp:k(),nm:T(),n:this._indices.length},this.updateMat()}readState(){this._attributes.aColorBackup=this._attributes.aColor,this._attributes.aColor=this._attributes.aSelColor}drawState(){this._attributes.aColor=this._attributes.aColorBackup}draw(i,e,o=!0){var s=i.getUniformLocation(e,"mWorld"),n=i.getUniformLocation(e,"uNormalMatrix");t.renderBuffers(i,e,this._attributes,this._indices),i.uniformMatrix4fv(s,!1,this._state.mvp),o&&i.uniformMatrix3fv(n,!1,this._state.nm),i.drawElements(i.TRIANGLES,this._state.n,i.UNSIGNED_BYTE,0)}updateMat(){z(this._state.mvp,this._state.position),K(this._state.nm,this._state.mvp)}get opacity(){return this._opacity}get color(){return this._color}get selColor(){return this._selColor}get position(){return this._state.position}set position(t){if(!t)throw new Error("error in Sphere.ts set position");this._state.position=t,this.updateMat()}set opacity(t){this._opacity=t,this._attributes.aColor.bufferData=new Float32Array([this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity])}set color(t){this._color=t;var i=[];for(let t=0;t<=14;++t)for(let t=0;t<=15;++t)i.push(this.color[0],this.color[1],this.color[2],this.opacity);this._attributes.aColor.bufferData=new Float32Array(i)}}function F(){var t=new o(4);return o!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}var I,R,U,q=(I=a(),R=c(1,0,0),U=c(0,1,0),function(t,i,e){var o=y(i,e);return o<-.999999?(m(I,R,i),w(I)<1e-6&&m(I,U,i),v(I,I),function(t,i,e){e*=.5;var o=Math.sin(e);t[0]=o*i[0],t[1]=o*i[1],t[2]=o*i[2],t[3]=Math.cos(e)}(t,I,Math.PI),t):o>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(m(I,i,e),t[0]=I[0],t[1]=I[1],t[2]=I[2],t[3]=1+o,function(t,i){var e=i[0],o=i[1],s=i[2],n=i[3],r=e*e+o*o+s*s+n*n;return r>0&&(r=1/Math.sqrt(r)),t[0]=e*r,t[1]=o*r,t[2]=s*r,t[3]=n*r,t}(t,t))});F(),F(),T();class O{constructor(t,i=1,e=[.18,.1,.18],o=[0,0,0],s=[0,0,1]){this._opacity=i,this._color=e,this._selColor=[t[0]/255,t[1]/255,t[2]/255,t[3]/255];let n=0;var r,h,c,l,_,d=[],u=[],p=[],f=[],v=[];for(let t=0;t<=1;++t){r=t;for(let t=0,i=0;t<=16;++t,i+=3)n=t/16*2*Math.PI,h=Math.cos(n),c=Math.sin(n),d.push(.03*h,.03*c,r),u.push(h,c,0),p.push(this.selColor[0],this.selColor[1],this.selColor[2],this.selColor[3]),f.push(this.color[0],this.color[1],this.color[2],this.opacity)}for(let t=0;t<1;++t){_=16+(l=17*t)+1;for(let t=0;t<16;++t,++l,++_)v.push(l,l+1,_),v.push(_,l+1,_+1)}this._attributes={aColor:{size:4,offset:0,bufferData:new Float32Array(f)},aNormal:{size:3,offset:0,bufferData:new Float32Array(u)},aPosition:{size:3,offset:0,bufferData:new Float32Array(d)},aSelColor:{size:4,offset:0,bufferData:new Float32Array(p)},aColorBackup:{size:4,offset:0,bufferData:new Float32Array([])}},this._indices=new Uint8Array(v),this._state={start:o,end:s,rotQuat:F(),scale:a(),mvp:k(),nm:T(),n:this._indices.length},this.updateMat()}readState(){this._attributes.aColorBackup=this._attributes.aColor,this._attributes.aColor=this._attributes.aSelColor}drawState(){this._attributes.aColor=this._attributes.aColorBackup}draw(i,e,o=!0){var s=i.getUniformLocation(e,"mWorld"),n=i.getUniformLocation(e,"uNormalMatrix");t.renderBuffers(i,e,this._attributes,this._indices),i.uniformMatrix4fv(s,!1,this._state.mvp),o&&i.uniformMatrix3fv(n,!1,this._state.nm),i.drawElements(i.TRIANGLES,this._state.n,i.UNSIGNED_BYTE,0)}get opacity(){return this._opacity}get color(){return this._color}get selColor(){return this._selColor}get start(){return this._state.start}get end(){return this._state.end}updateMat(){d(this._state.scale,this._state.end,this._state.start),q(this._state.rotQuat,[0,0,1],v(a(),this._state.scale)),E(this._state.mvp,this._state.rotQuat,this._state.start,[1,1,h(this._state.scale)]),K(this._state.nm,this._state.mvp)}set start(t){if(!t)throw new Error("error in Cylinder.ts set start");this._state.start=t,this.updateMat()}set end(t){if(!t)throw new Error("error in Cylinder.ts set end");this._state.end=t,this.updateMat()}set opacity(t){this._opacity=t,this._attributes.aColor.bufferData=new Float32Array([this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity,this._color[0],this._color[1],this._color[2],this._opacity])}set color(t){this._color=t;var i=[];for(let t=0;t<=1;++t)for(let t=0;t<=16;++t)i.push(this.color[0],this.color[1],this.color[2],this.opacity);this._attributes.aColor.bufferData=new Float32Array(i)}}class G{constructor(){this._opacity1=.24,this._opacity2=.4,this._attributes1={aColor:{size:4,offset:0,bufferData:new Float32Array([0,0,0,this._opacity1,0,0,0,this._opacity1,0,0,0,this._opacity1,0,0,0,this._opacity1])},aNormal:{size:3,offset:0,bufferData:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1])},aPosition:{size:3,offset:0,bufferData:new Float32Array([5,5,0,5,-5,0,-5,5,0,-5,-5,0])}},this._indices1=new Uint8Array([0,1,2,1,2,3]),this._attributes2={aColor:{size:4,offset:0,bufferData:new Float32Array([0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2])},aNormal:{size:3,offset:0,bufferData:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1])},aPosition:{size:3,offset:0,bufferData:new Float32Array([5,0,0,-5,0,0,5,.5,0,-5,.5,0,5,1,0,-5,1,0,5,1.5,0,-5,1.5,0,5,2,0,-5,2,0,5,2.5,0,-5,2.5,0,5,3,0,-5,3,0,5,3.5,0,-5,3.5,0,5,4,0,-5,4,0,5,4.5,0,-5,4.5,0,5,-.5,0,-5,-.5,0,5,-1,0,-5,-1,0,5,-1.5,0,-5,-1.5,0,5,-2,0,-5,-2,0,5,-2.5,0,-5,-2.5,0,5,-3,0,-5,-3,0,5,-3.5,0,-5,-3.5,0,5,-4,0,-5,-4,0,5,-4.5,0,-5,-4.5,0,0,5,0,0,-5,0,.5,5,0,.5,-5,0,1,5,0,1,-5,0,1.5,5,0,1.5,-5,0,2,5,0,2,-5,0,2.5,5,0,2.5,-5,0,3,5,0,3,-5,0,3.5,5,0,3.5,-5,0,4,5,0,4,-5,0,4.5,5,0,4.5,-5,0,-.5,5,0,-.5,-5,0,-1,5,0,-1,-5,0,-1.5,5,0,-1.5,-5,0,-2,5,0,-2,-5,0,-2.5,5,0,-2.5,-5,0,-3,5,0,-3,-5,0,-3.5,5,0,-3.5,-5,0,-4,5,0,-4,-5,0,-4.5,5,0,-4.5,-5,0])}},this._state={mvp:k(),nm:T(),n1:this._indices1.length,n2:76},C(this._state.mvp),this._state.nm=K(T(),this._state.mvp)}draw(i,e,o=!0){if(o){var s=i.getUniformLocation(e,"mWorld"),n=i.getUniformLocation(e,"uNormalMatrix");i.uniformMatrix4fv(s,!1,this._state.mvp),i.uniformMatrix3fv(n,!1,this._state.nm),t.renderBuffers(i,e,this._attributes1,this._indices1),i.drawElements(i.TRIANGLES,this._state.n1,i.UNSIGNED_BYTE,0),t.renderBuffers(i,e,this._attributes2),i.drawArrays(i.LINES,0,this._state.n2)}}}class Y{constructor(){this._arrows=[new V([0,0,1]),new V([0,0,-1])],this._position=[0,0,0]}draw(t,i,e=!0){this._arrows[0].draw(t,i,e),this._arrows[1].draw(t,i,e)}set position(t){if(!t)throw new Error("error in Arrow.ts set position");this._arrows[0].position=t,this._arrows[1].position=t}}class W{constructor(){this._arrows=[new V([1,0,0]),new V([-1,0,0]),new V([0,1,0]),new V([0,-1,0])],this._position=[0,0,0]}draw(t,i,e=!0){this._arrows[0].draw(t,i,e),this._arrows[1].draw(t,i,e),this._arrows[2].draw(t,i,e),this._arrows[3].draw(t,i,e)}set position(t){if(!t)throw new Error("error in Arrow.ts set position");this._arrows[0].position=t,this._arrows[1].position=t,this._arrows[2].position=t,this._arrows[3].position=t}}class V{constructor(t=[0,0,0]){this._state={mvp:k(),nm:T(),n:0};const i=[.3,.3,.3],e=16,o=.04,s=.08;let n=0;var r=[],h=[],c=[],l=[];const _=q(F(),[0,0,1],t);var d,u,p,f,y,m=a();for(let t=0;t<=1;++t){d=.2*t+.2;for(let t=0,s=0;t<=e;++t,s+=3)n=t/e*2*Math.PI,g(m,[o*(u=Math.cos(n)),o*(p=Math.sin(n)),d],_),r.push(m[0],m[1],m[2]),g(m,[u,p,0],_),h.push(m[0],m[1],m[2]),c.push(i[0],i[1],i[2],.3)}for(let t=0;t<1;++t){y=(f=17*t)+e+1;for(let t=0;t<e;++t,++f,++y)l.push(f,f+1,y),l.push(y,f+1,y+1)}for(let t=0;t<=1;++t){d=.4;for(let a=0,l=0;a<=e;++a,l+=3)n=a/e*2*Math.PI,u=Math.cos(n),p=Math.sin(n),g(m,0==t?[o*u,o*p,d]:[s*u,s*p,d],_),r.push(m[0],m[1],m[2]),g(m,[0,0,-1],_),h.push(m[0],m[1],m[2]),c.push(i[0],i[1],i[2],.3)}for(let t=2;t<3;++t){y=(f=17*t)+e+1;for(let t=0;t<e;++t,++f,++y)l.push(f,f+1,y),l.push(y,f+1,y+1)}for(let t=0;t<=1;++t){d=.2*t+.2+.2;for(let o=0,a=0;o<=e;++o,a+=3)n=o/e*2*Math.PI,u=Math.cos(n),p=Math.sin(n),g(m,0==t?[s*u,s*p,d]:[0,0,d],_),r.push(m[0],m[1],m[2]),g(m,[.2*u,.2*p,s],_),v(m,m),h.push(m[0],m[1],m[2]),c.push(i[0],i[1],i[2],.3)}for(let t=4;t<5;++t){y=(f=17*t)+e+1;for(let t=0;t<e;++t,++f,++y)l.push(f,f+1,y),l.push(y,f+1,y+1)}this._attributes={aColor:{size:4,offset:0,bufferData:new Float32Array(c)},aNormal:{size:3,offset:0,bufferData:new Float32Array(h)},aPosition:{size:3,offset:0,bufferData:new Float32Array(r)}},this._indices=new Uint8Array(l),this._state.n=this._indices.length,C(this._state.mvp),K(this._state.nm,this._state.mvp)}draw(i,e,o=!0){if(o){var s=i.getUniformLocation(e,"mWorld"),n=i.getUniformLocation(e,"uNormalMatrix");t.renderBuffers(i,e,this._attributes,this._indices),i.uniformMatrix4fv(s,!1,this._state.mvp),i.uniformMatrix3fv(n,!1,this._state.nm),i.drawElements(i.TRIANGLES,this._state.n,i.UNSIGNED_BYTE,0)}}set position(t){z(this._state.mvp,t),K(this._state.nm,this._state.mvp)}}class X{constructor(){this._opacity=.8,this._color=[.2,.2,.2];var t=[],i=[],e=[];for(let o=0;o<=25;++o)t.push(0,0,.2*o),i.push(0,0,0),e.push(this._color[0],this._color[1],this._color[2],this._opacity);this._attributes={aColor:{size:4,offset:0,bufferData:new Float32Array(e)},aNormal:{size:3,offset:0,bufferData:new Float32Array(i)},aPosition:{size:3,offset:0,bufferData:new Float32Array(t)}},this._state={position:[0,0,0],length:0,mvp:k(),n:0}}draw(i,e,o=!0){if(o){var s=i.getUniformLocation(e,"mWorld");t.renderBuffers(i,e,this._attributes),i.uniformMatrix4fv(s,!1,this._state.mvp),i.drawArrays(i.LINES,0,this._state.n)}}set position(t){if(!t)throw new Error("error in Cylinder.ts set start");var i,e;this._state.position[0]=t[0],this._state.position[1]=t[1],this._state.length=t[2],i=this._state.mvp,e=[1,1,Math.sign(this._state.length)],i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,M(this._state.mvp,this._state.mvp,this._state.position),this._state.n=Math.floor(Math.abs(this._state.length)/.2+1.5),this._state.n-=this._state.n%2}}class Q{constructor(){this._nodeStack=new H,this._edgeStack=new H,this._nodeNum=0,this._edgeNum=0,this._isKnot=!1,this._nodeArr=[],this._transform_z=!1,this._selected=null,this._xyPlane=new G,this._planeArrows=new W,this._verticalArrows=new Y,this._guide=new X,this._overlapNode=null,this._drawingTool=new $(this),this._drawingTool.initCallback()}deleteData(){this._nodeStack=new H,this._edgeStack=new H,this._nodeNum=0,this._edgeNum=0,this._isKnot=!1,this._nodeArr=[],this._selected=null,this._drawingTool.reset()}insert(){var t=[0,0,0];this.selectedNode&&(t=this.selected.object.position,this._overlapNode=this.selected);const i=this._nodeStack.available(),e=new J([i,0,0,255],t);if(i>255)throw new Error("Can only have at most 255 Nodes");this._nodeStack.insert(e,i),this.nodeNum++,this._isKnot=!1,this.selected=e}connect(t,i){const e=this._edgeStack.available();if(e>255)throw new Error("Can only have at most 255 Edges");var o;if(t.curNext||i.prevCur)if(t.prevCur||i.curNext)if(t.curNext||i.curNext){if(t.prevCur||i.prevCur)throw new Error("Nodes can only have 2 edges");Q.reverse(t),o=new Z(t,i,[0,e,1,255])}else Q.reverse(i),o=new Z(t,i,[0,e,1,255]);else o=new Z(i,t,[0,e,1,255]);else o=new Z(t,i,[0,e,1,255]);this._edgeStack.insert(o,e),this.edgeNum++,this.checkKnot()}subdivide(){if(this.selected instanceof Z){const t=this.selected.startNode,i=this.selected.endNode,e=u(a(),_(a(),i.object.position,t.object.position),.5);this.delete(),this.insert(),this.selected.object.position=e,this.connect(this.selected,i),this.connect(t,this.selected),this._verticalArrows.position=this.selected.object.position,this._planeArrows.position=this.selected.object.position}}connected(t,i){return t.next instanceof J&&(t.next===i.next||t.next===i.prev)||t.prev instanceof J&&(t.prev===i.next||t.prev===i.prev)}delete(t=this.selected){t instanceof J?(this._nodeStack.delete(t),this.nodeNum--,t.prevCur&&(this._edgeStack.delete(t.prevCur),this.edgeNum--),t.curNext&&(this._edgeStack.delete(t.curNext),this.edgeNum--),t.delete()):t instanceof Z&&(t.delete(),this._edgeStack.delete(t),this.edgeNum--),this.selected=null,this.checkKnot()}static reverse(t){var i,e,o,s=t;if(t.next)do{o=s,s=s.next,null===(i=o.curNext)||void 0===i||i.reverse(),o.reverse()}while(s);else if(t.prev)do{o=s,s=s.prev,null===(e=o.prevCur)||void 0===e||e.reverse(),o.reverse()}while(s)}checkKnot(){if(this.nodeNum==this.edgeNum&&this.nodeNum>2){var t=null;for(let i=0;i<this._nodeStack.data.length;i++)if(null!==this._nodeStack.data[i]){t=this._nodeStack.data[i];break}var i=null==t?void 0:t.next;for(let e=1;e<this.nodeNum;e++){if(!i)return void(this._isKnot=!1);if(t===i)return void(this._isKnot=!1);i=i.next}this._isKnot=!0}else this._isKnot=!1}draw(t,i,e){var o;for(let s=0;s<this._nodeStack.data.length;s++)(o=this._nodeStack.data[s])&&o.object.draw(t,i,e);for(let s=0;s<this._edgeStack.data.length;s++)(o=this._edgeStack.data[s])&&o.object.draw(t,i,e);e&&(t.enable(t.BLEND),t.depthMask(!1),this._xyPlane.draw(t,i,!0),this.selectedNode&&(this.transform_z?this._verticalArrows.draw(t,i,!0):this._planeArrows.draw(t,i,!0),this._guide.draw(t,i,!0)),t.disable(t.BLEND),t.depthMask(!0))}get isEmpty(){return 0==this.nodeNum&&0==this.edgeNum}get isKnot(){return this._isKnot}get nodeArr(){var t=null;for(let i=0;i<this._nodeStack.data.length;i++)if(null!==this._nodeStack.data[i]){t=this._nodeStack.data[i];break}var i=null==t?void 0:t.next;this._nodeArr=[],this._nodeArr.push(t.object.position);for(let e=1;e<this.nodeNum;e++){if(!i)throw this._isKnot=!1,new Error("not a knot");if(this._nodeArr.push(i.object.position),t===i)return void(this._isKnot=!1);i=i.next}return this._nodeArr}get selectedNode(){return this.selected instanceof J}get selected(){return this._selected}set selected(t){this.selected&&(this.selected.object.color=d(a(),this.selected.object.color,[.18,.18,.18])),this._selected=t,this.selected&&(this.selected.object.color=_(a(),this.selected.object.color,[.18,.18,.18]),this.selectedNode&&(this._verticalArrows.position=this.selected.object.position,this._planeArrows.position=this.selected.object.position,this._guide.position=this.selected.object.position))}get drawingTool(){return this._drawingTool}get nodeNum(){return this._nodeNum}set nodeNum(t){this._nodeNum=t}get edgeNum(){return this._edgeNum}set edgeNum(t){this._edgeNum=t}get transform_z(){return this._transform_z}set transform_z(t){this._transform_z=t}setDrawState(t){t?(this._nodeStack.data.forEach((function(t){t&&t.object.drawState()})),this._edgeStack.data.forEach((function(t){t&&t.object.drawState()}))):(this._nodeStack.data.forEach((function(t){t&&t.object.readState()})),this._edgeStack.data.forEach((function(t){t&&t.object.readState()})))}btnManager(){if(this.drawingTool.insert)this._overlapNode&&this.selected instanceof J&&(this.delete(),this.selected=this._overlapNode),this.insert(),this.drawingTool.insert=!0;else if(this.drawingTool.connectFirst){this._overlapNode&&this.selected instanceof J&&(this.delete(),this.selected=this._overlapNode);const t=this.selected;this.insert(),this.connect(t,this.selected),this.drawingTool.connectFirst=!1}else if(this.drawingTool.connectLast&&this.selected instanceof J){var t=null;if(this._overlapNode&&(this.selected.prev?t=this.selected.prev:this.selected.next&&(t=this.selected.next),this.delete(),this.selected=this._overlapNode,this.connect(t,this.selected),this.selected.next&&this.selected.prev))return void(this.drawingTool.connectLast=!1);t=this.selected,this.insert(),this.connect(t,this.selected)}}moveNode(t,i,e){var o,s;if(this.selected instanceof J){var n=a();l(n,this.selected.object.position);const r=d(a(),i,this.selected.object.position);if(this.transform_z){const o=A(e,[r[0],r[1]]);n[2]=t[2]*(-o/A([t[0],t[1]],e))+i[2],n[2]=Math.max(-5,Math.min(5,n[2]))}else{const e=-r[2]/t[2];n[0]=t[0]*e+i[0],n[1]=t[1]*e+i[1],n[0]=Math.max(-5,Math.min(5,n[0])),n[1]=Math.max(-5,Math.min(5,n[1]))}this.selected.object.position=n,(this.drawingTool.insert||this.drawingTool.connectLast)&&(this.overlapping(v(a(),t),i),this._overlapNode&&(this.selected.object.position=this._overlapNode.object.position)),null===(o=this.selected.prevCur)||void 0===o||o.updatePos(),null===(s=this.selected.curNext)||void 0===s||s.updatePos(),this._verticalArrows.position=this.selected.object.position,this._planeArrows.position=this.selected.object.position,this._guide.position=this.selected.object.position}}overlapping(t,i){var e,o,s;if(this.selected instanceof J)for(let n=0;n<this._nodeStack.data.length;n++)if(e=this._nodeStack.data[n]){if(e===this.selected||e===this.selected.prev||e===this.selected.next||this.connected(e,this.selected))continue;if((!e.prevCur||!e.curNext)&&(o=f(i,e.object.position),s=_(a(),u(a(),t,o),i),f(e.object.position,s)<.25))return void(this._overlapNode=e)}this._overlapNode=null}pickObj(t){t=t.map((function(t){return t/255}));var i=null;this._nodeStack.data.forEach((function(e){e&&t.every((function(t,i){return t===e.object.selColor[i]}))&&(i=e)})),this._edgeStack.data.forEach((function(e){e&&t.every((function(t,i){return t===e.object.selColor[i]}))&&(i=e)})),this.selected=i,this._overlapNode=null,this.drawingTool.erase?(this.delete(),this.isKnot&&(this.drawingTool.erase=!1)):this.drawingTool.subdivide&&(this.subdivide(),this.drawingTool.subdivide=!1)}}class H{constructor(){this._data=[]}insert(t,i){i<this._data.length?this._data[i]=t:this._data.push(t)}free(t){this._data[t]=null}delete(t){for(let i=0;i<this._data.length;i++)this._data[i]===t&&(this._data[i]=null)}available(){for(let t=0;t<this._data.length;t++)if(!this._data[t])return t;return this._data.length}get data(){return this._data}}class Z{constructor(t,i,e){this._startNode=t,this._endNode=i,this._startNode.curNext=this,this._startNode.next=this._endNode,this._endNode.prevCur=this,this._endNode.prev=this._startNode,this._object=new O(e,1,[.4,.4,.4],this._startNode.object.position,this._endNode.object.position)}delete(){this._startNode.next=null,this._endNode.prev=null,this._startNode.curNext=null,this._endNode.prevCur=null}updatePos(){this.object.start=this._startNode.object.position,this.object.end=this._endNode.object.position}reverse(){const t=this._startNode;this._startNode=this._endNode,this._endNode=t}get object(){return this._object}get startNode(){return this._startNode}set startNode(t){this._startNode=t}get endNode(){return this._endNode}set endNode(t){this._endNode=t}}class J{constructor(t,i=c(0,0,0),e=null,o=null){this._object=new D(t,1,u(a(),[42,106,209],1/255),.1,i),this._prev=e,this._next=o,this._curNext=null,this._prevCur=null}delete(){var t,i;null===(t=this._prevCur)||void 0===t||t.delete(),null===(i=this._curNext)||void 0===i||i.delete()}reverse(){const t=this._next;this._next=this._prev,this._prev=t;const i=this._curNext;this._curNext=this._prevCur,this._prevCur=i}get object(){return this._object}get next(){return this._next}get prev(){return this._prev}get prevCur(){return this._prevCur}get curNext(){return this._curNext}set next(t){this._next=t}set prev(t){this._prev=t}set prevCur(t){this._prevCur=t}set curNext(t){this._curNext=t}}class ${constructor(t){this._linkedKnot=t,this._overlay=document.getElementById("drawing tool"),this._insertBtn=document.getElementById("insert button"),this._connectBtn=document.getElementById("connect button"),this._subdivideBtn=document.getElementById("subdivide button"),this._eraseBtn=document.getElementById("erase button"),this._insert=!1,this._connectFirst=!1,this._connectLast=!1,this._subdivide=!1,this._erase=!1}initCallback(){this._overlay.addEventListener("mousedown",(t=>{this.resize(t)})),this._insertBtn.addEventListener("click",(()=>{this.insertBtnResponse()})),this._connectBtn.addEventListener("click",(()=>{this.connectBtnResponse()})),this._eraseBtn.addEventListener("click",(()=>{this.eraseBtnResponse()})),this._subdivideBtn.addEventListener("click",(()=>{this.subdivideBtnResponse()}))}reset(){this.insert=!1,this.connectLast=!1,this.subdivide=!1,this.erase=!1}insertBtnResponse(){if(this.linkedKnot.nodeNum>254)throw new Error("cannot have more than 255 nodes");if(this.insert=!this.insert,this.insert){if(this.linkedKnot.transform_z=!1,this.connectFirst)return void(this.connectLast=!1);this.connectLast&&this.linkedKnot.delete(),this.linkedKnot.insert()}else this.linkedKnot.delete();this.erase=!1,this.connectLast=!1,this.subdivide=!1}connectBtnResponse(){if(this.linkedKnot.nodeNum>254)throw new Error("cannot have more than 255 nodes");this.connectLast=!this.connectLast,this.connectLast?(this.linkedKnot.transform_z=!1,this.insert||this.linkedKnot.insert()):this.linkedKnot.delete(),this.insert=!1,this.erase=!1,this.subdivide=!1}eraseBtnResponse(){this.erase=!this.erase,this.erase&&((this.connectLast||this.insert)&&this.linkedKnot.delete(),this.linkedKnot.selected=null),this.insert=!1,this.connectLast=!1,this.subdivide=!1}subdivideBtnResponse(){this.subdivide=!this.subdivide,this.subdivide&&((this.connectLast||this.insert)&&this.linkedKnot.delete(),this.linkedKnot.selected=null),this.insert=!1,this.connectLast=!1,this.erase=!1}get insert(){return this._insert}set insert(t){this._insert=t,this._insertBtn.classList.toggle("active",t)}set connectLast(t){this._connectLast=t,this._connectFirst=t,this._connectBtn.classList.toggle("active",t)}set connectFirst(t){this._connectFirst=t}get connectLast(){return this._connectLast}get connectFirst(){return this._connectFirst}get subdivide(){return this._subdivide}set subdivide(t){this._subdivide=t,this._subdivideBtn.classList.toggle("active",t)}set erase(t){this._erase=t,this._eraseBtn.classList.toggle("active",t)}get erase(){return this._erase}get linkedKnot(){return this._linkedKnot}Disable(t){this.insert=!1,this.connectLast=!1,this.subdivide=!1,this.erase=!1,!0===t?this._overlay.classList.toggle("hidden",!0):this._overlay.classList.toggle("hidden",!1)}resize(t){t.offsetY>=75&&t.offsetX<240&&t.offsetX>160&&("translate(0px, -80%)"===this._overlay.style.transform?this._overlay.style.transform="translate(0px, -0%)":this._overlay.style.transform="translate(0px, -80%)")}}const tt=Math.PI;function it(t){return Math.cos(t)}function et(t){return Math.sin(t)}class ot{constructor(){this._cosCoef=[],this._sinCoef=[],this._color=[50,105,205],u(this._color,this._color,1/255),this._opacity=1,this._attributes={aColor:{size:4,offset:0,bufferData:new Float32Array},aNormal:{size:3,offset:0,bufferData:new Float32Array},aPosition:{size:3,offset:0,bufferData:new Float32Array}},this._indices=new Uint16Array,this._state={mvp:k(),nm:T(),n:0},this._calculated=!1,this._intersecting=!0}deleteData(){this._calculated=!1,this._intersecting=!0}calcFourier(t){var i,e,o=[],s=[],n=t.length,r=0,c=[0,0,0];for(let o=0;o<n;o++){r+=f(i=t[o],e=0==o?t[n-1]:t[o-1]);for(let e=0;e<n;e++){let o=d(a(),i,t[e]);Math.abs(o[0])>c[0]&&(c[0]=Math.abs(o[0])),Math.abs(o[1])>c[1]&&(c[1]=Math.abs(o[1])),Math.abs(o[2])>c[2]&&(c[2]=Math.abs(o[2]))}}const g=10/Math.max(c[0],c[1],c[2]);var b,w=a(),M=a(),z=0,E=a(),L=a();for(let h=1;h<=6;h++){let c=a(),l=a();x(c),x(l);for(let o=0;o<n;o++)b=z,z+=f(i=t[o],e=0==o?t[n-1]:t[o-1]),v(w,d(a(),i,e)),p(M,e,w,-b),_(E,_(a(),u(a(),M,2*tt*h*et(2*tt*h*z/r)),u(a(),w,2*tt*h*z*et(2*tt*h*z/r))),u(a(),w,r*it(2*tt*h*z/r))),_(L,_(a(),u(a(),M,2*tt*h*et(2*tt*h*b/r)),u(a(),w,2*tt*h*b*et(2*tt*h*b/r))),u(a(),w,r*it(2*tt*h*b/r))),p(c,c,d(a(),E,L),1/(2*tt*tt*h*h)),_(E,_(a(),u(a(),M,-2*tt*h*it(2*tt*h*z/r)),u(a(),w,-2*tt*h*z*it(2*tt*h*z/r))),u(a(),w,r*et(2*tt*h*z/r))),_(L,_(a(),u(a(),M,-2*tt*h*it(2*tt*h*b/r)),u(a(),w,-2*tt*h*b*it(2*tt*h*b/r))),u(a(),w,r*et(2*tt*h*b/r))),p(l,l,d(a(),E,L),1/(2*tt*tt*h*h));u(c,c,g),u(l,l,g),o.push(c),s.push(l)}this._cosCoef=o,this._sinCoef=s,this._calculated=!1;const A=1200;var N,P,S,B,j,D=[],F=[],I=[],R=[],U=a(),q=a(),O=[0,0,1];for(let t=0;t<=A;t++){v(N=d(a(),this.knot(t/A),this.knot((t+1)/A)),N),h(P=d(a(),O,u(a(),N,y(O,N))))<1e-6&&h(P=d(a(),[0,1,0],u(a(),N,y([0,1,0],N))))<1e-5&&(P=[1,0,0],P=d(a(),P,u(a(),N,y(P,N)))),v(P,P),v(S=m(a(),P,N),S),O=P;for(let i=0;i<=12;i++){const e=i/12*2*Math.PI;_(U,u(a(),P,it(e)),u(a(),S,et(e))),l(q,U),u(U,U,.025),_(U,U,this.knot(t/A)),D.push(U[0],U[1],U[2]),F.push(q[0],q[1],q[2]),I.push(this._color[0],this._color[1],this._color[2],this._opacity)}}for(let t=0;t<A;++t){j=13+(B=13*t);for(let t=0;t<12;++t,++B,++j)R.push(B,B+1,j),R.push(j,B+1,j+1)}this._attributes.aColor.bufferData=new Float32Array(I),this._attributes.aNormal.bufferData=new Float32Array(F),this._attributes.aPosition.bufferData=new Float32Array(D),this._indices=new Uint16Array(R),this._state.mvp=C(k()),this._state.nm=K(T(),this._state.mvp),this._state.n=this._indices.length,this._intersecting=!0,this._calculated=!0,this.checkIntersection()}knot(t){const i=2*t*tt;return _(a(),p(a(),p(a(),p(a(),p(a(),p(a(),u(a(),this._cosCoef[5],it(6*i)),this._cosCoef[4],it(5*i)),this._cosCoef[3],it(4*i)),this._cosCoef[2],it(3*i)),this._cosCoef[1],it(2*i)),this._cosCoef[0],it(i)),p(a(),p(a(),p(a(),p(a(),p(a(),u(a(),this._sinCoef[5],et(6*i)),this._sinCoef[4],et(5*i)),this._sinCoef[3],et(4*i)),this._sinCoef[2],et(3*i)),this._sinCoef[1],et(2*i)),this._sinCoef[0],et(i)))}draw(i,e,o=!0){if(o){var s=i.getUniformLocation(e,"mWorld"),n=i.getUniformLocation(e,"uNormalMatrix");t.renderBuffers(i,e,this._attributes,this._indices),i.uniformMatrix4fv(s,!1,this._state.mvp),i.uniformMatrix3fv(n,!1,this._state.nm),i.drawElements(i.TRIANGLES,this._state.n,i.UNSIGNED_SHORT,0)}}exportKI(){var t=[];for(let i=0;i<6;i++)t.push(this._cosCoef[i][0],this._cosCoef[i][1],this._cosCoef[i][2],0);for(let i=0;i<6;i++)t.push(this._sinCoef[i][0],this._sinCoef[i][1],this._sinCoef[i][2],0);return new Float32Array(t)}exportKIArr(){var t=[],i=[],e=[],o=[];for(let s=0;s<this._cosCoef.length;s++)t.push(u(a(),this._sinCoef[s],s+1)),i.push(u(a(),this._cosCoef[s],-(s+1))),e.push(u(a(),this._cosCoef[s],-(s+1)*(s+1))),o.push(u(a(),this._sinCoef[s],-(s+1)*(s+1)));return[this._cosCoef,this._sinCoef,t,i,e,o]}checkIntersection(){const t=2400;for(let i=0;i<t;i++)for(let e=i+Math.round(48);e<Math.floor(2304);e++)if(b(this.knot(i/t),this.knot(e/t))<.05)return;this._intersecting=!1}get intersecting(){return this._intersecting}get calculated(){return this._calculated}}class st{constructor(t=1,i=[.5,.5,.5]){this._opacity=1,this._color=u(a(),i,1/255),this._state={center:[0,0,0],normal:[0,0,1],radius:t,mvp:k(),nm:T(),n:0};var e=Math.max(Math.min(Math.round(60*Math.sqrt(this._state.radius)),500),50),o=this._state.radius,s=[],n=[],r=[],h=[];for(let t=0;t<=10;++t){const i=t/10*2*Math.PI,a=Math.cos(i),h=Math.sin(i),c=o+.012*a;for(let t=0;t<=e;++t){const i=t/e*2*Math.PI,o=Math.cos(i),l=Math.sin(i),_=c*o,d=c*l,u=.012*h;s.push(_,d,u),n.push(o*a,l*a,h),r.push(this._color[0],this._color[1],this._color[2],this._opacity)}}const c=e+1;var l,_;for(let t=0;t<10;++t){_=(l=t*c)+c;for(let t=0;t<e;++t,++l,++_)h.push(l,l+1,_),h.push(l+1,_+1,_)}this._attributes={aColor:{size:4,offset:0,bufferData:new Float32Array(r)},aNormal:{size:3,offset:0,bufferData:new Float32Array(n)},aPosition:{size:3,offset:0,bufferData:new Float32Array(s)}},this._indices=new Uint16Array(h),this._state.n=this._indices.length,C(this._state.mvp),K(this._state.nm,this._state.mvp)}setCenterNormalRad(t,i,e){var o;o=e/this._state.radius,E(this._state.mvp,q(F(),[0,0,1],i),t,[o,o,o]),K(this._state.nm,this._state.mvp)}draw(i,e,o=!0){if(o){var s=i.getUniformLocation(e,"mWorld"),n=i.getUniformLocation(e,"uNormalMatrix");t.renderBuffers(i,e,this._attributes,this._indices),i.uniformMatrix4fv(s,!1,this._state.mvp),i.uniformMatrix3fv(n,!1,this._state.nm),i.drawElements(i.TRIANGLES,this._state.n,i.UNSIGNED_SHORT,0)}}}class nt{constructor(){this._loader=document.getElementById("loader"),this._text=document.getElementById("loader text"),this._quit=document.getElementById("quit"),this._doubleCheck={overlay:document.getElementById("double check"),confirm:document.getElementById("confirm"),cancel:document.getElementById("cancel")},this._cancel=!1}initCallback(){this._quit.addEventListener("click",(()=>{this.quitBtnResponse()})),this._doubleCheck.confirm.addEventListener("click",(()=>{this.confirmBtnResponse()})),this._doubleCheck.cancel.addEventListener("click",(()=>{this.cancelBtnResponse()}))}quitBtnResponse(){this._doubleCheck.overlay.classList.toggle("hidden",!1)}confirmBtnResponse(){this._doubleCheck.overlay.classList.toggle("hidden",!0),this._cancel=!0}cancelBtnResponse(){this._doubleCheck.overlay.classList.toggle("hidden",!0),this._cancel=!1}load(t){this.text="",this._loader.classList.toggle("hidden",!t),this._doubleCheck.overlay.classList.toggle("hidden",!0),this._cancel=!1}set text(t){this._text.textContent=t}get cancel(){return this._cancel}}class rt{constructor(t,i=0,e="/%s"){this._resetValue=i,this._value=i,this._textTemp=e;const o=document.getElementById(t);this._button=o.querySelector(".dropbtn"),this._button.addEventListener("focus",(()=>{this._overlay.classList.toggle("hidden",!1)})),this._button.addEventListener("blur",(()=>{this._overlay.classList.toggle("hidden",!0)})),this._overlay=o.querySelector(".content");const s=o.querySelectorAll(".element");this._element=[];for(let t=0;t<s.length;t++){let i=s[t];this._element.push(i),i.addEventListener("mousedown",(()=>{this.value=Number(i.getAttribute("value")),this._overlay.classList.toggle("hidden",!0),this._button.textContent=i.textContent}))}this.reset()}reset(){this.value=this._resetValue,this._overlay.classList.toggle("hidden",!0)}set value(t){t=t||this._resetValue,this._value=t}get value(){return this._value}}var at=function(t,i,e,o){return new(e||(e=Promise))((function(s,n){function r(t){try{h(o.next(t))}catch(t){n(t)}}function a(t){try{h(o.throw(t))}catch(t){n(t)}}function h(t){var i;t.done?s(t.value):(i=t.value,i instanceof e?i:new e((function(t){t(i)}))).then(r,a)}h((o=o.apply(t,i||[])).next())}))};const ht=1200,ct=Math.PI;function lt(t){return Math.cos(t)}function _t(t){return Math.sin(t)}class dt{constructor(){this._bufferSize=897750,this._calc={error_field:1e-7,ACPolyAve:0},this._cosCoef=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],this._sinCoef=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],this._dcosCoef=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],this._dsinCoef=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],this._d2cosCoef=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],this._d2sinCoef=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],this._frames=new Array(ht),this._calculated=!1,this._player=new mt,this._player.initCallback()}deleteData(){this._player.reset(),this._frames=new Array(ht),this.calculated=!1}Initialize(){return at(this,void 0,void 0,(function*(){if(!navigator.gpu)throw new Error("WebGPU not supported.");if(this._adapter=yield navigator.gpu.requestAdapter(),!this._adapter)throw new Error("Couldn't request WebGPU adapter.");this._device=yield this._adapter.requestDevice(),this._bindGroupLayout=this._device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}}]});const t=this._device.createShaderModule({code:"\r\n\r\n\r\nstruct fourier_series {\r\n    cos : array<vec3f, 6>,\r\n    sin : array<vec3f, 6>,\r\n};\r\n\r\n\r\n@group(0) @binding(0)var<uniform> knot_info: fourier_series;\r\n@group(0) @binding(1)var<storage, read> tlist: array<f32>;\r\n@group(0) @binding(2)var<storage, read_write> output: array<f32>;\r\n\r\n\r\nconst PI : f32 = 3.1415926535897932384626433832795;\r\nconst error_field : f32 = 0.0025;\r\nconst grad_stop_double : f32 = 0.000001;\r\nconst ptol_stop_double : f32 = 0.0005;\r\n\r\nconst MAX_ITER : i32 = 250;\r\noverride BUFFER_SIZE : u32 = 5985 * 100;\r\n\r\nvar<workgroup> t_i : array<array<f32, 5>, 16>;\r\n\r\nvar<workgroup> abort : array<bool, 16>;\r\n\r\nvar<workgroup> vv : array<array<vec3f, 16>, 16>;\r\nvar<workgroup> nv : array<array<f32, 16>, 16>;\r\nvar<workgroup> dv : array<array<vec3f, 4>, 16>;\r\nvar<workgroup> d2v : array<array<vec3f, 4>, 16>;\r\n\r\nvar<workgroup> ptol : array<f32, 16>;\r\nvar<workgroup> grad : array<array<f32, 4>, 16>;\r\nvar<workgroup> hess : array<array<f32, 16>, 16>;\r\n\r\n\r\nvar<workgroup> diff : array<array<f32, 4>, 16>;\r\nvar<workgroup> backtrack : array<array<u32, 16>, 16>;\r\n\r\n\r\nfn set_variables(x_index : u32, z_index : u32){\r\n\r\n    for(var i : u32 = 0; i<4; i++){\r\n        vv[z_index][x_index + 4*i] = (\r\n            knotc(t_i[z_index][x_index + 1]) \r\n            - knotc(t_i[z_index][i])\r\n        );\r\n    }\r\n\r\n    vv[z_index][9] = -vv[z_index][11];\r\n    vv[z_index][14] = -vv[z_index][15];\r\n\r\n    for(var i : u32 = 0; i<4; i++){\r\n        nv[z_index][x_index + 4*i] = length(vv[z_index][x_index + 4*i]);\r\n    }\r\n\r\n\r\n    if(\r\n        (nv[z_index][0] < error_field) ||\r\n        (nv[z_index][1] < error_field) ||\r\n        (nv[z_index][2] < error_field) ||\r\n        (nv[z_index][3] < error_field) ||\r\n        (nv[z_index][5] < error_field) ||\r\n        (nv[z_index][6] < error_field) ||\r\n        (nv[z_index][10] < error_field) ||\r\n        (nv[z_index][11] < error_field) ||\r\n        (nv[z_index][15] < error_field)){\r\n        abort[z_index] = true;\r\n    }\r\n\r\n\r\n    ptol[z_index] = nv[z_index][2]*nv[z_index][5]+nv[z_index][6]*nv[z_index][1]-nv[z_index][0]*nv[z_index][10] \r\n                    +nv[z_index][2]*nv[z_index][11]+nv[z_index][1]*nv[z_index][15]-nv[z_index][3]*nv[z_index][10];\r\n\r\n\r\n    dv[z_index][x_index] = knotd(t_i[z_index][x_index + 1]);\r\n    d2v[z_index][x_index] = knotd2(t_i[z_index][x_index + 1]);\r\n\r\n}\r\n    \r\nfn grad_compute(x : u32, z_index : u32){\r\n\r\n    var sgn : array<f32, 3>;\r\n\r\n    var index1 : array<u32, 3>;\r\n    var index2 : array<u32, 3>;\r\n\r\n    let dvv : vec3f = dv[z_index][x];\r\n\r\n    index2[0] = 1;\r\n\r\n    switch x {\r\n        case 0: {\r\n            index1[0] = 10;   index1[1] = 2;   index1[2] = 1;\r\n            index2[0] = 0;   index2[1] = 8;   index2[2] = 12;\r\n            sgn[0] = f32(-1);   sgn[1] = f32(1);   sgn[2] = f32(1);\r\n\r\n        }\r\n        case 1: {\r\n            index1[0] = 6;   index1[1] = 0;   index1[2] = 2;\r\n            index2[0] = 1;   index2[1] = 13;   index2[2] = 5;\r\n            sgn[0] = f32(1);   sgn[1] = f32(-1);   sgn[2] = f32(1);\r\n\r\n        }\r\n        case 2: {\r\n            index1[0] = 5;   index1[1] = 1;   index1[2] = 0;\r\n            index2[0] = 2;   index2[1] = 6;   index2[2] = 10;\r\n            sgn[0] = f32(1);   sgn[1] = f32(1);   sgn[2] = f32(-1);\r\n\r\n        }\r\n        default {\r\n            sgn[0] = f32(0);   sgn[1] = f32(0);   sgn[2] = f32(0);\r\n        }\r\n    }\r\n\r\n    \r\n\r\n    let dptol1423 : f32= (\r\n        sgn[0]*(nv[z_index][index1[0]]/nv[z_index][index2[0]])*dot(vv[z_index][index2[0]],dvv) \r\n        + sgn[1]*(nv[z_index][index1[1]]/nv[z_index][index2[1]])*dot(vv[z_index][index2[1]],dvv)\r\n        + sgn[2]*(nv[z_index][index1[2]]/nv[z_index][index2[2]])*dot(vv[z_index][index2[2]],dvv)\r\n    );\r\n\r\n    switch x {\r\n        case 1: {\r\n            index1[0] = 3;   index1[1] = 2;   index1[2] = 15;\r\n            index2[0] = 13;   index2[1] = 9;   index2[2] = 1;\r\n            sgn[0] = f32(-1);   sgn[1] = f32(1);   sgn[2] = f32(1);\r\n\r\n        }\r\n        case 2: {\r\n            index1[0] = 1;   index1[1] = 3;   index1[2] = 11;\r\n            index2[0] = 14;   index2[1] = 10;   index2[2] = 2;\r\n            sgn[0] = f32(1);   sgn[1] = f32(-1);   sgn[2] = f32(1);\r\n\r\n        }\r\n        case 3: {\r\n            index1[0] = 2;   index1[1] = 1;   index1[2] = 10;\r\n            index2[0] = 11;   index2[1] = 15;   index2[2] = 3;\r\n            sgn[0] = f32(1);   sgn[1] = f32(1);   sgn[2] = f32(-1);\r\n\r\n        }\r\n        default {\r\n            sgn[0] = f32(0);   sgn[1] = f32(0);   sgn[2] = f32(0);\r\n        }\r\n    }\r\n\r\n\r\n    let dptol1453 : f32 = (\r\n        sgn[0]*(nv[z_index][index1[0]]/nv[z_index][index2[0]])*dot(vv[z_index][index2[0]],dvv) \r\n        + sgn[1]*(nv[z_index][index1[1]]/nv[z_index][index2[1]])*dot(vv[z_index][index2[1]],dvv)\r\n        + sgn[2]*(nv[z_index][index1[2]]/nv[z_index][index2[2]])*dot(vv[z_index][index2[2]],dvv)\r\n    );\r\n\r\n\r\n    grad[z_index][x] = dptol1423 + dptol1453;\r\n\r\n}\r\n\r\nfn hess_compute(x : u32, z_index : u32){\r\n\r\n    var sgn : array<f32, 3>;\r\n    \r\n    var index1 : array<u32, 2>;\r\n    var index2 : array<u32, 2>;\r\n    var index3 : array<u32, 2>;\r\n\r\n    let dvv : vec3f = dv[z_index][x];\r\n    let dvdv : f32 = dot(dvv,dvv);\r\n    let d2vv : vec3f = d2v[z_index][x];\r\n    \r\n    index1[1] = 1;\r\n\r\n\r\n    switch x {\r\n        case 0: {\r\n            index1[0] = 10;     index1[1] = 0;\r\n            index2[0] = 2;      index2[1] = 8;      \r\n            index3[0] = 1;      index3[1] = 12;\r\n            sgn[0] = f32(-1);   sgn[1] = f32(1);   sgn[2] = f32(1);\r\n\r\n        }\r\n        case 1: {\r\n            index1[0] = 6;     index1[1] = 1;\r\n            index2[0] = 0;      index2[1] = 13;      \r\n            index3[0] = 2;      index3[1] = 5;\r\n            sgn[0] = f32(1);   sgn[1] = f32(-1);   sgn[2] = f32(1);\r\n\r\n        }\r\n        case 2: {\r\n            index1[0] = 5;     index1[1] = 2;\r\n            index2[0] = 1;      index2[1] = 6;      \r\n            index3[0] = 0;      index3[1] = 10;\r\n            sgn[0] = f32(1);   sgn[1] = f32(1);   sgn[2] = f32(-1);\r\n\r\n        }\r\n        default {\r\n            sgn[0] = f32(0);   sgn[1] = f32(0);   sgn[2] = f32(0);\r\n        }\r\n    }\r\n    \r\n\r\n    let d2ptol1423_diag : f32 = (\r\n        sgn[0]*(nv[z_index][index1[0]]/nv[z_index][index1[1]])*(dot(vv[z_index][index1[1]],d2vv) + dvdv - pow(dot(vv[z_index][index1[1]],dvv), f32(2))/(pow(nv[z_index][index1[1]], f32(2))))\r\n        + sgn[1]*(nv[z_index][index2[0]]/nv[z_index][index2[1]])*(dot(vv[z_index][index2[1]],d2vv) + dvdv - pow(dot(vv[z_index][index2[1]],dvv), f32(2))/(pow(nv[z_index][index2[1]], f32(2))))\r\n        + sgn[2]*(nv[z_index][index3[0]]/nv[z_index][index3[1]])*(dot(vv[z_index][index3[1]],d2vv) + dvdv - pow(dot(vv[z_index][index3[1]],dvv), f32(2))/(pow(nv[z_index][index3[1]], f32(2))))\r\n    );\r\n\r\n    switch x {\r\n        case 1: {\r\n            index1[0] = 3;     index1[1] = 13;\r\n            index2[0] = 2;      index2[1] = 9;      \r\n            index3[0] = 15;      index3[1] = 1;\r\n            sgn[0] = f32(-1);   sgn[1] = f32(1);   sgn[2] = f32(1);\r\n\r\n        }\r\n        case 2: {\r\n            index1[0] = 1;     index1[1] = 14;\r\n            index2[0] = 3;      index2[1] = 10;      \r\n            index3[0] = 11;      index3[1] = 2;\r\n            sgn[0] = f32(1);   sgn[1] = f32(-1);   sgn[2] = f32(1);\r\n\r\n        }\r\n        case 3: {\r\n            index1[0] = 2;     index1[1] = 11;\r\n            index2[0] = 1;      index2[1] = 15;      \r\n            index3[0] = 10;      index3[1] = 3;\r\n            sgn[0] = f32(1);   sgn[1] = f32(1);   sgn[2] = f32(-1);\r\n\r\n        }\r\n        default {\r\n            sgn[0] = f32(0);   sgn[1] = f32(0);   sgn[2] = f32(0);\r\n        }\r\n    }\r\n    \r\n\r\n    let d2ptol1453_diag : f32 = (\r\n        sgn[0]*(nv[z_index][index1[0]]/nv[z_index][index1[1]])*(dot(vv[z_index][index1[1]],d2vv) + dvdv - pow(dot(vv[z_index][index1[1]],dvv), f32(2))/(pow(nv[z_index][index1[1]], f32(2))))\r\n        + sgn[1]*(nv[z_index][index2[0]]/nv[z_index][index2[1]])*(dot(vv[z_index][index2[1]],d2vv) + dvdv - pow(dot(vv[z_index][index2[1]],dvv), f32(2))/(pow(nv[z_index][index2[1]], f32(2))))\r\n        + sgn[2]*(nv[z_index][index3[0]]/nv[z_index][index3[1]])*(dot(vv[z_index][index3[1]],d2vv) + dvdv - pow(dot(vv[z_index][index3[1]],dvv), f32(2))/(pow(nv[z_index][index3[1]], f32(2))))\r\n    );\r\n\r\n    hess[z_index][x + 4*x] = d2ptol1423_diag + d2ptol1453_diag;\r\n\r\n    \r\n    var xindex : u32 = 1;\r\n    var yindex : u32 = 1;\r\n\r\n\r\n\r\n    switch x {\r\n        case 1: {\r\n            // block index 1\r\n            index1[0] = 2;    index1[1] = 5;\r\n            index2[0] = 10;    index2[1] = 0;    \r\n            index3[0] = 1;    index3[1] = 6;  \r\n            xindex = 1;\r\n            yindex = 0;\r\n            sgn[0] = f32(-1);   sgn[1] = f32(1);   sgn[2] = f32(-1);        \r\n\r\n        }\r\n        case 2: {\r\n            // block index 2\r\n            index1[0] = 1;    index1[1] = 6;\r\n            index2[0] = 10;    index2[1] = 0;    \r\n            index3[0] = 2;    index3[1] = 5;    \r\n            xindex = 2;\r\n            yindex = 0;\r\n            sgn[0] = f32(-1);   sgn[1] = f32(-1);   sgn[2] = f32(-1);        \r\n\r\n        }\r\n        case 3: {\r\n            // block index 6\r\n            index1[0] = 0;    index1[1] = 10;\r\n            index2[0] = 6;    index2[1] = 1;    \r\n            index3[0] = 2;    index3[1] = 5;    \r\n            xindex = 2;\r\n            yindex = 1;\r\n            sgn[0] = f32(1);   sgn[1] = f32(1);   sgn[2] = f32(1);        \r\n\r\n        }\r\n        default {\r\n            sgn[0] = f32(0);   sgn[1] = f32(0);   sgn[2] = f32(0);\r\n        }\r\n    }\r\n    \r\n\r\n    let d2ptol1423_non_diag : f32 = (\r\n        sgn[0]*(nv[z_index][index1[0]]/nv[z_index][index1[1]])*(dot(dv[z_index][xindex],dv[z_index][yindex]) - dot(vv[z_index][index1[1]],dv[z_index][xindex])*dot(vv[z_index][index1[1]],dv[z_index][yindex])/(nv[z_index][index1[1]]*nv[z_index][index1[1]]))\r\n        + sgn[1]/(nv[z_index][index2[0]]*nv[z_index][index2[1]])*dot(vv[z_index][index2[0]],dv[z_index][xindex])*dot(vv[z_index][index2[1]],dv[z_index][yindex])\r\n        + sgn[2]/(nv[z_index][index3[0]]*nv[z_index][index3[1]])*dot(vv[z_index][index3[0]],dv[z_index][xindex])*dot(vv[z_index][index3[1]],dv[z_index][yindex])\r\n    );\r\n\r\n\r\n\r\n    switch x {\r\n        case 3: {\r\n            // block index 6\r\n            index1[0] = 3;    index1[1] = 10;\r\n            index2[0] = 2;    index2[1] = 11;    \r\n            index3[0] = 15;    index3[1] = 1;   \r\n            xindex = 2;\r\n            yindex = 1; \r\n            sgn[0] = f32(1);   sgn[1] = f32(-1);   sgn[2] = f32(-1);        \r\n\r\n        }\r\n        case 2: {\r\n            // block index 7\r\n            index1[0] = 2;    index1[1] = 11;\r\n            index2[0] = 3;    index2[1] = 10;    \r\n            index3[0] = 15;    index3[1] = 1;    \r\n            xindex = 3;\r\n            yindex = 1;\r\n            sgn[0] = f32(-1);   sgn[1] = f32(1);   sgn[2] = f32(1);        \r\n\r\n        }\r\n        case 1: {\r\n            // block index 11\r\n            index1[0] = 1;    index1[1] = 15;\r\n            index2[0] = 3;    index2[1] = 10;    \r\n            index3[0] = 11;    index3[1] = 2;   \r\n            xindex = 3;\r\n            yindex = 2; \r\n            sgn[0] = f32(-1);   sgn[1] = f32(-1);   sgn[2] = f32(1);        \r\n\r\n        }\r\n        default {\r\n            sgn[0] = f32(0);   sgn[1] = f32(0);   sgn[2] = f32(0);\r\n        }\r\n    }\r\n    \r\n\r\n    let d2ptol1453_non_diag : f32 = (\r\n        sgn[0]*(nv[z_index][index1[0]]/nv[z_index][index1[1]])*(dot(dv[z_index][xindex],dv[z_index][yindex]) - dot(vv[z_index][index1[1]],dv[z_index][xindex])*dot(vv[z_index][index1[1]],dv[z_index][yindex])/(nv[z_index][index1[1]]*nv[z_index][index1[1]]))\r\n        + sgn[1]/(nv[z_index][index2[0]]*nv[z_index][index2[1]])*dot(vv[z_index][index2[0]],dv[z_index][xindex])*dot(vv[z_index][index2[1]],dv[z_index][yindex])\r\n        + sgn[2]/(nv[z_index][index3[0]]*nv[z_index][index3[1]])*dot(vv[z_index][index3[0]],dv[z_index][xindex])*dot(vv[z_index][index3[1]],dv[z_index][yindex])\r\n    );\r\n\r\n\r\n    switch x {\r\n        case 3: {\r\n            hess[z_index][6] = d2ptol1423_non_diag + d2ptol1453_non_diag;\r\n            hess[z_index][9] = hess[z_index][6];\r\n        }\r\n        case 2: {\r\n            hess[z_index][2] = d2ptol1423_non_diag;\r\n            hess[z_index][7] = d2ptol1453_non_diag;\r\n            hess[z_index][8] = hess[z_index][2];\r\n            hess[z_index][13] = hess[z_index][7];\r\n\r\n        }\r\n        case 1: {\r\n            hess[z_index][1] = d2ptol1423_non_diag;\r\n            hess[z_index][11] = d2ptol1453_non_diag;\r\n            hess[z_index][4] = hess[z_index][1];\r\n            hess[z_index][14] = hess[z_index][11];\r\n\r\n        }\r\n        default {\r\n\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\n\r\n\r\n\r\n@compute @workgroup_size(4,16)\r\nfn main(\r\n    @builtin(workgroup_id) workgroup_id : vec3<u32>,\r\n    @builtin(local_invocation_id) local_invocation_id : vec3<u32>,\r\n    @builtin(global_invocation_id) global_invocation_id : vec3<u32>,\r\n    @builtin(local_invocation_index) local_invocation_index: u32,\r\n    @builtin(num_workgroups) num_workgroups: vec3<u32>\r\n) {\r\n\r\n    \r\n\r\n    let workgroup_index = (\r\n        workgroup_id.x +\r\n        workgroup_id.y * num_workgroups.x +\r\n        workgroup_id.z * num_workgroups.x * num_workgroups.y\r\n    );\r\n    \r\n    let newton_index = (\r\n        workgroup_index * 16 +\r\n        local_invocation_id.y\r\n    );\r\n    \r\n\r\n\r\n    let global_invocation_index = (\r\n        workgroup_index * 64 +\r\n        local_invocation_index\r\n    );\r\n\r\n\r\n    let tlist_index = (\r\n        newton_index*5\r\n    );\r\n\r\n\r\n\r\n        // Avoid accessing the buffer out of bounds\r\n    if (tlist_index >= BUFFER_SIZE) {\r\n        return;\r\n    }\r\n\r\n    var grad_length: f32;\r\n\r\n    var i : u32;\r\n    var grad_dot_diff: f32;\r\n    var func: f32;\r\n    var min_backtrack : u32;\r\n\r\n    var x_n : array<f32, 5>;\r\n\r\n    let c : f32 = 0.0001;\r\n    const rho : f32 = 0.65;\r\n\tvar alpha : f32 = pow(rho, f32(4*local_invocation_id.x));\r\n\t\r\n\r\n    t_i[local_invocation_id.y][0] = tlist[tlist_index];\r\n    t_i[local_invocation_id.y][1] = tlist[tlist_index + 1];\r\n    t_i[local_invocation_id.y][2] = tlist[tlist_index + 2];\r\n    t_i[local_invocation_id.y][3] = tlist[tlist_index + 3];\r\n    t_i[local_invocation_id.y][4] = tlist[tlist_index + 4];\r\n\r\n\r\n    var iter : i32;\r\n\r\n    output[tlist_index] = 1.0;\r\n\r\n\r\n    for(iter = 0; iter< MAX_ITER; iter++){\r\n\r\n        set_variables(local_invocation_id.x, local_invocation_id.y);\r\n\r\n        if(abort[local_invocation_id.y] == true){\r\n            return;\r\n        }\r\n\r\n\r\n\r\n        grad_compute(local_invocation_id.x, local_invocation_id.y);\r\n        hess_compute(local_invocation_id.x, local_invocation_id.y);\r\n\r\n        \r\n        grad_length = sqrt(\r\n            pow(grad[local_invocation_id.y][0], 2.0) \r\n            + pow(grad[local_invocation_id.y][1], 2.0)\r\n            + pow(grad[local_invocation_id.y][2], 2.0)\r\n            + pow(grad[local_invocation_id.y][3], 2.0)\r\n        );\r\n\r\n\r\n        if((grad_length < grad_stop_double) || (ptol[local_invocation_id.y] <= ptol_stop_double)){\r\n            if(ptol[local_invocation_id.y] > ptol_stop_double){\r\n                return;\r\n            }\r\n\r\n\r\n            if(check_order(t_i[local_invocation_id.y])){\r\n\r\n                if(check_pentagon(t_i[local_invocation_id.y])){\r\n\r\n                    if(local_invocation_id.x == 0){\r\n                        output[tlist_index] = t_i[local_invocation_id.y][0];\r\n                        output[tlist_index + 1] = t_i[local_invocation_id.y][1];\r\n                        output[tlist_index + 2] = t_i[local_invocation_id.y][2];\r\n                        output[tlist_index + 3] = t_i[local_invocation_id.y][3];\r\n                        output[tlist_index + 4] = t_i[local_invocation_id.y][4];\r\n                    }\r\n                }\r\n                return;\r\n            }\r\n\r\n            var tmp : f32 = t_i[local_invocation_id.y][1];\r\n\r\n            t_i[local_invocation_id.y][1] = t_i[local_invocation_id.y][4];\r\n            t_i[local_invocation_id.y][4] = tmp;\r\n            tmp = t_i[local_invocation_id.y][2];\r\n            t_i[local_invocation_id.y][2] = t_i[local_invocation_id.y][3];\r\n            t_i[local_invocation_id.y][3] = tmp;\r\n\r\n            if(check_order(t_i[local_invocation_id.y])){\r\n\r\n                if(check_pentagon(t_i[local_invocation_id.y])){\r\n\r\n                    if(local_invocation_id.x == 0){\r\n                        output[tlist_index] = t_i[local_invocation_id.y][0];\r\n                        output[tlist_index + 1] = t_i[local_invocation_id.y][1];\r\n                        output[tlist_index + 2] = t_i[local_invocation_id.y][2];\r\n                        output[tlist_index + 3] = t_i[local_invocation_id.y][3];\r\n                        output[tlist_index + 4] = t_i[local_invocation_id.y][4];\r\n                    }\r\n            \r\n                }\r\n            }\r\n\r\n            return;\r\n\r\n        }\r\n\r\n\r\n\r\n        modified_Cholesky(local_invocation_id.y);\r\n\r\n\r\n        grad_dot_diff = (\r\n            grad[local_invocation_id.y][0] * diff[local_invocation_id.y][0]\r\n            + grad[local_invocation_id.y][1] * diff[local_invocation_id.y][1]\r\n            + grad[local_invocation_id.y][2] * diff[local_invocation_id.y][2]\r\n            + grad[local_invocation_id.y][3] * diff[local_invocation_id.y][3]\r\n        );\r\n\r\n\r\n        for (i = 0; i < 4; i++)\r\n        {\r\n\r\n            x_n[0] = t_i[local_invocation_id.y][0];\r\n            x_n[1] = t_i[local_invocation_id.y][1] - alpha*diff[local_invocation_id.y][0];\r\n            x_n[2] = t_i[local_invocation_id.y][2] - alpha*diff[local_invocation_id.y][1];\r\n            x_n[3] = t_i[local_invocation_id.y][3] - alpha*diff[local_invocation_id.y][2];\r\n            x_n[4] = t_i[local_invocation_id.y][4] - alpha*diff[local_invocation_id.y][3];\r\n\r\n            func = (\r\n                length(knotc(x_n[0]) - knotc(x_n[3])) * length(knotc(x_n[1]) - knotc(x_n[2]))\r\n                + length(knotc(x_n[1]) - knotc(x_n[3])) * length(knotc(x_n[0]) - knotc(x_n[2]))\r\n                - length(knotc(x_n[0]) - knotc(x_n[1])) * length(knotc(x_n[2]) - knotc(x_n[3]))\r\n                \r\n                + length(knotc(x_n[0]) - knotc(x_n[3])) * length(knotc(x_n[2]) - knotc(x_n[4]))\r\n                + length(knotc(x_n[0]) - knotc(x_n[2])) * length(knotc(x_n[3]) - knotc(x_n[4]))\r\n                - length(knotc(x_n[0]) - knotc(x_n[4])) * length(knotc(x_n[2]) - knotc(x_n[3]))\r\n            );\r\n\r\n            if(func <= (ptol[local_invocation_id.y] - c*alpha*grad_dot_diff)){\r\n                backtrack[local_invocation_id.y][4*local_invocation_id.x + i] = 4*local_invocation_id.x + i;\r\n            } else {\r\n                backtrack[local_invocation_id.y][4*local_invocation_id.x + i] = 15;\r\n            }\r\n\r\n            alpha = alpha * rho;\r\n\r\n        }\r\n\r\n\r\n\r\n        min_backtrack = 15;\r\n\r\n        if(local_invocation_id.x == 0){\r\n\r\n            for (i = 0; i < 16; i++)\r\n            {\r\n                if(backtrack[local_invocation_id.y][i] < min_backtrack){\r\n                    min_backtrack = backtrack[local_invocation_id.y][i];\r\n                }\r\n            }\r\n\r\n            alpha = pow(rho, f32(min_backtrack));\r\n\r\n            t_i[local_invocation_id.y][1] = t_i[local_invocation_id.y][1] - alpha*diff[local_invocation_id.y][0];\r\n            t_i[local_invocation_id.y][2] = t_i[local_invocation_id.y][2] - alpha*diff[local_invocation_id.y][1];\r\n            t_i[local_invocation_id.y][3] = t_i[local_invocation_id.y][3] - alpha*diff[local_invocation_id.y][2];\r\n            t_i[local_invocation_id.y][4] = t_i[local_invocation_id.y][4] - alpha*diff[local_invocation_id.y][3];\r\n        }\r\n        \r\n\r\n        t_i[local_invocation_id.y][local_invocation_id.x + 1] = fract(t_i[local_invocation_id.y][local_invocation_id.x + 1]);\r\n\r\n        proxim(local_invocation_id.x, local_invocation_id.y, error_field);\r\n\r\n        if(abort[local_invocation_id.y] == true){\r\n            return;\r\n        }\r\n\r\n        iter ++;\r\n\r\n    }\r\n\r\n\r\n}\r\n\r\nfn check_order(t_i : array<f32, 5>) -> bool{\r\n    if(\r\n        (t_i[0] < t_i[1])\r\n        && (t_i[1] < t_i[2])\r\n        && (t_i[2] < t_i[3])\r\n        && (t_i[3] < t_i[4])\r\n    ){\r\n        return true;\r\n    }else if(\r\n        (t_i[4] < t_i[0])\r\n        && (t_i[0] < t_i[1])\r\n        && (t_i[1] < t_i[2])\r\n        && (t_i[2] < t_i[3])\r\n    ){\r\n        return true;\r\n    }else if(\r\n        (t_i[3] < t_i[4])\r\n        && (t_i[4] < t_i[0])\r\n        && (t_i[0] < t_i[1])\r\n        && (t_i[1] < t_i[2])\r\n    ){\r\n        return true;\r\n    }else if(\r\n        (t_i[2] < t_i[3])\r\n        && (t_i[3] < t_i[4])\r\n        && (t_i[4] < t_i[0])\r\n        && (t_i[0] < t_i[1])\r\n    ){\r\n        return true;\r\n    }else if(\r\n        (t_i[1] < t_i[2])\r\n        && (t_i[2] < t_i[3])\r\n        && (t_i[3] < t_i[4])\r\n        && (t_i[4] < t_i[0])\r\n    ){\r\n        return true;\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\nfn proxim(x : u32, y : u32, proxim_float : f32){\r\n    for(var i = i32(x) + 1; i < 5; i++){\r\n        let t_diff = t_i[y][i] - t_i[y][x];\r\n\r\n        if((abs(t_diff) < proxim_float)\r\n            || (abs(t_diff + 1.0) < proxim_float)\r\n            || (abs(1.0 - t_diff) < proxim_float))\r\n        {\r\n            abort[y] = true;\r\n            return;\r\n        }\r\n    }\r\n}\r\n\r\n\r\nfn modified_Cholesky(z: u32) {\r\n\r\n    var max_diag : f32 = 0.0;\r\n    var max_nondiag : f32 = 0.0;\r\n\r\n\r\n    for (var i = 0; i < 4; i++)\r\n    {\r\n        if(abs(hess[z][i*4+i]) > max_diag){\r\n            max_diag = abs(hess[z][i*4+i]);\r\n        }\r\n        for(var j =i+1; j < 4; j++){\r\n            if(abs(hess[z][i*4+j]) > max_nondiag){\r\n                max_nondiag = abs(hess[z][i*4+j]);\r\n            }\r\n        }\r\n    }\r\n\r\n    var beta2 : f32 = max(max(max_diag, max_nondiag/(sqrt(f32(15)))), 0.0001);\r\n\r\n    var temp : array<f32, 16>;\r\n    var D : array<f32, 4>;\r\n    var L : array<f32, 16>;\r\n\r\n    var theta : array<f32, 4>;\r\n\r\n    for(var j =0; j<4; j++){\r\n        temp[j*4 + j] = hess[z][j*4 + j];\r\n        for(var s = 0; s< j; s++){\r\n            temp[j*4 + j] -= D[s]*L[j*4 + s]*L[j*4 + s];\r\n        }\r\n        \r\n        for(var i=j+1; i<4; i++){\r\n            temp[i*4 + j] = hess[z][i*4 + j];\r\n            for(var s = 0; s< j; s++){\r\n                temp[i*4 + j] -= D[s]*L[i*4 + s]*L[j*4 + s];\r\n            }\r\n\r\n            if(theta[j]< abs(temp[i*4 + j])){\r\n                theta[j]= abs(temp[i*4 + j]);\r\n            }\r\n        }\r\n\r\n        D[j] = max(max(abs(temp[j*4 + j]), theta[j]*theta[j]/beta2), 0.001);\r\n        \r\n        for(var i=j+1; i<4; i++){\r\n            L[i*4 + j] = temp[i*4 + j]/D[j];\r\n        }\r\n        L[j*4 + j] = 1.0;\r\n    }\r\n\r\n    // forward substitution.\r\n    var y : array<f32, 4>;\r\n    var sum : f32;\r\n\r\n    for (var i = 0; i < 4; i++)\r\n    {\r\n        sum = grad[z][i];\r\n        for (var j = 0; j < i; j++){\r\n            sum -= L[i*4+j] * y[j];\r\n        }\r\n        y[i] = sum / L[i*4 +i];\r\n    }\r\n\r\n\r\n    // back substitution.\r\n    // var retval = new Array(4);\r\n\r\n    for (var k = 3; k >= 0; k--)\r\n    {\r\n        sum = y[k];\r\n        for (var j = k + 1; j < 4; j++){\r\n            sum -= L[j*4+k] * diff[z][j] * D[k];\r\n        }\r\n        diff[z][k] = sum/(D[k]);\r\n    }\r\n\r\n}\r\n\r\n\r\nfn check_pentagon(t_i : array<f32, 5>) -> bool {\r\n\r\n    let v1 = knotc(t_i[0]);\r\n    let v2 = knotc(t_i[3]);\r\n    let v3 = knotc(t_i[1]);\r\n    let v4 = knotc(t_i[4]);\r\n    let v5 = knotc(t_i[2]);\r\n\r\n    let v12 = (v2-v1);\r\n    let v23 = (v3-v2);\r\n    let v34 = (v4-v3);\r\n    let v45 = (v5-v4);\r\n    let v51 = (v1-v5);\r\n\r\n    var sum_angle : f32 = 0.0;\r\n\r\n    sum_angle += acos(-1*dot(v12,v23)/(length(v12)*length(v23)));\r\n    sum_angle += acos(-1*dot(v23,v34)/(length(v23)*length(v34)));\r\n    sum_angle += acos(-1*dot(v34,v45)/(length(v34)*length(v45)));\r\n    sum_angle += acos(-1*dot(v45,v51)/(length(v45)*length(v51)));\r\n    sum_angle += acos(-1*dot(v51,v12)/(length(v51)*length(v12)));\r\n\r\n    if(abs(sum_angle - 3*PI) < 0.02){\r\n        return true;\r\n    }\r\n    return false;\r\n\r\n\r\n}\r\n\r\n\r\n\r\nfn knotc(param : f32) -> vec3f {\r\n    let t : f32 = 2 * PI * param;\r\n    let ret : vec3f = (\r\n        knot_info.cos[0] * cos(t) + knot_info.cos[1] * cos(2*t) + knot_info.cos[2] * cos(3*t) + knot_info.cos[3] * cos(4*t) + knot_info.cos[4] * cos(5*t) + knot_info.cos[5] * cos(6*t)\r\n        + knot_info.sin[0] * sin(t) + knot_info.sin[1] * sin(2*t) + knot_info.sin[2] * sin(3*t) + knot_info.sin[3] * sin(4*t) + knot_info.sin[4] * sin(5*t)+ knot_info.sin[5] * sin(6*t)\r\n    );\r\n\treturn ret;\r\n}\r\nfn knotd(param : f32) -> vec3f {\r\n    let t : f32 = 2 * PI * param;\r\n    let ret : vec3f = (\r\n        knot_info.sin[0] * cos(t) + knot_info.sin[1] *2* cos(2*t) + knot_info.sin[2] *3* cos(3*t) + knot_info.sin[3] *4* cos(4*t) + knot_info.sin[4] *5* cos(5*t)+ knot_info.sin[5] *6* cos(6*t)\r\n        - knot_info.cos[0] * sin(t) - knot_info.cos[1] *2* sin(2*t) - knot_info.cos[2] *3* sin(3*t) - knot_info.cos[3] *4* sin(4*t) - knot_info.cos[4] *5* sin(5*t)- knot_info.cos[5] *6* sin(6*t)\r\n    );\r\n\treturn 2*PI*ret;\r\n}\r\nfn knotd2(param : f32) -> vec3f {\r\n    let t : f32 = 2 * PI * param;\r\n    let ret : vec3f = (\r\n        knot_info.cos[0] * cos(t) + knot_info.cos[1] *4* cos(2*t) + knot_info.cos[2] *9* cos(3*t) + knot_info.cos[3] *16* cos(4*t) + knot_info.cos[4] *25* cos(5*t)+ knot_info.cos[5] *36* cos(6*t)\r\n        + knot_info.sin[0] * sin(t) + knot_info.sin[1] *4* sin(2*t) + knot_info.sin[2] *9* sin(3*t) + knot_info.sin[3] *16* sin(4*t) + knot_info.sin[4] *25* sin(5*t)+ knot_info.sin[5] *36* sin(6*t)\r\n    );\r\n\treturn -4*PI*PI*ret;\r\n}\r\n\r\n"});this._computePipeline=this._device.createComputePipeline({layout:this._device.createPipelineLayout({bindGroupLayouts:[this._bindGroupLayout]}),compute:{module:t,entryPoint:"main",constants:{BUFFER_SIZE:this._bufferSize}}})}))}initKnot(t){this._cosCoef=t[0],this._sinCoef=t[1],this._dcosCoef=t[2],this._dsinCoef=t[3],this._d2cosCoef=t[4],this._d2sinCoef=t[5]}get calculated(){return this._calculated}set calculated(t){this._calculated=t}findCircles(t,i,e,o,s){return at(this,void 0,void 0,(function*(){var n,r,a,h;s.text=(0).toFixed(1)+" %";var c=new Array(ht);for(let t=0;t<ht;t++)c[t]=[];for(let i=0;i<40;i++){const[,e]=this.sett_i(30,30*i),o=this._device.createCommandEncoder(),d=o.beginComputePass();n=this._device.createBuffer({size:48*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this._device.queue.writeBuffer(n,0,t),r=this._device.createBuffer({size:this._bufferSize*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),a=this._device.createBuffer({size:this._bufferSize*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC}),h=this._device.createBuffer({size:this._bufferSize*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),this._device.queue.writeBuffer(r,0,e);const u=this._device.createBindGroup({layout:this._bindGroupLayout,entries:[{binding:0,resource:{buffer:n}},{binding:1,resource:{buffer:r}},{binding:2,resource:{buffer:a}}]});d.setPipeline(this._computePipeline),d.setBindGroup(0,u),d.dispatchWorkgroups(200,200),d.end(),o.copyBufferToBuffer(a,0,h,0,this._bufferSize*Float32Array.BYTES_PER_ELEMENT),this._device.queue.submit([o.finish()]),yield h.mapAsync(GPUMapMode.READ,0,this._bufferSize*Float32Array.BYTES_PER_ELEMENT);var l=new Float32Array(h.getMappedRange(0,this._bufferSize*Float32Array.BYTES_PER_ELEMENT).slice(0));for(let t=0;t<l.length/5;t++)if(1!=l[5*t]){var _=Math.round(l[5*t]*ht);_>=ht||_<0||c[_].push([l[5*t],l[5*t+1],l[5*t+2],l[5*t+3],l[5*t+4]])}if(s.text=(100*i/40).toFixed(1)+" %",s.cancel)return}var d=new Array(2);d[0]=[],d[1]=[];for(let t=0;t<ht;t++)if(c[t]=this.removeDupe(c[t],.01),c[t]=c[t].slice(0,2*o),c[t]=this.c5_ptolemy(c[t]),c[t]=this.removeDupe(c[t],.001),c[t]=c[t].slice(0,o),this._calc.ACPolyAve+=c[t].length%2,d[c[t].length%2].push(t),s.cancel)return;if(this._calc.ACPolyAve=Math.round(this._calc.ACPolyAve/ht),i){var u,p;s.text="verifying number of circles",d[(this._calc.ACPolyAve+1)%2]=d[(this._calc.ACPolyAve+1)%2].slice(0,e);for(let t=0;t<d[(this._calc.ACPolyAve+1)%2].length;t++){p=[];let i=(u=d[(this._calc.ACPolyAve+1)%2][t])-1,e=u+1;i<0&&(i=1199),e>=ht&&(e=0);for(let t=0;t<c[i];t++){let e=c[i][t];p.push([u/ht,e[1],e[2],e[3],e[4]])}for(let t=0;t<c[e];t++){let i=c[e][t];p.push([u/ht,i[1],i[2],i[3],i[4]])}for(let t=0;t<c[u];t++){let i=c[u][t];p.push([u/ht,i[1],i[2],i[3],i[4]])}if(p=this.removeDupe(p,.001),p=this.c5_ptolemy(p),c[u]=this.removeDupe(p,.001),s.cancel)return}}s.text="creating buffers",this._calculated=!1,this.setFrameData(c,s),s.cancel||(this._calculated=!0,this._player.play=!0)}))}removeDupe(t,i){let e=[];for(var o=0;o<t.length;o++){var s=!0;let r=e.length;for(var n=0;n<r;n++)Math.sqrt(Math.pow(t[o][1]-e[n][1],2)+Math.pow(t[o][2]-e[n][2],2)+Math.pow(t[o][3]-e[n][3],2)+Math.pow(t[o][4]-e[n][4],2))<i&&(s=!1);s&&e.push(t[o])}return e}sett_i(t,i=0){var e,o,s,n,r,a=0;const h=22,c=new Float32Array(5985*t*5);for(a=0,r=0;r<t;r++)for(e=1;e<h;e++)for(o=e+1;o<h;o++)for(s=o+1;s<h;s++)for(n=s+1;n<h;n++)c[a]=i/ht+r/ht,c[a+1]=e/h+c[a],c[a+2]=o/h+c[a],c[a+3]=s/h+c[a],c[a+4]=n/h+c[a],a+=5;return[a,c]}setFrameData(t,i){var e,o,s,n=new D([0,0,0,0],1,[1,0,0],.08),r=new Array(30);for(let t=0;t<30;t++)r[t]={count:0,objs:[]};var a={count:0,objs:[]};for(let _=0;_<ht;_++){this._frames[_]={redPoints:{position:this.knot(_/ht),obj:n},blackPoints:[],circles:[]};for(let t=0;t<30;t++)r[t].count=0;a.count=0;var h=[],c=t[_];for(let t=0;t<c.length;t++){var l=[!0,!0,!0,!0];e=[c[t][5],c[t][6],c[t][7]],o=[c[t][8],c[t][9],c[t][10]],s=c[t][11];let i=Math.max(0,Math.min(Math.floor(2*Math.log2(s))+4,29));r[i].objs.length==r[i].count&&r[i].objs.push(new st(Math.pow(2,(i-4)/2),[65,40,80])),this._frames[_].circles.push({center:e,normal:o,radius:s,obj:r[i].objs[r[i].count]}),r[i].count++;for(let i=0;i<h.length;i++)b(h[i].position,this.knot(c[t][1]))<.001&&(l[0]=!1),b(h[i].position,this.knot(c[t][2]))<.001&&(l[1]=!1),b(h[i].position,this.knot(c[t][3]))<.001&&(l[2]=!1),b(h[i].position,this.knot(c[t][4]))<.001&&(l[3]=!1);l[0]&&(a.count==a.objs.length&&a.objs.push(new D([0,0,0,0],1,[.2,.2,.2],.06)),h.push({position:this.knot(c[t][1]),obj:a.objs[a.count]}),a.count++),l[1]&&(a.count==a.objs.length&&a.objs.push(new D([0,0,0,0],1,[.2,.2,.2],.06)),h.push({position:this.knot(c[t][2]),obj:a.objs[a.count]}),a.count++),l[2]&&(a.count==a.objs.length&&a.objs.push(new D([0,0,0,0],1,[.2,.2,.2],.06)),h.push({position:this.knot(c[t][3]),obj:a.objs[a.count]}),a.count++),l[3]&&(a.count==a.objs.length&&a.objs.push(new D([0,0,0,0],1,[.2,.2,.2],.06)),h.push({position:this.knot(c[t][4]),obj:a.objs[a.count]}),a.count++)}if(this._frames[_].blackPoints=h,i.cancel)return}}draw(t,i,e=!0){var o,s,n,r;if(e){var a,h,c=this._frames[this._player.frame];for(let e=0;e<c.circles.length;e++)null===(o=(a=c.circles[e]).obj)||void 0===o||o.setCenterNormalRad(a.center,a.normal,a.radius),null===(s=a.obj)||void 0===s||s.draw(t,i,!0);for(let e=0;e<c.blackPoints.length;e++)(h=c.blackPoints[e]).obj.position=h.position,null===(n=h.obj)||void 0===n||n.draw(t,i,!0);(h=c.redPoints).obj.position=h.position,null===(r=h.obj)||void 0===r||r.draw(t,i,!0),this._player.play&&this._player.addFrame()}}get player(){return this._player}toCVR(t,i,e){const o=ut(t,i),s=ut(i,e),n=ut(e,t);var r,a,h=(a=s,[(r=o)[1]*a[2]-r[2]*a[1],r[2]*a[0]-r[0]*a[2],r[0]*a[1]-r[1]*a[0]]);const c=ft(o)*ft(s)*ft(n)*.5/ft(h),l=ft(s)*ft(s)*yt(o,n)*-.5/yt(h,h),_=ft(n)*ft(n)*yt(o,s)*-.5/yt(h,h),d=ft(o)*ft(o)*yt(n,s)*-.5/yt(h,h),u=pt(pt(vt(l,t),vt(_,i)),vt(d,e));return h=function(t){const i=ft(t);return[t[0]/i,t[1]/i,t[2]/i]}(h),[u,h,c]}decim(t){for(var i=1;i<5;i++)t[i]%=1,t[i]<0&&(t[i]+=1)}proxim(t,i){for(var e=0;e<5;e++)for(var o=e+1;o<5;o++)if(Math.abs(t[e]-t[o])<i||Math.abs(t[e]-t[o]+1)<i||Math.abs(t[o]-t[e]+1)<i)return!0;return!1}modified_Cholesky(t,i){if(16!=t.length||4!=i.length)throw new Error("dimension error in modified_Cholesky");var e,o,s,n,r=0,a=0;for(e=0;e<4;e++)for(Math.abs(t[4*e+e])>r&&(r=Math.abs(t[4*e+e])),o=0;o<4;o++)Math.abs(t[4*e+o])>a&&o!=e&&(a=Math.abs(t[4*e+o]));var h=Math.max(r,a/Math.sqrt(15),1e-4),c=new Array(16),l=new Array(4),_=new Array(16),d=[0,0,0,0];for(o=0;o<4;o++){for(c[4*o+o]=t[4*o+o],n=0;n<o;n++)c[4*o+o]-=l[n]*_[4*o+n]*_[4*o+n];for(e=o+1;e<4;e++){for(c[4*e+o]=t[4*e+o],n=0;n<o;n++)c[4*e+o]-=l[n]*_[4*e+n]*_[4*o+n];d[o]<Math.abs(c[4*e+o])&&(d[o]=Math.abs(c[4*e+o]))}for(l[o]=Math.max(Math.abs(c[4*o+o]),d[o]*d[o]/h,.001),e=o+1;e<4;e++)_[4*e+o]=c[4*e+o]/l[o];_[4*o+o]=1}var u,p=new Array(4);for(e=0;e<4;e++){for(u=i[e],o=0;o<e;o++)u-=_[4*e+o]*p[o];p[e]=u/_[4*e+e]}var f=[0,0,0,0];for(s=3;s>=0;s--){for(u=p[s],o=s+1;o<4;o++)u-=_[4*o+s]*f[o]*l[s];f[s]=u/l[s]}return f}gradient_ptolemy(t,i,e){const o=-t[2]/t[4]*i[1]+-t[1]/t[5]*i[2]-t[7]/t[0]*i[0],s=t[2]/t[4]*i[5]+t[5]/t[1]*i[4]- -t[0]/t[7]*i[6],n=t[4]/t[2]*i[8]+t[1]/t[5]*i[9]-t[0]/t[7]*i[10],r=t[8]/t[0]*i[0]+-t[1]/t[6]*i[3]- -t[3]/t[4]*i[1],a=-t[0]/t[8]*i[7]+t[6]/t[1]*i[4]-t[3]/t[4]*i[5],h=t[0]/t[8]*i[13]+t[1]/t[6]*i[12]-t[4]/t[3]*i[11];e[0]=o+r,e[1]=s+a,e[2]=n,e[3]=h}hessian_ptolemy(t,i,e,o,s){const n=-t[2]/t[4]*(o[1]-e[0]+Math.pow(i[1],2)/Math.pow(t[4],2))+-t[1]/t[5]*(o[2]-e[0]+Math.pow(i[2],2)/Math.pow(t[5],2))-t[7]/t[0]*(o[0]+e[0]-Math.pow(i[0],2)/Math.pow(t[0],2)),r=1/(t[7]*t[0])*i[6]*i[0]+-t[2]/t[4]*(e[1]-i[5]*i[1]/Math.pow(t[4],2))+1/(-t[1]*t[5])*i[4]*i[2],a=-1/(t[7]*t[0])*i[10]*i[0]+1/(-t[2]*t[4])*i[8]*i[1]+-t[1]/t[5]*(e[2]-i[9]*i[2]/Math.pow(t[5],2)),h=t[2]/t[4]*(o[5]+e[4]-Math.pow(i[5],2)/Math.pow(t[4],2))+t[5]/t[1]*(o[4]+e[4]-Math.pow(i[4],2)/Math.pow(t[1],2))- -t[0]/t[7]*(o[6]-e[4]+Math.pow(i[6],2)/Math.pow(t[7],2)),c=- -t[0]/t[7]*(e[5]-i[10]*i[6]/Math.pow(t[7],2))+1/(t[2]*t[4])*i[8]*i[5]+1/(t[5]*t[1])*i[9]*i[4],l=t[4]/t[2]*(o[8]+e[7]-Math.pow(i[8],2)/Math.pow(t[2],2))+t[1]/t[5]*(o[9]+e[7]-Math.pow(i[9],2)/Math.pow(t[5],2))-t[0]/t[7]*(o[10]+e[7]-Math.pow(i[10],2)/Math.pow(t[7],2)),_=t[8]/t[0]*(o[0]+e[0]-Math.pow(i[0],2)/Math.pow(t[0],2))+-t[1]/t[6]*(o[3]-e[0]+Math.pow(i[3],2)/Math.pow(t[6],2))- -t[3]/t[4]*(o[1]-e[0]+Math.pow(i[1],2)/Math.pow(t[4],2)),d=- -t[3]/t[4]*(e[1]-i[1]*i[5]/Math.pow(t[4],2))+1/(-t[8]*t[0])*i[7]*i[0]+1/(-t[1]*t[6])*i[4]*i[3],u=-1/(-t[3]*t[4])*i[11]*i[1]+1/(t[8]*t[0])*i[13]*i[0]+-t[1]/t[6]*(e[3]-i[3]*i[12]/Math.pow(t[6],2)),p=-t[0]/t[8]*(o[7]-e[4]+Math.pow(i[7],2)/Math.pow(t[8],2))+t[6]/t[1]*(o[4]+e[4]-Math.pow(i[4],2)/Math.pow(t[1],2))-t[3]/t[4]*(o[5]+e[4]-Math.pow(i[5],2)/Math.pow(t[4],2)),f=-1/(t[3]*t[4])*i[11]*i[5]+-t[0]/t[8]*(e[6]-i[7]*i[13]/Math.pow(t[8],2))+1/(t[6]*t[1])*i[12]*i[4],v=t[0]/t[8]*(o[13]+e[8]-Math.pow(i[13],2)/Math.pow(t[8],2))+t[1]/t[6]*(o[12]+e[8]-Math.pow(i[12],2)/Math.pow(t[6],2))-t[4]/t[3]*(o[11]+e[8]-Math.pow(i[11],2)/Math.pow(t[3],2));s[0]=n+_,s[1]=r+d,s[2]=a,s[3]=u,s[4]=r+d,s[5]=h+p,s[6]=c,s[7]=f,s[8]=a,s[9]=c,s[10]=l,s[11]=0,s[12]=u,s[13]=f,s[14]=0,s[15]=v}setvariables(t,i,e,o,s,n,r,a,h){i[0]=this.knot(t[0]),i[1]=this.knot(t[1]),i[2]=this.knot(t[2]),i[3]=this.knot(t[3]),i[4]=this.knot(t[4]),o[0]=ut(i[1],i[0]),o[1]=ut(i[2],i[0]),o[2]=ut(i[3],i[0]),o[3]=ut(i[4],i[0]),o[4]=ut(i[2],i[1]),o[5]=ut(i[3],i[1]),o[6]=ut(i[4],i[1]),o[7]=ut(i[3],i[2]),o[8]=ut(i[4],i[2]),e[0]=ft(o[0]),e[1]=ft(o[1]),e[2]=ft(o[2]),e[3]=ft(o[3]),e[4]=ft(o[4]),e[5]=ft(o[5]),e[6]=ft(o[6]),e[7]=ft(o[7]),e[8]=ft(o[8]);for(var c=0;c<9;c++)if(e[c]<this._calc.error_field)return!0;return s[0]=this.dknot(t[1]),s[1]=this.dknot(t[2]),s[2]=this.dknot(t[3]),s[3]=this.dknot(t[4]),n[0]=yt(o[0],s[0]),n[1]=yt(o[4],s[0]),n[2]=yt(o[5],s[0]),n[3]=yt(o[6],s[0]),n[4]=yt(o[1],s[1]),n[5]=yt(o[4],s[1]),n[6]=yt(o[7],s[1]),n[7]=yt(o[8],s[1]),n[8]=yt(o[2],s[2]),n[9]=yt(o[5],s[2]),n[10]=yt(o[7],s[2]),n[11]=yt(o[3],s[3]),n[12]=yt(o[6],s[3]),n[13]=yt(o[8],s[3]),a[0]=this.d2knot(t[1]),a[1]=this.d2knot(t[2]),a[2]=this.d2knot(t[3]),a[3]=this.d2knot(t[4]),h[0]=yt(o[0],a[0]),h[1]=yt(o[4],a[0]),h[2]=yt(o[5],a[0]),h[3]=yt(o[6],a[0]),h[4]=yt(o[1],a[1]),h[5]=yt(o[4],a[1]),h[6]=yt(o[7],a[1]),h[7]=yt(o[8],a[1]),h[8]=yt(o[2],a[2]),h[9]=yt(o[5],a[2]),h[10]=yt(o[7],a[2]),h[11]=yt(o[3],a[3]),h[12]=yt(o[6],a[3]),h[13]=yt(o[8],a[3]),r[0]=yt(s[0],s[0]),r[1]=yt(s[0],s[1]),r[2]=yt(s[0],s[2]),r[3]=yt(s[0],s[3]),r[4]=yt(s[1],s[1]),r[5]=yt(s[1],s[2]),r[6]=yt(s[1],s[3]),r[7]=yt(s[2],s[2]),r[8]=yt(s[3],s[3]),!1}knot(t){const i=2*t*ct;return _(a(),p(a(),p(a(),p(a(),p(a(),p(a(),u(a(),this._cosCoef[5],lt(6*i)),this._cosCoef[4],lt(5*i)),this._cosCoef[3],lt(4*i)),this._cosCoef[2],lt(3*i)),this._cosCoef[1],lt(2*i)),this._cosCoef[0],lt(i)),p(a(),p(a(),p(a(),p(a(),p(a(),u(a(),this._sinCoef[5],_t(6*i)),this._sinCoef[4],_t(5*i)),this._sinCoef[3],_t(4*i)),this._sinCoef[2],_t(3*i)),this._sinCoef[1],_t(2*i)),this._sinCoef[0],_t(i)))}dknot(t){const i=2*t*ct;return u(a(),_(a(),p(a(),p(a(),p(a(),p(a(),p(a(),u(a(),this._dcosCoef[5],lt(6*i)),this._dcosCoef[4],lt(5*i)),this._dcosCoef[3],lt(4*i)),this._dcosCoef[2],lt(3*i)),this._dcosCoef[1],lt(2*i)),this._dcosCoef[0],lt(i)),p(a(),p(a(),p(a(),p(a(),p(a(),u(a(),this._dsinCoef[5],_t(6*i)),this._dsinCoef[4],_t(5*i)),this._dsinCoef[3],_t(4*i)),this._dsinCoef[2],_t(3*i)),this._dsinCoef[1],_t(2*i)),this._dsinCoef[0],_t(i))),2*ct)}d2knot(t){const i=2*t*ct;return u(a(),_(a(),p(a(),p(a(),p(a(),p(a(),p(a(),u(a(),this._d2cosCoef[5],lt(6*i)),this._d2cosCoef[4],lt(5*i)),this._d2cosCoef[3],lt(4*i)),this._d2cosCoef[2],lt(3*i)),this._d2cosCoef[1],lt(2*i)),this._d2cosCoef[0],lt(i)),p(a(),p(a(),p(a(),p(a(),p(a(),u(a(),this._d2cosCoef[5],_t(6*i)),this._d2sinCoef[4],_t(5*i)),this._d2sinCoef[3],_t(4*i)),this._d2sinCoef[2],_t(3*i)),this._d2sinCoef[1],_t(2*i)),this._d2sinCoef[0],_t(i))),4*ct*ct)}c5_ptolemy(t){var i,e,o,s,n,r,a,h=[],c=new Array(5),l=new Array(9),_=new Array(9),d=new Array(4),u=new Array(14),p=new Array(9),f=new Array(4),v=new Array(14),y=[0,0,0,0,0],m=[0,0,0,0],g=[0,0,0,0],x=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b=0,w=[0,0,0,0,0];for(let z=0;z<t.length;z++)for(y[0]=t[z][0],y[1]=t[z][1],y[2]=t[z][2],y[3]=t[z][3],y[4]=t[z][4],b=0;b<250&&!this.setvariables(y,c,_,l,d,u,p,f,v);){if(i=_[0]*_[8]+_[1]*_[6]-_[3]*_[4]+_[2]*_[4]+_[5]*_[1]-_[0]*_[7],this.gradient_ptolemy(_,u,m),this.hessian_ptolemy(_,u,p,v,x),Math.sqrt(Math.pow(m[0],2)+Math.pow(m[1],2)+Math.pow(m[2],2)+Math.pow(m[3],2))<1e-7||i<=1e-6){if(i>1e-6)break;var[k,C,M]=this.toCVR(this.knot(y[0]),this.knot(y[1]),this.knot(y[2]));h.push([y,k,C,M].flat());break}g=this.modified_Cholesky(x,m),r=0,o=1/.75,s=Math.sqrt(Math.pow(g[0],2)+Math.pow(g[1],2)+Math.pow(g[2],2)+Math.pow(g[3],2)),n=m[0]*g[0]+m[1]*g[1]+m[2]*g[2]+m[3]*g[3];do{for(o*=.75,r++,w[0]=y[0],e=0;e<4;e++)w[e+1]=y[e+1]-o*g[e];c[1]=this.knot(w[1]),c[2]=this.knot(w[2]),c[3]=this.knot(w[3]),c[4]=this.knot(w[4]),l[0]=ut(c[1],c[0]),l[1]=ut(c[2],c[0]),l[2]=ut(c[3],c[0]),l[3]=ut(c[4],c[0]),l[4]=ut(c[2],c[1]),l[5]=ut(c[3],c[1]),l[6]=ut(c[4],c[1]),l[7]=ut(c[3],c[2]),l[8]=ut(c[4],c[2]),_[0]=ft(l[0]),_[1]=ft(l[1]),_[2]=ft(l[2]),_[3]=ft(l[3]),_[4]=ft(l[4]),_[5]=ft(l[5]),_[6]=ft(l[6]),_[7]=ft(l[7]),_[8]=ft(l[8]),a=_[0]*_[8]+_[1]*_[6]-_[3]*_[4]+_[2]*_[4]+_[5]*_[1]-_[0]*_[7]}while(a>i-1e-4*o*n&&o*s>5e-6&&r<20);if(y=[w[0],w[1],w[2],w[3],w[4]],this.decim(y),this.proxim(y,2e-4))break;b++}return h}}function ut(t,i){return[t[0]-i[0],t[1]-i[1],t[2]-i[2]]}function pt(t,i){return[t[0]+i[0],t[1]+i[1],t[2]+i[2]]}function ft(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}function vt(t,i){return[t*i[0],t*i[1],t*i[2]]}function yt(t,i){return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]}class mt{constructor(){this.videoControls=document.getElementById("video-controls"),this.playpause=document.getElementById("playpause"),this.progress=document.getElementById("progress"),this.progressBar=document.getElementById("progress-bar"),this.left=0,this.pressed=!1,this.speedDrop=new rt("speed dropdown",1,"X %s"),this._animation={play:!1,frame:0,speed:1},this.videoControls.classList.toggle("hidden",!0),this.resize()}initCallback(){this.playpause.addEventListener("click",(()=>{this.playBtnResponse()})),this.progress.addEventListener("mousedown",(t=>{0==t.button&&(this.pressed=!0,this.progressResponse(t))})),document.addEventListener("mousemove",(t=>{this.progressResponse(t)})),document.addEventListener("mouseup",(()=>{this.pressed=!1}))}progressResponse(t){if(this.pressed){var i=(t.offsetX-this.left)/this.progress.offsetWidth;this.frame=Math.max(Math.min(Math.round(1199*i),1199),0)}}playBtnResponse(){this._animation.play=!this._animation.play,this._animation.play?this.playpause.setAttribute("data-state","play"):this.playpause.setAttribute("data-state","pause")}get frame(){return Math.floor(this._animation.frame)}addFrame(t=this.speed){this.frame=this._animation.frame+t}set frame(t){(t<0||t>=ht)&&(t=0),this.progressBar.style.width=String(Math.floor(t/1199*100))+"%",this._animation.frame=t}get speed(){return this._animation.speed=this.speedDrop.value,this._animation.speed}get play(){return this._animation.play}set play(t){this._animation.play=t}Disable(t){this.resize(),!0===t?this.videoControls.classList.toggle("hidden",!0):(this.videoControls.classList.toggle("hidden",!1),this.reset())}resize(){this.progress.getBoundingClientRect().left}reset(){this.frame=0,this._animation.speed=0,this.speedDrop.reset()}}class gt{constructor(){this._loader=new nt,this._loader.initCallback(),this._linkedKnot=new Q,this._fourierKnot=new ot,this._quintpules=new dt,this._quintpules.Initialize(),this._freeze=!1,this._knotMenu=new xt(this),this._knotMenu.initCallback()}get sceneType(){return this._knotMenu.sceneType}advanceScene(t){return i=this,e=void 0,s=function*(){if(this._freeze=!0,this.linkedKnot.selected=null,this.linkedKnot.drawingTool.Disable(!0),"Quintuples"===t){if(!this.fourierKnot.calculated||this.fourierKnot.intersecting)throw new Error("tried to find circles on incomplete knot");this._loader.load(!0);const t=this.fourierKnot.exportKIArr();this.quintuples.initKnot(t);const i=this.fourierKnot.exportKI();if(yield this.quintuples.findCircles(i,this._knotMenu.doubleCheck,this._knotMenu.doubleCheckLimit,this._knotMenu.maxCircles,this._loader),this._loader.load(!1),this._knotMenu.resetCircleOption(),!this._quintpules.calculated)return this._quintpules.deleteData(),this._knotMenu.sceneType="Fourier Knot",void(this._freeze=!1);this._knotMenu.sceneType="Quintuples"}else if("Fourier Knot"===t){if(!this.linkedKnot.isKnot)throw new Error("tried to smoothen incomplete knot");var i=this.linkedKnot.nodeArr;if(this.fourierKnot.calcFourier(i),!this.fourierKnot.calculated)return this._knotMenu.sceneType="Linked Knot",void(this._freeze=!1);this._knotMenu.sceneType="Fourier Knot"}this._freeze=!1},new((o=void 0)||(o=Promise))((function(t,n){function r(t){try{h(s.next(t))}catch(t){n(t)}}function a(t){try{h(s.throw(t))}catch(t){n(t)}}function h(i){var e;i.done?t(i.value):(e=i.value,e instanceof o?e:new o((function(t){t(e)}))).then(r,a)}h((s=s.apply(i,e||[])).next())}));var i,e,o,s}drawScene(t,i,e=!0){var o,s;this._freeze||(t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),"Linked Knot"==this.sceneType?this.linkedKnot.draw(t,i,e):"Fourier Knot"==this.sceneType?null===(o=this._fourierKnot)||void 0===o||o.draw(t,i,e):"Quintuples"==this.sceneType&&(null===(s=this._fourierKnot)||void 0===s||s.draw(t,i,e),this._quintpules.draw(t,i,e)))}get linkedKnot(){return this._linkedKnot}get fourierKnot(){return this._fourierKnot}get quintuples(){return this._quintpules}get transform_z(){return this.linkedKnot.transform_z}set transform_z(t){this.linkedKnot.transform_z=t}get selected(){return this.linkedKnot.selected}get InsertOrConnect(){return this.linkedKnot.drawingTool.connectLast||this.linkedKnot.drawingTool.insert}get EraseOrSubdiv(){return this.linkedKnot.drawingTool.erase||this.linkedKnot.drawingTool.subdivide}get selectedNode(){return this.linkedKnot.selectedNode}setSelected(t,e,o,s,n){t.useProgram(o),this.linkedKnot.setDrawState(!1),this.drawScene(t,o,!1);var r=Array.from(i.pixelsFromMouseClick(s,n,t));t.useProgram(e),this.linkedKnot.setDrawState(!0),this.drawScene(t,e,!0),this.linkedKnot.pickObj(r)}btnManager(){this._knotMenu.disableAdvance(),this._knotMenu.disableDelete()}}class xt{constructor(t){this._scene=t,this._sceneType="Linked Knot",this._advance=document.getElementById("advance scene"),this._delete=document.getElementById("delete scene"),this._doubleCheck={overlay:document.getElementById("delete-check"),confirm:document.getElementById("delete-confirm"),cancel:document.getElementById("delete-cancel")},this._slider={linkedKnot:document.getElementById("Linked Knot"),fourierKnot:document.getElementById("Fourier Knot"),quintuples:document.getElementById("Quintuples")},this._circleOptions={overlay:document.getElementById("circle options"),doubleCheck:document.getElementById("double check box"),doubleCheckLimit:new rt("double check limit",20),maxCircles:new rt("circle max dropdown",10),submit:document.getElementById("confirm calculate"),cancel:document.getElementById("cancel calculate")},this.cancelBtnResponse(),this.sceneSelect()}initCallback(){this._advance.addEventListener("click",(()=>{this.advanceBtnResponse()})),this._delete.addEventListener("click",(()=>{this.deleteBtnResponse()})),this._doubleCheck.confirm.addEventListener("click",(()=>{this.confirmBtnResponse()})),this._doubleCheck.cancel.addEventListener("click",(()=>{this.cancelBtnResponse()})),document.addEventListener("mousedown",(t=>{"Linked Knot"!==this.sceneType||this._doubleCheck.overlay.contains(t.target)||this._doubleCheck.overlay.classList.contains("hidden")||this._doubleCheck.overlay.classList.toggle("hidden",!0)})),this._slider.linkedKnot.addEventListener("click",(()=>{this.sceneSelect()})),this._slider.fourierKnot.addEventListener("click",(()=>{this.sceneSelect()})),this._slider.quintuples.addEventListener("click",(()=>{this.sceneSelect()})),this._circleOptions.submit.addEventListener("click",(()=>{this._circleOptions.overlay.classList.toggle("hidden",!0),this._scene.advanceScene("Quintuples")})),this._circleOptions.cancel.addEventListener("click",(()=>{this.resetCircleOption()}))}advanceBtnResponse(){"Linked Knot"===this.sceneType?this._scene.advanceScene("Fourier Knot"):"Fourier Knot"===this.sceneType&&this._circleOptions.overlay.classList.toggle("hidden",!1)}resetCircleOption(){this._circleOptions.doubleCheckLimit.reset(),this._circleOptions.maxCircles.reset(),this._circleOptions.doubleCheck.checked=!0,this._circleOptions.overlay.classList.toggle("hidden",!0)}get doubleCheckLimit(){return this._circleOptions.doubleCheckLimit.value}get maxCircles(){return this._circleOptions.maxCircles.value}get doubleCheck(){return this._circleOptions.doubleCheck.checked}deleteBtnResponse(){"Linked Knot"===this.sceneType&&this._doubleCheck.overlay.classList.toggle("hidden",!1)}confirmBtnResponse(){"Linked Knot"===this.sceneType&&(this._scene.linkedKnot.deleteData(),this._doubleCheck.overlay.classList.toggle("hidden",!0),this.disableDelete(),this.disableAdvance())}cancelBtnResponse(){this._doubleCheck.overlay.classList.toggle("hidden",!0)}disableDelete(){"Linked Knot"!=this.sceneType||this._scene.linkedKnot.isEmpty?this._delete.classList.toggle("hidden",!0):this._delete.classList.toggle("hidden",!1)}disableAdvance(){"Linked Knot"==this.sceneType?this._advance.disabled=!this._scene.linkedKnot.isKnot:"Fourier Knot"==this.sceneType&&(this._advance.disabled=this._scene.fourierKnot.intersecting)}sceneSelect(){this._slider.linkedKnot.checked?this.sceneType="Linked Knot":this._slider.fourierKnot.checked?this.sceneType="Fourier Knot":this._slider.quintuples.checked&&(this.sceneType="Quintuples")}disableSelector(){this._slider.fourierKnot.disabled=!this._scene.fourierKnot.calculated,this._slider.quintuples.disabled=!this._scene.quintuples.calculated}get sceneType(){return this._sceneType}set sceneType(t){this._sceneType=t,"Linked Knot"==this.sceneType?(this._slider.linkedKnot.checked=!0,this._scene.linkedKnot.drawingTool.Disable(!1),this._scene.quintuples.player.Disable(!0),this._advance.textContent="Smoothen Knot"):"Fourier Knot"==this.sceneType?(this._slider.fourierKnot.checked=!0,this._scene.linkedKnot.selected=null,this._scene.linkedKnot.drawingTool.Disable(!0),this._scene.quintuples.player.Disable(!0),this._advance.textContent="Find Circles"):"Quintuples"==this.sceneType&&(this._slider.quintuples.checked=!0,this._scene.linkedKnot.selected=null,this._scene.linkedKnot.drawingTool.Disable(!0),this._scene.quintuples.player.Disable(!1)),this._advance.setAttribute("sceneType",this._sceneType),this.disableAdvance(),this.disableDelete(),this.disableSelector(),this.resetCircleOption(),this._circleOptions.overlay.classList.toggle("hidden",!0)}}class bt{constructor(i){this.canvas=i,this.gl=t.checkWebGL(this.canvas),this.programs={render:t.createProgram(this.gl,"precision mediump float;\r\nattribute vec4 aColor;\r\nattribute vec4 aNormal;\r\nattribute vec4 aPosition;\r\n\r\nuniform mat4 mWorld;\r\nuniform mat4 mView;\r\nuniform mat4 mProj;\r\n\r\n\r\nuniform mat3 uNormalMatrix;\r\n\r\nvarying vec4 vColor;\r\nvarying vec3 vNormal;\r\n\r\nvoid main() {\r\n    gl_Position = mProj * mView * mWorld * aPosition;\r\n\r\n    vColor = aColor;\r\n    vNormal = normalize(uNormalMatrix * vec3(aNormal));\r\n}","precision mediump float;\r\n\r\nuniform vec3 uDiffuseLight;\r\nuniform vec3 uLightPosition;\r\nuniform vec3 uAmbientLight;\r\n\r\nvarying vec4 vColor;\r\nvarying vec3 vNormal;\r\n\r\n\r\nvoid main() {\r\n    // Normalize the normal because it is interpolated and not 1.0 in length any more\r\n    vec3 normal = normalize(vNormal);\r\n\r\n    // Calculate the light direction and make its length 1.\r\n    vec3 lightDirection = normalize(uLightPosition);\r\n\r\n    // The dot product of the light direction and the orientation of a surface (the normal)\r\n    float nDotL = max(dot(lightDirection, normal), 0.0);\r\n\r\n    // Calculate the final color from diffuse reflection and ambient reflection\r\n    vec3 diffuse = uDiffuseLight * vColor.rgb * nDotL;\r\n    vec3 ambient = uAmbientLight * vColor.rgb;\r\n    gl_FragColor = vec4(diffuse + ambient, vColor.a);\r\n}"),read:t.createProgram(this.gl,"attribute vec4 aPosition;\r\nattribute vec4 aColor;\r\n\r\nuniform mat4 mWorld;\r\nuniform mat4 mView;\r\nuniform mat4 mProj;\r\n\r\n\r\nvarying vec4 vColor;\r\n\r\nvoid main() {\r\n    gl_Position = mProj * mView * mWorld * aPosition;\r\n    vColor = aColor;\r\n}","precision mediump float;\r\n\r\nvarying vec4 vColor;\r\n\r\nvoid main() {\r\n    gl_FragColor = vColor;\r\n}")},this.camera=new B,this.scene=new gt,this.ui={left_down:!1,wheel_down:!1,mouse:{lastX:0,lastY:0},doubleClick:{click:!1,sameObj:!1,lastX:0,lastY:0},shift:!1},this._fps={fpsLimit:30,prev:0},this._infoPage={hidden:!0,overlay:document.getElementById("about overlay"),btn:document.getElementById("about button"),exit:document.getElementById("info-exit")}}run(){this.initGL(),this.initCallbacks(),requestAnimationFrame(this.animate.bind(this))}initGL(){this.gl.clearColor(.9855,.9867,.9812,1),this.gl.enable(this.gl.DEPTH_TEST),this.gl.useProgram(this.programs.render),j.setLight(this.gl,this.programs.render,[50,50,50]),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.blendEquation(this.gl.FUNC_ADD)}initCallbacks(){var t;window.addEventListener("beforeunload",(t=>{t.returnValue=!0})),this._infoPage.btn.addEventListener("click",(()=>{this._infoPage.overlay.classList.toggle("hidden",!1),this._infoPage.hidden=!1})),this._infoPage.exit.addEventListener("click",(()=>{this._infoPage.overlay.classList.toggle("hidden",!0),this._infoPage.hidden=!0})),document.addEventListener("mousedown",(t=>{var i;(null===(i=this._infoPage.overlay.querySelector("#info-content"))||void 0===i?void 0:i.contains(t.target))||this._infoPage.hidden||(this._infoPage.overlay.classList.toggle("hidden",!0),this._infoPage.hidden=!0)})),document.addEventListener("keydown",(t=>{this.keyDown(t)})),document.addEventListener("keyup",(t=>{this.keyUp(t)})),this.canvas.addEventListener("mousedown",(t=>{this.mouseDown(t)})),this.canvas.addEventListener("mouseup",(t=>{this.mouseUp(t)})),this.canvas.addEventListener("mousemove",(t=>{this.mouseMove(t)})),this.canvas.addEventListener("wheel",(t=>{this.zoom(t)})),null===(t=document.getElementById("camera button"))||void 0===t||t.addEventListener("click",(()=>{this.camera.reset=!0})),window.addEventListener("resize",(()=>{this.resizer()})),this.resizer(),this.canvas.addEventListener("wheel",(t=>{1==t.ctrlKey&&t.preventDefault()}),{passive:!1})}configCamera(){this.gl.useProgram(this.programs.read),this.camera.update(this.gl,this.programs.read,this.canvas.width,this.canvas.height),this.gl.useProgram(this.programs.render),this.camera.update(this.gl,this.programs.render,this.canvas.width,this.canvas.height),this.camera.setRay()}animate(t){requestAnimationFrame(this.animate.bind(this)),this.camera.reset&&this.camera.resetCam(this.gl,this.programs.render,this.canvas.width,this.canvas.height),t-this._fps.prev<1e3/this._fps.fpsLimit-.1||this.scene.drawScene(this.gl,this.programs.render,!0)}keyDown(t){this.ui.shift=t.shiftKey,("Delete"===t.key||"Backspace"===t.key)&&this.scene.linkedKnot.delete(),("="==t.key&&1==t.ctrlKey||"-"==t.key&&1==t.ctrlKey)&&t.preventDefault()}keyUp(t){this.ui.shift=t.shiftKey}mouseDown(t){if(this.camera.reset&&(this.camera.reset=!1,this.configCamera()),i.inCanvas(t)){if(this.ui.doubleClick.click=!0,this.ui.doubleClick.lastX=t.clientX,this.ui.doubleClick.lastY=t.clientY,0==t.button&&(this.ui.left_down=!0,"Linked Knot"==this.scene.sceneType&&!this.scene.InsertOrConnect)){const i=this.scene.selected;this.scene.setSelected(this.gl,this.programs.render,this.programs.read,t,this.canvas),i===this.scene.selected&&(this.scene.selectedNode||this.ui.shift)&&(this.ui.doubleClick.sameObj=!0)}1==t.button&&(this.ui.wheel_down=!0)}}mouseUp(t){0==t.button&&(this.ui.left_down=!1,this.ui.doubleClick.click&&(this.scene.InsertOrConnect||this.scene.EraseOrSubdiv?this.scene.linkedKnot.btnManager():this.ui.doubleClick.sameObj&&(this.scene.transform_z=!this.scene.transform_z)),this.scene.btnManager()),1==t.button&&(this.ui.wheel_down=!1),this.ui.doubleClick.sameObj=!1,this.configCamera()}checkClick(t,i){const e=Math.abs(t-this.ui.doubleClick.lastX),o=Math.abs(i-this.ui.doubleClick.lastY);return e<20&&o<20}mouseMove(t){const e=t.clientX,o=t.clientY;if(this.scene.selectedNode||!this.ui.left_down&&!this.ui.wheel_down){if("Linked Knot"==this.scene.sceneType&&(this.scene.InsertOrConnect||this.scene.EraseOrSubdiv)&&(this.ui.left_down||this.ui.wheel_down)){if(this.ui.doubleClick.click)return void(this.ui.doubleClick.click=this.checkClick(e,o));const t=1/this.canvas.height,i=t*(e-this.ui.mouse.lastX),s=t*(o-this.ui.mouse.lastY);this.ui.left_down&&!this.ui.shift?(this.camera.addAngle(i,s),this.camera.update(this.gl,this.programs.render,this.canvas.width,this.canvas.height)):(this.ui.wheel_down||this.ui.shift&&this.ui.left_down)&&(this.camera.transform(i,s,this.scene.transform_z),this.camera.update(this.gl,this.programs.render,this.canvas.width,this.canvas.height))}else if("Linked Knot"==this.scene.sceneType&&this.scene.selectedNode&&(this.ui.left_down||this.scene.InsertOrConnect)){if(this.ui.doubleClick.click)return void(this.ui.doubleClick.click=this.checkClick(e,o));const{relx:l,rely:_}=i.pixelInputToGLCoord(t,this.canvas);var h=r(s(),[l,_,-1,1],this.camera.toWorld),c=r(s(),[l,_,1,1],this.camera.toWorld);n(h,h,1/h[3]),n(c,c,1/c[3]);const u=d(a(),[c[0],c[1],c[2]],[h[0],h[1],h[2]]);this.scene.linkedKnot.moveNode(u,this.camera.absPos,this.camera.normal)}}else{this.ui.doubleClick.click=!1;const t=1/this.canvas.height,i=t*(e-this.ui.mouse.lastX),s=t*(o-this.ui.mouse.lastY);this.ui.left_down&&!this.ui.shift?(this.camera.addAngle(i,s),this.camera.update(this.gl,this.programs.render,this.canvas.width,this.canvas.height)):(this.ui.wheel_down||this.ui.shift&&this.ui.left_down)&&(this.camera.transform(i,s,this.scene.transform_z),this.camera.update(this.gl,this.programs.render,this.canvas.width,this.canvas.height))}this.ui.mouse.lastX=e,this.ui.mouse.lastY=o}zoom(t){this.camera.addRadius(t.deltaY),this.configCamera()}resizer(){this.scene.quintuples.player.resize(),this.resizeCanvasToDisplaySize(),this.configCamera()}resizeCanvasToDisplaySize(){const t=window.devicePixelRatio,{width:i,height:e}=this.canvas.getBoundingClientRect(),o=Math.round(i*t),s=Math.round(e*t);this.canvas.width=o,this.canvas.height=s}}const wt=document.getElementById("gfx-main"),kt=document.getElementById("error-screen");let Ct=!1;var Mt,zt;if(Mt=navigator.userAgent,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(Mt)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(Mt.substr(0,4)))&&(Ct=!0),Ct)throw kt.textContent="Mobile and Tablets not supported.",kt.classList.remove("hidden"),new Error("Use chrome on PC");try{zt=new bt(wt)}catch(t){throw console.log(t),kt.textContent="Try a new version of Chrome.",kt.classList.remove("hidden"),new Error}zt.run()})(),t=p(91),i=p.n(t),e=new URL(p(551),p.b),o=new URL(p(951),p.b),s=new URL(p(337),p.b),n=new URL(p(517),p.b),r=new URL(p(994),p.b),a=new URL(p(873),p.b),h=new URL(p(856),p.b),c=new URL(p(282),p.b),l=new URL(p(794),p.b),_=new URL(p(302),p.b),i()(e),i()(o),i()(s),i()(n),i()(r),i()(a),i()(h),i()(c),i()(l),i()(_)})();