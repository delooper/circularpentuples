(()=>{"use strict";var t,e,i,n,s,r,o,a,h,d,c,l,_,u,f,p,v,g,m,x,y,b={91:t=>{t.exports=function(t,e){return e||(e={}),t?(t=String(t.__esModule?t.default:t),e.hash&&(t+=e.hash),e.maybeNeedQuotes&&/[\t\n\f\r "'=<>`]/.test(t)?'"'.concat(t,'"'):t):t}},705:(t,e,i)=>{t.exports=i.p+"f92bef95b80a212116a0.png"},917:(t,e,i)=>{t.exports=i.p+"353ff3d844daacd77ca5.png"},231:(t,e,i)=>{t.exports=i.p+"fdc47023e117988fc918.png"},118:(t,e,i)=>{t.exports=i.p+"25e232bfda846245b027.png"},5:(t,e,i)=>{t.exports=i.p+"8631fddda8163a66737d.png"},951:(t,e,i)=>{t.exports=i.p+"83543eec05909a0ca535.png"},282:(t,e,i)=>{t.exports=i.p+"31f5ef0c8dffa5492da6.png"},349:(t,e,i)=>{t.exports=i.p+"7b3522d32d0512999cf5.png"},517:(t,e,i)=>{t.exports=i.p+"3ecd27d9240d163175c1.png"},856:(t,e,i)=>{t.exports=i.p+"857e29fea39a49d24eab.png"},873:(t,e,i)=>{t.exports=i.p+"0d1cb381129368ba84d1.png"},987:(t,e,i)=>{t.exports=i.p+"8a1efed4d2205d3a41b3.ico"},778:(t,e,i)=>{t.exports=i.p+"d6414f0234f82cbce69e.png"},337:(t,e,i)=>{t.exports=i.p+"23da7583e2e60bf72666.png"},302:(t,e,i)=>{t.exports=i.p+"4392c3e322617baf9aa7.png"},794:(t,e,i)=>{t.exports=i.p+"c72adc7afbb90c3d3def.png"},36:(t,e,i)=>{t.exports=i.p+"528a00f307bcc9471201.png"},994:(t,e,i)=>{t.exports=i.p+"65a7bd79167e55459bb5.png"},682:(t,e,i)=>{t.exports=i.p+"99a6ad1336a37107be45.png"}},k={};function w(t){var e=k[t];if(void 0!==e)return e.exports;var i=k[t]={exports:{}};return b[t](i,i.exports,w),i.exports}w.m=b,w.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return w.d(e,{a:e}),e},w.d=(t,e)=>{for(var i in e)w.o(e,i)&&!w.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},w.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),w.p="./dist/",w.b=document.baseURI||self.location.href,(()=>{class t{static checkWebGL(t){const e=["experimental-webgl","webkit-3d","moz-webgl"];var i=t.getContext("webgl",{preserveDrawingBuffer:!0});if(!i)for(var n=0;n<e.length;n++){try{i=t.getContext(e[n],{preserveDrawingBuffer:!0})}catch(t){}if(i)break}if(!i)throw alert("WebGL not available. Please use a new version of Chrome or Firefox."),new Error("WebGL not available. Please use a new version of Chrome or Firefox.");return i}static createProgram(e,i,n){var s=e.createProgram(),r=t.getShader(e,e.VERTEX_SHADER,i),o=t.getShader(e,e.FRAGMENT_SHADER,n);if(e.attachShader(s,r),e.attachShader(s,o),e.linkProgram(s),!e.getProgramParameter(s,e.LINK_STATUS)){var a=e.getProgramInfoLog(s);return console.log("Failed to link program: "+a),e.deleteProgram(s),e.deleteShader(o),e.deleteShader(r),null}return s}static renderBuffers(t,e,i,n=null){let s=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let n=0;n<s;++n){let s=t.getActiveAttrib(e,n);if(!s)break;var r=i[s.name],o=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,r.bufferData,t.STATIC_DRAW);var a=t.getAttribLocation(e,s.name);t.enableVertexAttribArray(a),t.vertexAttribPointer(a,r.size,t.FLOAT,!1,0,r.bufferData.BYTES_PER_ELEMENT*r.offset)}if(n){var h=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,h),t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW)}}static bindBuffers(t,e,i,n,s=null){let r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let s=0;s<r;++s){let r=t.getActiveAttrib(e,s);if(!r)break;var o=i[r.name];t.bindBuffer(t.ARRAY_BUFFER,n[r.name]);var a=t.getAttribLocation(e,r.name);t.enableVertexAttribArray(a),t.vertexAttribPointer(a,o.size,t.FLOAT,!1,0,o.bufferData.BYTES_PER_ELEMENT*o.offset)}s&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s)}static initBuffers(t,e,i,n=null){let s=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);var r={};for(let n=0;n<s;++n){let s=t.getActiveAttrib(e,n);if(!s)break;var o=i[s.name];r[s.name]=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,r[s.name]),t.bufferData(t.ARRAY_BUFFER,o.bufferData,t.STATIC_DRAW);var a=t.getAttribLocation(e,s.name);t.enableVertexAttribArray(a),t.vertexAttribPointer(a,o.size,t.FLOAT,!1,0,o.bufferData.BYTES_PER_ELEMENT*o.offset)}var h=null;return n&&(h=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,h),t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW)),[r,h]}static getShader(t,e,i){var n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:(console.log("An error occurred compiling the shaders:"+t.getShaderInfoLog(n)),t.deleteShader(n),null)}}class e{static inCanvas(t){var e=t.clientX,i=t.clientY,n=t.target.getBoundingClientRect();return n.left<=e&&e<n.right&&n.top<=i&&i<n.bottom}static pixelInputToGLCoord(t,e){var i=t.clientX,n=t.clientY,s=e.width/2,r=e.height/2;return{relx:i=(i-e.left-s)/s,rely:n=(r-(n-e.top))/r}}static pixelInputToCanvasCoord(t,e){var i=t.clientX,n=t.clientY,s=e.getBoundingClientRect();return{x:i-=s.left,y:n=s.bottom-n}}static pixelsFromMouseClick(t,i,n){var s=e.pixelInputToCanvasCoord(t,i),r=new Uint8Array(4);return n.readPixels(s.x,s.y,1,1,n.RGBA,n.UNSIGNED_BYTE,r),r}}var i=1e-6,n="undefined"!=typeof Float32Array?Float32Array:Array;function s(){var t=new n(4);return n!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function r(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function o(t,e,i){var n=e[0],s=e[1],r=e[2],o=e[3];return t[0]=i[0]*n+i[4]*s+i[8]*r+i[12]*o,t[1]=i[1]*n+i[5]*s+i[9]*r+i[13]*o,t[2]=i[2]*n+i[6]*s+i[10]*r+i[14]*o,t[3]=i[3]*n+i[7]*s+i[11]*r+i[15]*o,t}function a(){var t=new n(3);return n!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function h(t){var e=t[0],i=t[1],n=t[2];return Math.hypot(e,i,n)}function d(t,e,i){var s=new n(3);return s[0]=t,s[1]=e,s[2]=i,s}function c(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function l(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function _(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function u(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function f(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t}function p(t,e){var i=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2];return Math.hypot(i,n,s)}function v(t,e){var i=e[0],n=e[1],s=e[2],r=i*i+n*n+s*s;return r>0&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function g(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function m(t,e,i){var n=e[0],s=e[1],r=e[2],o=i[0],a=i[1],h=i[2];return t[0]=s*h-r*a,t[1]=r*o-n*h,t[2]=n*a-s*o,t}function x(t,e,i){var n=i[0],s=i[1],r=i[2],o=i[3],a=e[0],h=e[1],d=e[2],c=s*d-r*h,l=r*a-n*d,_=n*h-s*a,u=s*_-r*l,f=r*c-n*_,p=n*l-s*c,v=2*o;return c*=v,l*=v,_*=v,u*=2,f*=2,p*=2,t[0]=a+c+u,t[1]=h+l+f,t[2]=d+_+p,t}function y(t){return t[0]=0,t[1]=0,t[2]=0,t}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),s();var b=p,k=h;function w(){var t=new n(16);return n!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function C(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function M(t,e,i){var n,s,r,o,a,h,d,c,l,_,u,f,p=i[0],v=i[1],g=i[2];return e===t?(t[12]=e[0]*p+e[4]*v+e[8]*g+e[12],t[13]=e[1]*p+e[5]*v+e[9]*g+e[13],t[14]=e[2]*p+e[6]*v+e[10]*g+e[14],t[15]=e[3]*p+e[7]*v+e[11]*g+e[15]):(n=e[0],s=e[1],r=e[2],o=e[3],a=e[4],h=e[5],d=e[6],c=e[7],l=e[8],_=e[9],u=e[10],f=e[11],t[0]=n,t[1]=s,t[2]=r,t[3]=o,t[4]=a,t[5]=h,t[6]=d,t[7]=c,t[8]=l,t[9]=_,t[10]=u,t[11]=f,t[12]=n*p+a*v+l*g+e[12],t[13]=s*p+h*v+_*g+e[13],t[14]=r*p+d*v+u*g+e[14],t[15]=o*p+c*v+f*g+e[15]),t}function z(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function L(t,e,i,n){var s=e[0],r=e[1],o=e[2],a=e[3],h=s+s,d=r+r,c=o+o,l=s*h,_=s*d,u=s*c,f=r*d,p=r*c,v=o*c,g=a*h,m=a*d,x=a*c,y=n[0],b=n[1],k=n[2];return t[0]=(1-(f+v))*y,t[1]=(_+x)*y,t[2]=(u-m)*y,t[3]=0,t[4]=(_-x)*b,t[5]=(1-(l+v))*b,t[6]=(p+g)*b,t[7]=0,t[8]=(u+m)*k,t[9]=(p-g)*k,t[10]=(1-(l+f))*k,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}a();var E;function B(t,e){return t[0]*e[0]+t[1]*e[1]}E=new n(2),n!=Float32Array&&(E[0]=0,E[1]=0);const A=Math.PI;function P(t){return Math.cos(t)}function N(t){return Math.sin(t)}class S{constructor(){this._basePos={theta:A/4,phi:A/4,radius:12,trans:[0,0,1.5]},this._spherical={theta:this._basePos.theta,phi:this._basePos.phi,radius:this._basePos.radius},this._position=[0,0,0],this._ray={absPos:[0,0,0],normal:[0,0],toWorld:w()},this._transformation=c(a(),this._basePos.trans),this._mView=w(),this._mProj=w(),this._reset=!1,this.updateCameraPos(),this.setRay()}changeBase(t){this._basePos=t,this._spherical={theta:this._basePos.theta,phi:this._basePos.phi,radius:this._basePos.radius},this._transformation=this._basePos.trans,this.updateCameraPos()}update(t,e,n,s){var r=t.getUniformLocation(e,"mView"),o=t.getUniformLocation(e,"mProj");t.viewport(0,0,n,s),function(t,e,i,n,s){var r,o=1/Math.tan(e/2);t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=s&&s!==1/0?(r=1/(n-s),t[10]=(s+n)*r,t[14]=2*s*n*r):(t[10]=-1,t[14]=-2*n)}(this._mProj,A/4,n/s,1,5*this._spherical.radius),function(t,e,n,s){var r,o,a,h,d,c,l,_,u,f,p=e[0],v=e[1],g=e[2],m=s[0],x=s[1],y=s[2],b=n[0],k=n[1],w=n[2];Math.abs(p-b)<i&&Math.abs(v-k)<i&&Math.abs(g-w)<i?C(t):(l=p-b,_=v-k,u=g-w,r=x*(u*=f=1/Math.hypot(l,_,u))-y*(_*=f),o=y*(l*=f)-m*u,a=m*_-x*l,(f=Math.hypot(r,o,a))?(r*=f=1/f,o*=f,a*=f):(r=0,o=0,a=0),h=_*a-u*o,d=u*r-l*a,c=l*o-_*r,(f=Math.hypot(h,d,c))?(h*=f=1/f,d*=f,c*=f):(h=0,d=0,c=0),t[0]=r,t[1]=h,t[2]=l,t[3]=0,t[4]=o,t[5]=d,t[6]=_,t[7]=0,t[8]=a,t[9]=c,t[10]=u,t[11]=0,t[12]=-(r*p+o*v+a*g),t[13]=-(h*p+d*v+c*g),t[14]=-(l*p+_*v+u*g),t[15]=1)}(this._mView,this._position,[0,0,0],[0,0,1]),M(this._mView,this._mView,this._transformation),t.uniformMatrix4fv(r,!1,this._mView),t.uniformMatrix4fv(o,!1,this._mProj)}resetCam(t,e,i,n){const s=this._basePos.theta-this._spherical.theta,r=this._basePos.phi-this._spherical.phi,o=this._basePos.radius-this._spherical.radius;s<-A||s>=0?this._spherical.theta+=Math.sqrt(Math.abs(s))/30:this._spherical.theta-=Math.sqrt(Math.abs(s))/30,this._spherical.phi+=Math.sign(r)*Math.sqrt(Math.abs(r))/30,this._spherical.phi=Math.min(Math.max(1e-4,this._spherical.phi),A-1e-4),this._spherical.radius+=o/30;var h=_(a(),this._basePos.trans,this._transformation);f(this._transformation,this._transformation,h,1/30/1.6),Math.abs(s)<.001&&Math.abs(r)<.001&&Math.abs(o)<.01&&k(h)<.01&&(this.reset=!1),this.updateCameraPos(),this.update(t,e,i,n)}updateCameraPos(){this._spherical.theta>2*A&&(this._spherical.theta=this._spherical.theta-2*A),this._spherical.theta<0&&(this._spherical.theta=2*A-this._spherical.theta),this._position[0]=this._spherical.radius*N(this._spherical.phi)*P(this._spherical.theta),this._position[1]=this._spherical.radius*N(this._spherical.phi)*N(this._spherical.theta),this._position[2]=this._spherical.radius*P(this._spherical.phi)}addAngle(t,e){this._spherical.phi=this._spherical.phi-e*Math.sqrt(this._spherical.radius),this._spherical.theta=this._spherical.theta-t*Math.sqrt(this._spherical.radius),this._spherical.phi=Math.min(Math.max(1e-4,this._spherical.phi),A-1e-4),this.updateCameraPos()}addRadius(t){this._spherical.radius+=5e-4*t*this._spherical.radius,this._spherical.radius=Math.min(Math.max(2,this._spherical.radius),35),this.updateCameraPos()}transform(t,e,i){i?this._transformation[2]=this._transformation[2]-N(this._spherical.phi)*e*this._spherical.radius:(this._transformation[0]=this._transformation[0]-N(this._spherical.theta)*t*this._spherical.radius,this._transformation[0]=this._transformation[0]+P(this._spherical.theta)*e*this._spherical.radius,this._transformation[1]=this._transformation[1]+P(this._spherical.theta)*t*this._spherical.radius,this._transformation[1]=this._transformation[1]+N(this._spherical.theta)*e*this._spherical.radius),this._transformation[0]=Math.min(Math.max(-15,this._transformation[0]),15),this._transformation[1]=Math.min(Math.max(-15,this._transformation[1]),15),this._transformation[2]=Math.min(Math.max(-15,this._transformation[2]),15)}setRay(){var t,e,i,n,s,r,o,a,h,d,c,l,u,f,p,v,g,m,x,y,b,k,C,M,z,L,E,B,A,P,N;t=this._ray.toWorld,e=function(t,e,i){var n=e[0],s=e[1],r=e[2],o=e[3],a=e[4],h=e[5],d=e[6],c=e[7],l=e[8],_=e[9],u=e[10],f=e[11],p=e[12],v=e[13],g=e[14],m=e[15],x=i[0],y=i[1],b=i[2],k=i[3];return t[0]=x*n+y*a+b*l+k*p,t[1]=x*s+y*h+b*_+k*v,t[2]=x*r+y*d+b*u+k*g,t[3]=x*o+y*c+b*f+k*m,x=i[4],y=i[5],b=i[6],k=i[7],t[4]=x*n+y*a+b*l+k*p,t[5]=x*s+y*h+b*_+k*v,t[6]=x*r+y*d+b*u+k*g,t[7]=x*o+y*c+b*f+k*m,x=i[8],y=i[9],b=i[10],k=i[11],t[8]=x*n+y*a+b*l+k*p,t[9]=x*s+y*h+b*_+k*v,t[10]=x*r+y*d+b*u+k*g,t[11]=x*o+y*c+b*f+k*m,x=i[12],y=i[13],b=i[14],k=i[15],t[12]=x*n+y*a+b*l+k*p,t[13]=x*s+y*h+b*_+k*v,t[14]=x*r+y*d+b*u+k*g,t[15]=x*o+y*c+b*f+k*m,t}(w(),this._mProj,this._mView),i=e[0],n=e[1],s=e[2],r=e[3],o=e[4],a=e[5],h=e[6],d=e[7],c=e[8],l=e[9],u=e[10],f=e[11],p=e[12],v=e[13],g=e[14],(N=(x=i*a-n*o)*(P=u*(m=e[15])-f*g)-(y=i*h-s*o)*(A=l*m-f*v)+(b=i*d-r*o)*(B=l*g-u*v)+(k=n*h-s*a)*(E=c*m-f*p)-(C=n*d-r*a)*(L=c*g-u*p)+(M=s*d-r*h)*(z=c*v-l*p))&&(N=1/N,t[0]=(a*P-h*A+d*B)*N,t[1]=(s*A-n*P-r*B)*N,t[2]=(v*M-g*C+m*k)*N,t[3]=(u*C-l*M-f*k)*N,t[4]=(h*E-o*P-d*L)*N,t[5]=(i*P-s*E+r*L)*N,t[6]=(g*b-p*M-m*y)*N,t[7]=(c*M-u*b+f*y)*N,t[8]=(o*A-a*E+d*z)*N,t[9]=(n*E-i*A-r*z)*N,t[10]=(p*C-v*b+m*x)*N,t[11]=(l*b-c*C-f*x)*N,t[12]=(a*L-o*B-h*z)*N,t[13]=(i*B-n*L+s*z)*N,t[14]=(v*y-p*k-g*x)*N,t[15]=(c*k-l*y+u*x)*N),_(this._ray.absPos,this._position,this._transformation),function(t,e){var i=e[0],n=e[1],s=i*i+n*n;s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s}(this._ray.normal,[this._position[0],this._position[1]])}get toWorld(){return this._ray.toWorld}get absPos(){return this._ray.absPos}get normal(){return this._ray.normal}get reset(){return this._reset}set reset(t){this._reset=t}}class T{static setLight(t,e,i=[50,50,50]){var n=v(a(),i),s=t.getUniformLocation(e,"uAmbientLight"),r=t.getUniformLocation(e,"uDiffuseLight"),o=t.getUniformLocation(e,"uLightPosition");t.uniform3f(s,.75,.75,.75),t.uniform3f(r,.35,.35,.35),t.uniform3f(o,n[0],n[1],n[2])}}function R(){var t=new n(9);return n!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function D(t,e){var i=e[0],n=e[1],s=e[2],r=e[3],o=e[4],a=e[5],h=e[6],d=e[7],c=e[8],l=e[9],_=e[10],u=e[11],f=e[12],p=e[13],v=e[14],g=e[15],m=i*a-n*o,x=i*h-s*o,y=i*d-r*o,b=n*h-s*a,k=n*d-r*a,w=s*d-r*h,C=c*p-l*f,M=c*v-_*f,z=c*g-u*f,L=l*v-_*p,E=l*g-u*p,B=_*g-u*v,A=m*B-x*E+y*L+b*z-k*M+w*C;return A?(A=1/A,t[0]=(a*B-h*E+d*L)*A,t[1]=(h*z-o*B-d*M)*A,t[2]=(o*E-a*z+d*C)*A,t[3]=(s*E-n*B-r*L)*A,t[4]=(i*B-s*z+r*M)*A,t[5]=(n*z-i*E-r*C)*A,t[6]=(p*w-v*k+g*b)*A,t[7]=(v*y-f*w-g*x)*A,t[8]=(f*k-p*y+g*m)*A,t):null}class F{constructor(t=[.1,.2,.3],e=.1,i=[0,0,0]){this._rad=e,this._SBO=I.check(t),this._state={position:i,mvp:w(),nm:R()},this.updateMat()}draw(t,e){this._SBO.init||this._SBO.initBuffers(t,e);var i=t.getUniformLocation(e,"mWorld"),n=t.getUniformLocation(e,"uNormalMatrix");this._SBO.bindBuffers(t,e),t.uniformMatrix4fv(i,!1,this._state.mvp),t.uniformMatrix3fv(n,!1,this._state.nm),t.drawElements(t.TRIANGLES,this._SBO.numVert,t.UNSIGNED_SHORT,0)}updateMat(){var t,e,i,n,s,r;z(this._state.mvp,this._state.position),t=this._state.mvp,e=this._state.mvp,n=(i=[this._rad,this._rad,this._rad])[0],s=i[1],r=i[2],t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],D(this._state.nm,this._state.mvp)}get color(){return this._SBO.color}get position(){return this._state.position}set position(t){t?(this._state.position=t,this.updateMat()):alert("error in Sphere.ts set position")}changeColor(t){this._SBO=I.check(t)}}F.SBOList=[];class I{constructor(t){this._init=!1,this._color=t;let e,i,n=2*Math.PI/20,s=Math.PI/16;var r,o,a,h,d,c,l=[],_=[],u=[],f=[];for(let t=0;t<=16;++t){i=Math.PI/2-t*s,r=1*Math.cos(i),o=1*Math.sin(i);for(let t=0;t<=20;++t)e=t*n,a=r*Math.cos(e),h=r*Math.sin(e),l.push(a,h,o),_.push(1*a,1*h,1*o),u.push(this._color[0],this._color[1],this._color[2],1)}for(let t=0;t<16;++t){c=20+(d=21*t)+1;for(let e=0;e<20;++e,++d,++c)0!=t&&f.push(d,c,d+1),15!=t&&f.push(d+1,c,c+1)}this._attributes={aColor:{size:4,offset:0,bufferData:new Float32Array(u)},aPosition:{size:3,offset:0,bufferData:new Float32Array(l)},aNormal:{size:3,offset:0,bufferData:new Float32Array(_)}},this._indices=new Uint16Array(f),this._numVert=this._indices.length}initBuffers(e,i){[this._buffers,this._indexBuffer]=t.initBuffers(e,i,this._attributes,this._indices),this._init=!0}bindBuffers(e,i){t.bindBuffers(e,i,this._attributes,this._buffers,this._indexBuffer)}static check(t){var e,i;for(i=0;i<F.SBOList.length;i++)if(e=F.SBOList[i],b(e.color,t)<1e-4)return e;const n=new I(t);return F.SBOList.push(n),n}get color(){return this._color}get init(){return this._init}get numVert(){return this._numVert}}function K(){var t=new n(4);return n!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}var j,U,O,q=(j=a(),U=d(1,0,0),O=d(0,1,0),function(t,e,i){var n=g(e,i);return n<-.999999?(m(j,U,e),k(j)<1e-6&&m(j,O,e),v(j,j),function(t,e,i){i*=.5;var n=Math.sin(i);t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(i)}(t,j,Math.PI),t):n>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(m(j,e,i),t[0]=j[0],t[1]=j[1],t[2]=j[2],t[3]=1+n,function(t,e){var i=e[0],n=e[1],s=e[2],r=e[3],o=i*i+n*n+s*s+r*r;return o>0&&(o=1/Math.sqrt(o)),t[0]=i*o,t[1]=n*o,t[2]=s*o,t[3]=r*o,t}(t,t))});K(),K(),R();class G{constructor(t=[.18,.1,.18],e=[0,0,0],i=[0,0,1]){this._CBO=Y.check(t),this._state={start:e,end:i,rotQuat:K(),scale:a(),mvp:w(),nm:R()},this.updateMat()}draw(t,e){this._CBO.init||this._CBO.initBuffers(t,e);var i=t.getUniformLocation(e,"mWorld"),n=t.getUniformLocation(e,"uNormalMatrix");this._CBO.bindBuffers(t,e),t.uniformMatrix4fv(i,!1,this._state.mvp),t.uniformMatrix3fv(n,!1,this._state.nm),t.drawElements(t.TRIANGLES,this._CBO.numVert,t.UNSIGNED_BYTE,0)}get color(){return this._CBO.color}get start(){return this._state.start}get end(){return this._state.end}updateMat(){_(this._state.scale,this._state.end,this._state.start),q(this._state.rotQuat,[0,0,1],v(a(),this._state.scale)),L(this._state.mvp,this._state.rotQuat,this._state.start,[1,1,h(this._state.scale)]),D(this._state.nm,this._state.mvp)}set start(t){t?(this._state.start=t,this.updateMat()):alert("error in Cylinder.ts set start")}set end(t){t?(this._state.end=t,this.updateMat()):alert("error in Cylinder.ts set end")}changeColor(t){this._CBO=Y.check(t)}}G.CBOList=[];class Y{constructor(t){this._init=!1,this._color=t;let e=0;var i,n,s,r,o,a=[],h=[],d=[],c=[];for(let t=0;t<=1;++t){i=t;for(let t=0,r=0;t<=16;++t,r+=3)e=t/16*2*Math.PI,n=Math.cos(e),s=Math.sin(e),a.push(.03*n,.03*s,i),h.push(n,s,0),d.push(this.color[0],this.color[1],this.color[2],1)}for(let t=0;t<1;++t){o=16+(r=17*t)+1;for(let t=0;t<16;++t,++r,++o)c.push(r,r+1,o),c.push(o,r+1,o+1)}this._attributes={aColor:{size:4,offset:0,bufferData:new Float32Array(d)},aNormal:{size:3,offset:0,bufferData:new Float32Array(h)},aPosition:{size:3,offset:0,bufferData:new Float32Array(a)}},this._indices=new Uint8Array(c),this._numVert=this._indices.length}initBuffers(e,i){[this._buffers,this._indexBuffer]=t.initBuffers(e,i,this._attributes,this._indices),this._init=!0}bindBuffers(e,i){t.bindBuffers(e,i,this._attributes,this._buffers,this._indexBuffer)}static check(t){var e,i;for(i=0;i<G.CBOList.length;i++)if(e=G.CBOList[i],b(e.color,t)<1e-4)return e;const n=new Y(t);return G.CBOList.push(n),n}get color(){return this._color}get init(){return this._init}get numVert(){return this._numVert}}class W{constructor(){this._opacity1=.24,this._opacity2=.4,this._attributes1={aColor:{size:4,offset:0,bufferData:new Float32Array([0,0,0,this._opacity1,0,0,0,this._opacity1,0,0,0,this._opacity1,0,0,0,this._opacity1])},aNormal:{size:3,offset:0,bufferData:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1])},aPosition:{size:3,offset:0,bufferData:new Float32Array([5,5,0,5,-5,0,-5,5,0,-5,-5,0])}},this._indices1=new Uint8Array([0,1,2,1,2,3]),this._attributes2={aColor:{size:4,offset:0,bufferData:new Float32Array([0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2,0,0,0,this._opacity2])},aNormal:{size:3,offset:0,bufferData:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1])},aPosition:{size:3,offset:0,bufferData:new Float32Array([5,0,0,-5,0,0,5,.5,0,-5,.5,0,5,1,0,-5,1,0,5,1.5,0,-5,1.5,0,5,2,0,-5,2,0,5,2.5,0,-5,2.5,0,5,3,0,-5,3,0,5,3.5,0,-5,3.5,0,5,4,0,-5,4,0,5,4.5,0,-5,4.5,0,5,-.5,0,-5,-.5,0,5,-1,0,-5,-1,0,5,-1.5,0,-5,-1.5,0,5,-2,0,-5,-2,0,5,-2.5,0,-5,-2.5,0,5,-3,0,-5,-3,0,5,-3.5,0,-5,-3.5,0,5,-4,0,-5,-4,0,5,-4.5,0,-5,-4.5,0,0,5,0,0,-5,0,.5,5,0,.5,-5,0,1,5,0,1,-5,0,1.5,5,0,1.5,-5,0,2,5,0,2,-5,0,2.5,5,0,2.5,-5,0,3,5,0,3,-5,0,3.5,5,0,3.5,-5,0,4,5,0,4,-5,0,4.5,5,0,4.5,-5,0,-.5,5,0,-.5,-5,0,-1,5,0,-1,-5,0,-1.5,5,0,-1.5,-5,0,-2,5,0,-2,-5,0,-2.5,5,0,-2.5,-5,0,-3,5,0,-3,-5,0,-3.5,5,0,-3.5,-5,0,-4,5,0,-4,-5,0,-4.5,5,0,-4.5,-5,0])}},this._state={mvp:w(),nm:R(),n1:this._indices1.length,n2:76},C(this._state.mvp),this._state.nm=D(R(),this._state.mvp)}draw(e,i){this._buffers1||([this._buffers1,this._indexBuffer1]=t.initBuffers(e,i,this._attributes1,this._indices1),[this._buffers2]=t.initBuffers(e,i,this._attributes2));var n=e.getUniformLocation(i,"mWorld"),s=e.getUniformLocation(i,"uNormalMatrix");e.uniformMatrix4fv(n,!1,this._state.mvp),e.uniformMatrix3fv(s,!1,this._state.nm),t.bindBuffers(e,i,this._attributes1,this._buffers1,this._indexBuffer1),e.drawElements(e.TRIANGLES,this._state.n1,e.UNSIGNED_BYTE,0),t.bindBuffers(e,i,this._attributes2,this._buffers2),e.drawArrays(e.LINES,0,this._state.n2)}}class V{constructor(){this._arrows=[new Q([0,0,1]),new Q([0,0,-1])],this._position=[0,0,0]}draw(t,e){this._arrows[0].draw(t,e),this._arrows[1].draw(t,e)}set position(t){if(!t)throw new Error("error in Arrow.ts set position");this._arrows[0].position=t,this._arrows[1].position=t}}class X{constructor(){this._arrows=[new Q([1,0,0]),new Q([-1,0,0]),new Q([0,1,0]),new Q([0,-1,0])],this._position=[0,0,0]}draw(t,e){this._arrows[0].draw(t,e),this._arrows[1].draw(t,e),this._arrows[2].draw(t,e),this._arrows[3].draw(t,e)}set position(t){if(!t)throw new Error("error in Arrow.ts set position");this._arrows[0].position=t,this._arrows[1].position=t,this._arrows[2].position=t,this._arrows[3].position=t}}class Q{constructor(t=[0,0,0]){this._state={mvp:w(),nm:R(),n:0};const e=[.3,.3,.3],i=16,n=.04,s=.08;let r=0;var o=[],h=[],d=[],c=[];const l=q(K(),[0,0,1],t);var _,u,f,p,g,m=a();for(let t=0;t<=1;++t){_=.2*t+.2;for(let t=0,s=0;t<=i;++t,s+=3)r=t/i*2*Math.PI,x(m,[n*(u=Math.cos(r)),n*(f=Math.sin(r)),_],l),o.push(m[0],m[1],m[2]),x(m,[u,f,0],l),h.push(m[0],m[1],m[2]),d.push(e[0],e[1],e[2],.3)}for(let t=0;t<1;++t){g=(p=17*t)+i+1;for(let t=0;t<i;++t,++p,++g)c.push(p,p+1,g),c.push(g,p+1,g+1)}for(let t=0;t<=1;++t){_=.4;for(let a=0,c=0;a<=i;++a,c+=3)r=a/i*2*Math.PI,u=Math.cos(r),f=Math.sin(r),x(m,0==t?[n*u,n*f,_]:[s*u,s*f,_],l),o.push(m[0],m[1],m[2]),x(m,[0,0,-1],l),h.push(m[0],m[1],m[2]),d.push(e[0],e[1],e[2],.3)}for(let t=2;t<3;++t){g=(p=17*t)+i+1;for(let t=0;t<i;++t,++p,++g)c.push(p,p+1,g),c.push(g,p+1,g+1)}for(let t=0;t<=1;++t){_=.2*t+.2+.2;for(let n=0,a=0;n<=i;++n,a+=3)r=n/i*2*Math.PI,u=Math.cos(r),f=Math.sin(r),x(m,0==t?[s*u,s*f,_]:[0,0,_],l),o.push(m[0],m[1],m[2]),x(m,[.2*u,.2*f,s],l),v(m,m),h.push(m[0],m[1],m[2]),d.push(e[0],e[1],e[2],.3)}for(let t=4;t<5;++t){g=(p=17*t)+i+1;for(let t=0;t<i;++t,++p,++g)c.push(p,p+1,g),c.push(g,p+1,g+1)}this._attributes={aColor:{size:4,offset:0,bufferData:new Float32Array(d)},aNormal:{size:3,offset:0,bufferData:new Float32Array(h)},aPosition:{size:3,offset:0,bufferData:new Float32Array(o)}},this._indices=new Uint8Array(c),this._state.n=this._indices.length,C(this._state.mvp),D(this._state.nm,this._state.mvp)}draw(e,i){var n=e.getUniformLocation(i,"mWorld"),s=e.getUniformLocation(i,"uNormalMatrix");t.renderBuffers(e,i,this._attributes,this._indices),e.uniformMatrix4fv(n,!1,this._state.mvp),e.uniformMatrix3fv(s,!1,this._state.nm),e.drawElements(e.TRIANGLES,this._state.n,e.UNSIGNED_BYTE,0)}set position(t){z(this._state.mvp,t),D(this._state.nm,this._state.mvp)}}class H{constructor(){this._opacity=.8,this._color=[.2,.2,.2];var t=[],e=[],i=[];for(let n=0;n<=40;++n)t.push(0,0,.125*n),e.push(0,0,0),i.push(this._color[0],this._color[1],this._color[2],this._opacity);this._attributes={aColor:{size:4,offset:0,bufferData:new Float32Array(i)},aNormal:{size:3,offset:0,bufferData:new Float32Array(e)},aPosition:{size:3,offset:0,bufferData:new Float32Array(t)}},this._state={position:[0,0,0],length:0,mvp:w(),n:0}}draw(e,i){var n=e.getUniformLocation(i,"mWorld");t.renderBuffers(e,i,this._attributes),e.uniformMatrix4fv(n,!1,this._state.mvp),e.drawArrays(e.LINES,0,this._state.n)}set position(t){if(!t)throw new Error("error in Cylinder.ts set start");var e,i;this._state.position[0]=t[0],this._state.position[1]=t[1],this._state.length=t[2],e=this._state.mvp,i=[1,1,Math.sign(this._state.length)],e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,M(this._state.mvp,this._state.mvp,this._state.position),this._state.n=Math.floor(Math.abs(this._state.length)/.125+1.5),this._state.n-=this._state.n%2}}var Z=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class J{constructor(){this._nodeStack=new $,this._edgeStack=new $,this._nodeNum=0,this._edgeNum=0,this._isKnot=!1,this._nodeArr=[],this._transform_z=!1,this._selected=null,this._xyPlane=new W,this._planeArrows=new X,this._verticalArrows=new V,this._guide=new H,this._overlapNode=null,this._drawingTool=new it(this),this._drawingTool.initCallback();const t=document.getElementById("link-data");null==t||t.addEventListener("change",(()=>Z(this,void 0,void 0,(function*(){var e,i;if(this.deleteData(),0!=t.files.length){var n,s,r=(yield function(t){return Z(this,void 0,void 0,(function*(){return new Promise(((e,i)=>{var n=new FileReader;n.readAsText(t),n.onload=t=>{e(n.result)}}))}))}(t.files[0])).split("\n");if(!(r.length<=2)){for(let t=0;t<r.length&&!((n=r[t].split(", ")).length<3);t++)this.insert(),s=[parseFloat(n[0]),parseFloat(n[1]),parseFloat(n[2])],this.selected instanceof et&&(this.selected.object.position=s,null===(e=this.selected.prevCur)||void 0===e||e.updatePos(),null===(i=this.selected.curNext)||void 0===i||i.updatePos()),0!=t&&this.connect(this._nodeStack.data[t-1],this.selected);this.connect(this.selected,this._nodeStack.data[0])}}}))))}deleteData(){this._nodeStack=new $,this._edgeStack=new $,this._nodeNum=0,this._edgeNum=0,this._isKnot=!1,this._nodeArr=[],this._selected=null,this._drawingTool.reset()}insert(){var t=[0,0,0];this.selectedNode&&(t=this.selected.object.position,this._overlapNode=this.selected);const e=this._nodeStack.available();if(e>255)return void alert("Can only have at most 255 Nodes");const i=new et(t);this._nodeStack.insert(i,e),this.nodeNum++,this._isKnot=!1,this.selected=i}connect(t,e){const i=this._edgeStack.available();if(i>255)alert("Can only have at most 255 Edges");else{var n;if(t.curNext||e.prevCur)if(t.prevCur||e.curNext)if(t.curNext||e.curNext){if(t.prevCur||e.prevCur)return void alert("Nodes can have at most 2 edges");J.reverse(t),n=new tt(t,e)}else J.reverse(e),n=new tt(t,e);else n=new tt(e,t);else n=new tt(t,e);this._edgeStack.insert(n,i),this.edgeNum++,this.checkKnot()}}subdivide(){if(this.selected instanceof tt){const t=this.selected.startNode,e=this.selected.endNode,i=u(a(),l(a(),e.object.position,t.object.position),.5);this.delete(),this.insert(),this.selected.object.position=i,this.connect(this.selected,e),this.connect(t,this.selected),this._verticalArrows.position=this.selected.object.position,this._planeArrows.position=this.selected.object.position}}connected(t,e){return t.next instanceof et&&(t.next===e.next||t.next===e.prev)||t.prev instanceof et&&(t.prev===e.next||t.prev===e.prev)}delete(t=this.selected){t instanceof et?(this._nodeStack.delete(t),this.nodeNum--,t.prevCur&&(this._edgeStack.delete(t.prevCur),this.edgeNum--),t.curNext&&(this._edgeStack.delete(t.curNext),this.edgeNum--),t.delete()):t instanceof tt&&(t.delete(),this._edgeStack.delete(t),this.edgeNum--),this.selected=null,this.checkKnot()}static reverse(t){var e,i,n,s=t;if(t.next)do{n=s,s=s.next,null===(e=n.curNext)||void 0===e||e.reverse(),n.reverse()}while(s);else if(t.prev)do{n=s,s=s.prev,null===(i=n.prevCur)||void 0===i||i.reverse(),n.reverse()}while(s)}checkKnot(){if(this.nodeNum==this.edgeNum&&this.nodeNum>2){var t=null;for(let e=0;e<this._nodeStack.data.length;e++)if(null!==this._nodeStack.data[e]){t=this._nodeStack.data[e];break}var e=null==t?void 0:t.next;for(let i=1;i<this.nodeNum;i++){if(!e)return void(this._isKnot=!1);if(t===e)return void(this._isKnot=!1);e=e.next}this._isKnot=!0}else this._isKnot=!1}draw(t,e){var i;for(let n=0;n<this._nodeStack.data.length;n++)(i=this._nodeStack.data[n])&&i.object.draw(t,e);for(let n=0;n<this._edgeStack.data.length;n++)(i=this._edgeStack.data[n])&&i.object.draw(t,e);t.enable(t.BLEND),t.depthMask(!1),this._xyPlane.draw(t,e),this.selectedNode&&(this.transform_z?this._verticalArrows.draw(t,e):this._planeArrows.draw(t,e),this._guide.draw(t,e)),t.disable(t.BLEND),t.depthMask(!0)}get isEmpty(){return 0==this.nodeNum&&0==this.edgeNum}get isKnot(){return this._isKnot}get nodeArr(){var t=null;for(let e=0;e<this._nodeStack.data.length;e++)if(null!==this._nodeStack.data[e]){t=this._nodeStack.data[e];break}var e=null==t?void 0:t.next;this._nodeArr=[],this._nodeArr.push(t.object.position);for(let i=1;i<this.nodeNum;i++){if(!e)return this._isKnot=!1,void alert("not a knot");if(this._nodeArr.push(e.object.position),t===e)return void(this._isKnot=!1);e=e.next}return this._nodeArr}get selectedNode(){return this.selected instanceof et}get selected(){return this._selected}set selected(t){(this.selected instanceof et||this.selected instanceof tt)&&this.selected.object.changeColor(_(a(),this.selected.object.color,[.18,.18,.18])),this._selected=t,this.selected instanceof et?(this.selected.object.changeColor(l(a(),this.selected.object.color,[.18,.18,.18])),this._verticalArrows.position=this.selected.object.position,this._planeArrows.position=this.selected.object.position,this._guide.position=this.selected.object.position):this.selected instanceof tt&&this.selected.object.changeColor(l(a(),this.selected.object.color,[.18,.18,.18]))}get drawingTool(){return this._drawingTool}get nodeNum(){return this._nodeNum}set nodeNum(t){this._nodeNum=t}get edgeNum(){return this._edgeNum}set edgeNum(t){this._edgeNum=t}get transform_z(){return this._transform_z}set transform_z(t){this._transform_z=t}setDrawState(t){t?(this._nodeStack.data.forEach((function(t){t&&t.object.drawState()})),this._edgeStack.data.forEach((function(t){t&&t.object.drawState()}))):(this._nodeStack.data.forEach((function(t){t&&t.object.readState()})),this._edgeStack.data.forEach((function(t){t&&t.object.readState()})))}btnManager(){if(this.drawingTool.insert)this._overlapNode&&this.selected instanceof et&&(this.delete(),this.selected=this._overlapNode),this.insert(),this.drawingTool.insert=!0;else if(this.drawingTool.connectFirst){this._overlapNode&&this.selected instanceof et&&(this.delete(),this.selected=this._overlapNode);const t=this.selected;this.insert(),this.connect(t,this.selected),this.drawingTool.connectFirst=!1}else if(this.drawingTool.connectLast&&this.selected instanceof et){var t=null;if(this._overlapNode&&(this.selected.prev?t=this.selected.prev:this.selected.next&&(t=this.selected.next),this.delete(),this.selected=this._overlapNode,t&&this.connect(t,this.selected),this.selected.next&&this.selected.prev))return void(this.drawingTool.connectLast=!1);t=this.selected,this.insert(),this.connect(t,this.selected)}}moveNode(t,e,i){var n,s;if(this.selected instanceof et){var r=a();c(r,this.selected.object.position);const o=_(a(),e,this.selected.object.position);if(this.transform_z){const n=B(i,[o[0],o[1]]);r[2]=t[2]*(-n/B([t[0],t[1]],i))+e[2],r[2]=Math.max(-5,Math.min(5,r[2]))}else{const i=-o[2]/t[2];r[0]=t[0]*i+e[0],r[1]=t[1]*i+e[1],r[0]=Math.max(-5,Math.min(5,r[0])),r[1]=Math.max(-5,Math.min(5,r[1]))}this.selected.object.position=r,(this.drawingTool.insert||this.drawingTool.connectLast)&&(this.overlapping(v(a(),t),e),this._overlapNode&&(this.selected.object.position=this._overlapNode.object.position)),null===(n=this.selected.prevCur)||void 0===n||n.updatePos(),null===(s=this.selected.curNext)||void 0===s||s.updatePos(),this._verticalArrows.position=this.selected.object.position,this._planeArrows.position=this.selected.object.position,this._guide.position=this.selected.object.position}}overlapping(t,e){var i,n,s;if(this.selected instanceof et)for(let r=0;r<this._nodeStack.data.length;r++)if(i=this._nodeStack.data[r]){if(i===this.selected||i===this.selected.prev||i===this.selected.next||this.connected(i,this.selected))continue;if((!i.prevCur||!i.curNext)&&(n=p(e,i.object.position),s=l(a(),u(a(),t,n),e),p(i.object.position,s)<.25))return void(this._overlapNode=i)}this._overlapNode=null}pickObj(t,e){var i;this._overlapNode=null,this.selected=null;var n=a(),s=100,r=a(),o=a();for(let a=0;a<this._nodeStack.data.length;a++)(i=this._nodeStack.data[a])&&(_(n,i.object.position,e),v(r,t),f(o,n,r,-g(r,n)),h(o)<.12&&s>k(n)&&(this.selected=i,s=k(n)));if(!this.selected)for(let h=0;h<this._edgeStack.data.length;h++)if(i=this._edgeStack.data[h]){if(_(n,i.object.end,i.object.start),m(r,n,t),k(r)<.001)continue;if(_(o,e,i.object.start),v(r,r),Math.abs(g(r,o))<.12){m(r,t,r);const h=g(o,r)/g(r,n);if(h>0&&h<1){const t=_(a(),f(a(),i.object.start,n,h),e);s>k(t)&&(this.selected=i,s=k(t))}}}this.drawingTool.erase?(this.delete(),this.isEmpty&&(this.drawingTool.erase=!1)):this.drawingTool.subdivide&&(this.subdivide(),this.selectedNode&&(this.drawingTool.subdivide=!1))}}class ${constructor(){this._data=[]}insert(t,e){e<this._data.length?this._data[e]=t:this._data.push(t)}free(t){this._data[t]=null}delete(t){for(let e=0;e<this._data.length;e++)this._data[e]===t&&(this._data[e]=null)}available(){for(let t=0;t<this._data.length;t++)if(!this._data[t])return t;return this._data.length}get data(){return this._data}}class tt{constructor(t,e){this._startNode=t,this._endNode=e,this._startNode.curNext=this,this._startNode.next=this._endNode,this._endNode.prevCur=this,this._endNode.prev=this._startNode,this._object=new G([.4,.4,.4],this._startNode.object.position,this._endNode.object.position)}delete(){this._startNode.next=null,this._endNode.prev=null,this._startNode.curNext=null,this._endNode.prevCur=null}updatePos(){this.object.start=this._startNode.object.position,this.object.end=this._endNode.object.position}reverse(){const t=this._startNode;this._startNode=this._endNode,this._endNode=t}get object(){return this._object}get startNode(){return this._startNode}set startNode(t){this._startNode=t}get endNode(){return this._endNode}set endNode(t){this._endNode=t}}class et{constructor(t=d(0,0,0),e=null,i=null){this._object=new F(u(a(),[42,106,209],1/255),.1,t),this._prev=e,this._next=i,this._curNext=null,this._prevCur=null}delete(){var t,e;null===(t=this._prevCur)||void 0===t||t.delete(),null===(e=this._curNext)||void 0===e||e.delete()}reverse(){const t=this._next;this._next=this._prev,this._prev=t;const e=this._curNext;this._curNext=this._prevCur,this._prevCur=e}get object(){return this._object}get next(){return this._next}get prev(){return this._prev}get prevCur(){return this._prevCur}get curNext(){return this._curNext}set next(t){this._next=t}set prev(t){this._prev=t}set prevCur(t){this._prevCur=t}set curNext(t){this._curNext=t}}class it{constructor(t){this._linkedKnot=t,this._overlay=document.getElementById("drawing tool"),this._insertBtn=document.getElementById("insert button"),this._connectBtn=document.getElementById("connect button"),this._subdivideBtn=document.getElementById("subdivide button"),this._eraseBtn=document.getElementById("erase button"),this._insert=!1,this._connectFirst=!1,this._connectLast=!1,this._subdivide=!1,this._erase=!1}initCallback(){this._overlay.addEventListener("mousedown",(t=>{this.resize(t)})),this._insertBtn.addEventListener("click",(()=>{this.insertBtnResponse()})),this._connectBtn.addEventListener("click",(()=>{this.connectBtnResponse()})),this._eraseBtn.addEventListener("click",(()=>{this.eraseBtnResponse()})),this._subdivideBtn.addEventListener("click",(()=>{this.subdivideBtnResponse()}))}reset(){this.insert=!1,this.connectLast=!1,this.subdivide=!1,this.erase=!1}insertBtnResponse(){if(this.linkedKnot.nodeNum>254)alert("cannot have more than 255 nodes");else{if(this.insert=!this.insert,this.insert){if(this.linkedKnot.transform_z=!1,this.connectFirst)return void(this.connectLast=!1);this.connectLast&&this.linkedKnot.delete(),this.linkedKnot.insert()}else this.linkedKnot.delete();this.erase=!1,this.connectLast=!1,this.subdivide=!1}}connectBtnResponse(){this.linkedKnot.nodeNum>254?alert("cannot have more than 255 nodes"):(this.connectLast=!this.connectLast,this.connectLast?(this.linkedKnot.transform_z=!1,this.insert||this.linkedKnot.insert()):this.linkedKnot.delete(),this.insert=!1,this.erase=!1,this.subdivide=!1)}eraseBtnResponse(){this.erase=!this.erase,this.erase&&((this.connectLast||this.insert)&&this.linkedKnot.delete(),this.linkedKnot.selected=null),this.insert=!1,this.connectLast=!1,this.subdivide=!1}subdivideBtnResponse(){this.subdivide=!this.subdivide,this.subdivide&&((this.connectLast||this.insert)&&this.linkedKnot.delete(),this.linkedKnot.selected=null),this.insert=!1,this.connectLast=!1,this.erase=!1}get insert(){return this._insert}set insert(t){this._insert=t,this._insertBtn.classList.toggle("active",t)}set connectLast(t){this._connectLast=t,this._connectFirst=t,this._connectBtn.classList.toggle("active",t)}set connectFirst(t){this._connectFirst=t}get connectLast(){return this._connectLast}get connectFirst(){return this._connectFirst}get subdivide(){return this._subdivide}set subdivide(t){this._subdivide=t,this._subdivideBtn.classList.toggle("active",t)}set erase(t){this._erase=t,this._eraseBtn.classList.toggle("active",t)}get erase(){return this._erase}get linkedKnot(){return this._linkedKnot}Disable(t){this.insert=!1,this.connectLast=!1,this.subdivide=!1,this.erase=!1,!0===t?this._overlay.classList.toggle("hidden",!0):this._overlay.classList.toggle("hidden",!1)}resize(t){t.offsetY>=75&&t.offsetX<240&&t.offsetX>160&&("translate(0px, -80%)"===this._overlay.style.transform?this._overlay.style.transform="translate(0px, -0%)":this._overlay.style.transform="translate(0px, -80%)")}}const nt=Math.PI;function st(t){return Math.cos(t)}function rt(t){return Math.sin(t)}class ot{constructor(){this._cosCoef=[],this._sinCoef=[],this._opacity=1,this._attributes={aColor:{size:4,offset:0,bufferData:new Float32Array},aNormal:{size:3,offset:0,bufferData:new Float32Array},aPosition:{size:3,offset:0,bufferData:new Float32Array}},this._indices=new Uint16Array,this._state={mvp:w(),nm:R(),n:0},this._calculated=!1,this._intersecting=!0}deleteData(){this._calculated=!1,this._intersecting=!0}calcFourierFromLinked(t){var e,i,n=[],s=[],r=t.length,o=0,d=[0,0,0];for(let n=0;n<r;n++){o+=p(e=t[n],i=0==n?t[r-1]:t[n-1]);for(let i=0;i<r;i++){let n=_(a(),e,t[i]);Math.abs(n[0])>d[0]&&(d[0]=Math.abs(n[0])),Math.abs(n[1])>d[1]&&(d[1]=Math.abs(n[1])),Math.abs(n[2])>d[2]&&(d[2]=Math.abs(n[2]))}}const x=10/Math.max(d[0],d[1],d[2]);var b,k=a(),w=a(),M=0,z=a(),L=a();for(let h=1;h<=6;h++){let d=a(),c=a();y(d),y(c);for(let n=0;n<r;n++)b=M,M+=p(e=t[n],i=0==n?t[r-1]:t[n-1]),v(k,_(a(),e,i)),f(w,i,k,-b),l(z,l(a(),u(a(),w,2*nt*h*rt(2*nt*h*M/o)),u(a(),k,2*nt*h*M*rt(2*nt*h*M/o))),u(a(),k,o*st(2*nt*h*M/o))),l(L,l(a(),u(a(),w,2*nt*h*rt(2*nt*h*b/o)),u(a(),k,2*nt*h*b*rt(2*nt*h*b/o))),u(a(),k,o*st(2*nt*h*b/o))),f(d,d,_(a(),z,L),1/(2*nt*nt*h*h)),l(z,l(a(),u(a(),w,-2*nt*h*st(2*nt*h*M/o)),u(a(),k,-2*nt*h*M*st(2*nt*h*M/o))),u(a(),k,o*rt(2*nt*h*M/o))),l(L,l(a(),u(a(),w,-2*nt*h*st(2*nt*h*b/o)),u(a(),k,-2*nt*h*b*st(2*nt*h*b/o))),u(a(),k,o*rt(2*nt*h*b/o))),f(c,c,_(a(),z,L),1/(2*nt*nt*h*h));u(d,d,x),u(c,c,x),n.push(d),s.push(c)}this._cosCoef=n,this._sinCoef=s,this._calculated=!1;var E=d[2]*x*1.1;E<.01&&(E=1);const B=600;var A,P,N,S,T,R=[],F=[],I=[],K=[],j=a(),U=a(),O=[0,0,1];for(let t=0;t<=B;t++){v(A=_(a(),this.knot(t/B),this.knot((t+1)/B)),A),h(P=_(a(),O,u(a(),A,g(O,A))))<1e-6&&h(P=_(a(),[0,1,0],u(a(),A,g([0,1,0],A))))<1e-5&&(P=[1,0,0],P=_(a(),P,u(a(),A,g(P,A)))),v(P,P),v(N=m(a(),P,A),N),O=P;for(let e=0;e<=12;e++){const i=e/12*2*Math.PI;l(j,u(a(),P,st(i)),u(a(),N,rt(i))),c(U,j),u(j,j,.035),l(j,j,this.knot(t/B)),R.push(j[0],j[1],j[2]),F.push(U[0],U[1],U[2]),I.push(0,.75+j[2]/E/2,.75-j[2]/E/2,this._opacity)}}for(let t=0;t<B;++t){T=13+(S=13*t);for(let t=0;t<12;++t,++S,++T)K.push(S,S+1,T),K.push(T,S+1,T+1)}this._attributes.aColor.bufferData=new Float32Array(I),this._attributes.aNormal.bufferData=new Float32Array(F),this._attributes.aPosition.bufferData=new Float32Array(R),this._indices=new Uint16Array(K),C(this._state.mvp),D(this._state.nm,this._state.mvp),this._state.n=this._indices.length,this._intersecting=!0,this.checkIntersection()}knot(t){const e=2*t*nt;return l(a(),f(a(),f(a(),f(a(),f(a(),f(a(),u(a(),this._cosCoef[5],st(6*e)),this._cosCoef[4],st(5*e)),this._cosCoef[3],st(4*e)),this._cosCoef[2],st(3*e)),this._cosCoef[1],st(2*e)),this._cosCoef[0],st(e)),f(a(),f(a(),f(a(),f(a(),f(a(),u(a(),this._sinCoef[5],rt(6*e)),this._sinCoef[4],rt(5*e)),this._sinCoef[3],rt(4*e)),this._sinCoef[2],rt(3*e)),this._sinCoef[1],rt(2*e)),this._sinCoef[0],rt(e)))}draw(e,i){this.calculated||([this._buffers,this._indexBuffer]=t.initBuffers(e,i,this._attributes,this._indices),this._calculated=!0);var n=e.getUniformLocation(i,"mWorld"),s=e.getUniformLocation(i,"uNormalMatrix");t.bindBuffers(e,i,this._attributes,this._buffers,this._indexBuffer),e.uniformMatrix4fv(n,!1,this._state.mvp),e.uniformMatrix3fv(s,!1,this._state.nm),e.drawElements(e.TRIANGLES,this._state.n,e.UNSIGNED_SHORT,0)}exportKIArr(){var t=[],e=[],i=[],n=[];for(let s=0;s<this._cosCoef.length;s++)t.push(u(a(),this._sinCoef[s],s+1)),e.push(u(a(),this._cosCoef[s],-(s+1))),i.push(u(a(),this._cosCoef[s],-(s+1)*(s+1))),n.push(u(a(),this._sinCoef[s],-(s+1)*(s+1)));return[this._cosCoef,this._sinCoef,t,e,i,n]}checkIntersection(){const t=1200;for(let e=0;e<t;e++)for(let i=e+Math.round(24);i<Math.floor(1152);i++)if(b(this.knot(e/t),this.knot(i/t))<.05)return;this._intersecting=!1}get intersecting(){return this._intersecting}get calculated(){return this._calculated}}class at{constructor(t=1,e=[.5,.5,.5]){this._CBO=ht.check(e,t),this._state={center:[0,0,0],normal:[0,0,1],radius:t,mvp:w(),nm:R()},C(this._state.mvp),D(this._state.nm,this._state.mvp)}setCenterNormalRad(t,e,i){var n;n=i/this._state.radius,L(this._state.mvp,q(K(),[0,0,1],e),t,[n,n,n]),D(this._state.nm,this._state.mvp)}draw(t,e){this._CBO.init||this._CBO.initBuffers(t,e);var i=t.getUniformLocation(e,"mWorld"),n=t.getUniformLocation(e,"uNormalMatrix");this._CBO.bindBuffers(t,e),t.uniformMatrix4fv(i,!1,this._state.mvp),t.uniformMatrix3fv(n,!1,this._state.nm),t.drawElements(t.TRIANGLES,this._CBO.numVert,t.UNSIGNED_SHORT,0)}}at.CBOList=[];class ht{constructor(t,e){this._init=!1,this._color=t,this._majorRad=e;var i=Math.max(Math.min(Math.round(60*Math.sqrt(e)),500),50),n=e,s=[],r=[],o=[],a=[];for(let t=0;t<=10;++t){const e=t/10*2*Math.PI,a=Math.cos(e),h=Math.sin(e),d=n+.02*a;for(let t=0;t<=i;++t){const e=t/i*2*Math.PI,n=Math.cos(e),c=Math.sin(e),l=d*n,_=d*c,u=.02*h;s.push(l,_,u),r.push(n*a,c*a,h),o.push(this._color[0],this._color[1],this._color[2],1)}}const h=i+1;var d,c;for(let t=0;t<10;++t){c=(d=t*h)+h;for(let t=0;t<i;++t,++d,++c)a.push(d,d+1,c),a.push(d+1,c+1,c)}this._attributes={aColor:{size:4,offset:0,bufferData:new Float32Array(o)},aNormal:{size:3,offset:0,bufferData:new Float32Array(r)},aPosition:{size:3,offset:0,bufferData:new Float32Array(s)}},this._indices=new Uint16Array(a),this._numVert=this._indices.length}initBuffers(e,i){[this._buffers,this._indexBuffer]=t.initBuffers(e,i,this._attributes,this._indices),this._init=!0}bindBuffers(e,i){t.bindBuffers(e,i,this._attributes,this._buffers,this._indexBuffer)}static check(t,e){var i,n;for(n=0;n<at.CBOList.length;n++)if(i=at.CBOList[n],b(i.color,t)<1e-4&&Math.abs(i.radius-e)<.001)return i;const s=new ht(t,e);return at.CBOList.push(s),s}get color(){return this._color}get init(){return this._init}get numVert(){return this._numVert}get radius(){return this._majorRad}}class dt{constructor(){this._loader=document.getElementById("loader"),this._text=document.getElementById("loader text"),this._quit=document.getElementById("quit"),this._doubleCheck={overlay:document.getElementById("double check"),confirm:document.getElementById("confirm"),cancel:document.getElementById("cancel")},this._cancel=!1}initCallback(){this._quit.addEventListener("click",(()=>{this.quitBtnResponse()})),this._doubleCheck.confirm.addEventListener("click",(()=>{this.confirmBtnResponse()})),this._doubleCheck.cancel.addEventListener("click",(()=>{this.cancelBtnResponse()}))}quitBtnResponse(){this._doubleCheck.overlay.classList.toggle("hidden",!1)}confirmBtnResponse(){this._doubleCheck.overlay.classList.toggle("hidden",!0),this._cancel=!0}cancelBtnResponse(){this._doubleCheck.overlay.classList.toggle("hidden",!0),this._cancel=!1}load(t){this.text="",this._loader.classList.toggle("hidden",!t),this._doubleCheck.overlay.classList.toggle("hidden",!0),this._cancel=!1}set text(t){this._text.textContent=t}get cancel(){return this._cancel}static timeout(t){return new Promise((e=>setTimeout(e,t)))}}class ct{constructor(t,e=0){this._resetValue=e,this._value=e;const i=document.getElementById(t);this._button=i.querySelector(".dropbtn"),this._button.addEventListener("focus",(()=>{this._overlay.classList.toggle("hidden",!1)})),this._button.addEventListener("blur",(()=>{this._overlay.classList.toggle("hidden",!0)})),this._overlay=i.querySelector(".content"),this._resetStr=this._button.textContent?this._button.textContent:"";const n=i.querySelectorAll(".element");this._element=[];for(let t=0;t<n.length;t++){let e=n[t];this._element.push(e),e.addEventListener("mousedown",(()=>{this.value=Number(e.getAttribute("value")),this._overlay.classList.toggle("hidden",!0),this._button.textContent=e.textContent}))}this.reset()}reset(){this.value=this._resetValue,this._overlay.classList.toggle("hidden",!0),this._button.textContent=this._resetStr}set value(t){t=t||this._resetValue,this._value=t}get value(){return this._value}}var lt=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};const _t=Math.PI;function ut(t){return Math.cos(t)}function ft(t){return Math.sin(t)}function pt(t,e){return(t%e+e)%e}class vt{constructor(){this._frames=[],this._circles=new Array(80);for(let t=0;t<80;t++)this._circles[t]=new at(Math.pow(2,(t-10)/5),[.5,.5,.5]);this._spheres={red:new F([1,0,0],.1),black:new F([.2,.2,.2],.08)},this._player=new gt,this._player.initCallback()}set frames(t){this._frames=t}get frames(){return this._frames}setFrameData(t,e){this.frames=t,this.player.Disable(!1),this.player.max=e,this.player.reset()}draw(t,e){var i,n=this._frames[this._player.frame];for(let s=0;s<n.circles.length;s++)i=n.circles[s],this._circles[i.radID].setCenterNormalRad(i.center,i.normal,i.radius),this._circles[i.radID].draw(t,e);for(let i=0;i<n.blackPoints.length;i++)this._spheres.black.position=n.blackPoints[i].position,this._spheres.black.draw(t,e);this._spheres.red.position=n.redPoints.position,this._spheres.red.draw(t,e),this._player.play&&this._player.addFrame()}get player(){return this._player}}class gt{constructor(){this.videoControls=document.getElementById("video-controls"),this.playpause=document.getElementById("playpause"),this.progress=document.getElementById("progress"),this.progressBar=document.getElementById("progress-bar"),this.left=0,this.pressed=!1,this.speedDrop=new ct("speed dropdown",1),this._animation={play:!1,frame:0,max:0,speed:1},this.videoControls.classList.toggle("hidden",!0),this.resize()}initCallback(){this.playpause.addEventListener("click",(()=>{this.playBtnResponse()})),this.progress.addEventListener("mousedown",(t=>{0==t.button&&(this.pressed=!0,this.progressResponse(t))})),document.addEventListener("mousemove",(t=>{this.progressResponse(t)})),document.addEventListener("mouseup",(()=>{this.pressed=!1}))}progressResponse(t){if(this.pressed){var e=(t.clientX-this.left)/this.progress.offsetWidth;this.frame=Math.max(Math.min(Math.round(e*(this._animation.max-1)),this._animation.max-1),0)}}playBtnResponse(){this._animation.play=!this._animation.play}get frame(){return Math.floor(this._animation.frame)}addFrame(t=this.speed){2e3==this._animation.max||(t/=2),this.frame=this._animation.frame+t}set frame(t){(t<0||t>=this._animation.max)&&(t=0),this.progressBar.style.width=String(Math.floor(t/(this._animation.max-1)*1e3)/10)+"%",this._animation.frame=t}get speed(){return this._animation.speed=this.speedDrop.value,this._animation.speed}get play(){return this._animation.play}set max(t){this._animation.max=t}get max(){return this._animation.max}set play(t){this._animation.play=t,this._animation.play?this.playpause.setAttribute("data-state","play"):this.playpause.setAttribute("data-state","pause")}Disable(t){this.videoControls.classList.toggle("hidden",t)}resize(){this.left=this.progress.getBoundingClientRect().left}reset(){this.frame=0,this.play=!0,this._animation.speed=1,this.speedDrop.reset(),this.resize()}}class mt{constructor(){this._bufferSize=0,this._calc={error_field:1e-7,ACPolyAve:0,WrongPoly:[]},this._cosCoef=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],this._sinCoef=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],this._dcosCoef=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],this._dsinCoef=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],this._d2cosCoef=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],this._d2sinCoef=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],this._calculated=!1}Initialize(){return lt(this,void 0,void 0,(function*(){if(!navigator.gpu)throw new Error("WebGPU not supported.");if(this._adapter=yield navigator.gpu.requestAdapter({powerPreference:"high-performance"}),!this._adapter)throw new Error("Couldn't request WebGPU adapter.");if(this._device=yield this._adapter.requestDevice(),!this._device)throw new Error("Couldn't request WebGPU device.");{const t=document.getElementById("NewKnot");t.classList.toggle("disabled",!1);const e=t.querySelector("#New-Knot-txt");e&&(e.textContent="Draw new knot")}}))}initKnot(t){this._cosCoef=t[0],this._sinCoef=t[1],this._dcosCoef=t[2],this._dsinCoef=t[3],this._d2cosCoef=t[4],this._d2sinCoef=t[5]}KI(){var t=[];for(let e=0;e<6;e++)t.push(this._cosCoef[e][0],this._cosCoef[e][1],this._cosCoef[e][2],0);for(let e=0;e<6;e++)t.push(this._sinCoef[e][0],this._sinCoef[e][1],this._sinCoef[e][2],0);return new Float32Array(t)}get calculated(){return this._calculated}get wrongPoly(){return this._calc.WrongPoly}set calculated(t){this._calculated=t}findCircles(t,e,i,n,s){return lt(this,void 0,void 0,(function*(){s.text=(0).toFixed(1)+" %",yield dt.timeout(100),this._bufferSize=29925*n/2/40;const r=this.KI();var o=new Array(n);this._bindGroupLayout=this._device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}}]});const a=this._device.createShaderModule({code:"\r\n\r\n\r\nstruct fourier_series {\r\n    cos : array<vec3f, 6>,\r\n    sin : array<vec3f, 6>,\r\n};\r\n\r\n\r\n@group(0) @binding(0)var<uniform> knot_info: fourier_series;\r\n@group(0) @binding(1)var<storage, read> tlist: array<f32>;\r\n@group(0) @binding(2)var<storage, read_write> output: array<f32>;\r\n\r\n\r\nconst PI : f32 = 3.1415926535897932384626433832795;\r\nconst error_field : f32 = 0.0025;\r\nconst grad_stop_double : f32 = 0.00001;\r\nconst ptol_stop_double : f32 = 0.001;\r\n\r\nconst MAX_ITER : i32 = 150;\r\noverride BUFFER_SIZE : u32 = 5985 * 100;\r\n\r\nvar<workgroup> t_i : array<array<f32, 5>, 16>;\r\n\r\nvar<workgroup> abort : array<bool, 16>;\r\n\r\nvar<workgroup> vv : array<array<vec3f, 16>, 16>;\r\nvar<workgroup> nv : array<array<f32, 16>, 16>;\r\nvar<workgroup> dv : array<array<vec3f, 4>, 16>;\r\nvar<workgroup> d2v : array<array<vec3f, 4>, 16>;\r\n\r\nvar<workgroup> ptol : array<f32, 16>;\r\nvar<workgroup> grad : array<array<f32, 4>, 16>;\r\nvar<workgroup> hess : array<array<f32, 16>, 16>;\r\n\r\n\r\nvar<workgroup> diff : array<array<f32, 4>, 16>;\r\nvar<workgroup> backtrack : array<array<u32, 16>, 16>;\r\n\r\n\r\nfn set_variables(x_index : u32, z_index : u32){\r\n\r\n    for(var i : u32 = 0; i<4; i++){\r\n        vv[z_index][x_index + 4*i] = (\r\n            knotc(t_i[z_index][x_index + 1]) \r\n            - knotc(t_i[z_index][i])\r\n        );\r\n    }\r\n\r\n    vv[z_index][9] = -vv[z_index][11];\r\n    vv[z_index][14] = -vv[z_index][15];\r\n\r\n    for(var i : u32 = 0; i<4; i++){\r\n        nv[z_index][x_index + 4*i] = length(vv[z_index][x_index + 4*i]);\r\n    }\r\n\r\n\r\n    if(\r\n        (nv[z_index][0] < error_field) ||\r\n        (nv[z_index][1] < error_field) ||\r\n        (nv[z_index][2] < error_field) ||\r\n        (nv[z_index][3] < error_field) ||\r\n        (nv[z_index][5] < error_field) ||\r\n        (nv[z_index][6] < error_field) ||\r\n        (nv[z_index][10] < error_field) ||\r\n        (nv[z_index][11] < error_field) ||\r\n        (nv[z_index][15] < error_field)){\r\n        abort[z_index] = true;\r\n    }\r\n\r\n\r\n    ptol[z_index] = nv[z_index][2]*nv[z_index][5]+nv[z_index][6]*nv[z_index][1]-nv[z_index][0]*nv[z_index][10] \r\n                    +nv[z_index][2]*nv[z_index][11]+nv[z_index][1]*nv[z_index][15]-nv[z_index][3]*nv[z_index][10];\r\n\r\n\r\n    dv[z_index][x_index] = knotd(t_i[z_index][x_index + 1]);\r\n    d2v[z_index][x_index] = knotd2(t_i[z_index][x_index + 1]);\r\n\r\n}\r\n    \r\nfn grad_compute(x : u32, z_index : u32){\r\n\r\n    var sgn : array<f32, 3>;\r\n\r\n    var index1 : array<u32, 3>;\r\n    var index2 : array<u32, 3>;\r\n\r\n    let dvv : vec3f = dv[z_index][x];\r\n\r\n    index2[0] = 1;\r\n\r\n    switch x {\r\n        case 0: {\r\n            index1[0] = 10;   index1[1] = 2;   index1[2] = 1;\r\n            index2[0] = 0;   index2[1] = 8;   index2[2] = 12;\r\n            sgn[0] = f32(-1);   sgn[1] = f32(1);   sgn[2] = f32(1);\r\n\r\n        }\r\n        case 1: {\r\n            index1[0] = 6;   index1[1] = 0;   index1[2] = 2;\r\n            index2[0] = 1;   index2[1] = 13;   index2[2] = 5;\r\n            sgn[0] = f32(1);   sgn[1] = f32(-1);   sgn[2] = f32(1);\r\n\r\n        }\r\n        case 2: {\r\n            index1[0] = 5;   index1[1] = 1;   index1[2] = 0;\r\n            index2[0] = 2;   index2[1] = 6;   index2[2] = 10;\r\n            sgn[0] = f32(1);   sgn[1] = f32(1);   sgn[2] = f32(-1);\r\n\r\n        }\r\n        default {\r\n            sgn[0] = f32(0);   sgn[1] = f32(0);   sgn[2] = f32(0);\r\n        }\r\n    }\r\n\r\n    \r\n\r\n    let dptol1423 : f32= (\r\n        sgn[0]*(nv[z_index][index1[0]]/nv[z_index][index2[0]])*dot(vv[z_index][index2[0]],dvv) \r\n        + sgn[1]*(nv[z_index][index1[1]]/nv[z_index][index2[1]])*dot(vv[z_index][index2[1]],dvv)\r\n        + sgn[2]*(nv[z_index][index1[2]]/nv[z_index][index2[2]])*dot(vv[z_index][index2[2]],dvv)\r\n    );\r\n\r\n    switch x {\r\n        case 1: {\r\n            index1[0] = 3;   index1[1] = 2;   index1[2] = 15;\r\n            index2[0] = 13;   index2[1] = 9;   index2[2] = 1;\r\n            sgn[0] = f32(-1);   sgn[1] = f32(1);   sgn[2] = f32(1);\r\n\r\n        }\r\n        case 2: {\r\n            index1[0] = 1;   index1[1] = 3;   index1[2] = 11;\r\n            index2[0] = 14;   index2[1] = 10;   index2[2] = 2;\r\n            sgn[0] = f32(1);   sgn[1] = f32(-1);   sgn[2] = f32(1);\r\n\r\n        }\r\n        case 3: {\r\n            index1[0] = 2;   index1[1] = 1;   index1[2] = 10;\r\n            index2[0] = 11;   index2[1] = 15;   index2[2] = 3;\r\n            sgn[0] = f32(1);   sgn[1] = f32(1);   sgn[2] = f32(-1);\r\n\r\n        }\r\n        default {\r\n            sgn[0] = f32(0);   sgn[1] = f32(0);   sgn[2] = f32(0);\r\n        }\r\n    }\r\n\r\n\r\n    let dptol1453 : f32 = (\r\n        sgn[0]*(nv[z_index][index1[0]]/nv[z_index][index2[0]])*dot(vv[z_index][index2[0]],dvv) \r\n        + sgn[1]*(nv[z_index][index1[1]]/nv[z_index][index2[1]])*dot(vv[z_index][index2[1]],dvv)\r\n        + sgn[2]*(nv[z_index][index1[2]]/nv[z_index][index2[2]])*dot(vv[z_index][index2[2]],dvv)\r\n    );\r\n\r\n\r\n    grad[z_index][x] = dptol1423 + dptol1453;\r\n\r\n}\r\n\r\nfn hess_compute(x : u32, z_index : u32){\r\n\r\n    var sgn : array<f32, 3>;\r\n    \r\n    var index1 : array<u32, 2>;\r\n    var index2 : array<u32, 2>;\r\n    var index3 : array<u32, 2>;\r\n\r\n    let dvv : vec3f = dv[z_index][x];\r\n    let dvdv : f32 = dot(dvv,dvv);\r\n    let d2vv : vec3f = d2v[z_index][x];\r\n    \r\n    index1[1] = 1;\r\n\r\n\r\n    switch x {\r\n        case 0: {\r\n            index1[0] = 10;     index1[1] = 0;\r\n            index2[0] = 2;      index2[1] = 8;      \r\n            index3[0] = 1;      index3[1] = 12;\r\n            sgn[0] = f32(-1);   sgn[1] = f32(1);   sgn[2] = f32(1);\r\n\r\n        }\r\n        case 1: {\r\n            index1[0] = 6;     index1[1] = 1;\r\n            index2[0] = 0;      index2[1] = 13;      \r\n            index3[0] = 2;      index3[1] = 5;\r\n            sgn[0] = f32(1);   sgn[1] = f32(-1);   sgn[2] = f32(1);\r\n\r\n        }\r\n        case 2: {\r\n            index1[0] = 5;     index1[1] = 2;\r\n            index2[0] = 1;      index2[1] = 6;      \r\n            index3[0] = 0;      index3[1] = 10;\r\n            sgn[0] = f32(1);   sgn[1] = f32(1);   sgn[2] = f32(-1);\r\n\r\n        }\r\n        default {\r\n            sgn[0] = f32(0);   sgn[1] = f32(0);   sgn[2] = f32(0);\r\n        }\r\n    }\r\n    \r\n\r\n    let d2ptol1423_diag : f32 = (\r\n        sgn[0]*(nv[z_index][index1[0]]/nv[z_index][index1[1]])*(dot(vv[z_index][index1[1]],d2vv) + dvdv - pow(dot(vv[z_index][index1[1]],dvv), f32(2))/(pow(nv[z_index][index1[1]], f32(2))))\r\n        + sgn[1]*(nv[z_index][index2[0]]/nv[z_index][index2[1]])*(dot(vv[z_index][index2[1]],d2vv) + dvdv - pow(dot(vv[z_index][index2[1]],dvv), f32(2))/(pow(nv[z_index][index2[1]], f32(2))))\r\n        + sgn[2]*(nv[z_index][index3[0]]/nv[z_index][index3[1]])*(dot(vv[z_index][index3[1]],d2vv) + dvdv - pow(dot(vv[z_index][index3[1]],dvv), f32(2))/(pow(nv[z_index][index3[1]], f32(2))))\r\n    );\r\n\r\n    switch x {\r\n        case 1: {\r\n            index1[0] = 3;     index1[1] = 13;\r\n            index2[0] = 2;      index2[1] = 9;      \r\n            index3[0] = 15;      index3[1] = 1;\r\n            sgn[0] = f32(-1);   sgn[1] = f32(1);   sgn[2] = f32(1);\r\n\r\n        }\r\n        case 2: {\r\n            index1[0] = 1;     index1[1] = 14;\r\n            index2[0] = 3;      index2[1] = 10;      \r\n            index3[0] = 11;      index3[1] = 2;\r\n            sgn[0] = f32(1);   sgn[1] = f32(-1);   sgn[2] = f32(1);\r\n\r\n        }\r\n        case 3: {\r\n            index1[0] = 2;     index1[1] = 11;\r\n            index2[0] = 1;      index2[1] = 15;      \r\n            index3[0] = 10;      index3[1] = 3;\r\n            sgn[0] = f32(1);   sgn[1] = f32(1);   sgn[2] = f32(-1);\r\n\r\n        }\r\n        default {\r\n            sgn[0] = f32(0);   sgn[1] = f32(0);   sgn[2] = f32(0);\r\n        }\r\n    }\r\n    \r\n\r\n    let d2ptol1453_diag : f32 = (\r\n        sgn[0]*(nv[z_index][index1[0]]/nv[z_index][index1[1]])*(dot(vv[z_index][index1[1]],d2vv) + dvdv - pow(dot(vv[z_index][index1[1]],dvv), f32(2))/(pow(nv[z_index][index1[1]], f32(2))))\r\n        + sgn[1]*(nv[z_index][index2[0]]/nv[z_index][index2[1]])*(dot(vv[z_index][index2[1]],d2vv) + dvdv - pow(dot(vv[z_index][index2[1]],dvv), f32(2))/(pow(nv[z_index][index2[1]], f32(2))))\r\n        + sgn[2]*(nv[z_index][index3[0]]/nv[z_index][index3[1]])*(dot(vv[z_index][index3[1]],d2vv) + dvdv - pow(dot(vv[z_index][index3[1]],dvv), f32(2))/(pow(nv[z_index][index3[1]], f32(2))))\r\n    );\r\n\r\n    hess[z_index][x + 4*x] = d2ptol1423_diag + d2ptol1453_diag;\r\n\r\n    \r\n    var xindex : u32 = 1;\r\n    var yindex : u32 = 1;\r\n\r\n\r\n\r\n    switch x {\r\n        case 1: {\r\n            // block index 1\r\n            index1[0] = 2;    index1[1] = 5;\r\n            index2[0] = 10;    index2[1] = 0;    \r\n            index3[0] = 1;    index3[1] = 6;  \r\n            xindex = 1;\r\n            yindex = 0;\r\n            sgn[0] = f32(-1);   sgn[1] = f32(1);   sgn[2] = f32(-1);        \r\n\r\n        }\r\n        case 2: {\r\n            // block index 2\r\n            index1[0] = 1;    index1[1] = 6;\r\n            index2[0] = 10;    index2[1] = 0;    \r\n            index3[0] = 2;    index3[1] = 5;    \r\n            xindex = 2;\r\n            yindex = 0;\r\n            sgn[0] = f32(-1);   sgn[1] = f32(-1);   sgn[2] = f32(-1);        \r\n\r\n        }\r\n        case 3: {\r\n            // block index 6\r\n            index1[0] = 0;    index1[1] = 10;\r\n            index2[0] = 6;    index2[1] = 1;    \r\n            index3[0] = 2;    index3[1] = 5;    \r\n            xindex = 2;\r\n            yindex = 1;\r\n            sgn[0] = f32(1);   sgn[1] = f32(1);   sgn[2] = f32(1);        \r\n\r\n        }\r\n        default {\r\n            sgn[0] = f32(0);   sgn[1] = f32(0);   sgn[2] = f32(0);\r\n        }\r\n    }\r\n    \r\n\r\n    let d2ptol1423_non_diag : f32 = (\r\n        sgn[0]*(nv[z_index][index1[0]]/nv[z_index][index1[1]])*(dot(dv[z_index][xindex],dv[z_index][yindex]) - dot(vv[z_index][index1[1]],dv[z_index][xindex])*dot(vv[z_index][index1[1]],dv[z_index][yindex])/(nv[z_index][index1[1]]*nv[z_index][index1[1]]))\r\n        + sgn[1]/(nv[z_index][index2[0]]*nv[z_index][index2[1]])*dot(vv[z_index][index2[0]],dv[z_index][xindex])*dot(vv[z_index][index2[1]],dv[z_index][yindex])\r\n        + sgn[2]/(nv[z_index][index3[0]]*nv[z_index][index3[1]])*dot(vv[z_index][index3[0]],dv[z_index][xindex])*dot(vv[z_index][index3[1]],dv[z_index][yindex])\r\n    );\r\n\r\n\r\n\r\n    switch x {\r\n        case 3: {\r\n            // block index 6\r\n            index1[0] = 3;    index1[1] = 10;\r\n            index2[0] = 2;    index2[1] = 11;    \r\n            index3[0] = 15;    index3[1] = 1;   \r\n            xindex = 2;\r\n            yindex = 1; \r\n            sgn[0] = f32(1);   sgn[1] = f32(-1);   sgn[2] = f32(-1);        \r\n\r\n        }\r\n        case 2: {\r\n            // block index 7\r\n            index1[0] = 2;    index1[1] = 11;\r\n            index2[0] = 3;    index2[1] = 10;    \r\n            index3[0] = 15;    index3[1] = 1;    \r\n            xindex = 3;\r\n            yindex = 1;\r\n            sgn[0] = f32(-1);   sgn[1] = f32(1);   sgn[2] = f32(1);        \r\n\r\n        }\r\n        case 1: {\r\n            // block index 11\r\n            index1[0] = 1;    index1[1] = 15;\r\n            index2[0] = 3;    index2[1] = 10;    \r\n            index3[0] = 11;    index3[1] = 2;   \r\n            xindex = 3;\r\n            yindex = 2; \r\n            sgn[0] = f32(-1);   sgn[1] = f32(-1);   sgn[2] = f32(1);        \r\n\r\n        }\r\n        default {\r\n            sgn[0] = f32(0);   sgn[1] = f32(0);   sgn[2] = f32(0);\r\n        }\r\n    }\r\n    \r\n\r\n    let d2ptol1453_non_diag : f32 = (\r\n        sgn[0]*(nv[z_index][index1[0]]/nv[z_index][index1[1]])*(dot(dv[z_index][xindex],dv[z_index][yindex]) - dot(vv[z_index][index1[1]],dv[z_index][xindex])*dot(vv[z_index][index1[1]],dv[z_index][yindex])/(nv[z_index][index1[1]]*nv[z_index][index1[1]]))\r\n        + sgn[1]/(nv[z_index][index2[0]]*nv[z_index][index2[1]])*dot(vv[z_index][index2[0]],dv[z_index][xindex])*dot(vv[z_index][index2[1]],dv[z_index][yindex])\r\n        + sgn[2]/(nv[z_index][index3[0]]*nv[z_index][index3[1]])*dot(vv[z_index][index3[0]],dv[z_index][xindex])*dot(vv[z_index][index3[1]],dv[z_index][yindex])\r\n    );\r\n\r\n\r\n    switch x {\r\n        case 3: {\r\n            hess[z_index][6] = d2ptol1423_non_diag + d2ptol1453_non_diag;\r\n            hess[z_index][9] = hess[z_index][6];\r\n        }\r\n        case 2: {\r\n            hess[z_index][2] = d2ptol1423_non_diag;\r\n            hess[z_index][7] = d2ptol1453_non_diag;\r\n            hess[z_index][8] = hess[z_index][2];\r\n            hess[z_index][13] = hess[z_index][7];\r\n\r\n        }\r\n        case 1: {\r\n            hess[z_index][1] = d2ptol1423_non_diag;\r\n            hess[z_index][11] = d2ptol1453_non_diag;\r\n            hess[z_index][4] = hess[z_index][1];\r\n            hess[z_index][14] = hess[z_index][11];\r\n\r\n        }\r\n        default {\r\n\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\n\r\n\r\n\r\n@compute @workgroup_size(4,16)\r\nfn main(\r\n    @builtin(workgroup_id) workgroup_id : vec3<u32>,\r\n    @builtin(local_invocation_id) local_invocation_id : vec3<u32>,\r\n    @builtin(global_invocation_id) global_invocation_id : vec3<u32>,\r\n    @builtin(local_invocation_index) local_invocation_index: u32,\r\n    @builtin(num_workgroups) num_workgroups: vec3<u32>\r\n) {\r\n\r\n    \r\n\r\n    let workgroup_index = (\r\n        workgroup_id.x +\r\n        workgroup_id.y * num_workgroups.x +\r\n        workgroup_id.z * num_workgroups.x * num_workgroups.y\r\n    );\r\n    \r\n    let newton_index = (\r\n        workgroup_index * 16 +\r\n        local_invocation_id.y\r\n    );\r\n    \r\n\r\n\r\n    let global_invocation_index = (\r\n        workgroup_index * 64 +\r\n        local_invocation_index\r\n    );\r\n\r\n\r\n    let tlist_index = (\r\n        newton_index*5\r\n    );\r\n\r\n\r\n\r\n        // Avoid accessing the buffer out of bounds\r\n    if (tlist_index >= BUFFER_SIZE) {\r\n        return;\r\n    }\r\n\r\n    var grad_length: f32;\r\n\r\n    var i : u32;\r\n    var grad_dot_diff: f32;\r\n    var func: f32;\r\n    var min_backtrack : u32;\r\n\r\n    var x_n : array<f32, 5>;\r\n\r\n    let c : f32 = 0.0001;\r\n    const rho : f32 = 0.65;\r\n\tvar alpha : f32 = pow(rho, f32(4*local_invocation_id.x));\r\n\t\r\n\r\n    t_i[local_invocation_id.y][0] = tlist[tlist_index];\r\n    t_i[local_invocation_id.y][1] = tlist[tlist_index + 1];\r\n    t_i[local_invocation_id.y][2] = tlist[tlist_index + 2];\r\n    t_i[local_invocation_id.y][3] = tlist[tlist_index + 3];\r\n    t_i[local_invocation_id.y][4] = tlist[tlist_index + 4];\r\n\r\n\r\n    var iter : i32;\r\n\r\n    output[tlist_index] = 1.0;\r\n\r\n\r\n    for(iter = 0; iter< MAX_ITER; iter++){\r\n\r\n        set_variables(local_invocation_id.x, local_invocation_id.y);\r\n\r\n        if(abort[local_invocation_id.y] == true){\r\n            return;\r\n        }\r\n\r\n\r\n\r\n        grad_compute(local_invocation_id.x, local_invocation_id.y);\r\n        hess_compute(local_invocation_id.x, local_invocation_id.y);\r\n\r\n        \r\n        grad_length = sqrt(\r\n            pow(grad[local_invocation_id.y][0], 2.0) \r\n            + pow(grad[local_invocation_id.y][1], 2.0)\r\n            + pow(grad[local_invocation_id.y][2], 2.0)\r\n            + pow(grad[local_invocation_id.y][3], 2.0)\r\n        );\r\n\r\n\r\n        if((grad_length < grad_stop_double) || (ptol[local_invocation_id.y] <= ptol_stop_double)){\r\n            if(ptol[local_invocation_id.y] > ptol_stop_double){\r\n                return;\r\n            }\r\n\r\n\r\n            if(check_order(t_i[local_invocation_id.y])){\r\n\r\n                if(check_pentagon(t_i[local_invocation_id.y])){\r\n\r\n                    if(local_invocation_id.x == 0){\r\n                        output[tlist_index] = t_i[local_invocation_id.y][0];\r\n                        output[tlist_index + 1] = t_i[local_invocation_id.y][1];\r\n                        output[tlist_index + 2] = t_i[local_invocation_id.y][2];\r\n                        output[tlist_index + 3] = t_i[local_invocation_id.y][3];\r\n                        output[tlist_index + 4] = t_i[local_invocation_id.y][4];\r\n                    }\r\n                }\r\n                return;\r\n            }\r\n\r\n            var tmp : f32 = t_i[local_invocation_id.y][1];\r\n\r\n            t_i[local_invocation_id.y][1] = t_i[local_invocation_id.y][4];\r\n            t_i[local_invocation_id.y][4] = tmp;\r\n            tmp = t_i[local_invocation_id.y][2];\r\n            t_i[local_invocation_id.y][2] = t_i[local_invocation_id.y][3];\r\n            t_i[local_invocation_id.y][3] = tmp;\r\n\r\n            if(check_order(t_i[local_invocation_id.y])){\r\n\r\n                if(check_pentagon(t_i[local_invocation_id.y])){\r\n\r\n                    if(local_invocation_id.x == 0){\r\n                        output[tlist_index] = t_i[local_invocation_id.y][0];\r\n                        output[tlist_index + 1] = t_i[local_invocation_id.y][1];\r\n                        output[tlist_index + 2] = t_i[local_invocation_id.y][2];\r\n                        output[tlist_index + 3] = t_i[local_invocation_id.y][3];\r\n                        output[tlist_index + 4] = t_i[local_invocation_id.y][4];\r\n                    }\r\n            \r\n                }\r\n            }\r\n\r\n            return;\r\n\r\n        }\r\n\r\n\r\n\r\n        modified_Cholesky(local_invocation_id.y);\r\n\r\n\r\n        grad_dot_diff = (\r\n            grad[local_invocation_id.y][0] * diff[local_invocation_id.y][0]\r\n            + grad[local_invocation_id.y][1] * diff[local_invocation_id.y][1]\r\n            + grad[local_invocation_id.y][2] * diff[local_invocation_id.y][2]\r\n            + grad[local_invocation_id.y][3] * diff[local_invocation_id.y][3]\r\n        );\r\n\r\n\r\n        for (i = 0; i < 4; i++)\r\n        {\r\n\r\n            x_n[0] = t_i[local_invocation_id.y][0];\r\n            x_n[1] = t_i[local_invocation_id.y][1] - alpha*diff[local_invocation_id.y][0];\r\n            x_n[2] = t_i[local_invocation_id.y][2] - alpha*diff[local_invocation_id.y][1];\r\n            x_n[3] = t_i[local_invocation_id.y][3] - alpha*diff[local_invocation_id.y][2];\r\n            x_n[4] = t_i[local_invocation_id.y][4] - alpha*diff[local_invocation_id.y][3];\r\n\r\n            func = (\r\n                length(knotc(x_n[0]) - knotc(x_n[3])) * length(knotc(x_n[1]) - knotc(x_n[2]))\r\n                + length(knotc(x_n[1]) - knotc(x_n[3])) * length(knotc(x_n[0]) - knotc(x_n[2]))\r\n                - length(knotc(x_n[0]) - knotc(x_n[1])) * length(knotc(x_n[2]) - knotc(x_n[3]))\r\n                \r\n                + length(knotc(x_n[0]) - knotc(x_n[3])) * length(knotc(x_n[2]) - knotc(x_n[4]))\r\n                + length(knotc(x_n[0]) - knotc(x_n[2])) * length(knotc(x_n[3]) - knotc(x_n[4]))\r\n                - length(knotc(x_n[0]) - knotc(x_n[4])) * length(knotc(x_n[2]) - knotc(x_n[3]))\r\n            );\r\n\r\n            if(func <= (ptol[local_invocation_id.y] - c*alpha*grad_dot_diff)){\r\n                backtrack[local_invocation_id.y][4*local_invocation_id.x + i] = 4*local_invocation_id.x + i;\r\n            } else {\r\n                backtrack[local_invocation_id.y][4*local_invocation_id.x + i] = 15;\r\n            }\r\n\r\n            alpha = alpha * rho;\r\n\r\n        }\r\n\r\n\r\n\r\n        min_backtrack = 15;\r\n\r\n        if(local_invocation_id.x == 0){\r\n\r\n            for (i = 0; i < 16; i++)\r\n            {\r\n                if(backtrack[local_invocation_id.y][i] < min_backtrack){\r\n                    min_backtrack = backtrack[local_invocation_id.y][i];\r\n                }\r\n            }\r\n\r\n            alpha = pow(rho, f32(min_backtrack));\r\n\r\n            t_i[local_invocation_id.y][1] = t_i[local_invocation_id.y][1] - alpha*diff[local_invocation_id.y][0];\r\n            t_i[local_invocation_id.y][2] = t_i[local_invocation_id.y][2] - alpha*diff[local_invocation_id.y][1];\r\n            t_i[local_invocation_id.y][3] = t_i[local_invocation_id.y][3] - alpha*diff[local_invocation_id.y][2];\r\n            t_i[local_invocation_id.y][4] = t_i[local_invocation_id.y][4] - alpha*diff[local_invocation_id.y][3];\r\n        }\r\n        \r\n\r\n        t_i[local_invocation_id.y][local_invocation_id.x + 1] = fract(t_i[local_invocation_id.y][local_invocation_id.x + 1]);\r\n\r\n        proxim(local_invocation_id.x, local_invocation_id.y, error_field);\r\n\r\n        if(abort[local_invocation_id.y] == true){\r\n            return;\r\n        }\r\n\r\n        iter ++;\r\n\r\n    }\r\n\r\n\r\n}\r\n\r\nfn check_order(t_i : array<f32, 5>) -> bool{\r\n    if(\r\n        (t_i[0] < t_i[1])\r\n        && (t_i[1] < t_i[2])\r\n        && (t_i[2] < t_i[3])\r\n        && (t_i[3] < t_i[4])\r\n    ){\r\n        return true;\r\n    }else if(\r\n        (t_i[4] < t_i[0])\r\n        && (t_i[0] < t_i[1])\r\n        && (t_i[1] < t_i[2])\r\n        && (t_i[2] < t_i[3])\r\n    ){\r\n        return true;\r\n    }else if(\r\n        (t_i[3] < t_i[4])\r\n        && (t_i[4] < t_i[0])\r\n        && (t_i[0] < t_i[1])\r\n        && (t_i[1] < t_i[2])\r\n    ){\r\n        return true;\r\n    }else if(\r\n        (t_i[2] < t_i[3])\r\n        && (t_i[3] < t_i[4])\r\n        && (t_i[4] < t_i[0])\r\n        && (t_i[0] < t_i[1])\r\n    ){\r\n        return true;\r\n    }else if(\r\n        (t_i[1] < t_i[2])\r\n        && (t_i[2] < t_i[3])\r\n        && (t_i[3] < t_i[4])\r\n        && (t_i[4] < t_i[0])\r\n    ){\r\n        return true;\r\n    }\r\n\r\n    return false;\r\n}\r\n\r\nfn proxim(x : u32, y : u32, proxim_float : f32){\r\n    for(var i = i32(x) + 1; i < 5; i++){\r\n        let t_diff = t_i[y][i] - t_i[y][x];\r\n\r\n        if((abs(t_diff) < proxim_float)\r\n            || (abs(t_diff + 1.0) < proxim_float)\r\n            || (abs(1.0 - t_diff) < proxim_float))\r\n        {\r\n            abort[y] = true;\r\n            return;\r\n        }\r\n    }\r\n}\r\n\r\n\r\nfn modified_Cholesky(z: u32) {\r\n\r\n    var max_diag : f32 = 0.0;\r\n    var max_nondiag : f32 = 0.0;\r\n\r\n\r\n    for (var i = 0; i < 4; i++)\r\n    {\r\n        if(abs(hess[z][i*4+i]) > max_diag){\r\n            max_diag = abs(hess[z][i*4+i]);\r\n        }\r\n        for(var j =i+1; j < 4; j++){\r\n            if(abs(hess[z][i*4+j]) > max_nondiag){\r\n                max_nondiag = abs(hess[z][i*4+j]);\r\n            }\r\n        }\r\n    }\r\n\r\n    var beta2 : f32 = max(max(max_diag, max_nondiag/(sqrt(f32(15)))), 0.0001);\r\n\r\n    var temp : array<f32, 16>;\r\n    var D : array<f32, 4>;\r\n    var L : array<f32, 16>;\r\n\r\n    var theta : array<f32, 4>;\r\n\r\n    for(var j =0; j<4; j++){\r\n        temp[j*4 + j] = hess[z][j*4 + j];\r\n        for(var s = 0; s< j; s++){\r\n            temp[j*4 + j] -= D[s]*L[j*4 + s]*L[j*4 + s];\r\n        }\r\n        \r\n        for(var i=j+1; i<4; i++){\r\n            temp[i*4 + j] = hess[z][i*4 + j];\r\n            for(var s = 0; s< j; s++){\r\n                temp[i*4 + j] -= D[s]*L[i*4 + s]*L[j*4 + s];\r\n            }\r\n\r\n            if(theta[j]< abs(temp[i*4 + j])){\r\n                theta[j]= abs(temp[i*4 + j]);\r\n            }\r\n        }\r\n\r\n        D[j] = max(max(abs(temp[j*4 + j]), theta[j]*theta[j]/beta2), 0.001);\r\n        \r\n        for(var i=j+1; i<4; i++){\r\n            L[i*4 + j] = temp[i*4 + j]/D[j];\r\n        }\r\n        L[j*4 + j] = 1.0;\r\n    }\r\n\r\n    // forward substitution.\r\n    var y : array<f32, 4>;\r\n    var sum : f32;\r\n\r\n    for (var i = 0; i < 4; i++)\r\n    {\r\n        sum = grad[z][i];\r\n        for (var j = 0; j < i; j++){\r\n            sum -= L[i*4+j] * y[j];\r\n        }\r\n        y[i] = sum / L[i*4 +i];\r\n    }\r\n\r\n\r\n    // back substitution.\r\n    // var retval = new Array(4);\r\n\r\n    for (var k = 3; k >= 0; k--)\r\n    {\r\n        sum = y[k];\r\n        for (var j = k + 1; j < 4; j++){\r\n            sum -= L[j*4+k] * diff[z][j] * D[k];\r\n        }\r\n        diff[z][k] = sum/(D[k]);\r\n    }\r\n\r\n}\r\n\r\n\r\nfn check_pentagon(t_i : array<f32, 5>) -> bool {\r\n\r\n    let v1 = knotc(t_i[0]);\r\n    let v2 = knotc(t_i[3]);\r\n    let v3 = knotc(t_i[1]);\r\n    let v4 = knotc(t_i[4]);\r\n    let v5 = knotc(t_i[2]);\r\n\r\n    let v12 = (v2-v1);\r\n    let v23 = (v3-v2);\r\n    let v34 = (v4-v3);\r\n    let v45 = (v5-v4);\r\n    let v51 = (v1-v5);\r\n\r\n    var sum_angle : f32 = 0.0;\r\n\r\n    sum_angle += acos(-1*dot(v12,v23)/(length(v12)*length(v23)));\r\n    sum_angle += acos(-1*dot(v23,v34)/(length(v23)*length(v34)));\r\n    sum_angle += acos(-1*dot(v34,v45)/(length(v34)*length(v45)));\r\n    sum_angle += acos(-1*dot(v45,v51)/(length(v45)*length(v51)));\r\n    sum_angle += acos(-1*dot(v51,v12)/(length(v51)*length(v12)));\r\n\r\n    if(abs(sum_angle - 3*PI) < 0.02){\r\n        return true;\r\n    }\r\n    return false;\r\n\r\n\r\n}\r\n\r\n\r\n\r\nfn knotc(param : f32) -> vec3f {\r\n    let t : f32 = 2 * PI * param;\r\n    let ret : vec3f = (\r\n        knot_info.cos[0] * cos(t) + knot_info.cos[1] * cos(2*t) + knot_info.cos[2] * cos(3*t) + knot_info.cos[3] * cos(4*t) + knot_info.cos[4] * cos(5*t) + knot_info.cos[5] * cos(6*t)\r\n        + knot_info.sin[0] * sin(t) + knot_info.sin[1] * sin(2*t) + knot_info.sin[2] * sin(3*t) + knot_info.sin[3] * sin(4*t) + knot_info.sin[4] * sin(5*t)+ knot_info.sin[5] * sin(6*t)\r\n    );\r\n\treturn ret;\r\n}\r\nfn knotd(param : f32) -> vec3f {\r\n    let t : f32 = 2 * PI * param;\r\n    let ret : vec3f = (\r\n        knot_info.sin[0] * cos(t) + knot_info.sin[1] *2* cos(2*t) + knot_info.sin[2] *3* cos(3*t) + knot_info.sin[3] *4* cos(4*t) + knot_info.sin[4] *5* cos(5*t)+ knot_info.sin[5] *6* cos(6*t)\r\n        - knot_info.cos[0] * sin(t) - knot_info.cos[1] *2* sin(2*t) - knot_info.cos[2] *3* sin(3*t) - knot_info.cos[3] *4* sin(4*t) - knot_info.cos[4] *5* sin(5*t)- knot_info.cos[5] *6* sin(6*t)\r\n    );\r\n\treturn 2*PI*ret;\r\n}\r\nfn knotd2(param : f32) -> vec3f {\r\n    let t : f32 = 2 * PI * param;\r\n    let ret : vec3f = (\r\n        knot_info.cos[0] * cos(t) + knot_info.cos[1] *4* cos(2*t) + knot_info.cos[2] *9* cos(3*t) + knot_info.cos[3] *16* cos(4*t) + knot_info.cos[4] *25* cos(5*t)+ knot_info.cos[5] *36* cos(6*t)\r\n        + knot_info.sin[0] * sin(t) + knot_info.sin[1] *4* sin(2*t) + knot_info.sin[2] *9* sin(3*t) + knot_info.sin[3] *16* sin(4*t) + knot_info.sin[4] *25* sin(5*t)+ knot_info.sin[5] *36* sin(6*t)\r\n    );\r\n\treturn -4*PI*PI*ret;\r\n}\r\n\r\n"});this._computePipeline=this._device.createComputePipeline({layout:this._device.createPipelineLayout({bindGroupLayouts:[this._bindGroupLayout]}),compute:{module:a,entryPoint:"main",constants:{BUFFER_SIZE:this._bufferSize}}});for(let t=0;t<n;t++)o[t]=[];for(let t=0;t<40;t++){const[,e]=this.sett_i(n/2,n/2/40,n/2/40*t),i=this._device.createCommandEncoder(),a=i.beginComputePass();let c=this._device.createBuffer({size:48*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});this._device.queue.writeBuffer(c,0,r);let l=this._device.createBuffer({size:this._bufferSize*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),_=this._device.createBuffer({size:this._bufferSize*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC}),u=this._device.createBuffer({size:this._bufferSize*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST});this._device.queue.writeBuffer(l,0,e);const f=this._device.createBindGroup({layout:this._bindGroupLayout,entries:[{binding:0,resource:{buffer:c}},{binding:1,resource:{buffer:l}},{binding:2,resource:{buffer:_}}]});a.setPipeline(this._computePipeline),a.setBindGroup(0,f),a.dispatchWorkgroups(200,200),a.end(),i.copyBufferToBuffer(_,0,u,0,this._bufferSize*Float32Array.BYTES_PER_ELEMENT),this._device.queue.submit([i.finish()]),yield u.mapAsync(GPUMapMode.READ,0,this._bufferSize*Float32Array.BYTES_PER_ELEMENT);var h=new Float32Array(u.getMappedRange(0,this._bufferSize*Float32Array.BYTES_PER_ELEMENT).slice(0));for(let t=0;t<h.length/5;t++)if(1!=h[5*t]){var d=Math.round(h[5*t]*n);d>=n||d<0||o[d].push([h[5*t],h[5*t+1],h[5*t+2],h[5*t+3],h[5*t+4]])}if(s.text=(100*t/40).toFixed(1)+" %",yield dt.timeout(100),s.cancel)return}var c,l,_,u,f,p=new Array(2);p[0]=[],p[1]=[];for(let t=0;t<n;t+=2)if(o[t]=this.removeDupe(o[t],.01),o[t]=o[t].slice(0,2*i),o[t]=this.c5_ptolemy(o[t]),o[t]=this.removeDupe(o[t],.002),o[t]=o[t].slice(0,i),this._calc.ACPolyAve+=o[t].length%2,p[o[t].length%2].push(t),s.cancel)return;for(let t=1;t<n;t+=2){let e;(_=t+1)==n&&(_=0),f=[],u=o[l=t-1].length<o[_].length?_:l;for(let i=0;i<o[u].length;i++)e=o[u][i],f.push([t/n,e[1],e[2],e[3],e[4]]);if(f=this.c5_ptolemy(f),o[t]=this.removeDupe(f,.002),o[t]=o[t].slice(0,i),p[o[t].length%2].push(t),s.cancel)return}if(this._calc.ACPolyAve=Math.round(this._calc.ACPolyAve/n),p[(this._calc.ACPolyAve+1)%2]=p[(this._calc.ACPolyAve+1)%2].sort((function(t,e){return t-e})),this._calc.WrongPoly=p[(this._calc.ACPolyAve+1)%2],e){s.text="verifying number of circles",yield dt.timeout(100);const t=p[(this._calc.ACPolyAve+1)%2];this._calc.WrongPoly=[];for(let e=0;e<t.length;e++){f=[],l=pt((c=t[e])-1,n),_=pt(c+1,n),u=l;let i,r=0;do{o[l].length<o[_].length?(u=_,_=pt(_+1,n)):(u=l,_=pt(_-1,n)),r++}while(r<10&&o[u].length!=this._calc.ACPolyAve);for(let t=0;t<o[u].length;t++)i=o[u][t],f.push([c/n,i[1],i[2],i[3],i[4]]);if(f=this.c5_ptolemy(f),o[c]=this.removeDupe(f,.002),o[c].length%2!=this._calc.ACPolyAve){for(r=0;r<10&&o[l].length!=this._calc.ACPolyAve;)l=pt(l-1,n);u=l;for(let t=0;t<o[u].length;t++)i=o[u][t],f.push([c/n,i[1],i[2],i[3],i[4]]);f=this.c5_ptolemy(f),o[c]=this.removeDupe(f,.002)}if(o[c].length%2!=this._calc.ACPolyAve&&this._calc.WrongPoly.push(c),s.cancel)return}}s.text="creating buffers",yield dt.timeout(100),this._calculated=!1,this.exportFrame(t,o,n,s),s.cancel||(t.player.max=n,this._calculated=!0,t.player.play=!0)}))}removeDupe(t,e){let i=[];for(var n=0;n<t.length;n++){var s=!0;let o=i.length;for(var r=0;r<o;r++)Math.sqrt(Math.pow(t[n][1]-i[r][1],2)+Math.pow(t[n][2]-i[r][2],2)+Math.pow(t[n][3]-i[r][3],2)+Math.pow(t[n][4]-i[r][4],2))<e&&(s=!1);s&&i.push(t[n])}return i}sett_i(t,e,i){var n,s,r,o,a,h=0;const d=22,c=new Float32Array(5985*e*5);for(h=0,a=0;a<e;a++)for(n=1;n<d;n++)for(s=n+1;s<d;s++)for(r=s+1;r<d;r++)for(o=r+1;o<d;o++)c[h]=i/t+a/t,c[h+1]=n/d+c[h],c[h+2]=s/d+c[h],c[h+3]=r/d+c[h],c[h+4]=o/d+c[h],h+=5;return[h,c]}exportFrame(t,e,i,n){var s,r,o,a,h,d=Array(i);for(let t=0;t<i;t++){d[t]={redPoints:{position:this.knot(t/i)},blackPoints:[],circles:[]},a=[];var c=e[t];for(let e=0;e<c.length;e++){var l=[!0,!0,!0,!0];s=[c[e][5],c[e][6],c[e][7]],r=[c[e][8],c[e][9],c[e][10]],o=c[e][11],h=Math.max(0,Math.min(Math.floor(5*Math.log2(o))+10,79)),d[t].circles.push({center:s,normal:r,radius:o,radID:h});for(let t=0;t<a.length;t++)for(let i=0;i<4;i++)b(a[t].position,this.knot(c[e][i+1]))<.001&&(l[i]=!1);for(let t=0;t<4;t++)l[t]&&a.push({position:this.knot(c[e][t+1])})}if(d[t].blackPoints=a,n.cancel)return}t.frames=d}toCVR(t,e,i){const n=xt(t,e),s=xt(e,i),r=xt(i,t);var o,a,h=(a=s,[(o=n)[1]*a[2]-o[2]*a[1],o[2]*a[0]-o[0]*a[2],o[0]*a[1]-o[1]*a[0]]);const d=bt(n)*bt(s)*bt(r)*.5/bt(h),c=bt(s)*bt(s)*wt(n,r)*-.5/wt(h,h),l=bt(r)*bt(r)*wt(n,s)*-.5/wt(h,h),_=bt(n)*bt(n)*wt(r,s)*-.5/wt(h,h),u=yt(yt(kt(c,t),kt(l,e)),kt(_,i));return h=function(t){const e=bt(t);return[t[0]/e,t[1]/e,t[2]/e]}(h),[u,h,d]}decim(t){for(var e=1;e<5;e++)t[e]%=1,t[e]<0&&(t[e]+=1)}proxim(t,e){for(var i=0;i<5;i++)for(var n=i+1;n<5;n++)if(Math.abs(t[i]-t[n])<e||Math.abs(t[i]-t[n]+1)<e||Math.abs(t[n]-t[i]+1)<e)return!0;return!1}modified_Cholesky(t,e){if(16!=t.length||4!=e.length)throw new Error("dimension error in modified_Cholesky");var i,n,s,r,o=0,a=0;for(i=0;i<4;i++)for(Math.abs(t[4*i+i])>o&&(o=Math.abs(t[4*i+i])),n=0;n<4;n++)Math.abs(t[4*i+n])>a&&n!=i&&(a=Math.abs(t[4*i+n]));var h=Math.max(o,a/Math.sqrt(15),1e-4),d=new Array(16),c=new Array(4),l=new Array(16),_=[0,0,0,0];for(n=0;n<4;n++){for(d[4*n+n]=t[4*n+n],r=0;r<n;r++)d[4*n+n]-=c[r]*l[4*n+r]*l[4*n+r];for(i=n+1;i<4;i++){for(d[4*i+n]=t[4*i+n],r=0;r<n;r++)d[4*i+n]-=c[r]*l[4*i+r]*l[4*n+r];_[n]<Math.abs(d[4*i+n])&&(_[n]=Math.abs(d[4*i+n]))}for(c[n]=Math.max(Math.abs(d[4*n+n]),_[n]*_[n]/h,.001),i=n+1;i<4;i++)l[4*i+n]=d[4*i+n]/c[n];l[4*n+n]=1}var u,f=new Array(4);for(i=0;i<4;i++){for(u=e[i],n=0;n<i;n++)u-=l[4*i+n]*f[n];f[i]=u/l[4*i+i]}var p=[0,0,0,0];for(s=3;s>=0;s--){for(u=f[s],n=s+1;n<4;n++)u-=l[4*n+s]*p[n]*c[s];p[s]=u/c[s]}return p}gradient_ptolemy(t,e,i){const n=-t[2]/t[4]*e[1]+-t[1]/t[5]*e[2]-t[7]/t[0]*e[0],s=t[2]/t[4]*e[5]+t[5]/t[1]*e[4]- -t[0]/t[7]*e[6],r=t[4]/t[2]*e[8]+t[1]/t[5]*e[9]-t[0]/t[7]*e[10],o=t[8]/t[0]*e[0]+-t[1]/t[6]*e[3]- -t[3]/t[4]*e[1],a=-t[0]/t[8]*e[7]+t[6]/t[1]*e[4]-t[3]/t[4]*e[5],h=t[0]/t[8]*e[13]+t[1]/t[6]*e[12]-t[4]/t[3]*e[11];i[0]=n+o,i[1]=s+a,i[2]=r,i[3]=h}hessian_ptolemy(t,e,i,n,s){const r=-t[2]/t[4]*(n[1]-i[0]+Math.pow(e[1],2)/Math.pow(t[4],2))+-t[1]/t[5]*(n[2]-i[0]+Math.pow(e[2],2)/Math.pow(t[5],2))-t[7]/t[0]*(n[0]+i[0]-Math.pow(e[0],2)/Math.pow(t[0],2)),o=1/(t[7]*t[0])*e[6]*e[0]+-t[2]/t[4]*(i[1]-e[5]*e[1]/Math.pow(t[4],2))+1/(-t[1]*t[5])*e[4]*e[2],a=-1/(t[7]*t[0])*e[10]*e[0]+1/(-t[2]*t[4])*e[8]*e[1]+-t[1]/t[5]*(i[2]-e[9]*e[2]/Math.pow(t[5],2)),h=t[2]/t[4]*(n[5]+i[4]-Math.pow(e[5],2)/Math.pow(t[4],2))+t[5]/t[1]*(n[4]+i[4]-Math.pow(e[4],2)/Math.pow(t[1],2))- -t[0]/t[7]*(n[6]-i[4]+Math.pow(e[6],2)/Math.pow(t[7],2)),d=- -t[0]/t[7]*(i[5]-e[10]*e[6]/Math.pow(t[7],2))+1/(t[2]*t[4])*e[8]*e[5]+1/(t[5]*t[1])*e[9]*e[4],c=t[4]/t[2]*(n[8]+i[7]-Math.pow(e[8],2)/Math.pow(t[2],2))+t[1]/t[5]*(n[9]+i[7]-Math.pow(e[9],2)/Math.pow(t[5],2))-t[0]/t[7]*(n[10]+i[7]-Math.pow(e[10],2)/Math.pow(t[7],2)),l=t[8]/t[0]*(n[0]+i[0]-Math.pow(e[0],2)/Math.pow(t[0],2))+-t[1]/t[6]*(n[3]-i[0]+Math.pow(e[3],2)/Math.pow(t[6],2))- -t[3]/t[4]*(n[1]-i[0]+Math.pow(e[1],2)/Math.pow(t[4],2)),_=- -t[3]/t[4]*(i[1]-e[1]*e[5]/Math.pow(t[4],2))+1/(-t[8]*t[0])*e[7]*e[0]+1/(-t[1]*t[6])*e[4]*e[3],u=-1/(-t[3]*t[4])*e[11]*e[1]+1/(t[8]*t[0])*e[13]*e[0]+-t[1]/t[6]*(i[3]-e[3]*e[12]/Math.pow(t[6],2)),f=-t[0]/t[8]*(n[7]-i[4]+Math.pow(e[7],2)/Math.pow(t[8],2))+t[6]/t[1]*(n[4]+i[4]-Math.pow(e[4],2)/Math.pow(t[1],2))-t[3]/t[4]*(n[5]+i[4]-Math.pow(e[5],2)/Math.pow(t[4],2)),p=-1/(t[3]*t[4])*e[11]*e[5]+-t[0]/t[8]*(i[6]-e[7]*e[13]/Math.pow(t[8],2))+1/(t[6]*t[1])*e[12]*e[4],v=t[0]/t[8]*(n[13]+i[8]-Math.pow(e[13],2)/Math.pow(t[8],2))+t[1]/t[6]*(n[12]+i[8]-Math.pow(e[12],2)/Math.pow(t[6],2))-t[4]/t[3]*(n[11]+i[8]-Math.pow(e[11],2)/Math.pow(t[3],2));s[0]=r+l,s[1]=o+_,s[2]=a,s[3]=u,s[4]=o+_,s[5]=h+f,s[6]=d,s[7]=p,s[8]=a,s[9]=d,s[10]=c,s[11]=0,s[12]=u,s[13]=p,s[14]=0,s[15]=v}setvariables(t,e,i,n,s,r,o,a,h){e[0]=this.knot(t[0]),e[1]=this.knot(t[1]),e[2]=this.knot(t[2]),e[3]=this.knot(t[3]),e[4]=this.knot(t[4]),n[0]=xt(e[1],e[0]),n[1]=xt(e[2],e[0]),n[2]=xt(e[3],e[0]),n[3]=xt(e[4],e[0]),n[4]=xt(e[2],e[1]),n[5]=xt(e[3],e[1]),n[6]=xt(e[4],e[1]),n[7]=xt(e[3],e[2]),n[8]=xt(e[4],e[2]),i[0]=bt(n[0]),i[1]=bt(n[1]),i[2]=bt(n[2]),i[3]=bt(n[3]),i[4]=bt(n[4]),i[5]=bt(n[5]),i[6]=bt(n[6]),i[7]=bt(n[7]),i[8]=bt(n[8]);for(var d=0;d<9;d++)if(i[d]<this._calc.error_field)return!0;return s[0]=this.dknot(t[1]),s[1]=this.dknot(t[2]),s[2]=this.dknot(t[3]),s[3]=this.dknot(t[4]),r[0]=wt(n[0],s[0]),r[1]=wt(n[4],s[0]),r[2]=wt(n[5],s[0]),r[3]=wt(n[6],s[0]),r[4]=wt(n[1],s[1]),r[5]=wt(n[4],s[1]),r[6]=wt(n[7],s[1]),r[7]=wt(n[8],s[1]),r[8]=wt(n[2],s[2]),r[9]=wt(n[5],s[2]),r[10]=wt(n[7],s[2]),r[11]=wt(n[3],s[3]),r[12]=wt(n[6],s[3]),r[13]=wt(n[8],s[3]),a[0]=this.d2knot(t[1]),a[1]=this.d2knot(t[2]),a[2]=this.d2knot(t[3]),a[3]=this.d2knot(t[4]),h[0]=wt(n[0],a[0]),h[1]=wt(n[4],a[0]),h[2]=wt(n[5],a[0]),h[3]=wt(n[6],a[0]),h[4]=wt(n[1],a[1]),h[5]=wt(n[4],a[1]),h[6]=wt(n[7],a[1]),h[7]=wt(n[8],a[1]),h[8]=wt(n[2],a[2]),h[9]=wt(n[5],a[2]),h[10]=wt(n[7],a[2]),h[11]=wt(n[3],a[3]),h[12]=wt(n[6],a[3]),h[13]=wt(n[8],a[3]),o[0]=wt(s[0],s[0]),o[1]=wt(s[0],s[1]),o[2]=wt(s[0],s[2]),o[3]=wt(s[0],s[3]),o[4]=wt(s[1],s[1]),o[5]=wt(s[1],s[2]),o[6]=wt(s[1],s[3]),o[7]=wt(s[2],s[2]),o[8]=wt(s[3],s[3]),!1}knot(t){const e=2*t*_t;return l(a(),f(a(),f(a(),f(a(),f(a(),f(a(),u(a(),this._cosCoef[5],ut(6*e)),this._cosCoef[4],ut(5*e)),this._cosCoef[3],ut(4*e)),this._cosCoef[2],ut(3*e)),this._cosCoef[1],ut(2*e)),this._cosCoef[0],ut(e)),f(a(),f(a(),f(a(),f(a(),f(a(),u(a(),this._sinCoef[5],ft(6*e)),this._sinCoef[4],ft(5*e)),this._sinCoef[3],ft(4*e)),this._sinCoef[2],ft(3*e)),this._sinCoef[1],ft(2*e)),this._sinCoef[0],ft(e)))}dknot(t){const e=2*t*_t;return u(a(),l(a(),f(a(),f(a(),f(a(),f(a(),f(a(),u(a(),this._dcosCoef[5],ut(6*e)),this._dcosCoef[4],ut(5*e)),this._dcosCoef[3],ut(4*e)),this._dcosCoef[2],ut(3*e)),this._dcosCoef[1],ut(2*e)),this._dcosCoef[0],ut(e)),f(a(),f(a(),f(a(),f(a(),f(a(),u(a(),this._dsinCoef[5],ft(6*e)),this._dsinCoef[4],ft(5*e)),this._dsinCoef[3],ft(4*e)),this._dsinCoef[2],ft(3*e)),this._dsinCoef[1],ft(2*e)),this._dsinCoef[0],ft(e))),2*_t)}d2knot(t){const e=2*t*_t;return u(a(),l(a(),f(a(),f(a(),f(a(),f(a(),f(a(),u(a(),this._d2cosCoef[5],ut(6*e)),this._d2cosCoef[4],ut(5*e)),this._d2cosCoef[3],ut(4*e)),this._d2cosCoef[2],ut(3*e)),this._d2cosCoef[1],ut(2*e)),this._d2cosCoef[0],ut(e)),f(a(),f(a(),f(a(),f(a(),f(a(),u(a(),this._d2cosCoef[5],ft(6*e)),this._d2sinCoef[4],ft(5*e)),this._d2sinCoef[3],ft(4*e)),this._d2sinCoef[2],ft(3*e)),this._d2sinCoef[1],ft(2*e)),this._d2sinCoef[0],ft(e))),4*_t*_t)}c5_ptolemy(t){var e,i,n,s,r,o,a,h=[],d=new Array(5),c=new Array(9),l=new Array(9),_=new Array(4),u=new Array(14),f=new Array(9),p=new Array(4),v=new Array(14),g=[0,0,0,0,0],m=[0,0,0,0],x=[0,0,0,0],y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b=0,k=[0,0,0,0,0];for(let z=0;z<t.length;z++)for(g[0]=t[z][0],g[1]=t[z][1],g[2]=t[z][2],g[3]=t[z][3],g[4]=t[z][4],b=0;b<250&&!this.setvariables(g,d,l,c,_,u,f,p,v);){if(e=l[0]*l[8]+l[1]*l[6]-l[3]*l[4]+l[2]*l[4]+l[5]*l[1]-l[0]*l[7],this.gradient_ptolemy(l,u,m),this.hessian_ptolemy(l,u,f,v,y),Math.sqrt(Math.pow(m[0],2)+Math.pow(m[1],2)+Math.pow(m[2],2)+Math.pow(m[3],2))<1e-7||e<=1e-7){if(e>1e-7)break;var[w,C,M]=this.toCVR(this.knot(g[0]),this.knot(g[1]),this.knot(g[2]));h.push([g,w,C,M].flat());break}x=this.modified_Cholesky(y,m),o=0,n=1/.75,s=Math.sqrt(Math.pow(x[0],2)+Math.pow(x[1],2)+Math.pow(x[2],2)+Math.pow(x[3],2)),r=m[0]*x[0]+m[1]*x[1]+m[2]*x[2]+m[3]*x[3];do{for(n*=.75,o++,k[0]=g[0],i=0;i<4;i++)k[i+1]=g[i+1]-n*x[i];d[1]=this.knot(k[1]),d[2]=this.knot(k[2]),d[3]=this.knot(k[3]),d[4]=this.knot(k[4]),c[0]=xt(d[1],d[0]),c[1]=xt(d[2],d[0]),c[2]=xt(d[3],d[0]),c[3]=xt(d[4],d[0]),c[4]=xt(d[2],d[1]),c[5]=xt(d[3],d[1]),c[6]=xt(d[4],d[1]),c[7]=xt(d[3],d[2]),c[8]=xt(d[4],d[2]),l[0]=bt(c[0]),l[1]=bt(c[1]),l[2]=bt(c[2]),l[3]=bt(c[3]),l[4]=bt(c[4]),l[5]=bt(c[5]),l[6]=bt(c[6]),l[7]=bt(c[7]),l[8]=bt(c[8]),a=l[0]*l[8]+l[1]*l[6]-l[3]*l[4]+l[2]*l[4]+l[5]*l[1]-l[0]*l[7]}while(a>e-1e-4*n*r&&n*s>5e-6&&o<20);if(g=[k[0],k[1],k[2],k[3],k[4]],this.decim(g),this.proxim(g,2e-4))break;b++}return h}}function xt(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]}function yt(t,e){return[t[0]+e[0],t[1]+e[1],t[2]+e[2]]}function bt(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}function kt(t,e){return[t*e[0],t*e[1],t*e[2]]}function wt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}class Ct{constructor(){var t;this._loader=new dt,this._loader.initCallback(),this._linkedKnot=new J,this._fourierKnot=new ot,this._quintpules=new vt,this._webGPUCalc=new mt,this._freeze=!1,this._knotMenu=new Mt(this),this._knotMenu.initCallback(),this._exportData=document.getElementById("export-data"),null===(t=this._exportData)||void 0===t||t.addEventListener("click",(()=>{this.exportData()}))}get sceneType(){return this._knotMenu.sceneType}advanceScene(t){return e=this,i=void 0,s=function*(){if(this._freeze=!0,this.linkedKnot.selected=null,this.linkedKnot.drawingTool.Disable(!0),"Quintuples"===t){if(this.fourierKnot.calculated&&!this.fourierKnot.intersecting||(alert("Tried to find circles on incomplete knot"),this._knotMenu.sceneType="Fourier Knot"),this._loader.load(!0),yield dt.timeout(10),this._webGPUCalc.initKnot(this.fourierKnot.exportKIArr()),yield this._webGPUCalc.findCircles(this.quintuples,this._knotMenu.doubleCheck,this._knotMenu.maxCircles,this._knotMenu.knotDivision,this._loader),this._loader.load(!1),this._knotMenu.resetCircleOption(),!this._webGPUCalc.calculated)return this._knotMenu.sceneType="Fourier Knot",void(this._freeze=!1);this._knotMenu.sceneType="Quintuples",this.quintuples.player.reset()}else"Fourier Knot"===t&&(this.linkedKnot.isKnot||(alert("Tried to smoothen incomplete knot"),this._knotMenu.sceneType="Linked Knot"),this.fourierKnot.calcFourierFromLinked(this.linkedKnot.nodeArr),this._knotMenu.sceneType="Fourier Knot");this._freeze=!1},new((n=void 0)||(n=Promise))((function(t,r){function o(t){try{h(s.next(t))}catch(t){r(t)}}function a(t){try{h(s.throw(t))}catch(t){r(t)}}function h(e){var i;e.done?t(e.value):(i=e.value,i instanceof n?i:new n((function(t){t(i)}))).then(o,a)}h((s=s.apply(e,i||[])).next())}));var e,i,n,s}setPresetData(t,e,i){this._knotMenu.sceneType="Quintuples",this.fourierKnot.calcFourierFromLinked(i),this.quintuples.setFrameData(t,e)}drawScene(t,e,i){this._freeze||(t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),"Quintuples"==this.sceneType||i?(this._fourierKnot.draw(t,e),this._quintpules.draw(t,e)):"Fourier Knot"==this.sceneType?this._fourierKnot.draw(t,e):"Linked Knot"==this.sceneType&&this.linkedKnot.draw(t,e))}get linkedKnot(){return this._linkedKnot}get fourierKnot(){return this._fourierKnot}get quintuples(){return this._quintpules}get webGPUCalc(){return this._webGPUCalc}get transform_z(){return this.linkedKnot.transform_z}get knotMenu(){return this._knotMenu}set transform_z(t){this.linkedKnot.transform_z=t}get selected(){return this.linkedKnot.selected}get InsertOrConnect(){return this.linkedKnot.drawingTool.connectLast||this.linkedKnot.drawingTool.insert}get EraseOrSubdiv(){return this.linkedKnot.drawingTool.erase||this.linkedKnot.drawingTool.subdivide}get selectedNode(){return this.linkedKnot.selectedNode}btnManager(){this._knotMenu.disableAdvance(),this._knotMenu.disableDelete()}exportData(){const t={frames:this.quintuples.frames,knotDivision:this.quintuples.player.max,nodeArr:this.linkedKnot.nodeArr,wrongPolyList:this.webGPUCalc.wrongPoly},e=document.createElement("a");e.href=URL.createObjectURL(new Blob([JSON.stringify(t,null,2)],{type:"text/plain"})),e.setAttribute("download","data.knot"),document.body.appendChild(e),e.click(),document.body.removeChild(e)}}class Mt{constructor(t){this._scene=t,this._sceneType="Linked Knot",this._advance=document.getElementById("advance scene"),this._delete=document.getElementById("delete scene"),this._doubleCheck={overlay:document.getElementById("delete-check"),confirm:document.getElementById("delete-confirm"),cancel:document.getElementById("delete-cancel")},this._slider={linkedKnot:document.getElementById("Linked Knot"),fourierKnot:document.getElementById("Fourier Knot"),quintuples:document.getElementById("Quintuples")},this._slider.fourierKnot.disabled=!0,this._slider.quintuples.disabled=!0,this._circleOptions={overlay:document.getElementById("circle options"),doubleCheck:document.getElementById("double check box"),maxCircles:new ct("circle max dropdown",8),knotDivision:new ct("knotDivision",2e3),submit:document.getElementById("confirm calculate"),cancel:document.getElementById("cancel calculate")},this.sceneType="Linked Knot",this.cancelBtnResponse()}Disable(t){var e;null===(e=document.getElementById("scene manager"))||void 0===e||e.classList.toggle("hidden",t)}initCallback(){this._advance.addEventListener("click",(()=>{this.advanceBtnResponse()})),this._delete.addEventListener("click",(()=>{this.deleteBtnResponse()})),this._doubleCheck.confirm.addEventListener("click",(()=>{this.confirmBtnResponse()})),this._doubleCheck.cancel.addEventListener("click",(()=>{this.cancelBtnResponse()})),document.addEventListener("mousedown",(t=>{"Linked Knot"!==this.sceneType||this._doubleCheck.overlay.contains(t.target)||this._doubleCheck.overlay.classList.contains("hidden")||this._doubleCheck.overlay.classList.toggle("hidden",!0)})),this._slider.linkedKnot.addEventListener("click",(()=>{this.sceneSelect()})),this._slider.fourierKnot.addEventListener("click",(()=>{this.sceneSelect()})),this._slider.quintuples.addEventListener("click",(()=>{this.sceneSelect()})),this._circleOptions.submit.addEventListener("click",(()=>{this._circleOptions.overlay.classList.toggle("hidden",!0),this._scene.advanceScene("Quintuples")})),this._circleOptions.cancel.addEventListener("click",(()=>{this.resetCircleOption()}))}advanceBtnResponse(){"Linked Knot"===this.sceneType?this._scene.advanceScene("Fourier Knot"):"Fourier Knot"===this.sceneType&&this._circleOptions.overlay.classList.toggle("hidden",!1)}resetCircleOption(){this._circleOptions.knotDivision.reset(),this._circleOptions.maxCircles.reset(),this._circleOptions.doubleCheck.checked=!0,this._circleOptions.overlay.classList.toggle("hidden",!0)}get knotDivision(){return this._circleOptions.knotDivision.value}get maxCircles(){return this._circleOptions.maxCircles.value}get doubleCheck(){return this._circleOptions.doubleCheck.checked}deleteBtnResponse(){"Linked Knot"===this.sceneType&&this._doubleCheck.overlay.classList.toggle("hidden",!1)}confirmBtnResponse(){"Linked Knot"===this.sceneType&&(this._scene.linkedKnot.deleteData(),this._doubleCheck.overlay.classList.toggle("hidden",!0),this.disableDelete(),this.disableAdvance())}cancelBtnResponse(){this._doubleCheck.overlay.classList.toggle("hidden",!0)}disableDelete(){"Linked Knot"!=this.sceneType||this._scene.linkedKnot.isEmpty?this._delete.classList.toggle("hidden",!0):this._delete.classList.toggle("hidden",!1)}disableAdvance(){"Linked Knot"==this.sceneType?this._advance.disabled=!this._scene.linkedKnot.isKnot:"Fourier Knot"==this.sceneType&&(this._advance.disabled=this._scene.fourierKnot.intersecting)}sceneSelect(){this._slider.linkedKnot.checked?this.sceneType="Linked Knot":this._slider.fourierKnot.checked?this.sceneType="Fourier Knot":this._slider.quintuples.checked&&(this.sceneType="Quintuples")}get sceneType(){return this._sceneType}set sceneType(t){this._sceneType=t,"Linked Knot"==this.sceneType?(this._slider.linkedKnot.checked=!0,this._scene.linkedKnot.drawingTool.Disable(!1),this._scene.quintuples.player.Disable(!0),this._advance.textContent="Smoothen Knot"):"Fourier Knot"==this.sceneType?(this._slider.fourierKnot.disabled=!1,this._slider.fourierKnot.checked=!0,this._scene.linkedKnot.selected=null,this._scene.linkedKnot.drawingTool.Disable(!0),this._scene.quintuples.player.Disable(!0),this._advance.textContent="Find Circles"):"Quintuples"==this.sceneType&&(this._slider.quintuples.disabled=!1,this._slider.quintuples.checked=!0,this._scene.linkedKnot.selected=null,this._scene.linkedKnot.drawingTool.Disable(!0),this._scene.quintuples.player.Disable(!1)),this._advance.setAttribute("sceneType",this._sceneType),this.disableAdvance(),this.disableDelete(),this.resetCircleOption(),this._circleOptions.overlay.classList.toggle("hidden",!0)}}class zt{constructor(e){this.canvas=e,this.boundingClientRect=this.canvas.getBoundingClientRect(),this.gl=t.checkWebGL(this.canvas),this.programs={render:t.createProgram(this.gl,"precision mediump float;\r\nattribute vec4 aColor;\r\nattribute vec4 aNormal;\r\nattribute vec4 aPosition;\r\n\r\nuniform mat4 mWorld;\r\nuniform mat4 mView;\r\nuniform mat4 mProj;\r\n\r\n\r\nuniform mat3 uNormalMatrix;\r\n\r\nvarying vec4 vColor;\r\nvarying vec3 vNormal;\r\n\r\nvoid main() {\r\n    gl_Position = mProj * mView * mWorld * aPosition;\r\n\r\n    vColor = aColor;\r\n    vNormal = uNormalMatrix * vec3(aNormal);\r\n}","precision mediump float;\r\n\r\nuniform vec3 uDiffuseLight;\r\nuniform vec3 uLightPosition;\r\nuniform vec3 uAmbientLight;\r\n\r\nvarying vec4 vColor;\r\nvarying vec3 vNormal;\r\n\r\n\r\nvoid main() {\r\n    // Normalize the normal because it is interpolated and not 1.0 in length any more\r\n    vec3 normal = normalize(vNormal);\r\n\r\n    // Calculate the light direction and make its length 1.\r\n    vec3 lightDirection = uLightPosition;\r\n\r\n    // The dot product of the light direction and the orientation of a surface (the normal)\r\n    float nDotL = max(dot(lightDirection, normal), 0.0);\r\n\r\n    // Calculate the final color from diffuse reflection and ambient reflection\r\n    vec3 diffuse = uDiffuseLight * vColor.rgb * nDotL;\r\n    vec3 ambient = uAmbientLight * vColor.rgb;\r\n    gl_FragColor = vec4(diffuse + ambient, vColor.a);\r\n}")},this.scene=new Ct,this.ui={left_down:!1,wheel_down:!1,mouse:{lastX:0,lastY:0},doubleClick:{click:!1,sameObj:!1,lastX:0,lastY:0},shift:!1,space:!1},this._fps={fpsLimit:30,prev:0},this._infoPage={hidden:!0,overlay:document.getElementById("about overlay"),btn:document.getElementById("about button"),exit:document.getElementById("info-exit")},this._presetPage={preset:!1,presetOverlay:document.getElementById("preset-overlay")}}Initialize(){this.scene.webGPUCalc.Initialize(),this.initPreLoadCallbacks()}initGL(){this.gl.clearColor(.9855,.9867,.9812,1),this.gl.enable(this.gl.DEPTH_TEST),this.gl.useProgram(this.programs.render),T.setLight(this.gl,this.programs.render,[50,50,50]),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.blendEquation(this.gl.FUNC_ADD)}initPreLoadCallbacks(){var t;document.addEventListener("click",(t=>{var e,i;if(this._infoPage.btn.contains(t.target))return this._infoPage.overlay.classList.toggle("hidden",!1),this._infoPage.hidden=!1,void(this._infoPage.overlay.querySelector("#info-content").scrollTop=0);this._infoPage.exit.contains(t.target)?(this._infoPage.overlay.classList.toggle("hidden",!0),this._infoPage.hidden=!0):this._infoPage.hidden||(null===(e=this._infoPage.overlay.querySelector("#info-content"))||void 0===e?void 0:e.contains(t.target))||(null===(i=this._infoPage.overlay.querySelector("#info-menu"))||void 0===i?void 0:i.contains(t.target))||(this._infoPage.overlay.classList.toggle("hidden",!0),this._infoPage.hidden=!0)})),null===(t=document.getElementById("camera button"))||void 0===t||t.addEventListener("click",(()=>{this.camera.reset=!0}));const e=this._presetPage.presetOverlay.querySelectorAll(".button");for(let t=0;t<e.length;t++){let i=e[t];i.addEventListener("click",(()=>{const t=i.getAttribute("value");if("New Knot"===t)window.addEventListener("beforeunload",(t=>{t.returnValue=!0})),this._presetPage.preset=!1,this.scene.knotMenu.Disable(!1),this.run();else{const e=new Request(t||"");fetch(e).then((t=>t.json())).then((t=>{return e=this,i=void 0,s=function*(){const e=document.getElementById("loader2");null==e||e.classList.toggle("hidden",!1),yield dt.timeout(10),this.scene.setPresetData(t.frames,t.knotDivision,t.nodeArr),this._presetPage.preset=!0,yield dt.timeout(3e3),null==e||e.classList.toggle("hidden",!0),yield dt.timeout(10),this.run()},new((n=void 0)||(n=Promise))((function(t,r){function o(t){try{h(s.next(t))}catch(t){r(t)}}function a(t){try{h(s.throw(t))}catch(t){r(t)}}function h(e){var i;e.done?t(e.value):(i=e.value,i instanceof n?i:new n((function(t){t(i)}))).then(o,a)}h((s=s.apply(e,i||[])).next())}));var e,i,n,s})).catch(console.error)}}))}}initCallbacks(){this.canvas.addEventListener("mousedown",(t=>{this.mouseDown(t)})),document.addEventListener("mouseup",(t=>{this.mouseUp(t)})),document.addEventListener("click",(t=>{t.target.id==this.canvas.id&&this.ui.doubleClick.click&&(this.scene.InsertOrConnect||this.scene.EraseOrSubdiv?this.scene.linkedKnot.btnManager():this.ui.doubleClick.sameObj&&(this.scene.transform_z=!this.scene.transform_z)),this.scene.btnManager(),this.ui.doubleClick.sameObj=!1,this.configCamera()})),document.addEventListener("mousemove",(t=>{this.mouseMove(t)})),document.addEventListener("keydown",(t=>{this.keyDown(t)})),document.addEventListener("keyup",(t=>{this.keyUp(t)})),window.addEventListener("resize",(()=>{this.resizer()})),this.canvas.addEventListener("wheel",(t=>{this.zoom(t),1==t.ctrlKey&&t.preventDefault()}),{passive:!1})}configCamera(){this.camera.update(this.gl,this.programs.render,this.canvas.width,this.canvas.height),this.camera.setRay()}run(){var t;this._presetPage.presetOverlay.classList.toggle("hidden",!0),null===(t=document.getElementById("container"))||void 0===t||t.classList.toggle("hidden",!1),this.camera=new S,this._presetPage.preset&&this.camera.changeBase({theta:.7,phi:.7,radius:16,trans:[0,0,0]}),this.initGL(),this.initCallbacks(),this.resizer(),requestAnimationFrame(this.animate.bind(this))}animate(t){requestAnimationFrame(this.animate.bind(this)),this.camera.reset&&this.camera.resetCam(this.gl,this.programs.render,this.canvas.width,this.canvas.height),t-this._fps.prev<1e3/this._fps.fpsLimit-.1||this.scene.drawScene(this.gl,this.programs.render,this._presetPage.preset)}keyDown(t){this.ui.shift=t.shiftKey,("Delete"===t.key||"Backspace"===t.key)&&this.scene.linkedKnot.delete()," "!=t.key&&"Space"!=t.code&&32!=t.keyCode||(this.ui.space=!0),("="==t.key&&1==t.ctrlKey||"-"==t.key&&1==t.ctrlKey)&&t.preventDefault()}keyUp(t){this.ui.shift=t.shiftKey," "!=t.key&&"Space"!=t.code||(this.ui.space=!1,"Quintuples"==this.scene.sceneType&&(this.scene.quintuples.player.play=!this.scene.quintuples.player.play))}mouseDown(t){if(this.camera.reset&&(this.camera.reset=!1,this.configCamera()),this.ui.doubleClick.click=!0,this.ui.doubleClick.lastX=t.clientX,this.ui.doubleClick.lastY=t.clientY,0==t.button){this.ui.left_down=!0;const h=this.scene.selected;if("Linked Knot"==this.scene.sceneType&&!this.scene.InsertOrConnect){const{relx:h,rely:d}=e.pixelInputToGLCoord(t,this.boundingClientRect);var i=o(s(),[h,d,-1,1],this.camera.toWorld),n=o(s(),[h,d,1,1],this.camera.toWorld);r(i,i,1/i[3]),r(n,n,1/n[3]);const c=_(a(),[n[0],n[1],n[2]],[i[0],i[1],i[2]]);this.scene.linkedKnot.pickObj(c,this.camera.absPos)}h===this.scene.selected&&(this.scene.selectedNode||this.ui.shift)&&(this.ui.doubleClick.sameObj=!0)}1==t.button&&(this.ui.wheel_down=!0)}mouseUp(t){0==t.button&&(this.ui.left_down=!1),1==t.button&&(this.ui.wheel_down=!1),this.camera.setRay()}checkClick(t,e,i=25){const n=Math.abs(t-this.ui.doubleClick.lastX),s=Math.abs(e-this.ui.doubleClick.lastY);return n<i&&s<i}mouseMove(t){const i=t.clientX,n=t.clientY;if(this.scene.selectedNode||!this.ui.left_down&&!this.ui.wheel_down){if("Linked Knot"==this.scene.sceneType&&(this.scene.InsertOrConnect||this.scene.EraseOrSubdiv)&&(this.ui.left_down||this.ui.wheel_down)){if(this.ui.doubleClick.click)return void(this.ui.doubleClick.click=this.checkClick(i,n));const t=1/this.canvas.height,e=t*(i-this.ui.mouse.lastX),s=t*(n-this.ui.mouse.lastY);this.ui.left_down&&!this.ui.shift?(this.camera.addAngle(e,s),this.camera.update(this.gl,this.programs.render,this.canvas.width,this.canvas.height)):(this.ui.wheel_down||this.ui.shift&&this.ui.left_down)&&(this.camera.transform(e,s,this.scene.transform_z),this.camera.update(this.gl,this.programs.render,this.canvas.width,this.canvas.height))}else if("Linked Knot"==this.scene.sceneType&&this.scene.selectedNode&&(this.ui.left_down||this.scene.InsertOrConnect)){if(this.ui.doubleClick.click)return void(this.ui.doubleClick.click=this.checkClick(i,n,3));const{relx:c,rely:l}=e.pixelInputToGLCoord(t,this.boundingClientRect);var h=o(s(),[c,l,-1,1],this.camera.toWorld),d=o(s(),[c,l,1,1],this.camera.toWorld);r(h,h,1/h[3]),r(d,d,1/d[3]);const u=_(a(),[d[0],d[1],d[2]],[h[0],h[1],h[2]]);this.scene.linkedKnot.moveNode(u,this.camera.absPos,this.camera.normal)}}else{const t=1/this.canvas.height,e=t*(i-this.ui.mouse.lastX),s=t*(n-this.ui.mouse.lastY);this.ui.left_down&&!this.ui.shift?(this.camera.addAngle(e,s),this.camera.update(this.gl,this.programs.render,this.canvas.width,this.canvas.height),this.ui.doubleClick.click=!1):(this.ui.wheel_down||this.ui.shift&&this.ui.left_down)&&(this.ui.doubleClick.click&&(this.ui.doubleClick.click=this.checkClick(i,n,3)),this.camera.transform(e,s,this.scene.transform_z),this.camera.update(this.gl,this.programs.render,this.canvas.width,this.canvas.height))}this.ui.mouse.lastX=i,this.ui.mouse.lastY=n}zoom(t){this.camera.reset=!1,this.camera.addRadius(t.deltaY),this.configCamera()}resizer(){this.scene.quintuples.player.resize(),this.resizeCanvasToDisplaySize(),this.configCamera(),this.boundingClientRect=this.canvas.getBoundingClientRect()}resizeCanvasToDisplaySize(){const t=window.devicePixelRatio,{width:e,height:i}=this.canvas.getBoundingClientRect(),n=Math.round(e*t),s=Math.round(i*t);this.canvas.width=n,this.canvas.height=s}}const Lt=document.getElementById("gfx-main"),Et=document.getElementById("error-screen");let Bt=!1;var At;if(At=navigator.userAgent,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(At)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(At.substr(0,4)))&&(Bt=!0),Bt)throw Et.textContent="Mobile and Tablets not supported.",Et.classList.remove("hidden"),new Error("Use chrome on PC");!function(){var t,e,i,n;t=this,e=void 0,n=function*(){try{new zt(Lt).Initialize()}catch(t){throw console.log(t),Et.textContent=t.message+"\n\n Try a new version of Chrome.",Et.classList.remove("hidden"),new Error("Quit app due to error.")}},new((i=void 0)||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))}()})(),t=w(91),e=w.n(t),i=new URL(w(987),w.b),n=new URL(w(951),w.b),s=new URL(w(36),w.b),r=new URL(w(682),w.b),o=new URL(w(778),w.b),a=new URL(w(705),w.b),h=new URL(w(917),w.b),d=new URL(w(231),w.b),c=new URL(w(118),w.b),l=new URL(w(5),w.b),_=new URL(w(337),w.b),u=new URL(w(517),w.b),f=new URL(w(994),w.b),p=new URL(w(873),w.b),v=new URL(w(856),w.b),g=new URL(w(282),w.b),m=new URL(w(794),w.b),x=new URL(w(302),w.b),y=new URL(w(349),w.b),e()(i),e()(n),e()(s),e()(r),e()(o),e()(a),e()(h),e()(d),e()(c),e()(l),e()(_),e()(u),e()(f),e()(p),e()(v),e()(g),e()(m),e()(x),e()(y)})();